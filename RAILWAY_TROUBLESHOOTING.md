# Railway éƒ¨ç½²æ•…éšœæ’æŸ¥

## é—®é¢˜ï¼šè®¿é—® Railway URL å‡ºç° 404 é”™è¯¯

### åŸå› åˆ†æ

å½“è®¿é—® `https://your-app.up.railway.app/` æ—¶å‡ºç° 404 é”™è¯¯ï¼Œè¯´æ˜ï¼š
1. âœ… æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. âŒ é™æ€æ–‡ä»¶è·¯å¾„é…ç½®æœ‰é—®é¢˜

### æ ¹æœ¬åŸå› 

`server/server.js` ä¸­çš„é™æ€æ–‡ä»¶è·¯å¾„é…ç½®ä¾èµ– `NODE_ENV` ç¯å¢ƒå˜é‡ï¼š

```javascript
const webPath = process.env.NODE_ENV === 'production' 
  ? path.join(__dirname, 'web')      // ç”Ÿäº§ç¯å¢ƒï¼š/app/web
  : path.join(__dirname, '../web');  // å¼€å‘ç¯å¢ƒï¼š/app/../web
```

**å¦‚æœ Railway æ²¡æœ‰è®¾ç½® `NODE_ENV=production`ï¼ŒæœåŠ¡å™¨ä¼šå°è¯•ä» `/app/../web` è¯»å–æ–‡ä»¶ï¼Œä½†è¯¥è·¯å¾„ä¸å­˜åœ¨ï¼**

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

åœ¨ Railway é¡¹ç›®ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

1. è¿›å…¥ Railway é¡¹ç›®æ§åˆ¶å°
2. é€‰æ‹©æ‚¨çš„æœåŠ¡
3. ç‚¹å‡» **"Variables"** æ ‡ç­¾
4. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   ```
   NODE_ENV=production
   ```
5. é‡æ–°éƒ¨ç½²

#### æ–¹æ¡ˆ 2ï¼šä¿®æ”¹ä»£ç ï¼ˆæ›´å¯é ï¼‰

ä¿®æ”¹ `server/server.js`ï¼Œè®©å®ƒè‡ªåŠ¨æ£€æµ‹ Railway ç¯å¢ƒæˆ–é»˜è®¤ä½¿ç”¨ Docker è·¯å¾„ï¼š

```javascript
// æ”¹è¿›çš„è·¯å¾„æ£€æµ‹é€»è¾‘
const path = require('path');
const fs = require('fs');

// ä¼˜å…ˆæ£€æŸ¥ ./web ç›®å½•ï¼ˆDocker éƒ¨ç½²è·¯å¾„ï¼‰
const dockerWebPath = path.join(__dirname, 'web');
const devWebPath = path.join(__dirname, '../web');

let webPath;
if (fs.existsSync(dockerWebPath)) {
  webPath = dockerWebPath;
  console.log('ğŸ“ ä½¿ç”¨ Docker éƒ¨ç½²è·¯å¾„:', dockerWebPath);
} else if (fs.existsSync(devWebPath)) {
  webPath = devWebPath;
  console.log('ğŸ“ ä½¿ç”¨å¼€å‘è·¯å¾„:', devWebPath);
} else {
  console.error('âŒ é”™è¯¯: æ‰¾ä¸åˆ° web ç›®å½•ï¼');
  process.exit(1);
}

app.use(express.static(webPath));
```

### éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—**
   - åœ¨ Railway æ§åˆ¶å°æŸ¥çœ‹ Runtime Logs
   - åº”è¯¥çœ‹åˆ°ï¼š`ğŸ“ ä½¿ç”¨ Docker éƒ¨ç½²è·¯å¾„: /app/web`

2. **æµ‹è¯•å¥åº·æ£€æŸ¥**
   ```
   curl https://your-app.up.railway.app/health
   ```
   åº”è¯¥è¿”å›ï¼š`{"status":"ok","message":"æœåŠ¡å™¨è¿è¡Œæ­£å¸¸"}`

3. **æµ‹è¯•é™æ€æ–‡ä»¶**
   ```
   curl https://your-app.up.railway.app/index.html
   ```
   åº”è¯¥è¿”å› HTML å†…å®¹

4. **æµè§ˆå™¨è®¿é—®**
   ```
   https://your-app.up.railway.app/
   ```
   åº”è¯¥æ˜¾ç¤ºæ–°é—»åˆ—è¡¨é¡µé¢

### å…¶ä»–å¯èƒ½çš„é—®é¢˜

#### é—®é¢˜ 1ï¼šDocker æ„å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼šæ„å»ºæ—¥å¿—æ˜¾ç¤º "COPY web/ ./web/: not found"

**åŸå› **ï¼š`.dockerignore` æ’é™¤äº† `web/` ç›®å½•

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ `.dockerignore` ä¸­**æ²¡æœ‰** `web/` è¿™ä¸€è¡Œ

#### é—®é¢˜ 2ï¼šRailway ä½¿ç”¨äº†æ—§çš„æäº¤

**ç—‡çŠ¶**ï¼šä¿®æ”¹åé‡æ–°éƒ¨ç½²ä»ç„¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ä»£ç å·²æ¨é€åˆ° GitHubï¼š`git push origin main`
2. åœ¨ Railway æ§åˆ¶å°æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
3. æ£€æŸ¥ Railway æ˜¾ç¤ºçš„ commit hash æ˜¯å¦æ˜¯æœ€æ–°çš„

#### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šæœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å·²åœ¨ Railway ä¸­æ·»åŠ  PostgreSQL æœåŠ¡
2. æ£€æŸ¥ `DATABASE_URL` ç¯å¢ƒå˜é‡æ˜¯å¦å·²è‡ªåŠ¨è®¾ç½®
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

## å¿«é€Ÿè¯Šæ–­å‘½ä»¤

åœ¨ Railway æ§åˆ¶å°çš„æ—¥å¿—ä¸­ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

```bash
# 1. æœåŠ¡å™¨å¯åŠ¨ä¿¡æ¯
âœ… æœåŠ¡å™¨å·²å¯åŠ¨
   ç›‘å¬åœ°å€: 0.0.0.0:3000
   Railway éƒ¨ç½²åœ°å€: https://...

# 2. é™æ€æ–‡ä»¶è·¯å¾„
ğŸ“ ä½¿ç”¨ Docker éƒ¨ç½²è·¯å¾„: /app/web

# 3. æ•°æ®åº“è¿æ¥
âœ… å·²è¿æ¥åˆ° PostgreSQL æ•°æ®åº“
```

å¦‚æœç¼ºå°‘ä»¥ä¸Šä»»ä½•ä¿¡æ¯ï¼Œè¯´æ˜å¯¹åº”çš„åŠŸèƒ½æœ‰é—®é¢˜ã€‚

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·ï¼š

1. å¯¼å‡º Railway çš„å®Œæ•´éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥ GitHub æœ€æ–°æäº¤çš„ commit hash
3. æˆªå›¾é”™è¯¯ä¿¡æ¯
4. æä¾›ä»¥ä¸Šä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥è¯Šæ–­
