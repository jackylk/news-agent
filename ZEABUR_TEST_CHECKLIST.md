# Zeabur 部署后测试清单

部署到 Zeabur 后，请按以下清单逐项测试，确保所有功能正常运行。

## 📋 部署前检查

在开始测试前，确认以下部署状态：

- [ ] 应用服务显示为"运行中"（绿色状态）
- [ ] PostgreSQL 服务显示为"运行中"（绿色状态）
- [ ] 已配置环境变量 `JWT_SECRET`
- [ ] 已配置环境变量 `ADMIN_TOKEN`
- [ ] 已开启 Public Networking（公网访问）
- [ ] 已获得分配的域名（如 `https://news-agent-xxxxx.zeabur.app`）

**查看日志**：在 Zeabur 控制台查看应用日志，确认：
- [ ] 显示 "✅ 已连接到 PostgreSQL 数据库"
- [ ] 显示 "数据库表初始化完成"
- [ ] 显示 "服务器运行在端口 xxxx"
- [ ] 没有错误信息（❌）

---

## 1️⃣ 基础健康检查

### 1.1 健康检查接口

**测试 URL**：`https://你的域名/health`

**预期结果**：
```json
{
  "status": "ok",
  "message": "服务器运行正常"
}
```

**测试步骤**：
- [ ] 在浏览器中访问健康检查 URL
- [ ] 验证返回 JSON 格式正确
- [ ] HTTP 状态码为 200

---

## 2️⃣ 前端页面测试

### 2.1 首页访问

**测试 URL**：`https://你的域名/`

**测试步骤**：
- [ ] 页面能正常加载，无 404 或 500 错误
- [ ] 页面标题显示正确
- [ ] 页面样式加载正常（CSS）
- [ ] 页面布局正常，无明显错误

### 2.2 其他前端页面

测试所有静态页面是否可访问：

- [ ] `/index.html` - 新闻首页
- [ ] `/admin.html` - 管理后台
- [ ] `/dashboard.html` - 用户面板
- [ ] `/login.html` - 登录页面
- [ ] `/topics.html` - 主题管理
- [ ] `/subscriptions.html` - 订阅管理
- [ ] `/article.html` - 文章详情页

**预期结果**：所有页面都能正常加载，无 404 错误

---

## 3️⃣ 数据库连接测试

### 3.1 验证数据库初始化

**查看日志**：
- [ ] 日志中显示 "📦 使用独立环境变量连接数据库" 或 "📦 使用 DATABASE_URL 连接数据库"
- [ ] 日志中显示 "✅ 已连接到 PostgreSQL 数据库"
- [ ] 日志中显示 "数据库表初始化完成"
- [ ] 没有 "❌ 数据库连接失败" 错误

### 3.2 测试数据库表创建

通过 API 测试数据库是否正常工作：

**测试 URL**：`https://你的域名/api/news?limit=10`

**预期结果**：
- [ ] 返回 JSON 数组（即使是空数组 `[]`）
- [ ] 没有数据库错误信息
- [ ] HTTP 状态码为 200

---

## 4️⃣ 用户认证功能测试

### 4.1 用户注册

**页面**：`https://你的域名/login.html`（切换到注册标签）

**测试步骤**：
1. [ ] 填写用户名、邮箱、密码
2. [ ] 点击"注册"按钮
3. [ ] 验证注册成功提示
4. [ ] 验证自动跳转到首页或面板

**注意**：记录测试账号信息，用于后续测试

### 4.2 用户登录

**页面**：`https://你的域名/login.html`

**测试步骤**：
1. [ ] 使用注册的用户名/邮箱和密码登录
2. [ ] 验证登录成功提示
3. [ ] 验证自动跳转到用户面板
4. [ ] 检查是否保存登录状态（刷新页面仍保持登录）

### 4.3 Token 验证

**测试方法**：
- [ ] 登录后查看浏览器 localStorage，确认存储了 `token`
- [ ] 访问需要登录的页面（如 `/dashboard.html`），验证无需再次登录

---

## 5️⃣ 管理后台测试

### 5.1 管理员访问

**页面**：`https://你的域名/admin.html`

**测试步骤**：
1. [ ] 输入你在环境变量中设置的 `ADMIN_TOKEN`
2. [ ] 验证能成功进入管理后台
3. [ ] 页面显示管理功能界面

### 5.2 新闻源管理

在管理后台测试：
- [ ] 查看新闻源列表
- [ ] 添加新的新闻源
- [ ] 编辑现有新闻源
- [ ] 删除新闻源
- [ ] 验证操作后数据正确保存

### 5.3 手动触发新闻收集

**测试步骤**：
1. [ ] 在管理后台找到"手动收集新闻"功能
2. [ ] 点击触发收集
3. [ ] 观察收集进度（如有进度显示）
4. [ ] 验证收集完成后，新闻列表有新数据

**或通过 API 测试**：
```bash
curl -X POST https://你的域名/api/collect \
  -H "Content-Type: application/json"
```

- [ ] 返回收集日志或成功信息
- [ ] 查看日志确认爬虫运行正常

---

## 6️⃣ 用户功能测试

### 6.1 主题订阅

**页面**：`https://你的域名/topics.html`（需先登录）

**测试步骤**：
1. [ ] 创建新主题（如 "AI"、"区块链" 等）
2. [ ] 验证主题保存成功
3. [ ] 查看主题列表
4. [ ] 编辑主题
5. [ ] 删除主题

### 6.2 新闻源订阅

**页面**：`https://你的域名/subscriptions.html`（需先登录）

**测试步骤**：
1. [ ] 添加自定义新闻源
2. [ ] 选择关联的主题
3. [ ] 验证订阅保存成功
4. [ ] 查看订阅列表
5. [ ] 取消订阅

### 6.3 个性化新闻推送

**页面**：`https://你的域名/dashboard.html`

**测试步骤**：
1. [ ] 查看基于订阅主题的个性化新闻
2. [ ] 验证新闻与订阅主题相关
3. [ ] 测试筛选和排序功能

---

## 7️⃣ API 接口测试

### 7.1 新闻列表 API

**测试 URL**：`https://你的域名/api/news?limit=10`

**测试要点**：
- [ ] 返回 JSON 数组
- [ ] 包含新闻字段：`id`, `title`, `content`, `url`, `publish_date` 等
- [ ] 数据格式正确

### 7.2 新闻详情 API

**测试 URL**：`https://你的域名/api/news/1`（假设存在 ID 为 1 的新闻）

**测试要点**：
- [ ] 返回单条新闻的完整信息
- [ ] 包含内容、摘要等详细字段

### 7.3 用户 API（需登录）

使用登录后获得的 token 测试：

```bash
curl https://你的域名/api/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**测试要点**：
- [ ] 返回用户信息
- [ ] 包含用户名、邮箱等字段

---

## 8️⃣ 爬虫功能测试

### 8.1 RSS 爬虫

**测试方法**：
1. [ ] 在管理后台添加一个 RSS 新闻源（如 TechCrunch RSS）
2. [ ] 手动触发新闻收集
3. [ ] 查看日志，确认 RSS 解析成功
4. [ ] 验证新闻列表中出现新采集的文章

### 8.2 网页爬虫

**测试方法**：
1. [ ] 添加一个网页类型的新闻源
2. [ ] 触发收集
3. [ ] 查看日志，确认爬虫访问页面成功
4. [ ] 验证提取到的内容正确

### 8.3 Puppeteer 爬虫（JavaScript 渲染）

**测试方法**：
1. [ ] 添加需要 JavaScript 渲染的新闻源
2. [ ] 触发收集
3. [ ] 查看日志，确认 Chromium 启动成功
4. [ ] 验证动态内容被正确提取

**重要**：查看日志确认：
- [ ] 没有 "Chromium not found" 错误
- [ ] 没有 "Failed to launch browser" 错误

---

## 9️⃣ 定时任务测试

### 9.1 Cron 任务配置

**查看日志**：
- [ ] 日志中显示 "定时任务已启动"
- [ ] 显示定时任务时间配置（如 "每天凌晨 2:00"）

### 9.2 验证定时执行

**测试方法**（可选，需等待定时触发）：
1. [ ] 等待定时任务触发时间
2. [ ] 查看日志确认自动执行
3. [ ] 验证新闻自动更新

**或修改定时配置测试**：
- 临时修改 `server/server.js` 中的 cron 表达式为每 5 分钟执行一次
- 重新部署
- 观察 5 分钟后是否自动执行

---

## 🔟 性能与稳定性测试

### 10.1 响应时间

**测试要点**：
- [ ] 首页加载时间 < 3 秒
- [ ] API 响应时间 < 1 秒
- [ ] 新闻列表加载时间 < 2 秒

### 10.2 并发访问

**测试方法**：
- [ ] 多个浏览器标签同时访问
- [ ] 验证没有崩溃或错误
- [ ] 所有请求都能正常响应

### 10.3 数据库连接稳定性

**测试方法**：
- [ ] 长时间运行（1 小时以上）
- [ ] 查看日志无数据库连接超时
- [ ] 查看日志无连接池耗尽错误

---

## 1️⃣1️⃣ 数据持久化测试

### 11.1 重启应用后数据保留

**测试步骤**：
1. [ ] 在应用中创建一些测试数据（用户、主题、订阅等）
2. [ ] 在 Zeabur 控制台重启应用服务
3. [ ] 等待应用重新启动
4. [ ] 验证之前创建的数据仍然存在
5. [ ] 验证数据库连接正常

### 11.2 PostgreSQL 数据持久化

**验证要点**：
- [ ] 应用重新部署后，数据库数据不丢失
- [ ] 新闻、用户、订阅等数据完整保留

---

## 1️⃣2️⃣ 错误处理测试

### 12.1 404 错误

**测试 URL**：`https://你的域名/nonexistent-page`

**预期结果**：
- [ ] 返回 404 状态码
- [ ] 显示友好的错误页面或信息

### 12.2 API 错误处理

**测试场景**：
- [ ] 访问不存在的新闻 ID：`/api/news/99999`
- [ ] 未登录访问需要登录的 API
- [ ] 使用无效的 Admin Token 访问管理接口

**预期结果**：返回适当的错误状态码和错误信息

### 12.3 数据库错误恢复

**测试方法**（谨慎操作）：
- [ ] 在日志中观察是否有数据库重连机制
- [ ] 验证临时连接失败后能自动恢复

---

## 1️⃣3️⃣ 安全性测试

### 13.1 环境变量保护

**验证要点**：
- [ ] 无法通过 API 获取 `JWT_SECRET`
- [ ] 无法通过 API 获取 `ADMIN_TOKEN`
- [ ] 无法通过 API 获取数据库密码

### 13.2 身份验证保护

**测试场景**：
- [ ] 未登录时无法访问用户专属功能
- [ ] 使用错误的 token 无法访问受保护的 API
- [ ] 密码在传输和存储中加密

### 13.3 SQL 注入防护

**测试方法**：
- [ ] 尝试在搜索框中输入 SQL 语句（如 `' OR '1'='1`）
- [ ] 验证应用不会执行恶意 SQL
- [ ] 参数查询使用参数化查询（已在代码中实现）

---

## ✅ 测试完成检查表

完成所有测试后，确认：

- [ ] ✅ 所有基础功能正常
- [ ] ✅ 数据库连接稳定
- [ ] ✅ 用户认证工作正常
- [ ] ✅ 管理后台可访问
- [ ] ✅ 爬虫功能正常（RSS、网页、Puppeteer）
- [ ] ✅ API 接口响应正确
- [ ] ✅ 前端页面显示正常
- [ ] ✅ 数据持久化正常
- [ ] ✅ 没有严重的错误或警告
- [ ] ✅ 性能在可接受范围内

---

## 🐛 问题排查

如果测试过程中遇到问题，请参考：

1. **查看 Zeabur 日志**：Zeabur 控制台 → 应用服务 → Logs
2. **查看 `ZEABUR_DEPLOY.md` 的故障排查章节**
3. **常见问题**：
   - 数据库连接失败 → 检查 PostgreSQL 服务状态和环境变量
   - 爬虫失败 → 查看日志中 Chromium 相关错误
   - 页面 404 → 确认静态文件正确复制到 `web/` 目录
   - API 错误 → 检查后端日志和数据库连接

---

## 📝 测试记录

**部署信息**：
- 部署时间：____________________
- Zeabur 域名：____________________
- PostgreSQL 版本：____________________

**测试结果**：
- 通过测试项：_____ / _____
- 发现的问题：____________________
- 解决方案：____________________

---

## 🎉 测试通过

恭喜！所有测试通过后，你的应用已成功部署到 Zeabur，可以正常使用了。

**建议的后续操作**：
1. 绑定自定义域名（可选）
2. 配置 DEEPSEEK_API_KEY 启用 AI 摘要功能（可选）
3. 设置监控和告警（使用 Zeabur 或第三方服务）
4. 定期备份数据库数据
5. 监控应用日志，及时发现和解决问题
