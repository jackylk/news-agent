<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ªäººä¿¡æ¯æ•´ç† - ä»ªè¡¨ç›˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%);
      color: #333;
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    /* å·¦ä¾§èœå• */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #ffffff 0%, #faf5ff 100%);
      box-shadow: 2px 0 12px rgba(139, 92, 246, 0.15);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid #eee;
    }

    .sidebar-header h1 {
      font-size: 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .user-info {
      font-size: 14px;
      color: #666;
    }

    .sidebar-menu {
      flex: 1;
      padding: 20px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.08) 0%, rgba(139, 92, 246, 0.03) 100%);
    }

    .menu-item.active {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      border-left-color: #8B5CF6;
      color: #8B5CF6;
    }

    .menu-item-icon {
      width: 20px;
      margin-right: 12px;
      font-size: 18px;
    }

    .menu-item-text {
      font-size: 15px;
      font-weight: 500;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid #eee;
    }

    .logout-btn {
      width: 100%;
      padding: 10px;
      background-color: #f5f5f5;
      color: #666;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #e0e0e0;
    }

    /* ä¸»å†…å®¹åŒº */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 0;
      min-height: 100vh;
    }

    .content-page {
      display: none;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .content-page.active {
      display: block;
    }

    .page-header {
      margin-bottom: 24px;
    }

    .page-header h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }

    .page-header p {
      color: #666;
      font-size: 14px;
    }

    /* è®¢é˜…ç®¡ç†é¡µé¢æ ·å¼ */
    .section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.1);
      margin-bottom: 20px;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }

    .section h3 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .add-topic-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .add-topic-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    /* å¼¹çª—æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f0f0f0;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: #e0e0e0;
      color: #333;
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .input-group input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
    }

    .input-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .btn-primary {
      padding: 12px 24px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .topics-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
    }

    .topic-tag {
      padding: 8px 16px;
      background-color: #f0f0f0;
      border-radius: 20px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .topic-tag .remove-btn {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topic-tag .remove-btn:hover {
      color: #c33;
    }

    .recommendations-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .recommendations-table th,
    .recommendations-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .recommendations-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
    }

    .recommendations-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .recommendations-table tr.invalid-row {
      background-color: #f5f5f5;
      opacity: 0.6;
      color: #999;
      display: none; /* é»˜è®¤éšè—æ— æ•ˆä¿¡æ¯æº */
    }
    
    .recommendations-table.show-invalid tr.invalid-row {
      display: table-row; /* å½“è¡¨æ ¼æœ‰show-invalidç±»æ—¶æ˜¾ç¤ºæ— æ•ˆä¿¡æ¯æº */
    }
    
    .recommendations-table tr.invalid-row:hover {
      background-color: #f0f0f0;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox {
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox:disabled {
      cursor: not-allowed;
    }

    .invalid-sources-toggle {
      margin-left: 16px;
      padding: 6px 12px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      color: #6c757d;
      transition: all 0.2s;
    }

    .invalid-sources-toggle:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .checkbox-cell {
      width: 50px;
      text-align: center;
    }

    /* é™åˆ¶ä¿¡æ¯æºåç§°åˆ—çš„å®½åº¦ */
    .recommendations-table th:nth-child(2),
    .recommendations-table td:nth-child(2) {
      width: 200px;
      max-width: 200px;
      min-width: 200px;
    }
    
    .recommendations-table td:nth-child(2) .source-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    
    .recommendations-table td:nth-child(2) .source-url {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    /* å›ºå®šåœ°åŒºåˆ—å®½åº¦ï¼ˆç¬¬4åˆ—ï¼šcheckbox=1, ä¿¡æ¯æº=2, ç±»å‹=3, åœ°åŒº=4ï¼‰ */
    .recommendations-table th:nth-child(4),
    .recommendations-table td:nth-child(4) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(4) .source-region {
      white-space: nowrap;
      display: inline-block;
    }

    /* å›ºå®šæœ‰æ•ˆæ€§åˆ—å®½åº¦ï¼ˆç¬¬6åˆ—ï¼šcheckbox=1, ä¿¡æ¯æº=2, ç±»å‹=3, åœ°åŒº=4, æè¿°=5, æœ‰æ•ˆæ€§=6ï¼‰ */
    .recommendations-table th:nth-child(6),
    .recommendations-table td:nth-child(6) {
      width: 100px;
      max-width: 100px;
      min-width: 100px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(6) .source-validity {
      white-space: nowrap;
      display: inline-block;
    }
    
    /* å›ºå®šçŠ¶æ€åˆ—å®½åº¦ï¼ˆç¬¬7åˆ—ï¼šcheckbox=1, ä¿¡æ¯æº=2, ç±»å‹=3, åœ°åŒº=4, æè¿°=5, æœ‰æ•ˆæ€§=6, çŠ¶æ€=7ï¼‰ */
    .recommendations-table th:nth-child(7),
    .recommendations-table td:nth-child(7) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(7) .source-status {
      white-space: nowrap;
      display: inline-block;
    }

    .source-name {
      font-weight: 500;
      color: #333;
      cursor: help;
    }

    .source-url {
      color: #8B5CF6;
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: help;
    }

    .source-type {
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .source-description {
      color: #666;
      font-size: 13px;
    }

    .source-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .source-status.subscribed {
      background-color: #d4edda;
      color: #155724;
    }

    .source-status.not-subscribed {
      background-color: #f8f9fa;
      color: #666;
    }
    
    .source-validity {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .source-validity.valid {
      background-color: #d4edda;
      color: #155724;
    }
    
    .source-validity.invalid {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .source-validity.validating {
      background-color: #fff3cd;
      color: #856404;
    }

    .source-region {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .source-region.region-domestic {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
      color: #6D28D9;
    }

    .source-region.region-foreign {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      color: #BE185D;
    }

    /* è¿‡æ»¤æ§ä»¶æ ·å¼ */
    .recommendations-filters {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 500;
      color: #333;
      white-space: nowrap;
    }

    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
    }

    .filter-group select:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .recommendations-stats {
      font-size: 14px;
      color: #666;
      margin-left: auto;
    }

    /* æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æºåŒºåŸŸæ ·å¼ */
    .manual-add-source {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .manual-add-source h5 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .manual-add-source-form {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .manual-add-source-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 200px;
    }

    .manual-add-source-form .form-group label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .manual-add-source-form .form-group input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      transition: border-color 0.3s;
    }

    .manual-add-source-form .form-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .manual-add-source-form .form-group input[type="url"] {
      flex: 2;
      min-width: 300px;
    }

    .manual-add-source-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .manual-add-source-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .manual-add-source-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      padding: 12px 24px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
      transform: translateY(-2px);
    }

    /* DeepSeek äº¤äº’è¿‡ç¨‹æ ·å¼ */
    .deepseek-process {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: rgba(139, 92, 246, 0.8);
      padding: 8px 12px;
      background: rgba(139, 92, 246, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(139, 92, 246, 0.1);
      min-height: 36px;
    }

    .deepseek-process-text {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .deepseek-process-dots {
      display: inline-block;
      width: 12px;
      text-align: left;
    }

    .deepseek-process-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    .deepseek-process.success {
      color: #28a745;
      background: rgba(40, 167, 69, 0.05);
      border-color: rgba(40, 167, 69, 0.1);
    }

    .deepseek-process.error {
      color: #dc3545;
      background: rgba(220, 53, 69, 0.05);
      border-color: rgba(220, 53, 69, 0.1);
    }

    .deepseek-process.loading {
      color: rgba(139, 92, 246, 0.8);
    }

    /* ä¿ç•™æ—§çš„æ ·å¼ç”¨äºå…¼å®¹ï¼ˆå¦‚æœå…¶ä»–åœ°æ–¹è¿˜åœ¨ä½¿ç”¨ï¼‰ */
    .process-step {
      margin-bottom: 6px;
      padding: 5px 8px;
      border-left: 3px solid #8B5CF6;
      background-color: white;
      border-radius: 4px;
    }

    .process-step.success {
      border-left-color: #28a745;
    }

    .process-step.error {
      border-left-color: #dc3545;
    }

    .process-step.loading {
      border-left-color: #ffc107;
    }

    .process-time {
      color: #999;
      font-size: 11px;
      margin-left: 8px;
    }

    .process-message {
      color: #333;
    }

    .process-data {
      margin-top: 4px;
      padding: 4px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 10px;
      color: #666;
      max-height: 80px;
      overflow-y: auto;
    }

    /* ä¸»é¢˜é¡µç­¾æ ·å¼ */
    .topics-tabs-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .topics-tabs-header {
      display: flex;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid #dee2e6;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .topics-tabs-header::-webkit-scrollbar {
      height: 6px;
    }

    .topics-tabs-header::-webkit-scrollbar-thumb {
      background: #8B5CF6;
      border-radius: 3px;
    }

    .topic-tab {
      padding: 14px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      white-space: nowrap;
      transition: all 0.3s;
      position: relative;
    }

    .topic-tab:hover {
      background: rgba(139, 92, 246, 0.1);
      color: #8B5CF6;
    }

    .topic-tab.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: white;
    }

    .topic-tab .tab-badge {
      display: inline-block;
      margin-left: 8px;
      padding: 2px 8px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .topic-tab.active .tab-badge {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
    }

    .topics-tabs-content {
      padding: 24px;
    }

    .topic-tab-panel {
      display: none;
    }

    .topic-tab-panel.active {
      display: block;
    }

    .topic-tab-panel h4 {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    /* æ–‡ç« é˜…è¯»é¡µé¢æ ·å¼ */
    .refresh-status {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      color: #666;
      font-size: 14px;
    }

    .status-value {
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .status-value.success {
      color: #28a745;
    }

    .status-value.warning {
      color: #ffc107;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .news-item {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .news-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .news-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .news-item-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      flex: 1;
      margin-right: 16px;
    }

    .news-item-meta {
      display: flex;
      gap: 16px;
      font-size: 13px;
      color: #999;
      margin-bottom: 8px;
    }

    .news-item-summary {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 8px;
    }

    .news-item-source {
      display: inline-block;
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.error {
      background-color: #fee;
      color: #c33;
      border: 1px solid #fcc;
    }

    .message.success {
      background-color: #efe;
      color: #3c3;
      border: 1px solid #cfc;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    /* æ–‡ç« é˜…è¯»é¡µé¢æ–°æ ·å¼ */
    .articles-stats-bar {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      padding: 20px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
      margin-bottom: 24px;
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }
    
    .stats-items-container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      align-items: center;
      flex: 1;
      justify-content: flex-end;
    }
    
    .btn-refresh-now {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .btn-refresh-now:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .btn-refresh-now:active {
      transform: translateY(0);
    }
    
    .btn-refresh-now:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-refresh-now span {
      font-size: 16px;
      display: inline-block;
      animation: none;
    }
    
    .btn-refresh-now.refreshing span {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .refresh-progress {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      margin-left: 12px;
      display: none;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 400px;
    }

    .refresh-progress.show {
      display: flex;
    }

    .refresh-progress .progress-text {
      flex: 1;
      min-width: 0;
    }

    .refresh-progress .progress-dots {
      display: inline-block;
      width: 12px;
      text-align: left;
    }

    .refresh-progress .progress-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      color: #fff;
      font-weight: 700;
      font-size: 18px;
    }

    .source-filter-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .source-card {
      padding: 12px 24px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .source-card:hover {
      border-color: #8B5CF6;
      color: #8B5CF6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .source-card.active {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      border-color: #8B5CF6;
      color: white;
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }


    .articles-list-view {
      display: block;
    }

    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .date-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0f0f0;
    }

    .date-header {
      padding-bottom: 16px;
      border-bottom: 2px solid #e8e8e8;
      margin-bottom: 20px;
    }

    .date-text {
      font-size: 20px;
      font-weight: 700;
      color: #8B5CF6;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-text::before {
      content: 'ğŸ“…';
      font-size: 18px;
    }

    .articles-by-date {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    @media (max-width: 1200px) {
      .articles-by-date {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .articles-by-date {
        grid-template-columns: 1fr;
      }
    }

    .article-card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid #f0f0f0;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* ä¸ç›¸å…³æ–‡ç« çš„æ ·å¼ */
    .article-card.irrelevant {
      background: #fafafa;
      border-color: #e0e0e0;
      opacity: 0.85;
    }

    .article-card.irrelevant::before {
      background: linear-gradient(135deg, #9e9e9e 0%, #bdbdbd 100%);
    }

    .article-card.irrelevant:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(158, 158, 158, 0.15);
      border-color: #bdbdbd;
      opacity: 0.95;
    }

    .article-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      transform: scaleY(0);
      transition: transform 0.3s;
    }

    .article-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
      border-color: #8B5CF6;
    }

    .article-card:hover::before {
      transform: scaleY(1);
    }

    /* ä¸ç›¸å…³æ ‡ç­¾ */
    .article-irrelevant-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
      color: white;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .article-card.irrelevant .article-card-title {
      color: #666;
    }

    .article-card.irrelevant:hover .article-card-title {
      color: #757575;
    }

    .article-card-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
      line-height: 1.4;
      transition: color 0.3s;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-shrink: 0;
    }

    .article-card:hover .article-card-title {
      color: #8B5CF6;
    }

    .article-card-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 12px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .article-card-source {
      display: inline-block;
      padding: 6px 14px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .article-card-summary {
      color: #495057;
      font-size: 14px;
      line-height: 1.6;
      margin-top: auto;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-grow: 1;
    }

    /* æ–‡ç« è¯¦æƒ…è§†å›¾ */
    .article-detail-view {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 24px;
      position: relative;
    }

    .article-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .btn-back-to-list {
      padding: 10px 20px;
      background-color: #f5f5f5;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .btn-back-to-list:hover {
      background-color: #e0e0e0;
    }

    /* Header å³ä¾§çš„æ“ä½œæŒ‰é’®å®¹å™¨ */
    .article-header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .article-detail-content {
      max-width: 100%;
    }

    .article-detail-title {
      font-size: 32px;
      font-weight: bold;
      color: #1a1a1a;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .article-detail-meta {
      display: flex;
      gap: 20px;
      font-size: 14px;
      color: #666;
      margin-bottom: 24px;
    }

    .article-detail-image {
      margin-bottom: 24px;
    }

    .article-detail-image img {
      width: 100%;
      border-radius: 8px;
    }

    .article-detail-summary {
      background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
      padding: 16px;
      border-left: 4px solid #8B5CF6;
      border-radius: 4px;
      margin-bottom: 24px;
      font-size: 15px;
      line-height: 1.6;
      color: #333;
    }

    .article-generated-summary {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      padding: 20px;
      border-left: 4px solid #EC4899;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .article-generated-summary h3 {
      font-size: 18px;
      font-weight: 600;
      color: #BE185D;
      margin-bottom: 12px;
    }

    .article-generated-summary div {
      font-size: 15px;
      line-height: 1.7;
      color: #333;
    }

    .article-detail-text {
      font-size: 16px;
      line-height: 1.8;
      color: #333;
      max-width: 100%;
      word-wrap: break-word;
    }

    .article-detail-text p {
      margin-bottom: 16px;
    }
    
    /* HTMLå†…å®¹æ ·å¼ä¼˜åŒ– */
    .article-detail-text h1,
    .article-detail-text h2,
    .article-detail-text h3,
    .article-detail-text h4,
    .article-detail-text h5,
    .article-detail-text h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.4;
      color: #1a1a1a;
    }
    
    .article-detail-text h1 { font-size: 28px; }
    .article-detail-text h2 { font-size: 24px; }
    .article-detail-text h3 { font-size: 20px; }
    .article-detail-text h4 { font-size: 18px; }
    
    .article-detail-text ul,
    .article-detail-text ol {
      margin: 16px 0;
      padding-left: 32px;
    }
    
    .article-detail-text li {
      margin-bottom: 8px;
    }
    
    .article-detail-text code {
      background-color: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      color: #d63384;
    }
    
    .article-detail-text pre {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin: 16px 0;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .article-detail-text pre code {
      background-color: transparent;
      padding: 0;
      color: #333;
    }
    
    .article-detail-text blockquote {
      border-left: 4px solid #8B5CF6;
      padding-left: 16px;
      margin: 16px 0;
      color: #666;
      font-style: italic;
    }
    
    .article-detail-text img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 16px 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .article-detail-text a {
      color: #8B5CF6;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.3s;
    }
    
    .article-detail-text a:hover {
      border-bottom-color: #8B5CF6;
    }
    
    .article-detail-text table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    
    .article-detail-text table th,
    .article-detail-text table td {
      padding: 12px;
      border: 1px solid #e9ecef;
      text-align: left;
    }
    
    .article-detail-text table th {
      background-color: #f8f9fa;
      font-weight: 600;
    }
    
    .article-detail-text hr {
      border: none;
      border-top: 1px solid #e9ecef;
      margin: 24px 0;
    }
    
    .article-detail-text strong {
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .article-detail-text em {
      font-style: italic;
    }

    .btn-translate {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.4);
      white-space: nowrap;
    }

    .btn-translate:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-translate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .article-source-link {
      display: inline-block;
      margin-top: 24px;
      color: #8B5CF6;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }

    .article-source-link:hover {
      color: #7C3AED;
      text-decoration: underline;
    }

    /* ç”¨æˆ·æŒ‡å—é¡µé¢æ ·å¼ */
    .guide-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .guide-step,
    .guide-feature,
    .guide-tip,
    .guide-faq {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .guide-step h4,
    .guide-feature h4,
    .guide-tip h4,
    .guide-faq h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
      font-weight: 600;
    }

    .guide-step p,
    .guide-feature p,
    .guide-faq p {
      margin: 0;
      color: #666;
      line-height: 1.6;
    }

    .guide-tip ul {
      margin: 12px 0 0 0;
      padding-left: 24px;
      color: #666;
    }

    .guide-tip li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    /* ç‰¹æ€§ä»‹ç»é¡µé¢æ ·å¼ */
    .features-tabs {
      display: flex;
      gap: 0;
      border-bottom: 2px solid #e9ecef;
      background: white;
      border-radius: 12px 12px 0 0;
    }

    .features-tab {
      flex: 1;
      padding: 16px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      transition: all 0.3s;
    }

    .features-tab:hover {
      background: #f8f9fa;
      color: #8B5CF6;
    }

    .features-tab.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: #faf5ff;
    }

    .features-tab-content {
      display: none;
    }

    .features-tab-content.active {
      display: block;
    }

    /* ç‰¹æ€§å¡ç‰‡ç½‘æ ¼æ ·å¼ */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-top: 20px;
    }

    .feature-card {
      background: white;
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.1);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.3);
    }

    .feature-card:hover::before {
      transform: scaleX(1);
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .feature-card:hover .feature-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .feature-title {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 20px;
      font-weight: 600;
      line-height: 1.3;
    }

    .feature-description {
      margin: 0 0 20px 0;
      color: #666;
      line-height: 1.6;
      font-size: 14px;
      flex-grow: 1;
    }

    .feature-value {
      margin-top: auto;
      padding: 16px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
      border-radius: 12px;
      border: 1px solid rgba(139, 92, 246, 0.15);
    }

    .feature-value-label {
      font-size: 13px;
      font-weight: 600;
      color: #8B5CF6;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .feature-value-text {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .feature-card {
        padding: 24px;
      }
    }

    /* æ›´æ–°å†å²æ ·å¼ */
    .changelog-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .changelog-item {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .changelog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e9ecef;
    }

    .changelog-version {
      font-size: 18px;
      font-weight: 600;
      color: #8B5CF6;
    }

    .changelog-date {
      font-size: 14px;
      color: #999;
    }

    .changelog-section {
      margin-bottom: 12px;
    }

    .changelog-section:last-child {
      margin-bottom: 0;
    }

    .changelog-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .changelog-section ul {
      margin: 0;
      padding-left: 20px;
      color: #666;
    }

    .changelog-section li {
      margin-bottom: 6px;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 200px;
      }

      .main-content {
        margin-left: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- å·¦ä¾§èœå• -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h1>ä¸ªäººä¿¡æ¯æ•´ç†</h1>
      <div class="user-info" id="userInfo">åŠ è½½ä¸­...</div>
    </div>
    <div class="sidebar-menu">
      <div class="menu-item active" onclick="switchPage('subscriptions', event)">
        <span class="menu-item-icon">ğŸ“‹</span>
        <span class="menu-item-text">è®¢é˜…ç®¡ç†</span>
      </div>
      <div class="menu-item" onclick="switchPage('articles', event)">
        <span class="menu-item-icon">ğŸ“°</span>
        <span class="menu-item-text">æ–‡ç« é˜…è¯»</span>
      </div>
      <div class="menu-item" onclick="switchPage('tweets', event)">
        <span class="menu-item-icon">ğŸ¦</span>
        <span class="menu-item-text">æœ€æ–°æ¨æ–‡</span>
      </div>
      <div class="menu-item" onclick="switchPage('guide', event)">
        <span class="menu-item-icon">ğŸ“–</span>
        <span class="menu-item-text">ç”¨æˆ·æŒ‡å—</span>
      </div>
      <div class="menu-item" onclick="switchPage('features', event)">
        <span class="menu-item-icon">â­</span>
        <span class="menu-item-text">ç‰¹æ€§ä»‹ç»</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
    </div>
  </div>

  <!-- ä¸»å†…å®¹åŒº -->
  <div class="main-content">
    <!-- è®¢é˜…ç®¡ç†é¡µé¢ -->
    <div id="subscriptionsPage" class="content-page active">
      <div class="page-header">
        <h2>è®¢é˜…ç®¡ç†</h2>
        <p>ç®¡ç†æ‚¨å…³æ³¨çš„ä¸»é¢˜å’Œä¿¡æ¯æº</p>
      </div>

      <div id="message" class="message"></div>

      <!-- ä¸»é¢˜ç®¡ç† -->
      <div class="section">
        <h3>
          æˆ‘çš„ä¸»é¢˜
          <button class="add-topic-btn" onclick="showAddTopicModal()" title="æ·»åŠ æ–°ä¸»é¢˜">+</button>
        </h3>
        <div id="topicsList" class="topics-list">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>

      <!-- æ·»åŠ æ–°ä¸»é¢˜å¼¹çª— -->
      <div class="modal-overlay" id="addTopicModal" onclick="closeAddTopicModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
          <div class="modal-header">
            <h3>æ·»åŠ æ–°ä¸»é¢˜</h3>
            <button class="modal-close" onclick="closeAddTopicModal()">Ã—</button>
          </div>
          <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
            è¾“å…¥æ‚¨å…³æ³¨çš„ä¸»é¢˜å…³é”®è¯ï¼Œç³»ç»Ÿå°†ä¸ºæ‚¨æ¨èä¼˜è´¨çš„ä¿¡æ¯æº
          </p>
          <div class="input-group">
            <input 
              type="text" 
              id="topicInput" 
              placeholder="ä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€åŒºå—é“¾..."
              onkeypress="if(event.key==='Enter') recommendSources()"
            >
            <button class="btn-primary" onclick="recommendSources()" id="recommendBtn">
              è·å–æ¨è
            </button>
          </div>
        </div>
      </div>

      <!-- ä¸»é¢˜é¡µç­¾å®¹å™¨ -->
      <div class="section" id="topicsTabsSection" style="display: none;">
        <div class="topics-tabs-container">
          <div class="topics-tabs-header" id="topicsTabsHeader">
            <!-- é¡µç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
          </div>
          <div class="topics-tabs-content" id="topicsTabsContent">
            <!-- é¡µç­¾å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
    </div>

    <!-- æ–‡ç« é˜…è¯»é¡µé¢ -->
    <div id="articlesPage" class="content-page">
      <!-- ä¸»é¢˜é¡µç­¾å®¹å™¨ -->
      <div class="topics-tabs-container" id="articlesTopicsTabsContainer" style="display: none;">
        <div class="topics-tabs-header" id="articlesTopicsTabsHeader">
          <!-- é¡µç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="topics-tabs-content" id="articlesTopicsTabsContent">
          <!-- é¡µç­¾å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- æ— ä¸»é¢˜æ—¶çš„æç¤º -->
      <div id="articlesNoTopicsHint" class="empty-state" style="display: none;">
        <p>æš‚æ— ä¸»é¢˜ï¼Œè¯·å…ˆåœ¨"è®¢é˜…ç®¡ç†"é¡µé¢æ·»åŠ ä¸»é¢˜å¹¶è®¢é˜…ä¿¡æ¯æº</p>
      </div>

      <!-- æ–‡ç« è¯¦æƒ…è§†å›¾ -->
      <div id="articleDetailView" class="article-detail-view" style="display: none;">
        <div class="article-detail-header">
          <button class="btn-back-to-list" onclick="backToList()">â† è¿”å›åˆ—è¡¨</button>
          <div class="article-header-actions">
            <button id="articleSummarizeBtn" class="btn-translate" onclick="generateSummary()" style="display: none;">ç”Ÿæˆæ€»ç»“</button>
            <button id="articleTranslateBtn" class="btn-translate" onclick="toggleTranslate()" style="display: none;">ç¿»è¯‘ä¸ºä¸­æ–‡</button>
          </div>
        </div>
        <div class="article-detail-content">
          <h1 id="articleDetailTitle" class="article-detail-title">åŠ è½½ä¸­...</h1>
          <div class="article-detail-meta">
            <span id="articleDetailSource"></span>
            <span id="articleDetailDate"></span>
          </div>
          <div id="articleDetailImage" class="article-detail-image"></div>
          <div id="articleGeneratedSummary" class="article-generated-summary" style="display: none;">
            <h3>æ–‡ç« æ€»ç»“</h3>
            <div id="articleGeneratedSummaryContent"></div>
          </div>
          <div id="articleDetailSummary" class="article-detail-summary"></div>
          <div id="articleDetailContent" class="article-detail-text"></div>
          <a id="articleSourceLink" href="#" target="_blank" class="article-source-link" style="display: none;">æŸ¥çœ‹åŸæ–‡é“¾æ¥</a>
          <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button class="btn-back-to-list" onclick="backToList()">â† è¿”å›åˆ—è¡¨</button>
          </div>
        </div>
      </div>
    </div>

    <!-- æœ€æ–°æ¨æ–‡é¡µé¢ -->
    <div id="tweetsPage" class="content-page">
      <div class="page-header">
        <h2>æœ€æ–°æ¨æ–‡</h2>
        <p>æŸ¥çœ‹é€šè¿‡NitteræŠ“å–çš„Twitter/Xæ¨æ–‡</p>
      </div>

      <div id="tweetsMessage" class="message"></div>

      <!-- æ¨æ–‡ç­›é€‰ -->
      <div class="section" style="margin-bottom: 20px;">
        <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
          <input 
            type="text" 
            id="tweetsSearchInput" 
            placeholder="æœç´¢æ¨æ–‡..." 
            style="flex: 1; min-width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;"
            onkeypress="if(event.key==='Enter') loadTweets()"
          />
          <select 
            id="tweetsUserFilter" 
            style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;"
            onchange="loadTweets()"
          >
            <option value="">æ‰€æœ‰ç”¨æˆ·</option>
          </select>
          <button class="btn-primary" onclick="loadTweets()" style="padding: 10px 20px;">åˆ·æ–°</button>
        </div>
      </div>

      <!-- æ¨æ–‡åˆ—è¡¨ -->
      <div id="tweetsLoading" class="loading">åŠ è½½ä¸­...</div>
      <div id="tweetsContainer" style="display: none;">
        <div id="tweetsList"></div>
        <div id="tweetsPagination" style="text-align: center; margin-top: 20px; padding: 20px;"></div>
      </div>
    </div>

    <!-- ç”¨æˆ·æŒ‡å—é¡µé¢ -->
    <div id="guidePage" class="content-page">
      <div class="page-header">
        <h2>ç”¨æˆ·æŒ‡å—</h2>
        <p>äº†è§£å¦‚ä½•ä½¿ç”¨ä¸ªäººä¿¡æ¯æ•´ç†ç³»ç»Ÿ</p>
      </div>

      <!-- åŸºç¡€ä½¿ç”¨æµç¨‹ -->
      <div class="section">
        <h3>ğŸ“š åŸºç¡€ä½¿ç”¨æµç¨‹</h3>
        <div class="guide-content">
          <div class="guide-step">
            <h4>1. æ³¨å†Œ/ç™»å½•</h4>
            <p>é¦–æ¬¡ä½¿ç”¨éœ€è¦æ³¨å†Œè´¦å·ï¼Œè¾“å…¥ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç å³å¯å®Œæˆæ³¨å†Œã€‚å·²æœ‰è´¦å·çš„ç”¨æˆ·å¯ä»¥ç›´æ¥ç™»å½•ã€‚</p>
          </div>
          <div class="guide-step">
            <h4>2. æ·»åŠ ä¸»é¢˜å…³é”®è¯</h4>
            <p>åœ¨"è®¢é˜…ç®¡ç†"é¡µé¢ï¼Œç‚¹å‡»"+"æŒ‰é’®æ·»åŠ æ‚¨å…³æ³¨çš„ä¸»é¢˜å…³é”®è¯ï¼Œä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€åŒºå—é“¾ç­‰ã€‚</p>
          </div>
          <div class="guide-step">
            <h4>3. è·å–æ¨èä¿¡æ¯æº</h4>
            <p>è¾“å…¥ä¸»é¢˜å…³é”®è¯åï¼Œç‚¹å‡»"è·å–æ¨è"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ AI ä¸ºæ‚¨æ¨èä¼˜è´¨çš„ä¿¡æ¯æºã€‚</p>
          </div>
          <div class="guide-step">
            <h4>4. è®¢é˜…ä¿¡æ¯æº</h4>
            <p>åœ¨æ¨èçš„ä¿¡æ¯æºåˆ—è¡¨ä¸­ï¼Œé€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„ä¿¡æ¯æºï¼Œç‚¹å‡»"è®¢é˜…é€‰ä¸­"æŒ‰é’®å®Œæˆè®¢é˜…ã€‚</p>
          </div>
          <div class="guide-step">
            <h4>5. æŸ¥çœ‹æ”¶é›†çš„æ–°é—»</h4>
            <p>è®¢é˜…åï¼Œç³»ç»Ÿä¼šæ¯ 10 åˆ†é’Ÿè‡ªåŠ¨æ”¶é›†è¿™äº›ä¿¡æ¯æºçš„æœ€æ–°å†…å®¹ã€‚æ‚¨å¯ä»¥åœ¨"æ–‡ç« é˜…è¯»"é¡µé¢æŸ¥çœ‹æ”¶é›†åˆ°çš„æ–°é—»ã€‚</p>
          </div>
        </div>
      </div>

      <!-- è¯¦ç»†åŠŸèƒ½ä»‹ç» -->
      <div class="section">
        <h3>ğŸ”§ è¯¦ç»†åŠŸèƒ½ä»‹ç»</h3>
        <div class="guide-content">
          <div class="guide-feature">
            <h4>ä¸»é¢˜ç®¡ç†</h4>
            <p>æ‚¨å¯ä»¥æ·»åŠ å¤šä¸ªä¸»é¢˜å…³é”®è¯ï¼Œç³»ç»Ÿä¼šä¸ºæ¯ä¸ªä¸»é¢˜æ¨èç›¸åº”çš„ä¿¡æ¯æºã€‚ä¸»é¢˜ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ–¹ä¾¿æ‚¨ç®¡ç†ä¸åŒé¢†åŸŸçš„å…³æ³¨ç‚¹ã€‚</p>
          </div>
          <div class="guide-feature">
            <h4>AI æ¨èä¿¡æ¯æº</h4>
            <p>ç³»ç»Ÿä½¿ç”¨ DeepSeek AI æ ¹æ®æ‚¨è¾“å…¥çš„å…³é”®è¯ï¼Œæ™ºèƒ½æ¨èç›¸å…³çš„é«˜è´¨é‡ä¿¡æ¯æºï¼ŒåŒ…æ‹¬ RSS æºå’Œåšå®¢ç½‘ç«™ã€‚</p>
          </div>
          <div class="guide-feature">
            <h4>è®¢é˜…ç®¡ç†</h4>
            <p>åœ¨è®¢é˜…ç®¡ç†é¡µé¢ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²è®¢é˜…çš„ä¿¡æ¯æºï¼ŒåŒ…æ‹¬ä¿¡æ¯æºåç§°ã€URLã€ç±»å‹å’Œåˆ†ç±»ã€‚æ‚¨å¯ä»¥éšæ—¶å–æ¶ˆä¸éœ€è¦çš„è®¢é˜…ã€‚</p>
          </div>
          <div class="guide-feature">
            <h4>æ–‡ç« é˜…è¯»</h4>
            <p>æ–‡ç« é˜…è¯»é¡µé¢æŒ‰ä¸»é¢˜åˆ†ç»„å±•ç¤ºæ–°é—»ï¼Œæ”¯æŒæŒ‰ä¿¡æ¯æºè¿‡æ»¤ã€‚ç‚¹å‡»æ–‡ç« å¯ä»¥æŸ¥çœ‹è¯¦æƒ…ï¼Œæ”¯æŒç”Ÿæˆæ‘˜è¦å’Œç¿»è¯‘åŠŸèƒ½ã€‚</p>
          </div>
          <div class="guide-feature">
            <h4>æœ€æ–°æ¨æ–‡</h4>
            <p>é€šè¿‡ Nitter æŠ“å– Twitter/X æ¨æ–‡ï¼Œæ”¯æŒæœç´¢å’ŒæŒ‰ç”¨æˆ·è¿‡æ»¤ï¼Œæ–¹ä¾¿æ‚¨å…³æ³¨ç‰¹å®šè´¦å·çš„æœ€æ–°åŠ¨æ€ã€‚</p>
          </div>
        </div>
      </div>

      <!-- ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ -->
      <div class="section">
        <h3>ğŸ’¡ ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µ</h3>
        <div class="guide-content">
          <div class="guide-tip">
            <h4>å¦‚ä½•é€‰æ‹©æœ‰æ•ˆçš„å…³é”®è¯</h4>
            <ul>
              <li>ä½¿ç”¨å…·ä½“çš„å…³é”®è¯ï¼Œé¿å…è¿‡äºå®½æ³›çš„è¯æ±‡</li>
              <li>å¯ä»¥å°è¯•ä½¿ç”¨è‹±æ–‡å…³é”®è¯ï¼Œå¯èƒ½è·å¾—æ›´å¤šä¼˜è´¨ä¿¡æ¯æº</li>
              <li>ç»“åˆå¤šä¸ªç›¸å…³å…³é”®è¯ï¼Œè·å¾—æ›´å…¨é¢çš„æ¨è</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>å¦‚ä½•ç®¡ç†å¤šä¸ªä¸»é¢˜</h4>
            <ul>
              <li>ä¸ºä¸åŒé¢†åŸŸåˆ›å»ºä¸åŒçš„ä¸»é¢˜ï¼Œä¾¿äºåˆ†ç±»ç®¡ç†</li>
              <li>å®šæœŸæ£€æŸ¥è®¢é˜…çš„ä¿¡æ¯æºï¼Œå–æ¶ˆä¸å†éœ€è¦çš„è®¢é˜…</li>
              <li>åœ¨æ–‡ç« é˜…è¯»é¡µé¢ï¼Œä½¿ç”¨ä¸»é¢˜é¡µç­¾å¿«é€Ÿåˆ‡æ¢ä¸åŒä¸»é¢˜çš„å†…å®¹</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>å¦‚ä½•ä¼˜åŒ–è®¢é˜…åˆ—è¡¨</h4>
            <ul>
              <li>ä¼˜å…ˆè®¢é˜…æ›´æ–°é¢‘ç‡é«˜ã€å†…å®¹è´¨é‡å¥½çš„ä¿¡æ¯æº</li>
              <li>é¿å…è®¢é˜…è¿‡å¤šç›¸ä¼¼çš„ä¿¡æ¯æºï¼Œå‡å°‘é‡å¤å†…å®¹</li>
              <li>å®šæœŸæ£€æŸ¥è®¢é˜…çš„ä¿¡æ¯æºæ˜¯å¦ä»ç„¶æ´»è·ƒ</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>å¦‚ä½•é«˜æ•ˆé˜…è¯»æ–°é—»</h4>
            <ul>
              <li>ä½¿ç”¨ä¿¡æ¯æºè¿‡æ»¤åŠŸèƒ½ï¼Œä¸“æ³¨äºç‰¹å®šæ¥æºçš„å†…å®¹</li>
              <li>åˆ©ç”¨æ–‡ç« æ‘˜è¦åŠŸèƒ½ï¼Œå¿«é€Ÿäº†è§£æ–‡ç« è¦ç‚¹</li>
              <li>ä½¿ç”¨ç¿»è¯‘åŠŸèƒ½é˜…è¯»è‹±æ–‡å†…å®¹</li>
              <li>åœ¨æ–‡ç« è¯¦æƒ…é¡µæŸ¥çœ‹åŸæ–‡é“¾æ¥ï¼Œè·å–å®Œæ•´ä¿¡æ¯</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- å¸¸è§é—®é¢˜è§£ç­” -->
      <div class="section">
        <h3>â“ å¸¸è§é—®é¢˜è§£ç­”ï¼ˆFAQï¼‰</h3>
        <div class="guide-content">
          <div class="guide-faq">
            <h4>å¦‚ä½•å¼€å§‹ä½¿ç”¨ï¼Ÿ</h4>
            <p>é¦–å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶ååœ¨"è®¢é˜…ç®¡ç†"é¡µé¢æ·»åŠ æ‚¨å…³æ³¨çš„ä¸»é¢˜å…³é”®è¯ï¼Œè·å–æ¨èå¹¶è®¢é˜…ä¿¡æ¯æºï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨ä¸ºæ‚¨æ”¶é›†ç›¸å…³æ–°é—»ã€‚</p>
          </div>
          <div class="guide-faq">
            <h4>ä¸ºä»€ä¹ˆæ²¡æœ‰æ¨èåˆ°ä¿¡æ¯æºï¼Ÿ</h4>
            <p>å¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼šå…³é”®è¯è¿‡äºå®½æ³›æˆ–ç‰¹æ®Šã€AI æ¨èæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚å»ºè®®å°è¯•ä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯ï¼Œæˆ–ç¨åé‡è¯•ã€‚</p>
          </div>
          <div class="guide-faq">
            <h4>æ–°é—»å¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Ÿ</h4>
            <p>ç³»ç»Ÿæ¯ 10 åˆ†é’Ÿè‡ªåŠ¨æ”¶é›†ä¸€æ¬¡æ‚¨è®¢é˜…çš„ä¿¡æ¯æºçš„æœ€æ–°å†…å®¹ã€‚æ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ·æ–°æŸ¥çœ‹æœ€æ–°å†…å®¹ã€‚</p>
          </div>
          <div class="guide-faq">
            <h4>å¦‚ä½•å–æ¶ˆè®¢é˜…ï¼Ÿ</h4>
            <p>åœ¨"è®¢é˜…ç®¡ç†"é¡µé¢ï¼Œæ‰¾åˆ°è¦å–æ¶ˆçš„è®¢é˜…ï¼Œç‚¹å‡»åˆ é™¤æŒ‰é’®å³å¯ã€‚å–æ¶ˆè®¢é˜…åï¼Œç³»ç»Ÿå°†ä¸å†æ”¶é›†è¯¥ä¿¡æ¯æºçš„å†…å®¹ã€‚</p>
          </div>
          <div class="guide-faq">
            <h4>å¯ä»¥è®¢é˜…å¤šå°‘ä¸ªä¿¡æ¯æºï¼Ÿ</h4>
            <p>ç›®å‰æ²¡æœ‰é™åˆ¶ï¼Œä½†å»ºè®®ä¸è¦è®¢é˜…è¿‡å¤šä¿¡æ¯æºï¼Œä»¥å…å†…å®¹è¿‡å¤šéš¾ä»¥ç®¡ç†ã€‚å»ºè®®æ§åˆ¶åœ¨ 20-30 ä¸ªä»¥å†…ã€‚</p>
          </div>
          <div class="guide-faq">
            <h4>æ”¯æŒå“ªäº›ç±»å‹çš„ä¿¡æ¯æºï¼Ÿ</h4>
            <p>ç›®å‰æ”¯æŒ RSS æºå’Œåšå®¢ç½‘ç«™ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ä¿¡æ¯æºç±»å‹å¹¶é‡‡ç”¨ç›¸åº”çš„æ”¶é›†æ–¹å¼ã€‚</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ç‰¹æ€§ä»‹ç»é¡µé¢ -->
    <div id="featuresPage" class="content-page">
      <div class="page-header">
        <h2>ç‰¹æ€§ä»‹ç»</h2>
        <p>äº†è§£ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½å’Œæœ€æ–°æ›´æ–°</p>
      </div>

      <!-- é¡µç­¾åˆ‡æ¢ -->
      <div class="section" style="padding: 0;">
        <div class="features-tabs">
          <button class="features-tab active" onclick="switchFeaturesTab('major', event)">é‡å¤§ç‰¹æ€§</button>
          <button class="features-tab" onclick="switchFeaturesTab('changelog', event)">æ›´æ–°å†å²</button>
        </div>
      </div>

      <!-- é‡å¤§ç‰¹æ€§é¡µç­¾å†…å®¹ -->
      <div id="majorFeaturesTab" class="features-tab-content active">
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ”</div>
            <h3 class="feature-title">ç”¨æˆ·è®¤è¯ç³»ç»Ÿ</h3>
            <p class="feature-description">å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•å’Œè®¤è¯ç³»ç»Ÿï¼Œä½¿ç”¨ JWT token è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®å®‰å…¨ã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">ä¿æŠ¤ä¸ªäººéšç§ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±è®¢é˜…çš„å†…å®¹ï¼Œæ•°æ®å®‰å…¨å¯é ã€‚</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ¤–</div>
            <h3 class="feature-title">AI æ™ºèƒ½æ¨èä¿¡æ¯æº</h3>
            <p class="feature-description">åŸºäº DeepSeek AI çš„æ™ºèƒ½æ¨èç³»ç»Ÿï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„å…³é”®è¯è‡ªåŠ¨æ¨èé«˜è´¨é‡çš„ä¿¡æ¯æºã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">æ— éœ€æ‰‹åŠ¨æœç´¢ï¼ŒAI è‡ªåŠ¨ä¸ºæ‚¨æ‰¾åˆ°æœ€ç›¸å…³çš„ä¼˜è´¨ä¿¡æ¯æºï¼ŒèŠ‚çœå¤§é‡æ—¶é—´ã€‚</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ“°</div>
            <h3 class="feature-title">ä¸ªæ€§åŒ–æ–°é—»æ”¶é›†</h3>
            <p class="feature-description">ç³»ç»Ÿæ ¹æ®æ¯ä¸ªç”¨æˆ·çš„è®¢é˜…è‡ªåŠ¨æ”¶é›†æ–°é—»ï¼Œæ¯ 10 åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œç¡®ä¿å†…å®¹åŠæ—¶æ€§ã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">åªçœ‹åˆ°æ‚¨å…³å¿ƒçš„å†…å®¹ï¼Œä¸ä¼šè¢«æ— å…³ä¿¡æ¯å¹²æ‰°ï¼Œæé«˜é˜…è¯»æ•ˆç‡ã€‚</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ“‹</div>
            <h3 class="feature-title">å¤šæºè®¢é˜…ç®¡ç†</h3>
            <p class="feature-description">æ”¯æŒè®¢é˜…å¤šä¸ªä¿¡æ¯æºï¼Œæ”¯æŒ RSS å’Œåšå®¢ä¸¤ç§ç±»å‹ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰è®¢é˜…ã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">åœ¨ä¸€ä¸ªåœ°æ–¹ç®¡ç†æ‰€æœ‰ä¿¡æ¯æºï¼Œæ— éœ€è®¿é—®å¤šä¸ªç½‘ç«™ï¼Œæ–¹ä¾¿å¿«æ·ã€‚</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ“–</div>
            <h3 class="feature-title">æ–‡ç« é˜…è¯»ä½“éªŒ</h3>
            <p class="feature-description">æ”¯æŒæŒ‰ä¸»é¢˜å’Œä¿¡æ¯æºè¿‡æ»¤ï¼Œæä¾›æ–‡ç« æ‘˜è¦ç”Ÿæˆå’Œç¿»è¯‘åŠŸèƒ½ï¼Œä¼˜åŒ–é˜…è¯»ä½“éªŒã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">å¿«é€Ÿå®šä½æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œæ”¯æŒå¤šè¯­è¨€é˜…è¯»ï¼Œæå‡é˜…è¯»æ•ˆç‡ã€‚</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ğŸ¦</div>
            <h3 class="feature-title">æœ€æ–°æ¨æ–‡åŠŸèƒ½</h3>
            <p class="feature-description">é€šè¿‡ Nitter æŠ“å– Twitter/X æ¨æ–‡ï¼Œæ”¯æŒæœç´¢å’ŒæŒ‰ç”¨æˆ·è¿‡æ»¤ï¼Œæ–¹ä¾¿å…³æ³¨ç‰¹å®šè´¦å·ã€‚</p>
            <div class="feature-value">
              <div class="feature-value-label">ğŸ’ å¯¹ç”¨æˆ·çš„ä»·å€¼</div>
              <div class="feature-value-text">æ— éœ€ç™»å½• Twitterï¼Œå³å¯æŸ¥çœ‹å…³æ³¨è´¦å·çš„æœ€æ–°æ¨æ–‡ï¼Œä¿æŠ¤éšç§ã€‚</div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ›´æ–°å†å²é¡µç­¾å†…å®¹ -->
      <div id="changelogTab" class="features-tab-content">
        <div class="section">
          <div id="changelogContent" class="changelog-content">
            <div class="loading">åŠ è½½æ›´æ–°å†å²ä¸­...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API åŸºç¡€åœ°å€
    const API_BASE_URL = (() => {
      // æœ¬åœ°å¼€å‘ï¼šä½¿ç”¨æœ¬åœ°API
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return `${window.location.protocol}//${window.location.host}/api`;
      }
      // ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ Railway åç«¯åœ°å€
      return 'https://news-agent-production-c5db.up.railway.app/api';
    })();

    let authToken = localStorage.getItem('authToken');
    let currentUser = null;
    let recommendedSources = [];
    let userSubscriptions = []; // ç”¨æˆ·å·²è®¢é˜…çš„ä¿¡æ¯æºåˆ—è¡¨
    let savedProcessLogs = []; // ä¿å­˜çš„æ¨èè¿‡ç¨‹æ—¥å¿—
    
    // æ–‡ç« é˜…è¯»é¡µé¢ç›¸å…³å˜é‡
    let allArticles = []; // å­˜å‚¨æ‰€æœ‰æ–‡ç« æ•°æ®
    let filteredArticles = []; // å½“å‰è¿‡æ»¤åçš„æ–‡ç« 
    let currentSourceFilter = null; // å½“å‰é€‰ä¸­çš„ä¿¡æ¯æº
    let savedScrollPosition = 0; // ä¿å­˜æ»šåŠ¨ä½ç½®
    let currentTopicFilter = null; // å½“å‰é€‰ä¸­çš„ä¸»é¢˜
    let userTopics = []; // ç”¨æˆ·ä¸»é¢˜åˆ—è¡¨
    let topicRecommendationHistory = {}; // ä¸»é¢˜æ¨èå†å² {topic_keywords: {recommended_sources: [...]}}
    

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    if (!authToken) {
      alert('è¯·å…ˆç™»å½•');
      window.location.href = '/login.html';
    }

    function getHeaders() {
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      };
    }

    // éªŒè¯ç”¨æˆ·å¹¶åŠ è½½ç”¨æˆ·ä¿¡æ¯
    async function initUser() {
      try {
        const response = await fetch(`${API_BASE_URL}/auth/me`, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          currentUser = result.user;
          document.getElementById('userInfo').textContent = `æ¬¢è¿ï¼Œ${currentUser.username}`;
        } else {
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('éªŒè¯ç”¨æˆ·å¤±è´¥:', error);
        window.location.href = '/login.html';
      }
    }

    // åˆ‡æ¢é¡µé¢
    function switchPage(page, event) {
      // ä¿å­˜å½“å‰é¡µé¢åˆ° localStorage
      localStorage.setItem('dashboardCurrentPage', page);
      
      // æ›´æ–°èœå•çŠ¶æ€
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      if (event && event.target) {
        event.target.closest('.menu-item').classList.add('active');
      } else {
        // å¦‚æœæ²¡æœ‰ eventï¼Œé€šè¿‡ page å‚æ•°æ‰¾åˆ°å¯¹åº”çš„èœå•é¡¹
        const menuItems = document.querySelectorAll('.menu-item');
        const pageIndexMap = {
          'subscriptions': 0,
          'articles': 1,
          'tweets': 2,
          'guide': 3,
          'features': 4
        };
        menuItems.forEach((item, index) => {
          if (pageIndexMap[page] === index) {
            item.classList.add('active');
          }
        });
      }

      // æ›´æ–°é¡µé¢æ˜¾ç¤º
      document.querySelectorAll('.content-page').forEach(p => {
        p.classList.remove('active');
      });
      document.getElementById(page + 'Page').classList.add('active');

      // åŠ è½½å¯¹åº”é¡µé¢æ•°æ®
      if (page === 'subscriptions') {
        // åˆ‡æ¢åˆ°è®¢é˜…ç®¡ç†é¡µé¢æ—¶ï¼Œæ¸…é™¤æ–‡ç« è¯¦æƒ…çŠ¶æ€
        localStorage.removeItem('dashboardViewingArticleId');
        loadTopics();
        loadRecommendationHistory(); // åŠ è½½æ¨èå†å²
      } else if (page === 'tweets') {
        loadTweets();
      } else if (page === 'articles') {
        // å¦‚æœå½“å‰åœ¨æ–‡ç« è¯¦æƒ…é¡µé¢ï¼Œå…ˆè¿”å›åˆ—è¡¨é¡µé¢
        const articleDetailView = document.getElementById('articleDetailView');
        if (articleDetailView && articleDetailView.style.display !== 'none') {
          // è·å–å½“å‰æ´»åŠ¨çš„ä¸»é¢˜é¡µç­¾ç´¢å¼•ï¼ˆå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ä¸º0ï¼‰
          const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
          
          // æ˜¾ç¤ºå½“å‰æ´»åŠ¨é¡µç­¾çš„ç»Ÿè®¡ä¿¡æ¯æ ã€ä¿¡æ¯æºè¿‡æ»¤å¡ç‰‡
          const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
          const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
          
          if (statsBar) statsBar.style.display = 'flex';
          if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
          
          // éšè—è¯¦æƒ…è§†å›¾ï¼Œæ˜¾ç¤ºåˆ—è¡¨è§†å›¾
          articleDetailView.style.display = 'none';
          const articlesListView = document.getElementById(`articlesListView-${currentTabIndex}`);
          if (articlesListView) articlesListView.style.display = 'block';
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
        } else {
          // æ¯æ¬¡è¿›å…¥æ–‡ç« é˜…è¯»é¡µé¢æ—¶ï¼Œéƒ½é‡æ–°åŠ è½½ä¸»é¢˜é¡µç­¾ï¼Œç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰æœ€æ–°ä¸»é¢˜
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          console.log('ğŸ“š æ–‡ç« é˜…è¯»é¡µé¢ï¼šé‡æ–°åŠ è½½ä¸»é¢˜é¡µç­¾ï¼Œç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰ä¸»é¢˜...');
          loadArticlesTopicsTabs().then(() => {
            console.log('âœ… ä¸»é¢˜é¡µç­¾åŠ è½½å®Œæˆ');
            // ç¡®ä¿ä¸»é¢˜é¡µç­¾å®¹å™¨å¯è§
            if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
          }).catch(err => {
            console.error('âŒ åŠ è½½ä¸»é¢˜é¡µç­¾å¤±è´¥:', err);
          });
        }
      } else if (page === 'features') {
        // åŠ è½½æ›´æ–°å†å²
        loadChangelog();
      }
    }

    // é€€å‡ºç™»å½•
    function handleLogout() {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userInfo');
        window.location.href = '/login.html';
      }
    }

    // åˆ‡æ¢ç‰¹æ€§ä»‹ç»é¡µç­¾
    function switchFeaturesTab(tab, event) {
      // æ›´æ–°é¡µç­¾æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.features-tab').forEach(btn => {
        btn.classList.remove('active');
      });
      if (event && event.target) {
        event.target.classList.add('active');
      } else {
        // å¦‚æœæ²¡æœ‰ eventï¼Œé€šè¿‡ tab å‚æ•°æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®
        document.querySelectorAll('.features-tab').forEach((btn, index) => {
          if ((tab === 'major' && index === 0) || (tab === 'changelog' && index === 1)) {
            btn.classList.add('active');
          }
        });
      }

      // æ›´æ–°é¡µç­¾å†…å®¹æ˜¾ç¤º
      document.querySelectorAll('.features-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      if (tab === 'major') {
        document.getElementById('majorFeaturesTab').classList.add('active');
      } else if (tab === 'changelog') {
        document.getElementById('changelogTab').classList.add('active');
        loadChangelog();
      }
    }

    // åŠ è½½æ›´æ–°å†å²
    async function loadChangelog() {
      const changelogContent = document.getElementById('changelogContent');
      if (!changelogContent) return;

      try {
        changelogContent.innerHTML = '<div class="loading">åŠ è½½æ›´æ–°å†å²ä¸­...</div>';
        
        const response = await fetch('/changelog.json');
        if (!response.ok) {
          throw new Error('æ— æ³•åŠ è½½æ›´æ–°å†å²');
        }
        
        const data = await response.json();
        
        if (!data.updates || data.updates.length === 0) {
          changelogContent.innerHTML = '<div class="empty-state">æš‚æ— æ›´æ–°å†å²</div>';
          return;
        }

        let html = '';
        data.updates.forEach(update => {
          html += '<div class="changelog-item">';
          html += '<div class="changelog-header">';
          html += `<span class="changelog-version">ç‰ˆæœ¬ ${update.version}</span>`;
          html += `<span class="changelog-date">${update.date}</span>`;
          html += '</div>';
          
          if (update.features && update.features.length > 0) {
            html += '<div class="changelog-section">';
            html += '<div class="changelog-section-title">âœ¨ æ–°å¢åŠŸèƒ½</div>';
            html += '<ul>';
            update.features.forEach(feature => {
              html += `<li>${feature}</li>`;
            });
            html += '</ul>';
            html += '</div>';
          }
          
          if (update.improvements && update.improvements.length > 0) {
            html += '<div class="changelog-section">';
            html += '<div class="changelog-section-title">ğŸš€ æ”¹è¿›å’Œä¼˜åŒ–</div>';
            html += '<ul>';
            update.improvements.forEach(improvement => {
              html += `<li>${improvement}</li>`;
            });
            html += '</ul>';
            html += '</div>';
          }
          
          if (update.fixes && update.fixes.length > 0) {
            html += '<div class="changelog-section">';
            html += '<div class="changelog-section-title">ğŸ› Bug ä¿®å¤</div>';
            html += '<ul>';
            update.fixes.forEach(fix => {
              html += `<li>${fix}</li>`;
            });
            html += '</ul>';
            html += '</div>';
          }
          
          html += '</div>';
        });
        
        changelogContent.innerHTML = html;
      } catch (error) {
        console.error('åŠ è½½æ›´æ–°å†å²å¤±è´¥:', error);
        changelogContent.innerHTML = '<div class="empty-state">åŠ è½½æ›´æ–°å†å²å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
      }
    }

    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }

    // åŠ è½½ä¸»é¢˜åˆ—è¡¨
    async function loadTopics() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const topicsListEl = document.getElementById('topicsList');
          if (result.data.length === 0) {
            topicsListEl.innerHTML = '<p style="color: #999;">æš‚æ— ä¸»é¢˜ï¼Œè¯·æ·»åŠ æ–°ä¸»é¢˜</p>';
          } else {
            topicsListEl.innerHTML = result.data.map(topic => `
              <div class="topic-tag">
                <span>${escapeHtml(topic.topic_keywords)}</span>
                <button class="remove-btn" onclick="removeTopic('${topic.topic_keywords}')" title="åˆ é™¤">Ã—</button>
              </div>
            `).join('');
          }
        }
      } catch (error) {
        console.error('åŠ è½½ä¸»é¢˜å¤±è´¥:', error);
      }
    }

    // æ·»åŠ äº¤äº’è¿‡ç¨‹æ—¥å¿—
    function addProcessLog(message, type = 'info', data = null) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl) return;
      
      const stepEl = document.createElement('div');
      stepEl.className = `process-step ${type}`;
      
      const time = new Date().toLocaleTimeString('zh-CN');
      let html = `<div class="process-message">${escapeHtml(message)}<span class="process-time">${time}</span></div>`;
      
      if (data) {
        html += `<div class="process-data">${escapeHtml(JSON.stringify(data, null, 2))}</div>`;
      }
      
      stepEl.innerHTML = html;
      processEl.appendChild(stepEl);
      processEl.scrollTop = processEl.scrollHeight;
    }

    // æ¸²æŸ“ä¿å­˜çš„æ¨èè¿‡ç¨‹æ—¥å¿—
    function renderProcessLogs(logs) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl || !logs || logs.length === 0) return;
      
      processEl.innerHTML = '';
      logs.forEach(log => {
        const stepEl = document.createElement('div');
        stepEl.className = `process-step ${log.type || 'info'}`;
        
        const time = log.timestamp ? new Date(log.timestamp).toLocaleTimeString('zh-CN') : '';
        let html = `<div class="process-message">${escapeHtml(log.message)}<span class="process-time">${time}</span></div>`;
        
        if (log.data) {
          html += `<div class="process-data">${escapeHtml(JSON.stringify(log.data, null, 2))}</div>`;
        }
        
        stepEl.innerHTML = html;
        processEl.appendChild(stepEl);
      });
      processEl.scrollTop = processEl.scrollHeight;
    }

    // æ˜¾ç¤ºæ·»åŠ ä¸»é¢˜å¼¹çª—
    function showAddTopicModal() {
      const modal = document.getElementById('addTopicModal');
      if (modal) {
        modal.classList.add('show');
        // èšç„¦åˆ°è¾“å…¥æ¡†
        setTimeout(() => {
          const input = document.getElementById('topicInput');
          if (input) input.focus();
        }, 100);
      }
    }

    // å…³é—­æ·»åŠ ä¸»é¢˜å¼¹çª—
    function closeAddTopicModal(event) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯å…³é—­æŒ‰é’®æˆ–é®ç½©å±‚ï¼Œå…³é—­å¼¹çª—
      if (!event || event.target.classList.contains('modal-overlay') || event.target.classList.contains('modal-close')) {
        const modal = document.getElementById('addTopicModal');
        if (modal) {
          modal.classList.remove('show');
          // æ¸…ç©ºè¾“å…¥æ¡†
          const input = document.getElementById('topicInput');
          if (input) input.value = '';
        }
      }
    }

    // æ¨èä¿¡æ¯æº
    async function recommendSources() {
      const topicInputEl = document.getElementById('topicInput');
      if (!topicInputEl) {
        console.error('[æ¨è] é”™è¯¯ï¼šæ‰¾ä¸åˆ° topicInput å…ƒç´ ');
        showMessage('æ— æ³•æ‰¾åˆ°è¾“å…¥æ¡†ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
        return;
      }
      
      const keywords = topicInputEl.value.trim();
      console.log('[æ¨è] è·å–åˆ°çš„å…³é”®è¯:', keywords);
      
      if (!keywords) {
        console.warn('[æ¨è] å…³é”®è¯ä¸ºç©ºï¼Œåœæ­¢æ‰§è¡Œ');
        showMessage('è¯·è¾“å…¥ä¸»é¢˜å…³é”®è¯', 'error');
        return;
      }

      // å…ˆä¿å­˜å…³é”®è¯åˆ°å˜é‡ï¼Œå†å…³é—­å¼¹çª—ï¼ˆé¿å…å¼¹çª—å…³é—­åæ— æ³•è®¿é—®è¾“å…¥æ¡†ï¼‰
      const savedKeywords = keywords;
      
      // ç«‹å³å…³é—­å¼¹çª—
      closeAddTopicModal();

      const recommendBtn = document.getElementById('recommendBtn');
      recommendBtn.disabled = true;
      recommendBtn.textContent = 'æ­£åœ¨ä¿å­˜ä¸»é¢˜...';

      try {
        // ä½¿ç”¨ä¿å­˜çš„å…³é”®è¯å˜é‡
        console.log('[æ¨è] ä½¿ç”¨ä¿å­˜çš„å…³é”®è¯:', savedKeywords);
        
        // å…ˆä¿å­˜ä¸»é¢˜åˆ°æ•°æ®åº“ï¼Œç¡®ä¿å·²ä¿å­˜æˆåŠŸ
        const saveResult = await saveTopic(savedKeywords);
        
        if (!saveResult || !saveResult.success) {
          throw new Error('ä¿å­˜ä¸»é¢˜å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
        
        console.log('âœ… ä¸»é¢˜å·²æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“ï¼Œç»§ç»­è·å–æ¨è...');
        
        // æ›´æ–°æŒ‰é’®æ–‡æœ¬
        recommendBtn.textContent = 'æ­£åœ¨è·å–æ¨è...';
      } catch (saveError) {
        // ä¿å­˜å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯å¹¶æ¢å¤æŒ‰é’®çŠ¶æ€
        console.error('[æ¨è] ä¿å­˜ä¸»é¢˜å¤±è´¥:', saveError);
        showMessage('ä¿å­˜ä¸»é¢˜å¤±è´¥: ' + saveError.message, 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'è·å–æ¨è';
        return; // åœæ­¢åç»­æ“ä½œ
      }

      // åˆ›å»ºæ–°ä¸»é¢˜çš„é¡µç­¾å¹¶é€‰ä¸­ï¼ˆåœ¨ try å—å¤–ï¼Œç¡®ä¿ newTabIndex åœ¨åç»­ä»£ç ä¸­å¯ç”¨ï¼‰
      let newTabIndex = -1;
      try {
        newTabIndex = createNewTopicTab(savedKeywords);
        if (newTabIndex >= 0) {
          switchTopicTab(newTabIndex);
          // æ˜¾ç¤ºé¡µç­¾å®¹å™¨
          document.getElementById('topicsTabsSection').style.display = 'block';
        }
      } catch (tabError) {
        console.error('[æ¨è] åˆ›å»ºé¡µç­¾å¤±è´¥:', tabError);
      }

      if (newTabIndex < 0) {
        console.error('[æ¨è] âŒ åˆ›å»ºä¸»é¢˜é¡µç­¾å¤±è´¥ï¼Œæ— æ³•ç»§ç»­æ¨è');
        showMessage('åˆ›å»ºä¸»é¢˜é¡µç­¾å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'è·å–æ¨è';
        return;
      }

      // åœ¨é¡µç­¾ä¸­æ˜¾ç¤ºæ¨èè¿‡ç¨‹ï¼ˆå°å­—æ˜¾ç¤ºï¼‰
      addProcessLogInTab(newTabIndex, `å¼€å§‹ä¸ºå…³é”®è¯ "${savedKeywords}" è·å–æ¨èä¿¡æ¯æº...`, 'loading');
 
      // åˆå§‹åŒ–æ¨èä¿¡æ¯æºåˆ—è¡¨ï¼ˆç”¨äºå®æ—¶æ·»åŠ ï¼‰
      if (!window.recommendedSourcesByTab) {
        window.recommendedSourcesByTab = {};
      }
      window.recommendedSourcesByTab[newTabIndex] = [];

      try {
        console.log(`[æ¨è] å¼€å§‹è°ƒç”¨æ¨èæ¥å£ï¼Œå…³é”®è¯: "${savedKeywords}"`);
        console.log(`[æ¨è] APIåœ°å€: ${API_BASE_URL}/user/topics/recommend`);
        console.log(`[æ¨è] è¯·æ±‚ä½“:`, JSON.stringify({ keywords: savedKeywords }));
        
        // ä½¿ç”¨ fetch è·å–æµå¼å“åº”ï¼Œå®æ—¶æ˜¾ç¤ºè¿›åº¦
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords: savedKeywords })
        });

        console.log(`[æ¨è] æ”¶åˆ°å“åº”ï¼ŒçŠ¶æ€ç : ${response.status}, Content-Type: ${response.headers.get('Content-Type')}`);

        if (!response.ok) {
          const errorText = await response.text();
          console.error(`[æ¨è] HTTPé”™è¯¯: ${response.status}`, errorText);
          throw new Error(`HTTP error! status: ${response.status}: ${errorText}`);
        }

        // æ£€æŸ¥å“åº”ä½“æ˜¯å¦å­˜åœ¨
        if (!response.body) {
          console.error('[æ¨è] å“åº”ä½“ä¸ºç©º');
          throw new Error('å“åº”ä½“ä¸ºç©ºï¼Œæ— æ³•è¯»å–æµå¼æ•°æ®');
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        let hasReceivedData = false;

        console.log('[æ¨è] å¼€å§‹è¯»å–æµå¼å“åº”...');

        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            console.log('[æ¨è] æµå¼å“åº”è¯»å–å®Œæˆ');
            break;
          }
          
          hasReceivedData = true;
          
          // è§£ç æ•°æ®å¹¶æ·»åŠ åˆ°ç¼“å†²åŒº
          buffer += decoder.decode(value, { stream: true });
          
          // æŒ‰è¡Œåˆ†å‰²å¹¶å¤„ç†æ¯è¡Œ JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ä¿ç•™æœ€åä¸å®Œæ•´çš„è¡Œ
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                console.log('[æ¨è] æ”¶åˆ°è¿›åº¦æ•°æ®:', progress.type, progress.message || '');
                
                // å®æ—¶æ›´æ–°è¿›åº¦æ˜¾ç¤º
                if (progress.type === 'progress') {
                  addProcessLogInTab(newTabIndex, progress.message, progress.logType || 'info');
                } else if (progress.type === 'sourcesReceived') {
                  // DeepSeekè¿”å›çš„æ‰€æœ‰æ¨èä¿¡æ¯æºï¼Œç«‹å³æ˜¾ç¤ºè¡¨æ ¼
                  if (progress.sources && progress.sources.length > 0) {
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    window.recommendedSourcesByTab[newTabIndex] = progress.sources;
                    // ç«‹å³æ¸²æŸ“è¡¨æ ¼ï¼ˆæ‰€æœ‰ä¿¡æ¯æºæ˜¾ç¤ºä¸º"éªŒè¯ä¸­..."ï¼‰
                    renderRecommendationsInTab(newTabIndex, progress.sources);
                  }
                } else if (progress.type === 'sourceValidated') {
                  // éªŒè¯å®Œæˆçš„ä¿¡æ¯æºï¼Œæ›´æ–°è¡¨æ ¼ä¸­å¯¹åº”è¡Œçš„æœ‰æ•ˆæ€§çŠ¶æ€
                  if (progress.source) {
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    if (!window.recommendedSourcesByTab[newTabIndex]) {
                      window.recommendedSourcesByTab[newTabIndex] = [];
                    }
                    
                    // æŸ¥æ‰¾å¹¶æ›´æ–°å¯¹åº”çš„ä¿¡æ¯æº
                    const sourceIndex = window.recommendedSourcesByTab[newTabIndex].findIndex(
                      s => (s.sourceUrl || s.url) === (progress.source.sourceUrl || progress.source.url)
                    );
                    
                    if (sourceIndex >= 0) {
                      // æ›´æ–°ç°æœ‰ä¿¡æ¯æº
                      window.recommendedSourcesByTab[newTabIndex][sourceIndex] = progress.source;
                    } else {
                      // å¦‚æœæ‰¾ä¸åˆ°ï¼Œæ·»åŠ æ–°çš„
                      window.recommendedSourcesByTab[newTabIndex].push(progress.source);
                    }
                    
                    // å®æ—¶æ›´æ–°è¡¨æ ¼
                    renderRecommendationsInTab(newTabIndex, window.recommendedSourcesByTab[newTabIndex]);
                  }
                } else if (progress.type === 'final') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('è§£æè¿›åº¦æ•°æ®å¤±è´¥:', e, line);
              }
            }
          }
        }

        // å¤„ç†æœ€ç»ˆç»“æœ
        if (!hasReceivedData) {
          console.warn('[æ¨è] è­¦å‘Šï¼šæ²¡æœ‰æ”¶åˆ°ä»»ä½•æ•°æ®');
          addProcessLogInTab(newTabIndex, 'æœªæ”¶åˆ°æœåŠ¡å™¨å“åº”æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•', 'error');
          showMessage('æœªæ”¶åˆ°æœåŠ¡å™¨å“åº”ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
        } else if (finalResult) {
          console.log('[æ¨è] æ”¶åˆ°æœ€ç»ˆç»“æœ:', finalResult.success ? 'æˆåŠŸ' : 'å¤±è´¥');
          if (finalResult.success) {
            recommendedSources = finalResult.data || [];
            
            // ä¿å­˜æ¨èå†å²åˆ°æ•°æ®åº“ï¼ˆåç«¯å·²ç»åœ¨ recommend æ¥å£ä¸­ä¿å­˜äº†ï¼‰
            // é‡æ–°åŠ è½½æ‰€æœ‰æ¨èå†å²ï¼ˆåŒ…æ‹¬æ–°æ·»åŠ çš„ï¼‰ï¼Œè¿™ä¼šæ›´æ–°é¡µç­¾å†…å®¹
            await loadAllRecommendationHistory();
            
            // ç¡®ä¿é€‰ä¸­æ–°æ·»åŠ çš„ä¸»é¢˜é¡µç­¾ï¼ˆæ ¹æ®ä¸»é¢˜å…³é”®è¯ç²¾ç¡®æŸ¥æ‰¾ï¼‰
            const tabsHeader = document.getElementById('topicsTabsHeader');
            const tabsContent = document.getElementById('topicsTabsContent');
            if (tabsHeader && tabsContent) {
              const tabs = Array.from(tabsHeader.children);
              const panels = Array.from(tabsContent.children);
              
              // ç²¾ç¡®åŒ¹é…ä¸»é¢˜å…³é”®è¯
              for (let i = 0; i < tabs.length; i++) {
                const panel = panels[i];
                if (panel && panel.dataset.history) {
                  try {
                    const history = JSON.parse(panel.dataset.history);
                    if (history.topic_keywords === savedKeywords.trim()) {
                      switchTopicTab(i);
                      // ç¡®ä¿é¡µç­¾å®¹å™¨å¯è§
                      document.getElementById('topicsTabsSection').style.display = 'block';
                      break;
                    }
                  } catch (e) {
                    console.error('è§£æå†å²æ•°æ®å¤±è´¥:', e);
                  }
                }
              }
            }
            
            // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬ä»¥æ˜¾ç¤ºæ–°æ·»åŠ çš„ä¸»é¢˜
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('ğŸ“š è·å–æ¨èåï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
              await loadArticlesTopicsTabs();
            }
            
            showMessage(finalResult.message || `å·²æ‰¾åˆ° ${recommendedSources.length} ä¸ªæ¨èä¿¡æ¯æº`, 'success');
          } else {
            console.error('[æ¨è] æ¨èå¤±è´¥:', finalResult.message);
            addProcessLogInTab(newTabIndex, finalResult.message || 'è·å–æ¨èå¤±è´¥', 'error');
            showMessage(finalResult.message || 'è·å–æ¨èå¤±è´¥', 'error');
          }
        } else {
          console.warn('[æ¨è] è­¦å‘Šï¼šæ²¡æœ‰æ”¶åˆ°æœ€ç»ˆç»“æœï¼Œä½†å·²æ”¶åˆ°éƒ¨åˆ†æ•°æ®');
          addProcessLogInTab(newTabIndex, 'æ¨èè¿‡ç¨‹å¯èƒ½æœªå®Œæˆï¼Œè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹ç»“æœ', 'warning');
          showMessage('æ¨èè¿‡ç¨‹å¯èƒ½æœªå®Œæˆï¼Œè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹', 'warning');
        }
      } catch (error) {
        console.error('[æ¨è] æ•è·åˆ°é”™è¯¯:', error);
        addProcessLogInTab(newTabIndex, 'API è°ƒç”¨å¼‚å¸¸: ' + error.message, 'error');
        showMessage('è·å–æ¨èå¤±è´¥: ' + error.message, 'error');
      } finally {
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'è·å–æ¨è';
      }
    }

    // åˆ›å»ºæ–°ä¸»é¢˜çš„ä¸´æ—¶é¡µç­¾ï¼ˆåœ¨æ¨èå¼€å§‹æ—¶å°±åˆ›å»ºï¼‰
    function createNewTopicTab(keywords) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return -1;
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è¯¥ä¸»é¢˜çš„é¡µç­¾
      const existingHistories = Array.from(tabsHeader.children).map((tab, idx) => {
        const panel = document.getElementById(`panel-${idx}`);
        if (panel && panel.dataset.history) {
          try {
            const history = JSON.parse(panel.dataset.history);
            return history.topic_keywords;
          } catch (e) {
            return null;
          }
        }
        return null;
      });
      
      const existingIndex = existingHistories.findIndex(k => k === keywords.trim());
      if (existingIndex >= 0) {
        return existingIndex;
      }
      
      // è·å–å½“å‰é¡µç­¾æ•°é‡
      const currentTabCount = tabsHeader.children.length;
      const newTabIndex = currentTabCount;
      const tabId = `tab-${newTabIndex}`;
      const panelId = `panel-${newTabIndex}`;
      
      // åˆ›å»ºé¡µç­¾æŒ‰é’®
      const tabBtn = document.createElement('button');
      tabBtn.className = `topic-tab active`;
      tabBtn.id = tabId;
      tabBtn.onclick = () => switchTopicTab(newTabIndex);
      tabBtn.innerHTML = `${escapeHtml(keywords)}<span class="tab-badge">æ¨èä¸­...</span>`;
      tabsHeader.appendChild(tabBtn);
      
      // å–æ¶ˆå…¶ä»–é¡µç­¾çš„activeçŠ¶æ€
      Array.from(tabsHeader.children).forEach((tab, idx) => {
        if (idx !== newTabIndex) {
          tab.classList.remove('active');
        }
      });
      
      // åˆ›å»ºé¡µç­¾å†…å®¹é¢æ¿
      const panel = document.createElement('div');
      panel.className = `topic-tab-panel active`;
      panel.id = panelId;
      
      // åˆ›å»ºä¸´æ—¶å†å²æ•°æ®ï¼ˆè¿˜æ²¡æœ‰æ¨èç»“æœï¼‰
      const tempHistory = {
        topic_keywords: keywords.trim(),
        process_logs: [],
        recommended_sources: []
      };
      panel.dataset.history = JSON.stringify(tempHistory);
      
      // æ¨èè¿‡ç¨‹æ—¥å¿—åŒºåŸŸï¼ˆæ”¹ä¸ºå•è¡Œè¿›åº¦æ˜¾ç¤ºï¼‰
      const processLogsHtml = `
        <div style="font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;" id="processText-${newTabIndex}">
          å‡†å¤‡å¼€å§‹æ¨è...
        </div>
      `;
      
        // æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æºåŒºåŸŸ
        const manualAddSourceHtml = `
          <div class="manual-add-source" id="manualAddSource-${newTabIndex}">
            <h5>ğŸ“ æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æº</h5>
            <div class="manual-add-source-form">
              <div class="form-group">
                <label for="manualSourceName-${newTabIndex}">ä¿¡æ¯æºåç§°</label>
                <input type="text" id="manualSourceName-${newTabIndex}" placeholder="è¯·è¾“å…¥ä¿¡æ¯æºåç§°" onkeypress="if(event.key==='Enter') document.getElementById('manualSourceUrl-${newTabIndex}').focus()" />
              </div>
              <div class="form-group" style="flex: 2; min-width: 300px;">
                <label for="manualSourceUrl-${newTabIndex}">ä¿¡æ¯æºURL</label>
                <input type="url" id="manualSourceUrl-${newTabIndex}" placeholder="https://example.com/feed.xml" onkeypress="if(event.key==='Enter') handleManualAddSource(${newTabIndex})" />
              </div>
              <button class="manual-add-source-btn" onclick="handleManualAddSource(${newTabIndex})" id="manualAddBtn-${newTabIndex}">
                æ·»åŠ å¹¶è®¢é˜…
              </button>
            </div>
          </div>
        `;
      
      // æ¨èä¿¡æ¯æºè¡¨æ ¼ç»“æ„ï¼ˆåˆå§‹ä¸ºç©ºï¼Œç­‰å¾…æ•°æ®ï¼‰
      const recommendationsHtml = `
        <div class="recommendations-filters" id="filters-${newTabIndex}" style="display: none;">
          <div class="filter-group">
            <label>åœ°åŒºï¼š</label>
            <select id="regionFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">å…¨éƒ¨</option>
              <option value="å›½å†…">å›½å†…</option>
              <option value="å›½å¤–">å›½å¤–</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ç±»å‹ï¼š</label>
            <select id="typeFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">å…¨éƒ¨</option>
            </select>
          </div>
          <div class="recommendations-stats" id="recommendationsStats-${newTabIndex}"></div>
        </div>
        <table class="recommendations-table" id="recommendationsTable-${newTabIndex}" style="display: none;">
          <thead>
            <tr>
              <th class="checkbox-cell"></th>
              <th>ä¿¡æ¯æº</th>
              <th>ç±»å‹</th>
              <th>åœ°åŒº</th>
              <th>æè¿°</th>
              <th>æœ‰æ•ˆæ€§</th>
              <th>çŠ¶æ€</th>
            </tr>
          </thead>
          <tbody id="recommendationsBody-${newTabIndex}">
          </tbody>
        </table>
        <p id="recommendationsEmpty-${newTabIndex}" style="color: #999; padding: 20px; text-align: center;">æ­£åœ¨è·å–æ¨èä¿¡æ¯æºï¼Œè¯·ç¨å€™...</p>
      `;
      
      panel.innerHTML = processLogsHtml + manualAddSourceHtml + recommendationsHtml;
      
      // å–æ¶ˆå…¶ä»–é¢æ¿çš„activeçŠ¶æ€
      Array.from(tabsContent.children).forEach((p, idx) => {
        if (idx !== newTabIndex) {
          p.classList.remove('active');
        }
      });
      
      tabsContent.appendChild(panel);
      
      return newTabIndex;
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­æ·»åŠ æ¨èè¿‡ç¨‹æ—¥å¿—
    function addProcessLogInTab(tabIndex, message, type = 'info', data = null) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      
      // æ›´æ–°è¿›åº¦æ–‡æœ¬ï¼ˆå°å­—æ˜¾ç¤ºï¼‰
      if (processTextEl) {
        processTextEl.textContent = message;
      } else {
        // å¦‚æœæ²¡æœ‰æ–‡æœ¬å…ƒç´ ï¼Œåˆ›å»ºæ–°çš„ç»“æ„
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (panel) {
          const processDiv = document.createElement('div');
          processDiv.id = `processText-${tabIndex}`;
          processDiv.style.cssText = 'font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;';
          processDiv.textContent = message;
          // æ’å…¥åˆ°é¢æ¿çš„æœ€å‰é¢
          panel.insertBefore(processDiv, panel.firstChild);
        }
      }
    }

    // åŠ è½½ç”¨æˆ·è®¢é˜…åˆ—è¡¨
    async function loadUserSubscriptions(topicKeywords = null) {
      try {
        let url = `${API_BASE_URL}/user/subscriptions`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          // å¦‚æœæŒ‡å®šäº†ä¸»é¢˜ï¼Œåªè¿”å›è¯¥ä¸»é¢˜çš„è®¢é˜…ï¼›å¦åˆ™è¿”å›æ‰€æœ‰è®¢é˜…
          if (topicKeywords && topicKeywords.trim()) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          } else {
            // å­˜å‚¨æ‰€æœ‰è®¢é˜…ï¼Œä½†æŒ‰ä¸»é¢˜åˆ†ç»„
            if (!window.allUserSubscriptions) {
              window.allUserSubscriptions = {};
            }
            result.data.forEach(sub => {
              const topic = sub.topic_keywords || '';
              if (!window.allUserSubscriptions[topic]) {
                window.allUserSubscriptions[topic] = [];
              }
              window.allUserSubscriptions[topic].push(sub.source_name);
            });
            // ä¸ºäº†å…¼å®¹æ€§ï¼Œä»ç„¶è®¾ç½® userSubscriptions ä¸ºæ‰€æœ‰è®¢é˜…çš„ source_name
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        }
      } catch (error) {
        console.error('åŠ è½½è®¢é˜…åˆ—è¡¨å¤±è´¥:', error);
        userSubscriptions = [];
      }
    }


    // ä¿å­˜ä¸»é¢˜
    async function saveTopic(keywords) {
      try {
        console.log(`ğŸ’¾ å¼€å§‹ä¿å­˜ä¸»é¢˜åˆ°æ•°æ®åº“: "${keywords}"`);
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords }),
          cache: 'no-cache'
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.message || 'ä¿å­˜ä¸»é¢˜å¤±è´¥');
        }
        
        console.log(`âœ… ä¸»é¢˜å·²æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“: "${keywords}"`);
        
        // é‡æ–°åŠ è½½ä¸»é¢˜åˆ—è¡¨ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®
        await loadTopics();
        
        // ç«‹å³åˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾ï¼Œç¡®ä¿æ–°ä¸»é¢˜çš„é¡µç­¾æ˜¾ç¤º
        const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
        if (articlesTopicsTabsHeader) {
          console.log('ğŸ“š åˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
          await loadArticlesTopicsTabs();
        }
        
        return { success: true, topic: result.topic };
      } catch (error) {
        console.error('âŒ ä¿å­˜ä¸»é¢˜å¤±è´¥:', error);
        throw error; // æŠ›å‡ºé”™è¯¯ï¼Œè®©è°ƒç”¨è€…çŸ¥é“ä¿å­˜å¤±è´¥
      }
    }

    // æ¸²æŸ“æ¨èä¿¡æ¯æºï¼ˆå¸¦è¿‡æ»¤åŠŸèƒ½ï¼‰
    function renderRecommendations() {
      const tbody = document.getElementById('recommendationsBody');
      if (!tbody) return;
      
      // è·å–è¿‡æ»¤æ¡ä»¶
      const regionFilter = document.getElementById('regionFilter')?.value || 'all';
      const typeFilter = document.getElementById('typeFilter')?.value || 'all';
      
      // è¿‡æ»¤æ•°æ®
      let filteredSources = recommendedSources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'å›½å¤–') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      tbody.innerHTML = filteredSources.map((source, index) => {
        const isSubscribed = userSubscriptions.includes(source.sourceName);
        const region = source.region || 'å›½å¤–';
        const regionClass = region === 'å›½å†…' ? 'region-domestic' : 'region-foreign';
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${recommendedSources.indexOf(source)}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChange(this)">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'å·²è®¢é˜…' : 'æœªè®¢é˜…'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      updateRecommendationsStats(filteredSources.length, recommendedSources.length);
    }
    
    // æ›´æ–°æ¨èç»Ÿè®¡ä¿¡æ¯
    function updateRecommendationsStats(filtered, total) {
      const statsEl = document.getElementById('recommendationsStats');
      if (statsEl) {
        statsEl.textContent = `æ˜¾ç¤º ${filtered} / å…± ${total} ä¸ªä¿¡æ¯æº`;
      }
    }

    // å…¨é€‰/å–æ¶ˆå…¨é€‰
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.source-checkbox');
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
    }

    // å¤„ç†æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æº
    async function handleManualAddSource(tabIndex) {
      const sourceNameInput = document.getElementById(`manualSourceName-${tabIndex}`);
      const sourceUrlInput = document.getElementById(`manualSourceUrl-${tabIndex}`);
      const addBtn = document.getElementById(`manualAddBtn-${tabIndex}`);
      
      if (!sourceNameInput || !sourceUrlInput) {
        showMessage('æ‰¾ä¸åˆ°è¾“å…¥æ¡†å…ƒç´ ', 'error');
        return;
      }
      
      const sourceName = sourceNameInput.value.trim();
      const sourceUrl = sourceUrlInput.value.trim();
      
      // éªŒè¯è¾“å…¥
      if (!sourceName) {
        showMessage('è¯·è¾“å…¥ä¿¡æ¯æºåç§°', 'error');
        sourceNameInput.focus();
        return;
      }
      
      if (!sourceUrl) {
        showMessage('è¯·è¾“å…¥ä¿¡æ¯æºURL', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // éªŒè¯URLæ ¼å¼
      try {
        new URL(sourceUrl);
      } catch (e) {
        showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„URLæ ¼å¼', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // è·å–å½“å‰ä¸»é¢˜å…³é”®è¯
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) {
        showMessage('æ‰¾ä¸åˆ°ä¸»é¢˜ä¿¡æ¯', 'error');
        return;
      }
      
      const history = JSON.parse(panel.dataset.history || '{}');
      const topicKeywords = history.topic_keywords || '';
      
      if (!topicKeywords || !topicKeywords.trim()) {
        showMessage('æ— æ³•æ·»åŠ ï¼šç¼ºå°‘ä¸»é¢˜å…³é”®è¯', 'error');
        return;
      }
      
      // ç¦ç”¨æŒ‰é’®
      addBtn.disabled = true;
      addBtn.textContent = 'æ·»åŠ ä¸­...';
      
      try {
        // åˆ¤æ–­ä¿¡æ¯æºç±»å‹ï¼ˆç®€å•åˆ¤æ–­ï¼šå¦‚æœURLåŒ…å«rss/feed/xmlç­‰ï¼Œè®¤ä¸ºæ˜¯RSSï¼Œå¦åˆ™æ˜¯blogï¼‰
        let sourceType = 'rss';
        const urlLower = sourceUrl.toLowerCase();
        if (!urlLower.includes('rss') && !urlLower.includes('feed') && !urlLower.includes('.xml') && !urlLower.includes('atom')) {
          sourceType = 'blog';
        }
        
        const subscriptionData = {
          sourceName: sourceName,
          sourceUrl: sourceUrl,
          sourceType: sourceType,
          topicKeywords: topicKeywords
        };
        
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: [subscriptionData] })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`æˆåŠŸæ·»åŠ å¹¶è®¢é˜…ä¿¡æ¯æºï¼š${sourceName}`, 'success');
          
          // æ¸…ç©ºè¾“å…¥æ¡†
          sourceNameInput.value = '';
          sourceUrlInput.value = '';
          
          // é‡æ–°åŠ è½½è®¢é˜…åˆ—è¡¨
          await loadUserSubscriptions();
          
          // å¦‚æœè¯¥é¡µç­¾æœ‰æ¨èä¿¡æ¯æºï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°çŠ¶æ€
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            await renderRecommendationsInTab(tabIndex, history.recommended_sources);
          }
          
          // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('ğŸ“š æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æºåï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
            await loadArticlesTopicsTabs();
          }
        } else {
          showMessage(result.message || 'æ·»åŠ è®¢é˜…å¤±è´¥', 'error');
        }
      } catch (error) {
        console.error('æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æºå¤±è´¥:', error);
        showMessage('æ·»åŠ è®¢é˜…å¤±è´¥: ' + error.message, 'error');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'æ·»åŠ å¹¶è®¢é˜…';
      }
    }

    // è®¢é˜…é€‰ä¸­çš„ä¿¡æ¯æº
    async function subscribeSelected() {
      const checkboxes = document.querySelectorAll('.source-checkbox:checked');
      if (checkboxes.length === 0) {
        showMessage('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªä¿¡æ¯æº', 'error');
        return;
      }

      const subscribeBtn = document.getElementById('subscribeBtn');
      subscribeBtn.disabled = true;
      subscribeBtn.textContent = 'è®¢é˜…ä¸­...';

      const selectedSources = Array.from(checkboxes).map(cb => {
        const index = parseInt(cb.dataset.index);
        return recommendedSources[index];
      });

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: selectedSources })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`æˆåŠŸè®¢é˜… ${selectedSources.length} ä¸ªä¿¡æ¯æº`, 'success');
          // é‡æ–°åŠ è½½è®¢é˜…åˆ—è¡¨å¹¶æ›´æ–°è¡¨æ ¼æ˜¾ç¤º
          await loadUserSubscriptions();
          renderRecommendations();
          // ä¸æ¸…ç©ºè¾“å…¥æ¡†å’Œæ¨èåˆ—è¡¨ï¼Œä¿ç•™è¡¨æ ¼ä¾›ç”¨æˆ·æŸ¥çœ‹å’Œä¿®æ”¹
        } else {
          showMessage(result.message || 'è®¢é˜…å¤±è´¥', 'error');
        }
      } catch (error) {
        showMessage('è®¢é˜…å¤±è´¥: ' + error.message, 'error');
      } finally {
        subscribeBtn.disabled = false;
        subscribeBtn.textContent = 'è®¢é˜…é€‰ä¸­';
      }
    }

    // åˆ é™¤ä¸»é¢˜
    async function removeTopic(keywords) {
      if (!confirm(`ç¡®å®šè¦åˆ é™¤ä¸»é¢˜ "${keywords}" å—ï¼Ÿ\n\nåˆ é™¤åå°†åŒæ—¶åˆ é™¤ï¼š\n- è¯¥ä¸»é¢˜çš„æ‰€æœ‰ä¿¡æ¯æºè®¢é˜…\n- è¿™äº›ä¿¡æ¯æºæ”¶é›†çš„æ‰€æœ‰æ–‡ç« \n- è¯¥ä¸»é¢˜çš„æ¨èå†å²\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
        return;
      }

      try {
        const response = await fetch(
          `${API_BASE_URL}/user/topics/${encodeURIComponent(keywords)}`,
          {
            method: 'DELETE',
            headers: getHeaders()
          }
        );

        const result = await response.json();

        if (result.success) {
          let message = result.message || 'ä¸»é¢˜åˆ é™¤æˆåŠŸ';
          if (result.deletedSubscriptionCount > 0 || result.deletedArticleCount > 0) {
            message += `ï¼ˆå·²åˆ é™¤ ${result.deletedSubscriptionCount || 0} ä¸ªè®¢é˜…ï¼Œ${result.deletedArticleCount || 0} ç¯‡æ–‡ç« ï¼‰`;
          }
          showMessage(message, 'success');
          
          console.log(`ğŸ—‘ï¸  ä¸»é¢˜ "${keywords}" åˆ é™¤æˆåŠŸï¼Œå¼€å§‹åˆ·æ–°é¡µé¢...`);
          
          // é‡æ–°åŠ è½½ä¸»é¢˜åˆ—è¡¨
          await loadTopics();
          
          // å¼ºåˆ¶åˆ·æ–°æ¨èå†å²ï¼ˆç¡®ä¿åˆ é™¤çš„é¡µç­¾è¢«ç§»é™¤ï¼‰
          console.log('ğŸ”„ åˆ·æ–°æ¨èå†å²é¡µç­¾...');
          await loadAllRecommendationHistory();
          
          // å¦‚æœå½“å‰åœ¨æ–‡ç« é˜…è¯»é¡µé¢ï¼Œåˆ·æ–°æ–‡ç« åˆ—è¡¨
          if (document.getElementById('articlesPage').classList.contains('active')) {
            console.log('ğŸ”„ åˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
            await loadArticlesTopicsTabs();
          }
          
          console.log('âœ… é¡µé¢åˆ·æ–°å®Œæˆ');
        } else {
          showMessage(result.message || 'åˆ é™¤å¤±è´¥', 'error');
        }
      } catch (error) {
        showMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
      }
    }

    // æ ¼å¼åŒ–æ—¶é—´å·®
    function formatTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const minutes = Math.floor(diff / 60000);
      
      if (minutes < 1) return 'åˆšåˆš';
      if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}å°æ—¶å‰`;
      const days = Math.floor(hours / 24);
      return `${days}å¤©å‰`;
    }

    // è®¡ç®—å‘å¸ƒæ—¶é—´èŒƒå›´
    function calculatePublishDateRange(articles) {
      if (!articles || articles.length === 0) {
        return '-';
      }
      
      const dates = articles.map(a => new Date(a.publish_date)).filter(d => !isNaN(d));
      if (dates.length === 0) return '-';
      
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      
      const formatDate = (d) => {
        const month = d.getMonth() + 1;
        const day = d.getDate();
        return `${month}æœˆ${day}æ—¥`;
      };
      
      if (minDate.toDateString() === maxDate.toDateString()) {
        return formatDate(minDate);
      } else {
        return `${formatDate(minDate)} - ${formatDate(maxDate)}`;
      }
    }

    // è®¡ç®—æœ€è¿‘åˆ·æ–°çš„æ–‡ç« æ•°ï¼ˆæœ€è¿‘10åˆ†é’Ÿï¼‰
    function calculateRecentArticlesCount(articles) {
      if (!articles || articles.length === 0) return 0;
      
      const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000);
      return articles.filter(a => {
        const created = new Date(a.created_at || a.publish_date);
        return created >= tenMinutesAgo;
      }).length;
    }

    // åŠ è½½åˆ·æ–°çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
    async function loadRefreshStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/news/update-info`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          const lastUpdateTime = data.lastUpdateTime ? new Date(data.lastUpdateTime) : null;
          
          if (lastUpdateTime) {
            document.getElementById('lastRefreshTime').textContent = formatTimeAgo(lastUpdateTime);
          } else {
            document.getElementById('lastRefreshTime').textContent = '-';
          }
        }
      } catch (error) {
        console.error('åŠ è½½åˆ·æ–°çŠ¶æ€å¤±è´¥:', error);
      }
    }

    // ç«‹å³åˆ·æ–°æ–°é—»
    async function refreshNewsNow(tabIndex = null) {
      // å¦‚æœä¼ å…¥äº†tabIndexï¼Œä½¿ç”¨å¯¹åº”çš„æŒ‰é’®ï¼›å¦åˆ™å°è¯•æŸ¥æ‰¾é€šç”¨æŒ‰é’®
      let btn;
      let progressEl;
      let progressTextEl;
      
      if (tabIndex !== null) {
        btn = document.getElementById(`refreshNowBtn-${tabIndex}`);
        progressEl = document.getElementById(`refreshProgress-${tabIndex}`);
        progressTextEl = document.getElementById(`refreshProgressText-${tabIndex}`);
      } else {
        btn = document.getElementById('refreshNowBtn');
        progressEl = document.getElementById('refreshProgress');
        progressTextEl = document.getElementById('refreshProgressText');
      }
      
      if (!btn) {
        console.error('æ‰¾ä¸åˆ°åˆ·æ–°æŒ‰é’®');
        return;
      }
      
      btn.disabled = true;
      btn.classList.add('refreshing');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>ğŸ”„</span> åˆ·æ–°ä¸­...';
      
      // æ˜¾ç¤ºè¿›åº¦åŒºåŸŸ
      if (progressEl) {
        progressEl.classList.add('show');
      }
      if (progressTextEl) {
        progressTextEl.textContent = 'å‡†å¤‡å¼€å§‹æ”¶é›†...';
      }
      
      try {
        // æ„å»ºè¯·æ±‚ä½“ï¼Œå¦‚æœæ˜¯åœ¨ä¸»é¢˜é¡µç­¾ä¸­ï¼Œä¼ é€’ä¸»é¢˜å…³é”®è¯
        const requestBody = {};
        if (tabIndex !== null && currentTopicFilter) {
          requestBody.topicKeywords = currentTopicFilter;
        }
        
        // è°ƒç”¨åç«¯æ”¶é›†æ¥å£ï¼ˆæµå¼å“åº”ï¼‰
        const response = await fetch(`${API_BASE_URL}/collect`, {
          method: 'POST',
          headers: {
            ...getHeaders(),
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        
        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            break;
          }
          
          // è§£ç æ•°æ®å¹¶æ·»åŠ åˆ°ç¼“å†²åŒº
          buffer += decoder.decode(value, { stream: true });
          
          // æŒ‰è¡Œåˆ†å‰²å¹¶å¤„ç†æ¯è¡Œ JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ä¿ç•™æœ€åä¸å®Œæ•´çš„è¡Œ
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                if (progressTextEl) {
                  if (progress.type === 'start') {
                    progressTextEl.textContent = progress.message || 'å¼€å§‹æ”¶é›†...';
                  } else if (progress.type === 'progress') {
                    const percentage = Math.round((progress.current / progress.total) * 100);
                    progressTextEl.textContent = progress.message || 
                      `${progress.sourceName} (${progress.current}/${progress.total}, ${percentage}%)`;
                  } else if (progress.type === 'complete') {
                    progressTextEl.textContent = progress.message || 'æ”¶é›†å®Œæˆ';
                  } else if (progress.type === 'final') {
                    progressTextEl.textContent = progress.message || 'å®Œæˆ';
                    finalResult = progress;
                  } else if (progress.type === 'error') {
                    progressTextEl.textContent = progress.message || 'æ”¶é›†å¤±è´¥';
                    finalResult = progress;
                  }
                }
                
                // å®æ—¶æ·»åŠ æ”¶é›†åˆ°çš„æ–‡ç« 
                if (progress.type === 'articleCollected' && progress.article) {
                  // å¦‚æœå½“å‰åœ¨æ–‡ç« é˜…è¯»é¡µé¢ï¼Œç«‹å³æ˜¾ç¤ºæ–°æ–‡ç« 
                  if (tabIndex !== null && currentTopicFilter) {
                    // æ£€æŸ¥æ–‡ç« æ˜¯å¦å±äºå½“å‰ä¸»é¢˜
                    const recommendedSources = topicRecommendationHistory[currentTopicFilter]?.recommended_sources || [];
                    const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
                    if (sourceNames.length === 0 || sourceNames.includes(progress.article.source)) {
                      addArticleToTab(tabIndex, progress.article);
                    }
                  } else {
                    // ä¸åœ¨ä¸»é¢˜é¡µç­¾ä¸­ï¼Œç›´æ¥æ·»åŠ 
                    addArticleToList(progress.article);
                  }
                } else if (progress.type === 'filterStats') {
                  // æ˜¾ç¤ºè¿‡æ»¤ç»Ÿè®¡ä¿¡æ¯
                  const statsMsg = `âœ“ æ‰¾åˆ° ${progress.relevant} ç¯‡ç›¸å…³æ–‡ç« ï¼Œæ ‡è®°äº† ${progress.irrelevant} ç¯‡ä¸ç›¸å…³æ–‡ç« ï¼ˆä¸»é¢˜ï¼š${progress.topicKeywords}ï¼‰`;
                  if (progressTextEl) {
                    progressTextEl.textContent = statsMsg;
                  }
                  console.log(`[è¿‡æ»¤ç»Ÿè®¡] ${statsMsg}`);
                  // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
                  showMessage(statsMsg, 'success');
                }
                
                // å¦‚æœæ˜¯æœ€ç»ˆç»“æœï¼Œä¿å­˜
                if (progress.type === 'final' || progress.type === 'error') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('è§£æè¿›åº¦æ•°æ®å¤±è´¥:', e, line);
              }
            }
          }
        }
        
        // å¤„ç†æœ€ç»ˆç»“æœ
        if (finalResult) {
          if (finalResult.success !== false) {
            showMessage('æ–°é—»æ”¶é›†å®Œæˆ', 'success');
            
            // ç­‰å¾…å‡ ç§’åé‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨
            setTimeout(async () => {
              if (tabIndex !== null && currentTopicFilter) {
                // å¦‚æœæ˜¯åœ¨ä¸»é¢˜é¡µç­¾ä¸­ï¼Œé‡æ–°åŠ è½½è¯¥ä¸»é¢˜çš„æ–‡ç« 
                await loadArticlesForTopic(currentTopicFilter, tabIndex, true);
                // æ›´æ–°è¯¥é¡µç­¾çš„åˆ·æ–°æ—¶é—´
                if (document.getElementById(`lastRefreshTime-${tabIndex}`)) {
                  document.getElementById(`lastRefreshTime-${tabIndex}`).textContent = 'åˆšåˆš';
                }
              } else {
                // å¦åˆ™ä½¿ç”¨åŸæœ‰çš„åŠ è½½æ–¹å¼
                await loadArticles(true);
                await loadRefreshStatus();
              }
            }, 1000);
          } else {
            showMessage('åˆ·æ–°å¤±è´¥: ' + (finalResult.message || 'æœªçŸ¥é”™è¯¯'), 'error');
          }
        }
      } catch (error) {
        console.error('åˆ·æ–°æ–°é—»å¤±è´¥:', error);
        showMessage('åˆ·æ–°å¤±è´¥: ' + error.message, 'error');
        if (progressTextEl) {
          progressTextEl.textContent = 'æ”¶é›†å¤±è´¥: ' + error.message;
        }
      } finally {
        btn.disabled = false;
        btn.classList.remove('refreshing');
        btn.innerHTML = originalText;
        
        // å»¶è¿Ÿéšè—è¿›åº¦åŒºåŸŸ
        setTimeout(() => {
          if (progressEl) {
            progressEl.classList.remove('show');
          }
          if (progressTextEl) {
            progressTextEl.textContent = '';
          }
        }, 2000);
      }
    }

    // åŠ è½½æ–‡ç« åˆ—è¡¨
    async function loadArticles(forceRefresh = false) {
      const articlesListEl = document.getElementById('articlesList');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      articlesListEl.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

      try {
        const response = await fetch(`${API_BASE_URL}/news/list`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          
          // å°†æ‰€æœ‰æ–‡ç« å±•å¹³åˆ°ä¸€ä¸ªæ•°ç»„ä¸­
          allArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              allArticles.push({
                ...news,
                date: day.date
              });
            });
          });

          if (allArticles.length === 0) {
            articlesListEl.innerHTML = '<div class="empty-state"><p>æš‚æ— æ–‡ç« ï¼Œè¯·å…ˆè®¢é˜…ä¿¡æ¯æº</p><p style="margin-top: 12px; font-size: 13px; color: #999;">ç³»ç»Ÿæ¯10åˆ†é’Ÿè‡ªåŠ¨æ”¶é›†ä¸€æ¬¡ï¼Œè¯·ç¨å€™</p></div>';
            updateStats([]);
            loadSourceCards([]);
          } else {
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats(allArticles);
            
            // åŠ è½½ä¿¡æ¯æºå¡ç‰‡
            const sources = [...new Set(allArticles.map(a => a.source))];
            loadSourceCards(sources);
            
            // åº”ç”¨å½“å‰è¿‡æ»¤å’Œæœç´¢
            applyFilters();
          }
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥: ' + error.message + '</p></div>';
      }
    }
    

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats(articles) {
      document.getElementById('totalArticles').textContent = articles.length;
      document.getElementById('publishDateRange').textContent = calculatePublishDateRange(articles);
      document.getElementById('recentArticlesCount').textContent = calculateRecentArticlesCount(articles);
    }

    // åŠ è½½ä¿¡æ¯æºå¡ç‰‡
    function loadSourceCards(sources) {
      const container = document.getElementById('sourceFilterCards');
      
      // æ¸…ç©ºæ‰€æœ‰å¡ç‰‡ï¼ŒåŒ…æ‹¬"å…¨éƒ¨"
      container.innerHTML = '';
      
      // é‡æ–°åˆ›å»º"å…¨éƒ¨"å¡ç‰‡
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>å…¨éƒ¨</span>';
      allCard.onclick = () => filterArticlesBySource(null);
      container.appendChild(allCard);
      
      // æ·»åŠ ä¿¡æ¯æºå¡ç‰‡
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySource(source);
        container.appendChild(card);
      });
      
      // ç¡®ä¿"å…¨éƒ¨"å¡ç‰‡æ˜¯æ¿€æ´»çŠ¶æ€ï¼ˆå¦‚æœå½“å‰æ²¡æœ‰é€‰æ‹©ç‰¹å®šä¿¡æ¯æºï¼‰
      if (currentSourceFilter === null) {
        allCard.classList.add('active');
      }
    }

    // æŒ‰ä¿¡æ¯æºè¿‡æ»¤
    function filterArticlesBySource(source) {
      currentSourceFilter = source;
      
      // æ›´æ–°å¡ç‰‡çŠ¶æ€
      document.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      applyFilters();
    }

    // åº”ç”¨è¿‡æ»¤
    function applyFilters() {
      let filtered = [...allArticles];
      
      // æŒ‰ä¿¡æ¯æºè¿‡æ»¤
      if (currentSourceFilter) {
        filtered = filtered.filter(a => a.source === currentSourceFilter);
      }
      
      filteredArticles = filtered;
      renderArticles(filtered);
    }

    // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
    function renderArticles(articles) {
      const articlesListEl = document.getElementById('articlesList');
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>æš‚æ— æ–‡ç« </p></div>';
        return;
      }
      
      // æŒ‰æ—¥æœŸåˆ†ç»„
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // æ¸²æŸ“è¯¥æ—¥æœŸä¸‹çš„æ‰€æœ‰æ–‡ç« 
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">ä¸ç›¸å…³</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'æœªçŸ¥')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // æŸ¥çœ‹æ–‡ç« è¯¦æƒ…
    async function viewArticle(id) {
      // ä¿å­˜æ»šåŠ¨ä½ç½®
      savedScrollPosition = window.pageYOffset || document.documentElement.scrollTop;
      
      // è·å–å½“å‰æ´»åŠ¨çš„ä¸»é¢˜é¡µç­¾ç´¢å¼•ï¼ˆå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ä¸º0ï¼‰
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
      
      // ä¿å­˜æ–‡ç« è¯¦æƒ…çŠ¶æ€åˆ° localStorage
      localStorage.setItem('dashboardCurrentPage', 'articles');
      localStorage.setItem('dashboardViewingArticleId', id.toString());
      localStorage.setItem('dashboardCurrentTopicIndex', currentTabIndex.toString());
      
      // éšè—å½“å‰æ´»åŠ¨é¡µç­¾çš„ç»Ÿè®¡ä¿¡æ¯æ ã€ä¿¡æ¯æºè¿‡æ»¤å¡ç‰‡
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      
      if (statsBar) statsBar.style.display = 'none';
      if (sourceFilterCards) sourceFilterCards.style.display = 'none';
      
      // éšè—å½“å‰æ´»åŠ¨é¡µç­¾çš„åˆ—è¡¨è§†å›¾ï¼Œéšè—ä¸»é¢˜é¡µç­¾å®¹å™¨ï¼Œæ˜¾ç¤ºè¯¦æƒ…è§†å›¾
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'none';
      document.getElementById('articleDetailView').style.display = 'block';
      
      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo(0, 0);
      
      // åŠ è½½æ–‡ç« è¯¦æƒ…
      try {
        const response = await fetch(`${API_BASE_URL}/news/${id}`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const article = result.data;
          
          document.getElementById('articleDetailTitle').textContent = article.title;
          document.getElementById('articleDetailSource').textContent = `æ¥æºï¼š${article.source || 'æœªçŸ¥'}`;
          document.getElementById('articleDetailDate').textContent = `å‘å¸ƒæ—¶é—´ï¼š${formatDate(article.publish_date)}`;
          
          // æ­£æ–‡å†…å®¹ - ä¿ç•™HTMLæ ¼å¼ï¼ˆå…ˆå¤„ç†å†…å®¹ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«å›¾ç‰‡ï¼‰
          const contentEl = document.getElementById('articleDetailContent');
          let originalContent = '';
          let contentHasImages = false;
          
          if (article.content) {
            originalContent = article.content;
            
            // æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«HTMLæ ‡ç­¾
            const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
            
            // æ£€æŸ¥å†…å®¹ä¸­æ˜¯å¦åŒ…å«å›¾ç‰‡æ ‡ç­¾
            contentHasImages = /<img[^>]*>/i.test(originalContent);
            
            if (hasHtml) {
              // åŒ…å«HTMLï¼Œè¿›è¡Œå®‰å…¨æ¸…ç†åæ˜¾ç¤º
              // ç§»é™¤å±é™©æ ‡ç­¾å’Œå±æ€§ï¼Œä½†ä¿ç•™æ ¼å¼æ ‡ç­¾
              let safeHtml = originalContent
                // ç§»é™¤scriptå’Œstyleæ ‡ç­¾åŠå…¶å†…å®¹
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                // ç§»é™¤iframe
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                // ç§»é™¤å±é™©äº‹ä»¶å±æ€§
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                // ç§»é™¤javascript:é“¾æ¥
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              
              // ä½¿ç”¨DOMPurifyæˆ–ç®€å•çš„æ¸…ç†åè®¾ç½®innerHTML
              contentEl.innerHTML = safeHtml;
            } else {
              // çº¯æ–‡æœ¬å†…å®¹ï¼Œè½¬æ¢ä¸ºæ®µè½
              const textContent = originalContent
                .replace(/&nbsp;/g, ' ')
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&quot;/g, '"')
                .trim();
              
              const paragraphs = textContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
          } else {
            contentEl.textContent = 'æš‚æ— è¯¦ç»†å†…å®¹';
          }
          
          // å›¾ç‰‡ - å¦‚æœå†…å®¹ä¸­å·²ç»åŒ…å«å›¾ç‰‡ï¼Œå°±ä¸æ˜¾ç¤ºå•ç‹¬çš„image_urlå›¾ç‰‡
          const imageEl = document.getElementById('articleDetailImage');
          if (article.image_url && !contentHasImages) {
            // åªæœ‰å½“å†…å®¹ä¸­æ²¡æœ‰å›¾ç‰‡æ—¶ï¼Œæ‰æ˜¾ç¤ºimage_urlçš„å›¾ç‰‡
            imageEl.innerHTML = `<img src="${escapeHtml(article.image_url)}" alt="${escapeHtml(article.title)}" onerror="this.style.display='none'">`;
          } else {
            imageEl.innerHTML = '';
          }
          
          // æ‘˜è¦
          const summaryEl = document.getElementById('articleDetailSummary');
          if (article.summary) {
            summaryEl.textContent = article.summary;
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          // ä¿å­˜æ–‡ç« IDå’ŒåŸå§‹å†…å®¹ç”¨äºç¿»è¯‘åˆ‡æ¢
          window.currentArticleId = article.id;
          window.originalArticleData = {
            title: article.title,
            summary: article.summary || '',
            content: originalContent
          };
          window.isArticleTranslated = false; // é‡ç½®ç¿»è¯‘çŠ¶æ€
          
          // åŸæ–‡é“¾æ¥
          const sourceLink = document.getElementById('articleSourceLink');
          if (article.url) {
            sourceLink.href = article.url;
            sourceLink.style.display = 'inline-block';
          } else {
            sourceLink.style.display = 'none';
          }
          
          // ç¿»è¯‘æŒ‰é’®ï¼ˆå¦‚æœæ˜¯è‹±æ–‡ï¼‰
          const textToCheck = (article.title + ' ' + (article.summary || '') + ' ' + (article.content || '')).substring(0, 500);
          const translateBtn = document.getElementById('articleTranslateBtn');
          if (isEnglish(textToCheck)) {
            translateBtn.style.display = 'inline-block';
            translateBtn.textContent = 'ç¿»è¯‘ä¸ºä¸­æ–‡';
            translateBtn.setAttribute('data-translated', 'false');
            window.isArticleTranslated = false;
          } else {
            translateBtn.style.display = 'none';
          }
          
          // æ€»ç»“æŒ‰é’®ï¼ˆå¦‚æœæ–‡ç« è¾ƒé•¿ï¼Œè¶…è¿‡500å­—ï¼‰
          const summarizeBtn = document.getElementById('articleSummarizeBtn');
          const contentLength = originalContent.length;
          if (contentLength > 500) {
            summarizeBtn.style.display = 'inline-block';
          } else {
            summarizeBtn.style.display = 'none';
          }
          
          // éšè—ç”Ÿæˆçš„æ€»ç»“åŒºåŸŸï¼ˆå¦‚æœå­˜åœ¨ï¼‰
          document.getElementById('articleGeneratedSummary').style.display = 'none';
        }
      } catch (error) {
        document.getElementById('articleDetailContent').textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
      }
    }

    // è¿”å›åˆ—è¡¨
    function backToList() {
      // æ¸…é™¤æ–‡ç« è¯¦æƒ…çŠ¶æ€
      localStorage.removeItem('dashboardViewingArticleId');
      
      // è·å–å½“å‰æ´»åŠ¨çš„ä¸»é¢˜é¡µç­¾ç´¢å¼•ï¼ˆå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ä¸º0ï¼‰
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
      
      // æ˜¾ç¤ºå½“å‰æ´»åŠ¨é¡µç­¾çš„ç»Ÿè®¡ä¿¡æ¯æ ã€ä¿¡æ¯æºè¿‡æ»¤å¡ç‰‡
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      
      if (statsBar) statsBar.style.display = 'flex';
      if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
      
      // éšè—è¯¦æƒ…è§†å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜é¡µç­¾å®¹å™¨å’Œå½“å‰æ´»åŠ¨é¡µç­¾çš„åˆ—è¡¨è§†å›¾
      document.getElementById('articleDetailView').style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'block';
      
      // æ¢å¤æ»šåŠ¨ä½ç½®
      window.scrollTo(0, savedScrollPosition);
    }

    // æ£€æµ‹æ˜¯å¦ä¸ºè‹±æ–‡
    function isEnglish(text) {
      const englishChars = (text.match(/[a-zA-Z]/g) || []).length;
      const totalChars = text.replace(/\s/g, '').length;
      return totalChars > 0 && englishChars / totalChars > 0.5;
    }

    // åˆ‡æ¢ç¿»è¯‘/åŸæ–‡
    async function toggleTranslate() {
      const btn = document.getElementById('articleTranslateBtn');
      const titleEl = document.getElementById('articleDetailTitle');
      const summaryEl = document.getElementById('articleDetailSummary');
      const contentEl = document.getElementById('articleDetailContent');
      
      if (!window.originalArticleData || !window.currentArticleId) {
        return;
      }
      
      const isTranslated = window.isArticleTranslated || false;
      
      if (isTranslated) {
        // æ˜¾ç¤ºåŸæ–‡
        titleEl.textContent = window.originalArticleData.title;
        if (window.originalArticleData.summary) {
          summaryEl.textContent = window.originalArticleData.summary;
          summaryEl.style.display = 'block';
        } else {
          summaryEl.style.display = 'none';
        }
        
        // æ£€æŸ¥åŸæ–‡æ˜¯å¦åŒ…å«HTML
        const originalContent = window.originalArticleData.content;
        const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
        
        if (hasHtml) {
          // åŒ…å«HTMLï¼Œè¿›è¡Œå®‰å…¨æ¸…ç†åæ˜¾ç¤º
          let safeHtml = originalContent
            .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
            .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
            .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
            .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
            .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
            .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
          contentEl.innerHTML = safeHtml;
        } else {
          // çº¯æ–‡æœ¬ï¼Œè½¬æ¢ä¸ºæ®µè½
          const paragraphs = originalContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
          contentEl.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p)}</p>`).join('');
        }
        
        btn.textContent = 'ç¿»è¯‘ä¸ºä¸­æ–‡';
        btn.setAttribute('data-translated', 'false');
        window.isArticleTranslated = false;
      } else {
        // ç¿»è¯‘ä¸ºä¸­æ–‡ï¼ˆä½¿ç”¨ DeepSeek APIï¼Œå¸¦ç¼“å­˜ï¼‰
        btn.disabled = true;
        btn.textContent = 'ç¿»è¯‘ä¸­...';
        
        try {
          // æå–çº¯æ–‡æœ¬ç”¨äºç¿»è¯‘ï¼ˆå¦‚æœåŒ…å«HTMLï¼Œæå–æ–‡æœ¬å†…å®¹ï¼‰
          const originalContent = window.originalArticleData.content;
          const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
          
          let textForTranslation = '';
          if (hasHtml) {
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶DOMå…ƒç´ æ¥æå–æ–‡æœ¬
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalContent;
            textForTranslation = (tempDiv.textContent || tempDiv.innerText || originalContent.replace(/<[^>]*>/g, '')).trim();
          } else {
            // çº¯æ–‡æœ¬ï¼Œç›´æ¥ä½¿ç”¨
            textForTranslation = originalContent.replace(/<[^>]*>/g, '').trim();
          }
          
          // ä½¿ç”¨æ–°çš„ç¿»è¯‘æ•´ç¯‡æ–‡ç« APIï¼Œä¼ é€’æ–‡ç« IDä»¥æ”¯æŒç¼“å­˜
          const response = await fetch(`${API_BASE_URL}/news/translate/article`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              ...getHeaders()
            },
            body: JSON.stringify({
              articleId: window.currentArticleId,
              title: window.originalArticleData.title,
              summary: window.originalArticleData.summary || '',
              content: textForTranslation.substring(0, 4000),
              source: 'en',
              target: 'zh'
            })
          });
          
          const result = await response.json();
          
          if (!result.success) {
            throw new Error(result.message || 'ç¿»è¯‘å¤±è´¥');
          }
          
          // æ›´æ–°æ˜¾ç¤º
          titleEl.textContent = result.translatedTitle || window.originalArticleData.title;
          
          if (result.translatedSummary) {
            summaryEl.textContent = result.translatedSummary;
            summaryEl.style.display = 'block';
          } else if (window.originalArticleData.summary) {
            summaryEl.textContent = window.originalArticleData.summary;
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          if (result.translatedContent) {
            // ç¿»è¯‘åçš„å†…å®¹æ˜¯çº¯æ–‡æœ¬ï¼Œè½¬æ¢ä¸ºæ®µè½æ ¼å¼
            const paragraphs = result.translatedContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
            contentEl.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p)}</p>`).join('');
          } else {
            // å¦‚æœç¿»è¯‘å¤±è´¥ï¼Œæ˜¾ç¤ºåŸæ–‡ï¼ˆä¿æŒHTMLæ ¼å¼ï¼‰
            if (hasHtml) {
              let safeHtml = originalContent
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              contentEl.innerHTML = safeHtml;
            } else {
              const paragraphs = textForTranslation.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }
          }
          
          // ä¿å­˜ç¿»è¯‘ç»“æœåˆ° window å¯¹è±¡ï¼Œä»¥ä¾¿åˆ‡æ¢æ—¶ä½¿ç”¨
          window.translatedArticleData = {
            title: result.translatedTitle,
            summary: result.translatedSummary,
            content: result.translatedContent
          };
          
          btn.textContent = 'æŸ¥çœ‹åŸæ–‡';
          btn.setAttribute('data-translated', 'true');
          window.isArticleTranslated = true;
          
          // å¦‚æœæ¥è‡ªç¼“å­˜ï¼Œæ˜¾ç¤ºæç¤º
          if (result.fromCache) {
            console.log('ç¿»è¯‘ç»“æœæ¥è‡ªç¼“å­˜');
          }
        } catch (error) {
          alert('ç¿»è¯‘å¤±è´¥: ' + error.message);
          btn.textContent = 'ç¿»è¯‘ä¸ºä¸­æ–‡';
        } finally {
          btn.disabled = false;
        }
      }
    }

    // ç”Ÿæˆæ–‡ç« æ€»ç»“
    async function generateSummary() {
      const btn = document.getElementById('articleSummarizeBtn');
      const summaryEl = document.getElementById('articleGeneratedSummary');
      const summaryContentEl = document.getElementById('articleGeneratedSummaryContent');
      
      if (!window.originalArticleData) {
        return;
      }
      
      btn.disabled = true;
      btn.textContent = 'ç”Ÿæˆä¸­...';
      summaryEl.style.display = 'block';
      summaryContentEl.textContent = 'æ­£åœ¨ç”Ÿæˆæ€»ç»“ï¼Œè¯·ç¨å€™...';
      
      try {
        const content = window.originalArticleData.content.replace(/<[^>]*>/g, '').trim();
        const textToSummarize = (window.originalArticleData.title + '\n\n' + content).substring(0, 4000);
        
        const response = await fetch(`${API_BASE_URL}/news/summarize`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...getHeaders()
          },
          body: JSON.stringify({
            text: textToSummarize
          })
        });
        
        const result = await response.json();
        
        if (result.success && result.summary) {
          summaryContentEl.textContent = result.summary;
          btn.textContent = 'é‡æ–°ç”Ÿæˆ';
        } else {
          summaryContentEl.textContent = 'ç”Ÿæˆæ€»ç»“å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯');
          btn.textContent = 'ç”Ÿæˆæ€»ç»“';
        }
      } catch (error) {
        summaryContentEl.textContent = 'ç”Ÿæˆæ€»ç»“å¤±è´¥: ' + error.message;
        btn.textContent = 'ç”Ÿæˆæ€»ç»“';
      } finally {
        btn.disabled = false;
      }
    }

    function formatDate(dateStr) {
      if (!dateStr) return '-';
      try {
        const date = new Date(dateStr);
        return date.toLocaleString('zh-CN');
      } catch (e) {
        return dateStr;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // è‡ªåŠ¨åˆ·æ–°æ–‡ç« åˆ—è¡¨ï¼ˆæ¯30ç§’ï¼‰
    let articlesRefreshInterval = null;

    function startArticlesAutoRefresh() {
      if (articlesRefreshInterval) {
        clearInterval(articlesRefreshInterval);
      }
      articlesRefreshInterval = setInterval(() => {
        const articlesPage = document.getElementById('articlesPage');
        if (articlesPage.classList.contains('active')) {
          // è‡ªåŠ¨åˆ·æ–°ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®
          loadArticles(true);
          loadRefreshStatus();
        }
      }, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
    }

    // åŠ è½½æ‰€æœ‰ä¸»é¢˜çš„æ¨èå†å²å¹¶æ¸²æŸ“é¡µç­¾
    async function loadAllRecommendationHistory() {
      try {
        console.log('ğŸ“– å¼€å§‹åŠ è½½æ‰€æœ‰æ¨èå†å²...');
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        console.log('ğŸ“– æ¨èå†å²å“åº”:', result);

        if (result.success && result.data && result.data.length > 0) {
          const histories = result.data;
          console.log(`ğŸ“– æ‰¾åˆ° ${histories.length} æ¡æ¨èå†å²ï¼Œå¼€å§‹æ¸²æŸ“é¡µç­¾...`);
          console.log('ğŸ“– æ¨èå†å²ä¸»é¢˜åˆ—è¡¨:', histories.map(h => h.topic_keywords));
          
          // æ¸…ç©ºå¹¶é‡æ–°æ¸²æŸ“é¡µç­¾
          renderTopicsTabs(histories);
          document.getElementById('topicsTabsSection').style.display = 'block';
          console.log('âœ… æ¨èå†å²é¡µç­¾æ¸²æŸ“å®Œæˆ');
        } else {
          console.log('ğŸ“– æ²¡æœ‰æ¨èå†å²ï¼Œéšè—é¡µç­¾å®¹å™¨');
          document.getElementById('topicsTabsSection').style.display = 'none';
        }
      } catch (error) {
        console.error('âŒ åŠ è½½æ¨èå†å²å¤±è´¥:', error);
        document.getElementById('topicsTabsSection').style.display = 'none';
      }
    }

    // æ¸²æŸ“ä¸»é¢˜é¡µç­¾
    function renderTopicsTabs(histories) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) {
        console.warn('âš ï¸  é¡µç­¾å®¹å™¨ä¸å­˜åœ¨ï¼Œæ— æ³•æ¸²æŸ“');
        return;
      }
      
      console.log(`ğŸ¨ å¼€å§‹æ¸²æŸ“ ${histories?.length || 0} ä¸ªä¸»é¢˜çš„é¡µç­¾...`);
      
      // æ¸…ç©ºç°æœ‰å†…å®¹
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';
      
      if (!histories || histories.length === 0) {
        console.log('â„¹ï¸  æ²¡æœ‰æ¨èå†å²ï¼Œæ¸…ç©ºé¡µç­¾å¹¶éšè—å®¹å™¨');
        // å¦‚æœæ²¡æœ‰æ¨èå†å²ï¼Œéšè—é¡µç­¾å®¹å™¨
        const topicsTabsSection = document.getElementById('topicsTabsSection');
        if (topicsTabsSection) {
          topicsTabsSection.style.display = 'none';
        }
        return;
      }
      
      // è·å–å½“å‰é€‰ä¸­çš„ä¸»é¢˜å…³é”®è¯ï¼ˆå¦‚æœæœ‰ï¼‰
      let activeTopicKeywords = null;
      const currentActiveTab = tabsHeader.querySelector('.topic-tab.active');
      if (currentActiveTab) {
        // ä»å½“å‰æ´»åŠ¨é¡µç­¾çš„æ–‡æœ¬ä¸­æå–ä¸»é¢˜å…³é”®è¯ï¼ˆå»æ‰å¾½ç« å’Œ"æ¨èä¸­..."ï¼‰
        const tabText = currentActiveTab.textContent.trim();
        activeTopicKeywords = tabText.replace(/\s*\(\d+\)\s*$/, '').replace(/\s*æ¨èä¸­\.\.\.\s*$/, '').trim();
      }
      
      // ç”Ÿæˆé¡µç­¾å’Œå†…å®¹
      histories.forEach((history, index) => {
        const topicKeywords = history.topic_keywords;
        const tabId = `tab-${index}`;
        const panelId = `panel-${index}`;
        // å¦‚æœå½“å‰ä¸»é¢˜å…³é”®è¯åŒ¹é…ä¹‹å‰é€‰ä¸­çš„ï¼Œåˆ™ä¿æŒé€‰ä¸­çŠ¶æ€
        const isActive = activeTopicKeywords && topicKeywords === activeTopicKeywords 
          ? true 
          : (index === 0 && !activeTopicKeywords);
        
        // åˆ›å»ºé¡µç­¾æŒ‰é’®
        const tabBtn = document.createElement('button');
        tabBtn.className = `topic-tab ${isActive ? 'active' : ''}`;
        tabBtn.id = tabId;
        tabBtn.onclick = () => switchTopicTab(index);
        const sourceCount = history.recommended_sources ? history.recommended_sources.length : 0;
        tabBtn.innerHTML = `${escapeHtml(topicKeywords)}${sourceCount > 0 ? `<span class="tab-badge">${sourceCount}</span>` : ''}`;
        tabsHeader.appendChild(tabBtn);
        
        // åˆ›å»ºé¡µç­¾å†…å®¹é¢æ¿
        const panel = document.createElement('div');
        panel.className = `topic-tab-panel ${isActive ? 'active' : ''}`;
        panel.id = panelId;
        panel.dataset.history = JSON.stringify(history);
        
        // æ¨èè¿‡ç¨‹æ—¥å¿—ï¼ˆå°å­—æ˜¾ç¤ºï¼‰
        let processLogsHtml = '';
        if (history.process_logs && history.process_logs.length > 0) {
          // è·å–æœ€åä¸€æ¡æ—¥å¿—ä½œä¸ºå½“å‰çŠ¶æ€
          const lastLog = history.process_logs[history.process_logs.length - 1];
          const lastMessage = lastLog.message || 'æ¨èå®Œæˆ';
          
          processLogsHtml = `
            <div style="font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;" id="processText-${index}">
              ${escapeHtml(lastMessage)}
            </div>
          `;
        }
        
        // æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æºåŒºåŸŸ
        const manualAddSourceHtml = `
          <div class="manual-add-source" id="manualAddSource-${index}">
            <h5>ğŸ“ æ‰‹åŠ¨æ·»åŠ ä¿¡æ¯æº</h5>
            <div class="manual-add-source-form">
              <div class="form-group">
                <label for="manualSourceName-${index}">ä¿¡æ¯æºåç§°</label>
                <input type="text" id="manualSourceName-${index}" placeholder="è¯·è¾“å…¥ä¿¡æ¯æºåç§°" onkeypress="if(event.key==='Enter') document.getElementById('manualSourceUrl-${index}').focus()" />
              </div>
              <div class="form-group" style="flex: 2; min-width: 300px;">
                <label for="manualSourceUrl-${index}">ä¿¡æ¯æºURL</label>
                <input type="url" id="manualSourceUrl-${index}" placeholder="https://example.com/feed.xml" onkeypress="if(event.key==='Enter') handleManualAddSource(${index})" />
              </div>
              <button class="manual-add-source-btn" onclick="handleManualAddSource(${index})" id="manualAddBtn-${index}">
                æ·»åŠ å¹¶è®¢é˜…
              </button>
            </div>
          </div>
        `;
        
        // æ¨èä¿¡æ¯æºè¡¨æ ¼ï¼ˆåŒ…å«è¿‡æ»¤å™¨å’Œåœ°åŒºåˆ—ï¼‰
        let recommendationsHtml = '';
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          // è·å–å”¯ä¸€çš„ç±»å‹åˆ—è¡¨
          const types = [...new Set(history.recommended_sources.map(s => s.sourceType || 'rss'))];
          
          recommendationsHtml = `
            <div class="recommendations-filters" id="filters-${index}">
              <div class="filter-group">
                <label>åœ°åŒºï¼š</label>
                <select id="regionFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">å…¨éƒ¨</option>
                  <option value="å›½å†…">å›½å†…</option>
                  <option value="å›½å¤–">å›½å¤–</option>
                </select>
              </div>
              <div class="filter-group">
                <label>ç±»å‹ï¼š</label>
                <select id="typeFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">å…¨éƒ¨</option>
                  ${types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('')}
                </select>
              </div>
              <div class="recommendations-stats" id="recommendationsStats-${index}"></div>
              <button class="invalid-sources-toggle" id="toggleInvalid-${index}" onclick="toggleInvalidSources(${index})" style="display: none;">
                <span id="toggleInvalidText-${index}">æ˜¾ç¤ºæ— æ•ˆä¿¡æ¯æº</span>
                <span id="toggleInvalidCount-${index}"></span>
              </button>
            </div>
            <table class="recommendations-table" id="recommendationsTable-${index}">
              <thead>
                <tr>
                  <th class="checkbox-cell"></th>
                  <th>ä¿¡æ¯æº</th>
                  <th>ç±»å‹</th>
                  <th>åœ°åŒº</th>
                  <th>æè¿°</th>
                  <th>æœ‰æ•ˆæ€§</th>
                  <th>çŠ¶æ€</th>
                </tr>
              </thead>
              <tbody id="recommendationsBody-${index}">
              </tbody>
            </table>
          `;
        } else {
          recommendationsHtml = '<p style="color: #999;">æš‚æ— æ¨èä¿¡æ¯æº</p>';
        }
        
        panel.innerHTML = processLogsHtml + manualAddSourceHtml + recommendationsHtml;
        tabsContent.appendChild(panel);
        
        // æ¸²æŸ“è¯¥ä¸»é¢˜çš„æ¨èè¿‡ç¨‹å’Œæ¨èä¿¡æ¯æº
        if (history.process_logs && history.process_logs.length > 0) {
          renderProcessLogsInTab(index, history.process_logs);
        }
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          renderRecommendationsInTab(index, history.recommended_sources);
        }
      });
    }

    // åˆ‡æ¢ä¸»é¢˜é¡µç­¾
    function switchTopicTab(index) {
      // æ›´æ–°é¡µç­¾æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.topic-tab').forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // æ›´æ–°å†…å®¹é¢æ¿çŠ¶æ€
      document.querySelectorAll('.topic-tab-panel').forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­æ¸²æŸ“æ¨èè¿‡ç¨‹æ—¥å¿—ï¼ˆå°å­—æ˜¾ç¤ºï¼‰
    function renderProcessLogsInTab(tabIndex, logs) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      if (!processTextEl) return;
      
      // åªæ˜¾ç¤ºæœ€åä¸€æ¡æ—¥å¿—ï¼ˆæœ€æ–°çš„è¿›åº¦ï¼‰
      if (logs && logs.length > 0) {
        const lastLog = logs[logs.length - 1];
        const message = lastLog.message || '';
        
        // æ›´æ–°è¿›åº¦æ–‡æœ¬
        processTextEl.textContent = message;
      }
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­æ¸²æŸ“æ¨èä¿¡æ¯æºï¼ˆå¸¦è¿‡æ»¤åŠŸèƒ½ï¼‰
    async function renderRecommendationsInTab(tabIndex, sources) {
      const tbody = document.getElementById(`recommendationsBody-${tabIndex}`);
      const table = document.getElementById(`recommendationsTable-${tabIndex}`);
      const filters = document.getElementById(`filters-${tabIndex}`);
      const emptyMsg = document.getElementById(`recommendationsEmpty-${tabIndex}`);
      
      if (!tbody) return;
      
      // å¦‚æœæœ‰æ•°æ®ï¼Œæ˜¾ç¤ºè¡¨æ ¼å’Œè¿‡æ»¤å™¨ï¼Œéšè—ç©ºçŠ¶æ€æç¤º
      if (sources && sources.length > 0) {
        if (table) table.style.display = 'table';
        if (filters) filters.style.display = 'flex';
        if (emptyMsg) emptyMsg.style.display = 'none';
      } else {
        if (table) table.style.display = 'none';
        if (filters) filters.style.display = 'none';
        if (emptyMsg) emptyMsg.style.display = 'block';
        return;
      }
      
      // è·å–å½“å‰ä¸»é¢˜çš„å…³é”®è¯
      const panel = document.getElementById(`panel-${tabIndex}`);
      const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
      const topicKeywords = history.topic_keywords || null;
      
      // æŒ‰ä¸»é¢˜åŠ è½½è®¢é˜…ï¼ˆå¦‚æœæœ‰ä¸»é¢˜ï¼‰
      if (topicKeywords) {
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          const result = await response.json();
          if (result.success) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        } catch (error) {
          console.error('åŠ è½½ä¸»é¢˜è®¢é˜…å¤±è´¥:', error);
          await loadUserSubscriptions(); // é™çº§åˆ°åŠ è½½æ‰€æœ‰è®¢é˜…
        }
      } else {
        await loadUserSubscriptions();
      }
      
      // æ›´æ–°ç±»å‹è¿‡æ»¤å™¨é€‰é¡¹
      const types = [...new Set(sources.map(s => s.sourceType || 'rss'))];
      const typeFilterEl = document.getElementById(`typeFilter-${tabIndex}`);
      if (typeFilterEl) {
        const currentValue = typeFilterEl.value;
        typeFilterEl.innerHTML = '<option value="all">å…¨éƒ¨</option>' + 
          types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');
        if (currentValue && types.includes(currentValue)) {
          typeFilterEl.value = currentValue;
        }
      }
      
      // è·å–è¿‡æ»¤æ¡ä»¶
      const regionFilter = document.getElementById(`regionFilter-${tabIndex}`)?.value || 'all';
      const typeFilter = document.getElementById(`typeFilter-${tabIndex}`)?.value || 'all';
      
      // è¿‡æ»¤æ•°æ®
      let filteredSources = sources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'å›½å¤–') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      // åˆ†ç¦»æœ‰æ•ˆå’Œæ— æ•ˆçš„ä¿¡æ¯æº
      const validSources = filteredSources.filter(s => s.isValid !== false);
      const invalidSources = filteredSources.filter(s => s.isValid === false);
      
      // æ’åºï¼šæœ‰æ•ˆçš„æ’åœ¨å‰é¢ï¼Œæ— æ•ˆçš„æ’åœ¨åé¢ï¼ŒæœªéªŒè¯çš„æ’åœ¨ä¸­é—´
      validSources.sort((a, b) => {
        const aValid = a.isValid === true ? 0 : 1;
        const bValid = b.isValid === true ? 0 : 1;
        return aValid - bValid;
      });
      
      invalidSources.sort((a, b) => {
        const aName = (a.sourceName || '').toLowerCase();
        const bName = (b.sourceName || '').toLowerCase();
        return aName.localeCompare(bName);
      });
      
      // æ›´æ–°æ— æ•ˆä¿¡æ¯æºåˆ‡æ¢æŒ‰é’®
      const toggleBtn = document.getElementById(`toggleInvalid-${tabIndex}`);
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      const toggleCount = document.getElementById(`toggleInvalidCount-${tabIndex}`);
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      
      if (invalidSources.length > 0) {
        if (toggleBtn) toggleBtn.style.display = 'inline-block';
        if (toggleCount) toggleCount.textContent = ` (${invalidSources.length})`;
        
        // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¾ç¤ºæ— æ•ˆä¿¡æ¯æº
        const isShowingInvalid = window[`showInvalidSources_${tabIndex}`] || false;
        if (toggleText) {
          toggleText.textContent = isShowingInvalid ? 'éšè—æ— æ•ˆä¿¡æ¯æº' : 'æ˜¾ç¤ºæ— æ•ˆä¿¡æ¯æº';
        }
        if (recommendationsTable) {
          if (isShowingInvalid) {
            recommendationsTable.classList.add('show-invalid');
          } else {
            recommendationsTable.classList.remove('show-invalid');
          }
        }
      } else {
        if (toggleBtn) toggleBtn.style.display = 'none';
        if (recommendationsTable) recommendationsTable.classList.remove('show-invalid');
      }
      
      // æ¸²æŸ“æœ‰æ•ˆçš„ä¿¡æ¯æº
      const validRows = validSources.map((source, idx) => {
        const isSubscribed = userSubscriptions.includes(source.sourceName);
        const region = source.region || 'å›½å¤–';
        const regionClass = region === 'å›½å†…' ? 'region-domestic' : 'region-foreign';
        
        // æ£€æŸ¥æ˜¯å¦éªŒè¯ä¸é€šè¿‡
        const isValid = source.isValid !== false; // å¦‚æœ isValid æ˜¯ falseï¼Œåˆ™ä¸ºæ— æ•ˆ
        const isInvalid = source.isValid === false;
        
        // å¤„ç†éªŒè¯ç»“æœ
        let validityHtml = '';
        if (source.isValid === true) {
          validityHtml = '<span class="source-validity valid" title="å·²éªŒè¯æœ‰æ•ˆ">âœ“ æœ‰æ•ˆ</span>';
        } else if (source.isValid === false) {
          const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
          validityHtml = `<span class="source-validity invalid"${errorMsg}>âœ— æ— æ•ˆ</span>`;
        } else {
          validityHtml = '<span class="source-validity validating">éªŒè¯ä¸­...</span>';
        }
        
        // å¦‚æœéªŒè¯ä¸é€šè¿‡ï¼Œæ·»åŠ  invalid-row ç±»å¹¶ç¦ç”¨å¤é€‰æ¡†
        const rowClass = isInvalid ? 'invalid-row' : '';
        const checkboxDisabled = isInvalid ? 'disabled' : '';
        const checkboxChecked = isInvalid ? '' : (isSubscribed ? 'checked' : '');
        
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${idx}" data-tab="${tabIndex}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChangeInTab(this, ${tabIndex})">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'å·²è®¢é˜…' : 'æœªè®¢é˜…'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      // æ¸²æŸ“æ— æ•ˆçš„ä¿¡æ¯æº
      const invalidRows = invalidSources.map((source, idx) => {
        const region = source.region || 'å›½å¤–';
        const regionClass = region === 'å›½å†…' ? 'region-domestic' : 'region-foreign';
        
        const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
        const validityHtml = `<span class="source-validity invalid"${errorMsg}>âœ— æ— æ•ˆ</span>`;
        
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr class="invalid-row">
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" disabled>
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status not-subscribed">æœªè®¢é˜…</span>
            </td>
          </tr>
        `;
      }).join('');
      
      tbody.innerHTML = validRows + invalidRows;
      
      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      const statsEl = document.getElementById(`recommendationsStats-${tabIndex}`);
      if (statsEl) {
        const validCount = validSources.length;
        const invalidCount = invalidSources.length;
        const totalCount = sources.length;
        statsEl.textContent = `æ˜¾ç¤º ${validCount} ä¸ªæœ‰æ•ˆä¿¡æ¯æº${invalidCount > 0 ? `ï¼Œ${invalidCount} ä¸ªæ— æ•ˆä¿¡æ¯æº` : ''} / å…± ${totalCount} ä¸ªä¿¡æ¯æº`;
      }
    }

    // åˆ‡æ¢æ˜¾ç¤º/éšè—æ— æ•ˆä¿¡æ¯æº
    function toggleInvalidSources(tabIndex) {
      // åˆ‡æ¢çŠ¶æ€
      window[`showInvalidSources_${tabIndex}`] = !(window[`showInvalidSources_${tabIndex}`] || false);
      
      // æ›´æ–°è¡¨æ ¼çš„show-invalidç±»
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      if (recommendationsTable) {
        if (window[`showInvalidSources_${tabIndex}`]) {
          recommendationsTable.classList.add('show-invalid');
        } else {
          recommendationsTable.classList.remove('show-invalid');
        }
      }
      
      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      if (toggleText) {
        toggleText.textContent = window[`showInvalidSources_${tabIndex}`] ? 'éšè—æ— æ•ˆä¿¡æ¯æº' : 'æ˜¾ç¤ºæ— æ•ˆä¿¡æ¯æº';
      }
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­è¿‡æ»¤æ¨èä¿¡æ¯æº
    function filterRecommendationsInTab(tabIndex) {
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) return;
      const history = JSON.parse(panel.dataset.history || '{}');
      if (history.recommended_sources) {
        renderRecommendationsInTab(tabIndex, history.recommended_sources);
      }
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­å…¨é€‰/å–æ¶ˆå…¨é€‰
    async function toggleSelectAllInTab(tabIndex, checkbox) {
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:not(:disabled)`);
      const isChecked = checkbox.checked;
      
      // å…ˆæ›´æ–°æ‰€æœ‰ checkbox çš„çŠ¶æ€
      checkboxes.forEach(cb => {
        cb.checked = isChecked;
      });
      
      // å¦‚æœå…¨é€‰ï¼Œè‡ªåŠ¨è®¢é˜…æ‰€æœ‰ä¿¡æ¯æº
      if (isChecked) {
        console.log(`ğŸ“‹ å…¨é€‰ï¼šå¼€å§‹è®¢é˜… ${checkboxes.length} ä¸ªä¿¡æ¯æº...`);
        
        // æ”¶é›†æ‰€æœ‰è¦è®¢é˜…çš„ä¿¡æ¯æº
        const sourcesToSubscribe = [];
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              sourcesToSubscribe.push(source);
            } catch (e) {
              console.error('è§£æä¿¡æ¯æºæ•°æ®å¤±è´¥:', e);
            }
          }
        }
        
        if (sourcesToSubscribe.length === 0) {
          console.warn('âš ï¸  æ²¡æœ‰å¯è®¢é˜…çš„ä¿¡æ¯æº');
          return;
        }
        
        // æ‰¹é‡è®¢é˜…æ‰€æœ‰ä¿¡æ¯æº
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: sourcesToSubscribe })
          });
          
          const result = await response.json();
          
          if (result.success) {
            console.log(`âœ… æˆåŠŸè®¢é˜… ${sourcesToSubscribe.length} ä¸ªä¿¡æ¯æº`);
            showMessage(`å·²è®¢é˜… ${sourcesToSubscribe.length} ä¸ªä¿¡æ¯æº`, 'success');
            
            // é‡æ–°åŠ è½½è®¢é˜…åˆ—è¡¨å’Œæ¨èä¿¡æ¯æºï¼Œæ›´æ–°çŠ¶æ€
            await loadUserSubscriptions();
            
            // é‡æ–°æ¸²æŸ“è¯¥é¡µç­¾çš„æ¨èä¿¡æ¯æºï¼ˆå·²è®¢é˜…çš„ä¼šè‡ªåŠ¨é€‰ä¸­ï¼‰
            const panel = document.getElementById(`panel-${tabIndex}`);
            if (panel) {
              const history = JSON.parse(panel.dataset.history || '{}');
              if (history.recommended_sources) {
                await renderRecommendationsInTab(tabIndex, history.recommended_sources);
              }
            }
            
            // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬ä»¥æ˜¾ç¤ºæ–°åˆ›å»ºçš„ä¸»é¢˜
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('ğŸ“š æ‰¹é‡è®¢é˜…ä¿¡æ¯æºåï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
              await loadArticlesTopicsTabs();
            }
          } else {
            console.error('âŒ æ‰¹é‡è®¢é˜…å¤±è´¥:', result.message);
            showMessage(result.message || 'æ‰¹é‡è®¢é˜…å¤±è´¥', 'error');
            // æ¢å¤ checkbox çŠ¶æ€
            checkboxes.forEach(cb => cb.checked = false);
            checkbox.checked = false;
          }
        } catch (error) {
          console.error('âŒ æ‰¹é‡è®¢é˜…å¼‚å¸¸:', error);
          showMessage('æ‰¹é‡è®¢é˜…å¤±è´¥: ' + error.message, 'error');
          // æ¢å¤ checkbox çŠ¶æ€
          checkboxes.forEach(cb => cb.checked = false);
          checkbox.checked = false;
        }
      } else {
        // å¦‚æœå–æ¶ˆå…¨é€‰ï¼Œå–æ¶ˆè®¢é˜…æ‰€æœ‰ä¿¡æ¯æº
        console.log(`ğŸ“‹ å–æ¶ˆå…¨é€‰ï¼šå¼€å§‹å–æ¶ˆè®¢é˜… ${checkboxes.length} ä¸ªä¿¡æ¯æº...`);
        
        // è·å–ä¸»é¢˜å…³é”®è¯
        const panel = document.getElementById(`panel-${tabIndex}`);
        const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
        const topicKeywords = history.topic_keywords || '';
        
        // é€ä¸ªå–æ¶ˆè®¢é˜…ï¼ˆå› ä¸º DELETE API ä¸€æ¬¡åªèƒ½åˆ é™¤ä¸€ä¸ªï¼‰
        let successCount = 0;
        let failCount = 0;
        let totalDeletedArticles = 0;
        
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              const sourceName = encodeURIComponent(source.sourceName);
              
              // æ„å»ºåˆ é™¤ URLï¼ŒåŒ…å« topicKeywords
              let deleteUrl = `${API_BASE_URL}/user/subscriptions/${sourceName}`;
              if (topicKeywords && topicKeywords.trim()) {
                deleteUrl += `?topicKeywords=${encodeURIComponent(topicKeywords.trim())}`;
              }
              
              const response = await fetch(deleteUrl, {
                method: 'DELETE',
                headers: getHeaders()
              });
              
              const result = await response.json();
              
              if (result.success) {
                successCount++;
                totalDeletedArticles += (result.deletedArticleCount || 0);
              } else {
                failCount++;
              }
            } catch (e) {
              console.error('å–æ¶ˆè®¢é˜…å¤±è´¥:', e);
              failCount++;
            }
          }
        }
        
        if (successCount > 0) {
          console.log(`âœ… æˆåŠŸå–æ¶ˆè®¢é˜… ${successCount} ä¸ªä¿¡æ¯æº`);
          let message = `å·²å–æ¶ˆè®¢é˜… ${successCount} ä¸ªä¿¡æ¯æº`;
          if (totalDeletedArticles > 0) {
            message += `ï¼Œå·²åˆ é™¤ ${totalDeletedArticles} ç¯‡ç›¸å…³æ–‡ç« `;
          }
          if (failCount > 0) {
            message += `ï¼Œ${failCount} ä¸ªå¤±è´¥`;
            showMessage(message, 'warning');
          } else {
            showMessage(message, 'success');
          }
          
          // é‡æ–°åŠ è½½è®¢é˜…åˆ—è¡¨å’Œæ¨èä¿¡æ¯æºï¼Œæ›´æ–°çŠ¶æ€
          await loadUserSubscriptions();
          
          // é‡æ–°æ¸²æŸ“è¯¥é¡µç­¾çš„æ¨èä¿¡æ¯æº
          const panel = document.getElementById(`panel-${tabIndex}`);
          if (panel) {
            const history = JSON.parse(panel.dataset.history || '{}');
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
          }
          
          // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('ğŸ“š æ‰¹é‡å–æ¶ˆè®¢é˜…åï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
            await loadArticlesTopicsTabs();
          }
        } else {
          console.error('âŒ å–æ¶ˆè®¢é˜…å¤±è´¥');
          showMessage('å–æ¶ˆè®¢é˜…å¤±è´¥', 'error');
          // æ¢å¤ checkbox çŠ¶æ€
          checkboxes.forEach(cb => cb.checked = true);
          checkbox.checked = true;
        }
      }
    }

    // å¤„ç†å•ä¸ªä¿¡æ¯æºå¤é€‰æ¡†å˜åŒ–ï¼ˆæ—§ç‰ˆæ¨èæ˜¾ç¤ºï¼‰
    async function handleSourceCheckboxChange(checkbox) {
      if (checkbox.disabled) return;
      
      const sourceJson = checkbox.dataset.source;
      if (!sourceJson) return;
      
      const source = JSON.parse(sourceJson);
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true; // é˜²æ­¢é‡å¤ç‚¹å‡»
      
      try {
        if (isChecked) {
          // è®¢é˜…
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: [source] })
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadUserSubscriptions();
            renderRecommendations(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°çŠ¶æ€
          } else {
            checkbox.checked = false; // æ¢å¤çŠ¶æ€
            showMessage(result.message || 'è®¢é˜…å¤±è´¥', 'error');
          }
        } else {
          // å–æ¶ˆè®¢é˜…ï¼ˆåŒæ—¶åˆ é™¤è¯¥ä¿¡æ¯æºçš„æ–‡ç« ï¼‰
          // æ³¨æ„ï¼šæ—§ç‰ˆæ¨èæ˜¾ç¤ºå¯èƒ½æ²¡æœ‰ä¸»é¢˜å…³é”®è¯ï¼Œæ‰€ä»¥ä¸ä¼ é€’ topicKeywords
          const sourceName = encodeURIComponent(source.sourceName);
          const response = await fetch(`${API_BASE_URL}/user/subscriptions/${sourceName}`, {
            method: 'DELETE',
            headers: getHeaders()
          });
          
          const result = await response.json();
          
          if (result.success) {
            let message = result.message || 'å–æ¶ˆè®¢é˜…æˆåŠŸ';
            if (result.deletedArticleCount > 0) {
              message += `ï¼Œå·²åˆ é™¤ ${result.deletedArticleCount} ç¯‡ç›¸å…³æ–‡ç« `;
            }
            showMessage(message, 'success');
            
            await loadUserSubscriptions();
            renderRecommendations(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°çŠ¶æ€
          } else {
            checkbox.checked = true; // æ¢å¤çŠ¶æ€
            showMessage(result.message || 'å–æ¶ˆè®¢é˜…å¤±è´¥', 'error');
          }
        }
      } catch (error) {
        // æ¢å¤çŠ¶æ€
        checkbox.checked = !isChecked;
        showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
      } finally {
        checkbox.disabled = false;
      }
    }

    // å¤„ç†å•ä¸ªä¿¡æ¯æºå¤é€‰æ¡†å˜åŒ–ï¼ˆé¡µç­¾ä¸­ï¼‰
    async function handleSourceCheckboxChangeInTab(checkbox, tabIndex) {
      if (checkbox.disabled) return;
      
      const sourceJson = checkbox.dataset.source;
      if (!sourceJson) return;
      
      const source = JSON.parse(sourceJson);
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true; // é˜²æ­¢é‡å¤ç‚¹å‡»
      
      try {
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (!panel) return;
        
        const history = JSON.parse(panel.dataset.history || '{}');
        const topicKeywords = history.topic_keywords || '';
        
        if (isChecked) {
          // è®¢é˜…ï¼ˆå¿…é¡»åŒ…å«ä¸»é¢˜å…³é”®è¯ï¼‰
          if (!topicKeywords || !topicKeywords.trim()) {
            checkbox.checked = false;
            showMessage('æ— æ³•è®¢é˜…ï¼šç¼ºå°‘ä¸»é¢˜å…³é”®è¯', 'error');
            checkbox.disabled = false;
            return;
          }
          
          const subscriptionData = {
            ...source,
            topicKeywords: topicKeywords
          };
          
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: [subscriptionData] })
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadUserSubscriptions();
            // é‡æ–°æ¸²æŸ“è¯¥é¡µç­¾çš„æ¨èä¿¡æ¯æº
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
            
            // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬ä»¥æ˜¾ç¤ºæ–°åˆ›å»ºçš„ä¸»é¢˜
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('ğŸ“š è®¢é˜…ä¿¡æ¯æºåï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
              await loadArticlesTopicsTabs();
            }
          } else {
            checkbox.checked = false; // æ¢å¤çŠ¶æ€
            showMessage(result.message || 'è®¢é˜…å¤±è´¥', 'error');
          }
        } else {
          // å–æ¶ˆè®¢é˜…ï¼ˆåŒæ—¶åˆ é™¤è¯¥ä¿¡æ¯æºçš„æ–‡ç« ï¼‰
          const sourceName = encodeURIComponent(source.sourceName);
          let deleteUrl = `${API_BASE_URL}/user/subscriptions/${sourceName}`;
          
          // å¦‚æœæœ‰ä¸»é¢˜å…³é”®è¯ï¼Œæ·»åŠ åˆ°æŸ¥è¯¢å‚æ•°
          if (topicKeywords && topicKeywords.trim()) {
            deleteUrl += `?topicKeywords=${encodeURIComponent(topicKeywords.trim())}`;
          }
          
          const response = await fetch(deleteUrl, {
            method: 'DELETE',
            headers: getHeaders()
          });
          
          const result = await response.json();
          
          if (result.success) {
            let message = result.message || 'å–æ¶ˆè®¢é˜…æˆåŠŸ';
            if (result.deletedArticleCount > 0) {
              message += `ï¼Œå·²åˆ é™¤ ${result.deletedArticleCount} ç¯‡ç›¸å…³æ–‡ç« `;
            }
            showMessage(message, 'success');
            
            await loadUserSubscriptions();
            // é‡æ–°æ¸²æŸ“è¯¥é¡µç­¾çš„æ¨èä¿¡æ¯æº
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
            
            // å¦‚æœæ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾å·²åŠ è½½ï¼Œåˆ·æ–°å®ƒä»¬
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('ğŸ“š å–æ¶ˆè®¢é˜…åï¼Œåˆ·æ–°æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
              await loadArticlesTopicsTabs();
            }
          } else {
            checkbox.checked = true; // æ¢å¤çŠ¶æ€
            showMessage(result.message || 'å–æ¶ˆè®¢é˜…å¤±è´¥', 'error');
          }
        }
      } catch (error) {
        // æ¢å¤çŠ¶æ€
        checkbox.checked = !isChecked;
        showMessage('æ“ä½œå¤±è´¥: ' + error.message, 'error');
      } finally {
        checkbox.disabled = false;
      }
    }

    // åœ¨æŒ‡å®šé¡µç­¾ä¸­è®¢é˜…é€‰ä¸­çš„ä¿¡æ¯æºï¼ˆä¿ç•™ç”¨äºå…¼å®¹ï¼Œä½†ä¸å†ä½¿ç”¨ï¼‰
    async function subscribeSelectedInTab(tabIndex) {
      // åªé€‰æ‹©æœªç¦ç”¨çš„å¤é€‰æ¡†ï¼ˆå³æœ‰æ•ˆçš„ä¿¡æ¯æºï¼‰
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:checked:not(:disabled)`);
      if (checkboxes.length === 0) {
        showMessage('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆçš„ä¿¡æ¯æº', 'error');
        return;
      }

      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) return;
      
      const history = JSON.parse(panel.dataset.history || '{}');
      if (!history.recommended_sources) return;
      
      // è¿‡æ»¤æ‰æ— æ•ˆçš„ä¿¡æ¯æº
      const sources = Array.from(checkboxes)
        .map(cb => {
          const idx = parseInt(cb.dataset.index);
          return history.recommended_sources[idx];
        })
        .filter(source => source.isValid !== false); // åªä¿ç•™æœ‰æ•ˆçš„æˆ–æœªéªŒè¯çš„ä¿¡æ¯æº

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: sources })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`æˆåŠŸè®¢é˜… ${sources.length} ä¸ªä¿¡æ¯æº`, 'success');
          await loadUserSubscriptions();
          // é‡æ–°æ¸²æŸ“è¯¥é¡µç­¾çš„æ¨èä¿¡æ¯æºï¼ˆå·²è®¢é˜…çš„ä¼šè‡ªåŠ¨é€‰ä¸­ï¼Œå› ä¸ºrenderRecommendationsInTabä¼šæ ¹æ®isSubscribedè®¾ç½®checkedå±æ€§ï¼‰
          if (history.recommended_sources) {
            await renderRecommendationsInTab(tabIndex, history.recommended_sources);
          }
        } else {
          showMessage(result.message || 'è®¢é˜…å¤±è´¥', 'error');
        }
      } catch (error) {
        showMessage('è®¢é˜…å¤±è´¥: ' + error.message, 'error');
      }
    }


    // åŠ è½½æ¨èå†å²ï¼ˆä¿ç•™å‘åå…¼å®¹ï¼‰
    async function loadRecommendationHistory() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success && result.data) {
          const history = result.data;
          
          // æ˜¾ç¤ºæ¨èè¿‡ç¨‹æ—¥å¿—
          if (history.process_logs && history.process_logs.length > 0) {
            savedProcessLogs = history.process_logs;
            document.getElementById('deepseekProcessSection').style.display = 'block';
            renderProcessLogs(history.process_logs);
          }
          
          // æ˜¾ç¤ºæ¨èä¿¡æ¯æºè¡¨æ ¼
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            recommendedSources = history.recommended_sources;
            await loadUserSubscriptions();
            renderRecommendations();
            document.getElementById('recommendationsSection').style.display = 'block';
            
            // å¦‚æœæœ‰ä¿å­˜çš„ä¸»é¢˜å…³é”®è¯ï¼Œæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸­
            if (history.topic_keywords) {
              document.getElementById('topicInput').value = history.topic_keywords;
            }
          }
        }
      } catch (error) {
        console.error('åŠ è½½æ¨èå†å²å¤±è´¥:', error);
      }
    }

    // åŠ è½½æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾
    async function loadArticlesTopicsTabs() {
      console.log('ğŸ“š å¼€å§‹åŠ è½½æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾...');
      
      try {
        // åŠ è½½ç”¨æˆ·ä¸»é¢˜åˆ—è¡¨ï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®ï¼‰
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        
        if (!topicsResponse.ok) {
          throw new Error(`HTTP ${topicsResponse.status}: ${topicsResponse.statusText}`);
        }
        
        const topicsResult = await topicsResponse.json();
        console.log('ğŸ“‹ ä¸»é¢˜åˆ—è¡¨å“åº”:', topicsResult);
        
        if (!topicsResult.success || !topicsResult.data || topicsResult.data.length === 0) {
          console.log('â„¹ï¸  ç”¨æˆ·æ²¡æœ‰ä¸»é¢˜ï¼Œæ˜¾ç¤ºæç¤º');
          document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
          document.getElementById('articlesNoTopicsHint').style.display = 'block';
          return;
        }
        
        userTopics = topicsResult.data;
        console.log(`âœ… æ‰¾åˆ° ${userTopics.length} ä¸ªä¸»é¢˜`);
        
        document.getElementById('articlesTopicsTabsContainer').style.display = 'block';
        document.getElementById('articlesNoTopicsHint').style.display = 'none';
        
        // åŠ è½½æ‰€æœ‰æ¨èå†å²ï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿è·å–æœ€æ–°æ•°æ®ï¼‰
        try {
          const historyResponse = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          
          if (historyResponse.ok) {
            const historyResult = await historyResponse.json();
            
            if (historyResult.success && historyResult.data) {
              console.log(`ğŸ“– åŠ è½½äº† ${historyResult.data.length} æ¡æ¨èå†å²`);
              historyResult.data.forEach(history => {
                if (history.recommended_sources) {
                  topicRecommendationHistory[history.topic_keywords] = {
                    recommended_sources: Array.isArray(history.recommended_sources) 
                      ? history.recommended_sources 
                      : (typeof history.recommended_sources === 'string' 
                          ? JSON.parse(history.recommended_sources) 
                          : [])
                  };
                }
              });
            }
          } else {
            console.warn('âš ï¸  åŠ è½½æ¨èå†å²å¤±è´¥:', historyResponse.status);
          }
        } catch (historyError) {
          console.warn('âš ï¸  åŠ è½½æ¨èå†å²æ—¶å‡ºé”™:', historyError);
          // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­æµç¨‹
        }
        
        // æ¸²æŸ“ä¸»é¢˜é¡µç­¾ï¼ˆä¸ºæ‰€æœ‰ä¸»é¢˜åˆ›å»ºé¡µç­¾ï¼Œå³ä½¿æ²¡æœ‰æ¨èå†å²ï¼‰
        renderArticlesTopicsTabs();
        
        // åˆå§‹åŒ–å½“å‰æ´»åŠ¨é¡µç­¾ç´¢å¼•
        if (userTopics.length > 0) {
          window.currentArticlesTopicIndex = 0;
          console.log(`âœ… ä¸»é¢˜é¡µç­¾åŠ è½½å®Œæˆï¼Œå…± ${userTopics.length} ä¸ªä¸»é¢˜ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªä¸»é¢˜`);
          
          // æ‰“å°æ¯ä¸ªä¸»é¢˜çš„é¡µç­¾çŠ¶æ€
          userTopics.forEach((topic, index) => {
            const hasHistory = topicRecommendationHistory[topic.topic_keywords]?.recommended_sources?.length > 0;
            console.log(`   - ä¸»é¢˜ ${index + 1}: "${topic.topic_keywords}" ${hasHistory ? '(æœ‰æ¨èå†å²)' : '(æ— æ¨èå†å²ï¼Œä½†é¡µç­¾å·²åˆ›å»º)'}`);
          });
        }
      } catch (error) {
        console.error('âŒ åŠ è½½æ–‡ç« ä¸»é¢˜é¡µç­¾å¤±è´¥:', error);
        console.error('   é”™è¯¯è¯¦æƒ…:', error.message);
        console.error('   é”™è¯¯å †æ ˆ:', error.stack);
        document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
        document.getElementById('articlesNoTopicsHint').style.display = 'block';
      }
    }
    
    // æ¸²æŸ“æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾
    function renderArticlesTopicsTabs() {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // æ¸…ç©ºç°æœ‰å†…å®¹
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';
      
      // ä¸ºæ¯ä¸ªä¸»é¢˜åˆ›å»ºé¡µç­¾å’Œå†…å®¹é¢æ¿
      userTopics.forEach((topic, index) => {
        const topicKeywords = topic.topic_keywords;
        
        // åˆ›å»ºé¡µç­¾
        const tab = document.createElement('button');
        tab.className = 'topic-tab' + (index === 0 ? ' active' : '');
        tab.textContent = topicKeywords;
        tab.onclick = () => switchArticlesTopicTab(index);
        tabsHeader.appendChild(tab);
        
        // åˆ›å»ºå†…å®¹é¢æ¿
        const panel = document.createElement('div');
        panel.className = 'topic-tab-panel' + (index === 0 ? ' active' : '');
        panel.id = `articlesTopicPanel-${index}`;
        panel.innerHTML = `
          <!-- ç»Ÿè®¡ä¿¡æ¯æ  -->
          <div class="articles-stats-bar" id="articlesStatsBar-${index}">
            <div style="display: flex; align-items: center;">
              <button class="btn-refresh-now" onclick="refreshNewsNow(${index})" id="refreshNowBtn-${index}">
                <span>ğŸ”„</span> ç«‹å³åˆ·æ–°
              </button>
              <div class="refresh-progress" id="refreshProgress-${index}">
                <span class="progress-text" id="refreshProgressText-${index}"></span>
                <span class="progress-dots"></span>
              </div>
            </div>
            <div class="stats-items-container">
              <div class="stat-item">
                <span class="stat-label">æœ€ååˆ·æ–°</span>
                <span class="stat-value" id="lastRefreshTime-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">å‘å¸ƒæ—¶é—´</span>
                <span class="stat-value" id="publishDateRange-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">æœ€è¿‘åˆ·æ–°</span>
                <span class="stat-value" id="recentArticlesCount-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">æ–‡ç« æ€»æ•°</span>
                <span class="stat-value" id="totalArticles-${index}">-</span>
              </div>
            </div>
          </div>

          <!-- ä¿¡æ¯æºè¿‡æ»¤å¡ç‰‡ -->
          <div class="source-filter-cards" id="sourceFilterCards-${index}">
            <div class="source-card active" data-source="all" onclick="filterArticlesBySourceInTab(${index}, null)">
              <span>å…¨éƒ¨</span>
            </div>
            <!-- åŠ¨æ€åŠ è½½ä¿¡æ¯æº -->
          </div>

          <!-- æ–‡ç« åˆ—è¡¨è§†å›¾ -->
          <div id="articlesListView-${index}" class="articles-list-view">
            <div id="articlesList-${index}" class="articles-list">
              <div class="loading">åŠ è½½ä¸­...</div>
            </div>
          </div>
        `;
        tabsContent.appendChild(panel);
      });
      
      // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªä¸»é¢˜
      if (userTopics.length > 0) {
        currentTopicFilter = userTopics[0].topic_keywords;
        switchArticlesTopicTab(0);
      }
    }
    
    // åˆ‡æ¢æ–‡ç« ä¸»é¢˜é¡µç­¾
    function switchArticlesTopicTab(index) {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // æ›´æ–°é¡µç­¾çŠ¶æ€
      Array.from(tabsHeader.children).forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // æ›´æ–°å†…å®¹é¢æ¿çŠ¶æ€
      Array.from(tabsContent.children).forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
      
      // æ›´æ–°å½“å‰ä¸»é¢˜è¿‡æ»¤å’Œæ´»åŠ¨é¡µç­¾ç´¢å¼•
      if (userTopics[index]) {
        currentTopicFilter = userTopics[index].topic_keywords;
        window.currentArticlesTopicIndex = index; // ä¿å­˜å½“å‰æ´»åŠ¨é¡µç­¾ç´¢å¼•
        // é‡æ–°åŠ è½½è¯¥ä¸»é¢˜çš„æ–‡ç« 
        loadArticlesForTopic(currentTopicFilter, index);
      }
    }
    
    // ä¸ºç‰¹å®šä¸»é¢˜åŠ è½½æ–‡ç« 
    async function loadArticlesForTopic(topicKeywords, tabIndex, forceRefresh = false) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // è·å–è¯¥ä¸»é¢˜çš„æ¨èä¿¡æ¯æº
      const recommendedSources = topicRecommendationHistory[topicKeywords]?.recommended_sources || [];
      const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
      
      // å¦‚æœæ²¡æœ‰æ¨èå†å²ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
      if (recommendedSources.length === 0) {
        console.log(`â„¹ï¸  ä¸»é¢˜ "${topicKeywords}" è¿˜æ²¡æœ‰æ¨èå†å²ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯`);
        articlesListEl.innerHTML = `
          <div class="empty-state">
            <p>è¯¥ä¸»é¢˜è¿˜æ²¡æœ‰è·å–æ¨èä¿¡æ¯æº</p>
            <p style="margin-top: 12px; font-size: 13px; color: #999;">
              è¯·å‰å¾€"è®¢é˜…ç®¡ç†"é¡µé¢ï¼Œä¸ºè¯¥ä¸»é¢˜è·å–æ¨èä¿¡æ¯æº
            </p>
          </div>
        `;
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStatsForTab([], tabIndex);
        // æ¸…ç©ºä¿¡æ¯æºå¡ç‰‡ï¼ˆåªä¿ç•™"å…¨éƒ¨"ï¼‰
        loadSourceCardsForTab([], tabIndex);
        return;
      }
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      articlesListEl.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
      
      try {
        // åŠ è½½è¯¥ä¸»é¢˜çš„æ–‡ç« ï¼ˆä¼ é€’ topicKeywords å‚æ•°ï¼‰
        let url = `${API_BASE_URL}/news/list`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();
        
        if (result.success) {
          const data = result.data;
          
          // å°†æ‰€æœ‰æ–‡ç« å±•å¹³åˆ°ä¸€ä¸ªæ•°ç»„ä¸­
          let topicArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              const article = {
                ...news,
                date: day.date
              };
              
              // åªåŒ…å«å±äºè¯¥ä¸»é¢˜æ¨èä¿¡æ¯æºçš„æ–‡ç« ï¼Œä¸”ä¸»é¢˜å…³é”®è¯åŒ¹é…
              if ((sourceNames.length === 0 || sourceNames.includes(news.source)) &&
                  (!news.topic_keywords || news.topic_keywords === topicKeywords)) {
                topicArticles.push(article);
              }
            });
          });
          
          // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
          updateStatsForTab(topicArticles, tabIndex);
          
          // åŠ è½½ä¿¡æ¯æºå¡ç‰‡ï¼ˆåªæ˜¾ç¤ºè¯¥ä¸»é¢˜ç›¸å…³çš„ä¿¡æ¯æºï¼‰
          const sources = [...new Set(topicArticles.map(a => a.source))];
          loadSourceCardsForTab(sources, tabIndex);
          
          // å­˜å‚¨è¯¥ä¸»é¢˜çš„æ–‡ç« æ•°æ®
          if (!window.topicArticlesData) {
            window.topicArticlesData = {};
          }
          window.topicArticlesData[topicKeywords] = topicArticles;
          
          // åº”ç”¨å½“å‰è¿‡æ»¤å’Œæœç´¢
          applyFiltersForTab(topicKeywords, tabIndex);
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>åŠ è½½å¤±è´¥: ' + error.message + '</p></div>';
      }
    }
    
    // æ›´æ–°ç‰¹å®šé¡µç­¾çš„ç»Ÿè®¡ä¿¡æ¯
    function updateStatsForTab(articles, tabIndex) {
      document.getElementById(`totalArticles-${tabIndex}`).textContent = articles.length;
      document.getElementById(`publishDateRange-${tabIndex}`).textContent = calculatePublishDateRange(articles);
      document.getElementById(`recentArticlesCount-${tabIndex}`).textContent = calculateRecentArticlesCount(articles);
    }
    
    // ä¸ºç‰¹å®šé¡µç­¾åŠ è½½ä¿¡æ¯æºå¡ç‰‡
    function loadSourceCardsForTab(sources, tabIndex) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // æ¸…ç©ºæ‰€æœ‰å¡ç‰‡ï¼ŒåŒ…æ‹¬"å…¨éƒ¨"
      container.innerHTML = '';
      
      // é‡æ–°åˆ›å»º"å…¨éƒ¨"å¡ç‰‡
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>å…¨éƒ¨</span>';
      allCard.onclick = () => filterArticlesBySourceInTab(tabIndex, null);
      container.appendChild(allCard);
      
      // æ·»åŠ ä¿¡æ¯æºå¡ç‰‡
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySourceInTab(tabIndex, source);
        container.appendChild(card);
      });
    }
    
    // åœ¨ç‰¹å®šé¡µç­¾ä¸­æŒ‰ä¿¡æ¯æºè¿‡æ»¤
    function filterArticlesBySourceInTab(tabIndex, source) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // æ›´æ–°å¡ç‰‡çŠ¶æ€
      container.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      // åº”ç”¨è¿‡æ»¤
      if (currentTopicFilter) {
        applyFiltersForTab(currentTopicFilter, tabIndex, source);
      }
    }
    
    // ä¸ºç‰¹å®šé¡µç­¾åº”ç”¨è¿‡æ»¤å’Œæœç´¢
    function applyFiltersForTab(topicKeywords, tabIndex, sourceFilter = null) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // è·å–è¯¥ä¸»é¢˜çš„æ–‡ç« æ•°æ®
      const topicArticles = window.topicArticlesData?.[topicKeywords] || [];
      let filtered = [...topicArticles];
      
      // æŒ‰ä¿¡æ¯æºè¿‡æ»¤
      const sourceInput = document.querySelector(`#sourceFilterCards-${tabIndex} .source-card.active`);
      const activeSource = sourceInput?.getAttribute('data-source');
      if (sourceFilter !== null) {
        // ä½¿ç”¨ä¼ å…¥çš„sourceFilter
        if (sourceFilter !== 'all') {
          filtered = filtered.filter(a => a.source === sourceFilter);
        }
      } else if (activeSource && activeSource !== 'all') {
        filtered = filtered.filter(a => a.source === activeSource);
      }
      
      
      // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
      renderArticlesForTab(filtered, tabIndex);
    }
    
    // æ ¼å¼åŒ–æ—¥æœŸä¸ºå®Œæ•´æ ¼å¼ï¼ˆç”¨äºæ—¥æœŸæ ‡é¢˜ï¼‰
    function formatDateFull(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      const weekday = weekdays[date.getDay()];
      
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (date.toDateString() === today.toDateString()) {
        return `ä»Šå¤© (${year}å¹´${month}æœˆ${day}æ—¥)`;
      } else if (date.toDateString() === yesterday.toDateString()) {
        return `æ˜¨å¤© (${year}å¹´${month}æœˆ${day}æ—¥)`;
      } else {
        return `${year}å¹´${month}æœˆ${day}æ—¥ æ˜ŸæœŸ${weekday}`;
      }
    }

    // æ ¼å¼åŒ–æ—¥æœŸä¸ºç®€çŸ­æ ¼å¼ï¼ˆç”¨äºæ–‡ç« å¡ç‰‡ï¼‰
    function formatDateShort(dateStr) {
      const date = new Date(dateStr);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      return `${month}æœˆ${day}æ—¥`;
    }

    // æŒ‰æ—¥æœŸåˆ†ç»„æ–‡ç« 
    function groupArticlesByDate(articles) {
      const groups = {};
      
      articles.forEach(article => {
        const date = new Date(article.publish_date);
        const dateKey = date.toDateString(); // ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²ä½œä¸ºé”®
        
        if (!groups[dateKey]) {
          groups[dateKey] = {
            date: date,
            articles: []
          };
        }
        
        groups[dateKey].articles.push(article);
      });
      
      // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
      return Object.values(groups).sort((a, b) => b.date - a.date);
    }

    // æ·»åŠ æ–‡ç« åˆ°æŒ‡å®šé¡µç­¾
    function addArticleToTab(tabIndex, article) {
      if (!window.topicArticlesData) {
        window.topicArticlesData = {};
      }
      if (!window.topicArticlesData[currentTopicFilter]) {
        window.topicArticlesData[currentTopicFilter] = [];
      }
      
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      const exists = window.topicArticlesData[currentTopicFilter].some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        window.topicArticlesData[currentTopicFilter].push(article);
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStatsForTab(window.topicArticlesData[currentTopicFilter], tabIndex);
        
        // æ›´æ–°ä¿¡æ¯æºå¡ç‰‡ï¼ˆå®æ—¶æ·»åŠ æ–°çš„ä¿¡æ¯æºï¼‰
        const currentSources = [...new Set(window.topicArticlesData[currentTopicFilter].map(a => a.source))];
        loadSourceCardsForTab(currentSources, tabIndex);
        
        // é‡æ–°æ¸²æŸ“æ–‡ç« åˆ—è¡¨
        applyFiltersForTab(currentTopicFilter, tabIndex);
      }
    }
    
    // æ·»åŠ æ–‡ç« åˆ°åˆ—è¡¨ï¼ˆéä¸»é¢˜é¡µç­¾ï¼‰
    function addArticleToList(article) {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      const exists = allArticles.some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        allArticles.push(article);
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStats(allArticles);
        
        // æ›´æ–°ä¿¡æ¯æºå¡ç‰‡ï¼ˆå®æ—¶æ·»åŠ æ–°çš„ä¿¡æ¯æºï¼‰
        const currentSources = [...new Set(allArticles.map(a => a.source))];
        loadSourceCards(currentSources);
        
        // åº”ç”¨å½“å‰è¿‡æ»¤å’Œæœç´¢
        applyFilters();
      }
    }

    // ä¸ºç‰¹å®šé¡µç­¾æ¸²æŸ“æ–‡ç« åˆ—è¡¨
    function renderArticlesForTab(articles, tabIndex) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>æš‚æ— æ–‡ç« </p></div>';
        return;
      }
      
      // æŒ‰æ—¥æœŸåˆ†ç»„
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // æ¸²æŸ“è¯¥æ—¥æœŸä¸‹çš„æ‰€æœ‰æ–‡ç« 
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">ä¸ç›¸å…³</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'æœªçŸ¥')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // å¤„ç†ESCé”®å…³é—­å¼¹çª—
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('addTopicModal');
        if (modal && modal.classList.contains('show')) {
          closeAddTopicModal();
        }
      }
    });

    // ========== æ¨æ–‡ç®¡ç† ==========
    
    let currentTweetsPage = 1;
    const tweetsPageSize = 20;
    let allTweets = [];
    let tweetsUsers = new Set();

    // åŠ è½½æ¨æ–‡
    async function loadTweets(page = 1) {
      const loadingEl = document.getElementById('tweetsLoading');
      const containerEl = document.getElementById('tweetsContainer');
      const listEl = document.getElementById('tweetsList');
      const paginationEl = document.getElementById('tweetsPagination');
      const searchInput = document.getElementById('tweetsSearchInput');
      const userFilter = document.getElementById('tweetsUserFilter');
      
      try {
        loadingEl.style.display = 'block';
        containerEl.style.display = 'none';
        
        // æ„å»ºAPI URL
        let url = `${API_BASE_URL}/news/list?page=${page}&pageSize=${tweetsPageSize}`;
        const searchKeyword = searchInput?.value || '';
        const selectedUser = userFilter?.value || '';
        
        const response = await fetch(url, {
          headers: getHeaders()
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          // è¿‡æ»¤å‡ºTwitter/Xæ¨æ–‡
          let tweets = result.data || [];
          if (Array.isArray(tweets)) {
            // å¦‚æœæ˜¯æŒ‰æ—¥æœŸåˆ†ç»„çš„æ ¼å¼ï¼Œéœ€è¦å±•å¼€
            const allItems = [];
            tweets.forEach(dateGroup => {
              if (dateGroup.news && Array.isArray(dateGroup.news)) {
                dateGroup.news.forEach(news => {
                  allItems.push({...news, date: dateGroup.date});
                });
              }
            });
            tweets = allItems;
          }
          
          // è¿‡æ»¤æ¨æ–‡ï¼šURLåŒ…å«nitter/twitter/x.comï¼Œæˆ–sourceä»¥@å¼€å¤´
          tweets = tweets.filter(tweet => {
            const url = (tweet.url || '').toLowerCase();
            const source = (tweet.source || '').trim();
            return url.includes('nitter') || 
                   url.includes('twitter.com') || 
                   url.includes('x.com') ||
                   source.startsWith('@') ||
                   source.includes('Twitter') ||
                   source.includes('X');
          });
          
          // æœç´¢è¿‡æ»¤
          if (searchKeyword) {
            const keyword = searchKeyword.toLowerCase();
            tweets = tweets.filter(tweet => {
              const title = (tweet.title || '').toLowerCase();
              const summary = (tweet.summary || '').toLowerCase();
              return title.includes(keyword) || summary.includes(keyword);
            });
          }
          
          // ç”¨æˆ·è¿‡æ»¤
          if (selectedUser) {
            tweets = tweets.filter(tweet => {
              const source = (tweet.source || '').trim();
              return source === selectedUser || source.includes(selectedUser);
            });
          }
          
          allTweets = tweets;
          
          // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
          tweetsUsers.clear();
          tweets.forEach(tweet => {
            const source = (tweet.source || '').trim();
            if (source && (source.startsWith('@') || source.includes('Twitter') || source.includes('X'))) {
              tweetsUsers.add(source);
            }
          });
          
          // æ›´æ–°ç”¨æˆ·ç­›é€‰ä¸‹æ‹‰æ¡†
          if (userFilter) {
            const currentValue = userFilter.value;
            userFilter.innerHTML = '<option value="">æ‰€æœ‰ç”¨æˆ·</option>';
            Array.from(tweetsUsers).sort().forEach(user => {
              const option = document.createElement('option');
              option.value = user;
              option.textContent = user;
              if (user === currentValue) {
                option.selected = true;
              }
              userFilter.appendChild(option);
            });
          }
          
          // æ¸²æŸ“æ¨æ–‡
          listEl.innerHTML = '';
          
          if (tweets.length === 0) {
            listEl.innerHTML = `
              <div class="empty-tweets">
                <div class="empty-tweets-icon">ğŸ¦</div>
                <p>æš‚æ— æ¨æ–‡</p>
                <p style="font-size: 14px; color: #999; margin-top: 8px;">
                  ${searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨æ–‡' : 'è¿˜æ²¡æœ‰æŠ“å–åˆ°æ¨æ–‡ï¼Œè¯·å…ˆåœ¨è®¢é˜…ç®¡ç†ä¸­æ·»åŠ Twitter/Xè®¢é˜…æº'}
                </p>
              </div>
            `;
          } else {
            tweets.forEach(tweet => {
              const tweetEl = createTweetElement(tweet);
              listEl.appendChild(tweetEl);
            });
          }
          
          // åˆ†é¡µï¼ˆç®€åŒ–ç‰ˆï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»è¿‡æ»¤äº†ï¼‰
          paginationEl.innerHTML = `
            <span style="color: #536471;">æ˜¾ç¤º ${tweets.length} æ¡æ¨æ–‡</span>
          `;
          
          loadingEl.style.display = 'none';
          containerEl.style.display = 'block';
          currentTweetsPage = page;
        }
      } catch (error) {
        console.error('åŠ è½½æ¨æ–‡å¤±è´¥:', error);
        loadingEl.style.display = 'none';
        showMessage('åŠ è½½æ¨æ–‡å¤±è´¥: ' + error.message, 'error', 'tweetsMessage');
      }
    }
    
    // åˆ›å»ºæ¨æ–‡å…ƒç´ 
    function createTweetElement(tweet) {
      const tweetEl = document.createElement('div');
      tweetEl.className = 'tweet';
      
      // æå–ç”¨æˆ·åå’Œå¤´åƒ
      let username = 'Unknown';
      let handle = '';
      const source = (tweet.source || '').trim();
      
      if (source.startsWith('@')) {
        handle = source;
        username = source.substring(1).charAt(0).toUpperCase() + source.substring(2);
      } else if (tweet.url) {
        const match = tweet.url.match(/(?:twitter\.com|x\.com|nitter[^/]+)\/([a-zA-Z0-9_]+)/);
        if (match) {
          handle = '@' + match[1];
          username = match[1].charAt(0).toUpperCase() + match[1].substring(1);
        }
      }
      
      // æ ¼å¼åŒ–æ—¶é—´
      const time = formatTweetTime(tweet.publish_date || tweet.date);
      
      // è·å–å¤´åƒé¦–å­—æ¯
      const avatarLetter = username.charAt(0).toUpperCase();
      
      // å¤„ç†å†…å®¹ï¼ˆç§»é™¤HTMLæ ‡ç­¾ï¼Œä¿ç•™æ¢è¡Œï¼‰
      let content = tweet.title || tweet.summary || '';
      content = content.replace(/<[^>]*>/g, '').trim();
      
      // å¤„ç†å›¾ç‰‡
      let imageHtml = '';
      if (tweet.image_url) {
        imageHtml = `<img src="${tweet.image_url}" alt="Tweet image" class="tweet-image" onerror="this.style.display='none'">`;
      }
      
      tweetEl.innerHTML = `
        <div class="tweet-header">
          <div class="tweet-avatar">${avatarLetter}</div>
          <div class="tweet-user-info">
            <div class="tweet-username">
              ${escapeHtml(username)}
              <span class="tweet-handle">${escapeHtml(handle)}</span>
              <span class="tweet-time">Â· ${time}</span>
            </div>
          </div>
        </div>
        <div class="tweet-content">${escapeHtml(content)}</div>
        ${imageHtml}
        <div class="tweet-footer">
          <div class="tweet-action" onclick="event.stopPropagation(); window.open('${tweet.url || '#'}', '_blank')">
            <span class="tweet-action-icon">ğŸ”—</span>
            <span>æŸ¥çœ‹åŸæ–‡</span>
          </div>
          <div class="tweet-action" onclick="event.stopPropagation(); viewTweetDetail(${tweet.id})">
            <span class="tweet-action-icon">ğŸ“–</span>
            <span>æŸ¥çœ‹è¯¦æƒ…</span>
          </div>
        </div>
      `;
      
      // ç‚¹å‡»æ¨æ–‡è·³è½¬åˆ°è¯¦æƒ…
      tweetEl.addEventListener('click', (e) => {
        if (!e.target.closest('.tweet-action')) {
          viewTweetDetail(tweet.id);
        }
      });
      
      return tweetEl;
    }
    
    // æ ¼å¼åŒ–æ¨æ–‡æ—¶é—´
    function formatTweetTime(dateStr) {
      if (!dateStr) return '';
      
      const date = new Date(dateStr);
      const now = new Date();
      const diff = now - date;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (seconds < 60) {
        return 'åˆšåˆš';
      } else if (minutes < 60) {
        return `${minutes}åˆ†é’Ÿå‰`;
      } else if (hours < 24) {
        return `${hours}å°æ—¶å‰`;
      } else if (days < 7) {
        return `${days}å¤©å‰`;
      } else {
        return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
      }
    }
    
    // æŸ¥çœ‹æ¨æ–‡è¯¦æƒ…
    function viewTweetDetail(tweetId) {
      window.location.href = `/article.html?id=${tweetId}`;
    }
    
    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, type, containerId = 'message') {
      const messageEl = document.getElementById(containerId);
      if (!messageEl) return;
      
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }
    
    // è½¬ä¹‰HTML
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // é¡µé¢åŠ è½½æ—¶
    window.onload = async function() {
      await initUser();
      await loadTopics();
      await loadUserSubscriptions(); // åŠ è½½ç”¨æˆ·è®¢é˜…åˆ—è¡¨
      await loadAllRecommendationHistory(); // åŠ è½½æ‰€æœ‰æ¨èå†å²
      await loadArticlesTopicsTabs(); // åŠ è½½æ–‡ç« é˜…è¯»é¡µé¢çš„ä¸»é¢˜é¡µç­¾
      await loadArticles(); // ä¿ç•™åŸæœ‰çš„loadArticlesç”¨äºå…¼å®¹
      await loadRefreshStatus();
      startArticlesAutoRefresh();
      
      // å¤„ç† URL hash å¯¼èˆª
      const hash = window.location.hash.substring(1);
      if (hash === 'guide' || hash === 'features') {
        switchPage(hash);
      } else {
        // æ¢å¤é¡µé¢çŠ¶æ€
        const savedPage = localStorage.getItem('dashboardCurrentPage');
        const savedArticleId = localStorage.getItem('dashboardViewingArticleId');
        const savedTopicIndex = localStorage.getItem('dashboardCurrentTopicIndex');
        
        if (savedPage) {
        // åˆ‡æ¢åˆ°ä¿å­˜çš„é¡µé¢
        switchPage(savedPage);
        
        // å¦‚æœæ˜¯åœ¨æ–‡ç« é˜…è¯»é¡µé¢ï¼Œä¸”ä¿å­˜äº†æ–‡ç« IDï¼Œåˆ™æ¢å¤æ–‡ç« è¯¦æƒ…
        if (savedPage === 'articles' && savedArticleId) {
          // æ¢å¤ä¸»é¢˜é¡µç­¾ç´¢å¼•
          if (savedTopicIndex) {
            const topicIndex = parseInt(savedTopicIndex, 10);
            window.currentArticlesTopicIndex = topicIndex;
            switchArticlesTopicTab(topicIndex);
          }
          
          // ç­‰å¾…æ–‡ç« åˆ—è¡¨åŠ è½½å®Œæˆåå†æ˜¾ç¤ºæ–‡ç« è¯¦æƒ…
          setTimeout(async () => {
            try {
              await viewArticle(parseInt(savedArticleId, 10));
            } catch (error) {
              console.error('æ¢å¤æ–‡ç« è¯¦æƒ…å¤±è´¥:', error);
              // å¦‚æœæ–‡ç« ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œæ¸…é™¤ä¿å­˜çš„çŠ¶æ€
              localStorage.removeItem('dashboardViewingArticleId');
            }
          }, 800);
        }
      }
      }
    };
  </script>
</body>
</html>
