<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‰∏™‰∫∫‰ø°ÊÅØÊï¥ÁêÜ - ‰ª™Ë°®Áõò</title>
  <script src="js/global-progress.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%);
      color: #333;
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    /* Â∑¶‰æßËèúÂçï */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #ffffff 0%, #faf5ff 100%);
      box-shadow: 2px 0 12px rgba(139, 92, 246, 0.15);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid #eee;
    }

    .sidebar-header h1 {
      font-size: 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .user-info {
      font-size: 14px;
      color: #666;
    }

    .sidebar-menu {
      flex: 1;
      padding: 20px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.08) 0%, rgba(139, 92, 246, 0.03) 100%);
    }

    .menu-item.active {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      border-left-color: #8B5CF6;
      color: #8B5CF6;
    }

    .menu-item-icon {
      width: 20px;
      margin-right: 12px;
      font-size: 18px;
    }

    .menu-item-text {
      font-size: 15px;
      font-weight: 500;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid #eee;
    }

    .logout-btn {
      width: 100%;
      padding: 10px;
      background-color: #f5f5f5;
      color: #666;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #e0e0e0;
    }

    /* Êó•ÊúüËøáÊª§‰æßËæπÊ†è */
    .date-sidebar {
      width: 140px;
      background: linear-gradient(180deg, #faf5ff 0%, #f3e8ff 100%);
      border-right: 1px solid #e9d5ff;
      position: fixed;
      left: 240px;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      z-index: 99;
      box-shadow: 2px 0 8px rgba(139, 92, 246, 0.1);
    }

    .date-sidebar-header {
      padding: 20px 16px;
      border-bottom: 1px solid #e9d5ff;
      background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
    }

    .date-sidebar-header h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: white;
    }

    .date-sidebar-list {
      padding: 8px 0;
    }

    .date-sidebar-item {
      padding: 10px 16px;
      cursor: pointer;
      font-size: 13px;
      color: #6b7280;
      border-bottom: 1px solid #f3e8ff;
      transition: all 0.2s ease;
    }

    .date-sidebar-item:hover {
      background: #f3e8ff;
      color: #7c3aed;
    }

    .date-sidebar-item.active {
      background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
      color: white;
      font-weight: 500;
    }

    .date-sidebar-item.all-dates {
      font-weight: 600;
      color: #8B5CF6;
      border-bottom: 2px solid #e9d5ff;
    }

    .date-sidebar-item.all-dates.active {
      background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
      color: white;
    }

    /* ‰∏ªÂÜÖÂÆπÂå∫ */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 0;
      min-height: 100vh;
      min-width: 0;
      overflow-x: hidden;
      transition: margin-left 0.3s ease;
    }

    /* ÂΩìÊó•Êúü‰æßËæπÊ†èÊòæÁ§∫Êó∂Ôºå‰∏ªÂÜÖÂÆπÂå∫ÈúÄË¶ÅÂ¢ûÂä†Â∑¶ËæπË∑ù */
    .main-content.with-date-sidebar {
      margin-left: 380px;
    }

    .content-page {
      display: none;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .content-page.active {
      display: block;
    }

    /* ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Ê†∑Âºè */
    .section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.1);
      margin-bottom: 20px;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }

    .section h3 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* ‰∏ªÈ¢òËØçËæìÂÖ•Âå∫Âüü */
    .topic-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .topic-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
    }

    .topic-input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    /* Á©∫Áä∂ÊÄÅÊèêÁ§∫ */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }

    .empty-state .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h4 {
      font-size: 18px;
      color: #333;
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 14px;
      color: #999;
    }

    /* ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÁ≠æÊ†∑Âºè */
    .sub-topics-tabs-container {
      margin-top: 0;
    }

    .sub-topics-tabs-header {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 0;
      overflow-x: auto;
      flex-wrap: nowrap;
    }

    .sub-topic-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      position: relative;
      white-space: nowrap;
      transition: all 0.3s;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sub-topic-tab:hover {
      color: #8B5CF6;
    }

    .sub-topic-tab.active {
      color: #8B5CF6;
      font-weight: 600;
      border-bottom-color: #8B5CF6;
    }

    .sub-topic-tab .delete-topic-btn {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #f0f0f0;
      border: none;
      cursor: pointer;
      font-size: 12px;
      color: #999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      opacity: 0;
    }

    .sub-topic-tab:hover .delete-topic-btn {
      opacity: 1;
    }

    .sub-topic-tab .delete-topic-btn:hover {
      background: #ffebee;
      color: #c33;
    }

    .sub-topics-tabs-content {
      padding-top: 20px;
    }

    .sub-topic-panel {
      display: none;
    }

    .sub-topic-panel.active {
      display: block;
    }

    /* Â∑≤ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂå∫Âüü */
    .subscribed-sources-section {
      margin-bottom: 24px;
    }

    .subscribed-sources-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .subscribed-sources-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .subscribed-sources-count {
      font-size: 13px;
      color: #666;
      background: #f0f0f0;
      padding: 4px 10px;
      border-radius: 12px;
    }

    .subscribed-sources-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .subscribed-source-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
      border-radius: 20px;
      font-size: 13px;
      color: #6D28D9;
    }

    .subscribed-source-tag .unsubscribe-btn {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(109, 40, 217, 0.2);
      border: none;
      cursor: pointer;
      font-size: 12px;
      color: #6D28D9;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .subscribed-source-tag .unsubscribe-btn:hover {
      background: #c33;
      color: white;
    }

    .no-subscriptions {
      color: #999;
      font-size: 14px;
      padding: 16px;
      text-align: center;
      background: #f8f9fa;
      border-radius: 8px;
    }

    /* Êé®Ëçê‰ø°ÊÅØÊ∫êÂå∫Âüü */
    .recommended-sources-section {
      margin-bottom: 24px;
    }

    .recommended-sources-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .recommended-sources-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .sub-recommendations-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .sub-recommendations-table th,
    .sub-recommendations-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
      vertical-align: middle;
      overflow: hidden;
    }

    .sub-recommendations-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      font-size: 13px;
    }

    .sub-recommendations-table tr:hover {
      background-color: #f8f9fa;
    }

    .sub-recommendations-table th:nth-child(1),
    .sub-recommendations-table td:nth-child(1) {
      width: 40px;
      text-align: center;
    }

    .sub-recommendations-table th:nth-child(2),
    .sub-recommendations-table td:nth-child(2) {
      width: 180px;
    }

    .sub-recommendations-table td:nth-child(2) .source-name,
    .sub-recommendations-table td:nth-child(2) .source-url {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: block;
    }

    .sub-recommendations-table th:nth-child(3),
    .sub-recommendations-table td:nth-child(3) {
      width: 70px;
      text-align: center;
    }

    .sub-recommendations-table th:nth-child(4),
    .sub-recommendations-table td:nth-child(4) {
      width: auto;
    }

    .sub-recommendations-table td:nth-child(4) {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Êìç‰ΩúÊåâÈíÆÂå∫Âüü */
    .actions-container {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    .btn-secondary {
      padding: 10px 20px;
      background: #f0f0f0;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn-secondary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-ai-recommend {
      padding: 10px 20px;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ai-recommend:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btn-ai-recommend:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-ai-recommend .loading-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .add-topic-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .add-topic-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    /* ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÁ§∫Âå∫ÂüüÊ†∑Âºè */
    .curated-sources-section {
      margin-top: 20px;
    }

    .curated-sources-header {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      padding: 8px 0;
      transition: background-color 0.2s;
      border-radius: 8px;
      margin: -8px -8px 0 -8px;
      padding: 12px;
    }

    .curated-sources-header:hover {
      background-color: #f8f9fa;
    }

    .curated-sources-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-left: 8px;
    }

    .curated-sources-toggle {
      font-size: 12px;
      color: #8B5CF6;
      transition: transform 0.3s;
      width: 16px;
      text-align: center;
    }

    .curated-sources-toggle.expanded {
      transform: rotate(90deg);
    }

    .curated-sources-count {
      color: #8B5CF6;
      font-size: 14px;
      font-weight: normal;
      margin-left: 8px;
    }

    .curated-sources-content {
      margin-top: 16px;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .curated-sources-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .curated-sources-search-input {
      flex: 1;
      min-width: 200px;
      padding: 10px 14px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .curated-sources-search-input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .curated-sources-filters select {
      padding: 10px 14px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
      transition: border-color 0.2s;
    }

    .curated-sources-filters select:hover {
      border-color: #8B5CF6;
    }

    .curated-sources-filters select:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .curated-sources-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      font-size: 13px;
      color: #666;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .curated-sources-stats span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .curated-sources-stats .stat-value {
      font-weight: 600;
      color: #8B5CF6;
    }

    .curated-sources-table-wrapper {
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }

    .curated-sources-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      min-width: 700px;
    }

    .curated-sources-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid #e0e0e0;
      position: sticky;
      top: 0;
      z-index: 10;
      font-size: 13px;
    }

    .curated-sources-table td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 13px;
      color: #333;
    }

    .curated-sources-table tbody tr:hover {
      background-color: #faf5ff;
    }

    .curated-sources-table .source-name {
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
    }

    .curated-sources-table .source-url {
      color: #8B5CF6;
      font-size: 12px;
      word-break: break-all;
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .curated-sources-table .source-type {
      padding: 4px 8px;
      background-color: #e3f2fd;
      border-radius: 4px;
      font-size: 12px;
      color: #1976d2;
      display: inline-block;
    }

    .curated-sources-table .source-category {
      padding: 4px 8px;
      background-color: #f3e5f5;
      border-radius: 4px;
      font-size: 12px;
      color: #7b1fa2;
      display: inline-block;
    }

    .curated-sources-table .source-region {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      display: inline-block;
    }

    .curated-sources-table .source-region.domestic {
      background-color: #fff3e0;
      color: #e65100;
    }

    .curated-sources-table .source-region.foreign {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .curated-sources-table .source-description {
      color: #666;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ÂºπÁ™óÊ†∑Âºè */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f0f0f0;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: #e0e0e0;
      color: #333;
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .input-group input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
    }

    .input-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .btn-primary {
      padding: 12px 24px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .topics-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
    }

    .topic-tag {
      padding: 8px 16px;
      background-color: #f0f0f0;
      border-radius: 20px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .topic-tag .remove-btn {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topic-tag .remove-btn:hover {
      color: #c33;
    }

    .recommendations-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .recommendations-table th,
    .recommendations-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .recommendations-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
    }

    .recommendations-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .recommendations-table tr.invalid-row {
      background-color: #f5f5f5;
      opacity: 0.6;
      color: #999;
      display: none; /* ÈªòËÆ§ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê */
    }
    
    .recommendations-table.show-invalid tr.invalid-row {
      display: table-row; /* ÂΩìË°®Ê†ºÊúâshow-invalidÁ±ªÊó∂ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê */
    }
    
    .recommendations-table tr.invalid-row:hover {
      background-color: #f0f0f0;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox {
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox:disabled {
      cursor: not-allowed;
    }

    .invalid-sources-toggle {
      margin-left: 16px;
      padding: 6px 12px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      color: #6c757d;
      transition: all 0.2s;
    }

    .invalid-sources-toggle:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .checkbox-cell {
      width: 50px;
      text-align: center;
    }

    /* ÈôêÂà∂‰ø°ÊÅØÊ∫êÂêçÁß∞ÂàóÁöÑÂÆΩÂ∫¶ */
    .recommendations-table th:nth-child(2),
    .recommendations-table td:nth-child(2) {
      width: 200px;
      max-width: 200px;
      min-width: 200px;
    }
    
    .recommendations-table td:nth-child(2) .source-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    
    .recommendations-table td:nth-child(2) .source-url {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    /* Âõ∫ÂÆöÂú∞Âå∫ÂàóÂÆΩÂ∫¶ÔºàÁ¨¨4ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4Ôºâ */
    .recommendations-table th:nth-child(4),
    .recommendations-table td:nth-child(4) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(4) .source-region {
      white-space: nowrap;
      display: inline-block;
    }

    /* Âõ∫ÂÆöÊúâÊïàÊÄßÂàóÂÆΩÂ∫¶ÔºàÁ¨¨6ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4, ÊèèËø∞=5, ÊúâÊïàÊÄß=6Ôºâ */
    .recommendations-table th:nth-child(6),
    .recommendations-table td:nth-child(6) {
      width: 100px;
      max-width: 100px;
      min-width: 100px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(6) .source-validity {
      white-space: nowrap;
      display: inline-block;
    }
    
    /* Âõ∫ÂÆöÁä∂ÊÄÅÂàóÂÆΩÂ∫¶ÔºàÁ¨¨7ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4, ÊèèËø∞=5, ÊúâÊïàÊÄß=6, Áä∂ÊÄÅ=7Ôºâ */
    .recommendations-table th:nth-child(7),
    .recommendations-table td:nth-child(7) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(7) .source-status {
      white-space: nowrap;
      display: inline-block;
    }

    .source-name {
      font-weight: 500;
      color: #333;
      cursor: help;
    }

    .source-url {
      color: #8B5CF6;
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: help;
    }

    .source-type {
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .source-description {
      color: #666;
      font-size: 13px;
    }

    /* ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊ†∑Âºè */
    .curated-sources-header {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      padding: 8px 0;
      transition: background-color 0.2s;
      border-radius: 8px;
      margin: -8px -8px 0 -8px;
      padding: 8px;
    }

    .curated-sources-header:hover {
      background-color: #f8f9fa;
    }

    .curated-sources-header h3 {
      margin: 0;
      flex: 1;
      margin-left: 8px;
    }

    .curated-sources-count {
      color: #8B5CF6;
      font-size: 14px;
      font-weight: normal;
      margin-left: 8px;
    }

    .curated-sources-toggle {
      font-size: 12px;
      color: #666;
      transition: transform 0.3s;
      margin-right: 4px;
    }

    .curated-sources-content {
      margin-top: 20px;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .curated-sources-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      min-width: 150px;
      padding: 16px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 8px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 24px;
      margin: 0 0 4px 0;
      color: #333;
    }

    .stat-card p {
      margin: 0;
      font-size: 12px;
      color: #666;
    }

    .curated-sources-search {
      margin-bottom: 16px;
    }

    .curated-sources-search input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .curated-sources-search input:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .curated-sources-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .curated-sources-filters select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
    }

    .curated-sources-filters select:hover {
      border-color: #8B5CF6;
    }

    .curated-sources-actions {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      padding: 12px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .curated-sources-actions label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    .curated-sources-filtered-count {
      margin-left: auto;
      color: #666;
      font-size: 14px;
    }

    .curated-sources-table-container {
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }

    .curated-sources-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .curated-sources-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .curated-sources-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }

    .curated-sources-table tbody tr:hover {
      background-color: #f8f9fa;
    }

    .curated-source-checkbox {
      cursor: pointer;
    }

    .curated-source-name {
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
    }

    .curated-source-url {
      color: #8B5CF6;
      font-size: 12px;
      word-break: break-all;
    }

    .curated-source-type {
      padding: 4px 8px;
      background-color: #e3f2fd;
      border-radius: 4px;
      font-size: 12px;
      color: #1976d2;
    }

    .curated-source-region {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .curated-source-region.region-domestic {
      background-color: #fff3e0;
      color: #e65100;
    }

    .curated-source-region.region-foreign {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .curated-source-category {
      padding: 4px 8px;
      background-color: #f3e5f5;
      border-radius: 4px;
      font-size: 12px;
      color: #7b1fa2;
    }

    .curated-source-description {
      font-size: 13px;
      color: #666;
      max-width: 300px;
    }

    .source-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .source-status.subscribed {
      background-color: #d4edda;
      color: #155724;
    }

    .source-status.not-subscribed {
      background-color: #f8f9fa;
      color: #666;
    }
    
    .source-validity {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .source-validity.valid {
      background-color: #d4edda;
      color: #155724;
    }
    
    .source-validity.invalid {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .source-validity.validating {
      background-color: #fff3cd;
      color: #856404;
    }

    .source-region {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .source-region.region-domestic {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
      color: #6D28D9;
    }

    .source-region.region-foreign {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      color: #BE185D;
    }

    /* ËøáÊª§Êéß‰ª∂Ê†∑Âºè */
    .recommendations-filters {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 500;
      color: #333;
      white-space: nowrap;
    }

    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
    }

    .filter-group select:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .recommendations-stats {
      font-size: 14px;
      color: #666;
      margin-left: auto;
    }

    /* ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂå∫ÂüüÊ†∑Âºè */
    .manual-add-source {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .manual-add-source h5 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .manual-add-source-form {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .section .manual-add-source-form {
      margin-top: 16px;
    }

    .section .manual-add-source-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .section .manual-add-source-form .form-group label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .section .manual-add-source-form .form-group input,
    .section .manual-add-source-form .form-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .section .manual-add-source-form .form-group input:focus,
    .section .manual-add-source-form .form-group select:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .manual-add-source-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 200px;
    }

    .manual-add-source-form .form-group label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .manual-add-source-form .form-group input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      transition: border-color 0.3s;
    }

    .manual-add-source-form .form-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .manual-add-source-form .form-group input[type="url"] {
      flex: 2;
      min-width: 300px;
    }

    .manual-add-source-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .manual-add-source-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .manual-add-source-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      padding: 12px 24px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
      transform: translateY(-2px);
    }

    /* DeepSeek ‰∫§‰∫íËøáÁ®ãÊ†∑Âºè */
    .deepseek-process {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: rgba(139, 92, 246, 0.8);
      padding: 8px 12px;
      background: rgba(139, 92, 246, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(139, 92, 246, 0.1);
      min-height: 36px;
    }

    .deepseek-process-text {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .deepseek-process-dots {
      display: inline-block;
      width: 12px;
      text-align: left;
    }

    .deepseek-process-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    .deepseek-process.success {
      color: #28a745;
      background: rgba(40, 167, 69, 0.05);
      border-color: rgba(40, 167, 69, 0.1);
    }

    .deepseek-process.error {
      color: #dc3545;
      background: rgba(220, 53, 69, 0.05);
      border-color: rgba(220, 53, 69, 0.1);
    }

    .deepseek-process.loading {
      color: rgba(139, 92, 246, 0.8);
    }

    /* ‰øùÁïôÊóßÁöÑÊ†∑ÂºèÁî®‰∫éÂÖºÂÆπÔºàÂ¶ÇÊûúÂÖ∂‰ªñÂú∞ÊñπËøòÂú®‰ΩøÁî®Ôºâ */
    .process-step {
      margin-bottom: 6px;
      padding: 5px 8px;
      border-left: 3px solid #8B5CF6;
      background-color: white;
      border-radius: 4px;
    }

    .process-step.success {
      border-left-color: #28a745;
    }

    .process-step.error {
      border-left-color: #dc3545;
    }

    .process-step.loading {
      border-left-color: #ffc107;
    }

    .process-time {
      color: #999;
      font-size: 11px;
      margin-left: 8px;
    }

    .process-message {
      color: #333;
    }

    .process-data {
      margin-top: 4px;
      padding: 4px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 10px;
      color: #666;
      max-height: 80px;
      overflow-y: auto;
    }

    /* ‰∏ªÈ¢òÈ°µÁ≠æÊ†∑Âºè */
    .topics-tabs-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .topics-tabs-header {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 0;
      overflow-x: auto;
      flex-wrap: nowrap;
      scrollbar-width: thin;
    }

    .topics-tabs-header::-webkit-scrollbar {
      height: 6px;
    }

    .topics-tabs-header::-webkit-scrollbar-thumb {
      background: #8B5CF6;
      border-radius: 3px;
    }

    .topic-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      white-space: nowrap;
      transition: all 0.3s;
      position: relative;
      margin-bottom: -2px;
    }

    .topic-tab:hover {
      color: #8B5CF6;
    }

    .topic-tab.active {
      color: #8B5CF6;
      font-weight: 600;
      border-bottom-color: #8B5CF6;
    }

    .topic-tab .tab-badge {
      display: inline-block;
      margin-left: 8px;
      padding: 2px 8px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .topic-tab.active .tab-badge {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
    }

    .topics-tabs-content {
      padding-top: 20px;
    }

    .topic-tab-panel {
      display: none;
    }

    .topic-tab-panel.active {
      display: block;
    }

    .topic-tab-panel h4 {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    /* ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ê†∑Âºè */
    .refresh-status {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      color: #666;
      font-size: 14px;
    }

    .status-value {
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .status-value.success {
      color: #28a745;
    }

    .status-value.warning {
      color: #ffc107;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .news-item {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .news-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .news-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .news-item-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      flex: 1;
      margin-right: 16px;
    }

    .news-item-meta {
      display: flex;
      gap: 16px;
      font-size: 13px;
      color: #999;
      margin-bottom: 8px;
    }

    .news-item-summary {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 8px;
    }

    .news-item-source {
      display: inline-block;
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.error {
      background-color: #fee;
      color: #c33;
      border: 1px solid #fcc;
    }

    .message.success {
      background-color: #efe;
      color: #3c3;
      border: 1px solid #cfc;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    /* ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êñ∞Ê†∑Âºè */
    .btn-refresh-now {
      padding: 8px 16px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(139, 92, 246, 0.3);
      margin-bottom: 12px;
    }

    .btn-refresh-now:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-refresh-now:active {
      transform: translateY(0);
    }

    .btn-refresh-now:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-refresh-now span {
      font-size: 14px;
      display: inline-block;
      animation: none;
    }

    /* ÊñáÁ´†ËØ¶ÊÉÖÈ°µÊó∂ÈöêËóèÂà∑Êñ∞ÊåâÈíÆ */
    .article-detail-view ~ .btn-refresh-now,
    .topic-tab-panel:has(.article-detail-view[style*="display: block"]) .btn-refresh-now {
      display: none;
    }

    .btn-refresh-now.refreshing span {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }


    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      color: #999;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .source-filter-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      align-items: center;
      justify-content: space-between;
    }

    /* Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†checkboxÂÆπÂô® */
    .relevant-filter-checkbox {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      user-select: none;
      margin-left: auto;
    }

    .relevant-filter-checkbox:hover {
      border-color: #8B5CF6;
      background: #f3e8ff;
    }

    .relevant-filter-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #8B5CF6;
      margin: 0;
    }

    .relevant-filter-checkbox input[type="checkbox"]:checked {
      accent-color: #8B5CF6;
    }

    .relevant-filter-checkbox label {
      cursor: pointer;
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
    }

    .relevant-filter-checkbox:hover label {
      color: #8B5CF6;
    }

    .source-card {
      padding: 12px 24px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .source-card:hover {
      border-color: #8B5CF6;
      color: #8B5CF6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .source-card.active {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      border-color: #8B5CF6;
      color: white;
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }


    .articles-list-view {
      display: block;
    }

    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .date-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0f0f0;
    }

    .date-header {
      padding-bottom: 16px;
      border-bottom: 2px solid #e8e8e8;
      margin-bottom: 20px;
    }

    .date-text {
      font-size: 20px;
      font-weight: 700;
      color: #8B5CF6;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-text::before {
      content: 'üìÖ';
      font-size: 18px;
    }

    .articles-by-date {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    @media (max-width: 1200px) {
      .articles-by-date {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .articles-by-date {
        grid-template-columns: 1fr;
      }
    }

    /* Êó•Êúü‰æßËæπÊ†èÂìçÂ∫îÂºè */
    @media (max-width: 1024px) {
      .date-sidebar {
        width: 120px;
      }
      .main-content.with-date-sidebar {
        margin-left: 360px;
      }
    }

    @media (max-width: 768px) {
      .date-sidebar {
        display: none !important;
      }
      .main-content.with-date-sidebar {
        margin-left: 0;
      }
    }

    .article-card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid #f0f0f0;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* ‰∏çÁõ∏ÂÖ≥ÊñáÁ´†ÁöÑÊ†∑Âºè */
    .article-card.irrelevant {
      background: #fafafa;
      border-color: #e0e0e0;
      opacity: 0.85;
    }

    .article-card.irrelevant::before {
      background: linear-gradient(135deg, #9e9e9e 0%, #bdbdbd 100%);
    }

    .article-card.irrelevant:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(158, 158, 158, 0.15);
      border-color: #bdbdbd;
      opacity: 0.95;
    }

    .article-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      transform: scaleY(0);
      transition: transform 0.3s;
    }

    .article-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
      border-color: #8B5CF6;
    }

    .article-card:hover::before {
      transform: scaleY(1);
    }

    /* ‰∏çÁõ∏ÂÖ≥Ê†áÁ≠æ */
    .article-irrelevant-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
      color: white;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .article-card.irrelevant .article-card-title {
      color: #666;
    }

    .article-card.irrelevant:hover .article-card-title {
      color: #757575;
    }

    .article-card-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
      line-height: 1.4;
      transition: color 0.3s;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-shrink: 0;
    }

    .article-card:hover .article-card-title {
      color: #8B5CF6;
    }

    .article-card-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 12px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .article-card-source {
      display: inline-block;
      padding: 6px 14px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .article-card-summary {
      color: #495057;
      font-size: 14px;
      line-height: 1.6;
      margin-top: auto;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-grow: 1;
    }

    /* ÊñáÁ´†ËØ¶ÊÉÖËßÜÂõæ */
    .article-detail-view {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 24px;
      position: relative;
      overflow: hidden;
    }

    .article-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .btn-back-to-list {
      padding: 10px 20px;
      background-color: #f5f5f5;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .btn-back-to-list:hover {
      background-color: #e0e0e0;
    }

    /* Header Âè≥‰æßÁöÑÊìç‰ΩúÊåâÈíÆÂÆπÂô® */
    .article-header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .article-detail-content {
      max-width: 100%;
      min-width: 0;
      overflow-wrap: anywhere;
    }

    .article-detail-title {
      font-size: 32px;
      font-weight: bold;
      color: #1a1a1a;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .article-detail-meta {
      display: flex;
      gap: 20px;
      font-size: 14px;
      color: #666;
      margin-bottom: 24px;
    }

    .article-detail-image {
      margin-bottom: 24px;
    }

    .article-detail-image img {
      width: 100%;
      border-radius: 8px;
    }

    .article-detail-summary {
      background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
      padding: 16px;
      border-left: 4px solid #8B5CF6;
      border-radius: 4px;
      margin-bottom: 24px;
      font-size: 15px;
      line-height: 1.6;
      color: #333;
    }

    .article-generated-summary {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      padding: 20px;
      border-left: 4px solid #EC4899;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .article-generated-summary h3 {
      font-size: 18px;
      font-weight: 600;
      color: #BE185D;
      margin-bottom: 12px;
    }

    .article-generated-summary div {
      font-size: 15px;
      line-height: 1.7;
      color: #333;
    }

    .article-detail-text {
      font-size: 16px;
      line-height: 1.8;
      color: #333;
      max-width: 100%;
      word-wrap: break-word;
      overflow-wrap: anywhere;
      overflow-x: hidden;
    }

    .article-detail-text p {
      margin-bottom: 16px;
    }
    
    /* HTMLÂÜÖÂÆπÊ†∑Âºè‰ºòÂåñ */
    .article-detail-text h1,
    .article-detail-text h2,
    .article-detail-text h3,
    .article-detail-text h4,
    .article-detail-text h5,
    .article-detail-text h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.4;
      color: #1a1a1a;
    }
    
    .article-detail-text h1 { font-size: 28px; }
    .article-detail-text h2 { font-size: 24px; }
    .article-detail-text h3 { font-size: 20px; }
    .article-detail-text h4 { font-size: 18px; }
    
    .article-detail-text ul,
    .article-detail-text ol {
      margin: 16px 0;
      padding-left: 32px;
    }
    
    .article-detail-text li {
      margin-bottom: 8px;
    }
    
    .article-detail-text code {
      background-color: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      color: #d63384;
    }
    
    .article-detail-text pre {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin: 16px 0;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .article-detail-text pre code {
      background-color: transparent;
      padding: 0;
      color: #333;
    }
    
    .article-detail-text blockquote {
      border-left: 4px solid #8B5CF6;
      padding-left: 16px;
      margin: 16px 0;
      color: #666;
      font-style: italic;
    }
    
    .article-detail-text img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 16px 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .article-detail-text a {
      color: #8B5CF6;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.3s;
    }
    
    .article-detail-text a:hover {
      border-bottom-color: #8B5CF6;
    }
    
    .article-detail-text table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    
    .article-detail-text table th,
    .article-detail-text table td {
      padding: 12px;
      border: 1px solid #e9ecef;
      text-align: left;
    }
    
    .article-detail-text table th {
      background-color: #f8f9fa;
      font-weight: 600;
    }
    
    .article-detail-text hr {
      border: none;
      border-top: 1px solid #e9ecef;
      margin: 24px 0;
    }
    
    .article-detail-text strong {
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .article-detail-text em {
      font-style: italic;
    }

    .btn-translate {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.4);
      white-space: nowrap;
    }

    .btn-translate:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-translate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .article-source-link {
      display: inline-block;
      margin-top: 24px;
      color: #8B5CF6;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }

    .article-source-link:hover {
      color: #7C3AED;
      text-decoration: underline;
    }

    /* Áî®Êà∑ÊåáÂçóÈ°µÈù¢Ê†∑Âºè */
    .guide-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .guide-step,
    .guide-feature,
    .guide-tip,
    .guide-faq {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .guide-step h4,
    .guide-feature h4,
    .guide-tip h4,
    .guide-faq h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
      font-weight: 600;
    }

    .guide-step p,
    .guide-feature p,
    .guide-faq p {
      margin: 0;
      color: #666;
      line-height: 1.6;
    }

    .guide-tip ul {
      margin: 12px 0 0 0;
      padding-left: 24px;
      color: #666;
    }

    .guide-tip li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    /* ÁâπÊÄß‰ªãÁªçÈ°µÈù¢Ê†∑Âºè */
    .features-tabs {
      display: flex;
      gap: 0;
      border-bottom: 2px solid #e9ecef;
      background: white;
      border-radius: 12px 12px 0 0;
    }

    .features-tab {
      flex: 1;
      padding: 16px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      transition: all 0.3s;
    }

    .features-tab:hover {
      background: #f8f9fa;
      color: #8B5CF6;
    }

    .features-tab.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: #faf5ff;
    }

    .features-tab-content {
      display: none;
    }

    .features-tab-content.active {
      display: block;
    }

    /* ÁâπÊÄßÂç°ÁâáÁΩëÊ†ºÊ†∑Âºè */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-top: 20px;
    }

    .feature-card {
      background: white;
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.1);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #8B5CF6 0%, #EC4899 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.3);
    }

    .feature-card:hover::before {
      transform: scaleX(1);
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .feature-card:hover .feature-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .feature-title {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 20px;
      font-weight: 600;
      line-height: 1.3;
    }

    .feature-description {
      margin: 0 0 20px 0;
      color: #666;
      line-height: 1.6;
      font-size: 14px;
      flex-grow: 1;
    }

    .feature-value {
      margin-top: auto;
      padding: 16px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
      border-radius: 12px;
      border: 1px solid rgba(139, 92, 246, 0.15);
    }

    .feature-value-label {
      font-size: 13px;
      font-weight: 600;
      color: #8B5CF6;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .feature-value-text {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .feature-card {
        padding: 24px;
      }
    }

    /* Êõ¥Êñ∞ÂéÜÂè≤Ê†∑Âºè */
    .changelog-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .changelog-item {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .changelog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e9ecef;
    }

    .changelog-version {
      font-size: 18px;
      font-weight: 600;
      color: #8B5CF6;
    }

    .changelog-date {
      font-size: 14px;
      color: #999;
    }

    .changelog-section {
      margin-bottom: 12px;
    }

    .changelog-section:last-child {
      margin-bottom: 0;
    }

    .changelog-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .changelog-section ul {
      margin: 0;
      padding-left: 20px;
      color: #666;
    }

    .changelog-section li {
      margin-bottom: 6px;
      line-height: 1.5;
    }

    /* Hamburger menu button */
    .hamburger-btn {
      display: none;
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 1001;
      width: 44px;
      height: 44px;
      border: none;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border-radius: 10px;
      cursor: pointer;
      font-size: 22px;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      transition: transform 0.2s;
    }

    .hamburger-btn:active {
      transform: scale(0.95);
    }

    /* Sidebar overlay backdrop */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      backdrop-filter: blur(2px);
    }

    .sidebar-overlay.show {
      display: block;
    }

    @media (max-width: 768px) {
      .hamburger-btn {
        display: flex;
      }

      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        width: 260px;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0 !important;
      }

      .main-content.with-date-sidebar {
        margin-left: 0 !important;
      }

      .date-sidebar {
        display: none !important;
      }

      .content-page {
        padding: 16px;
        padding-top: 72px;
        max-width: 100%;
        width: 100%;
        overflow-x: hidden;
      }

      .section {
        padding: 16px;
        overflow-x: hidden;
      }

      /* ÊñáÁ´†ËØ¶ÊÉÖ */
      .article-detail-view {
        padding: 16px;
        overflow: hidden;
      }

      .article-detail-content {
        overflow-x: hidden;
      }

      .article-detail-text {
        overflow-x: hidden;
        overflow-wrap: anywhere;
        word-break: break-word;
      }

      .article-detail-text pre {
        max-width: 100%;
        overflow-x: auto;
      }

      .article-detail-text img {
        max-width: 100%;
        height: auto;
      }

      .article-detail-text table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        max-width: 100%;
      }

      .article-generated-summary {
        padding: 16px;
        overflow-wrap: anywhere;
      }

      .article-detail-summary {
        overflow-wrap: anywhere;
      }

      /* Topic input area */
      .topic-input-container {
        flex-direction: column;
        width: 100%;
      }

      .topic-input-container .topic-input {
        width: 100%;
        min-height: 44px;
      }

      .topic-input-container .btn-primary {
        width: 100%;
      }

      /* Subscription tabs */
      .sub-topics-tabs-header {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .sub-topic-tab {
        padding: 10px 14px;
        font-size: 13px;
        min-height: 44px;
      }

      .sub-topic-tab .delete-topic-btn {
        opacity: 1;
      }

      /* Tables */
      .sub-recommendations-table,
      .recommendations-table,
      .curated-sources-table {
        min-width: 600px;
      }

      /* Ë°®Ê†ºÂ§ñÂ±ÇÂÆπÂô®Ê∑ªÂä†Ê®™ÂêëÊªöÂä® */
      .curated-sources-table-wrapper,
      .curated-sources-table-container,
      [id^="sub-recommendations-container-"],
      .recommended-sources-section,
      .sub-topic-panel > div:has(.recommendations-table) {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Á°Æ‰øù section ÂÜÖÁöÑË°®Ê†ºÂèØ‰ª•ÊªöÂä® */
      .section:has(.recommendations-table),
      .section:has(.sub-recommendations-table) {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Filters */
      .recommendations-filters {
        flex-direction: column;
        gap: 8px;
      }

      .filter-group {
        width: 100%;
      }

      .filter-group select {
        width: 100%;
        min-height: 44px;
      }

      .curated-sources-filters {
        flex-direction: column;
      }

      .curated-sources-filters select {
        width: 100%;
        min-height: 44px;
      }

      .curated-sources-search-input {
        min-width: unset;
        width: 100%;
        min-height: 44px;
      }

      .curated-sources-actions {
        flex-direction: column;
        gap: 8px;
      }

      /* Manual add source form */
      .manual-add-source-form {
        flex-direction: column;
      }

      .manual-add-source-form .form-group {
        min-width: unset;
        width: 100%;
      }

      .manual-add-source-form .form-group input[type="url"] {
        min-width: unset;
        flex: unset;
      }

      .manual-add-source-btn {
        width: 100%;
        min-height: 44px;
      }

      /* Buttons */
      .btn-primary,
      .btn-secondary,
      .btn-ai-recommend {
        min-height: 44px;
        padding: 12px 20px;
      }

      .add-topic-btn {
        width: 36px;
        height: 36px;
      }

      .actions-container {
        flex-direction: column;
      }

      .actions-container button {
        width: 100%;
      }

      /* Modal */
      .modal-content {
        width: 95%;
        max-width: none;
        padding: 20px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .input-group {
        flex-direction: column;
      }

      .input-group input {
        min-height: 44px;
      }

      /* Articles page - mobile optimized */
      .btn-refresh-now {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        padding: 0;
        justify-content: center;
        align-items: center;
        z-index: 100;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      }

      .btn-refresh-now span {
        font-size: 20px;
        margin: 0;
      }

      /* ÈöêËóèÊåâÈíÆÊñáÂ≠óÔºåÂè™ÊòæÁ§∫ÂõæÊ†á */
      .btn-refresh-now {
        font-size: 0;
      }

      .source-filter-cards {
        padding: 8px 12px;
        gap: 6px;
        margin-bottom: 12px;
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        justify-content: flex-start;
        background: transparent;
        box-shadow: none;
        border-radius: 0;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .source-filter-cards::-webkit-scrollbar {
        display: none;
      }

      .source-card {
        padding: 6px 12px;
        font-size: 12px;
        min-height: 32px;
        display: inline-flex;
        align-items: center;
        flex-shrink: 0;
        border-radius: 16px;
      }

      .relevant-filter-checkbox {
        margin-left: 0;
        width: auto;
        justify-content: center;
        padding: 6px 12px;
        font-size: 12px;
        flex-shrink: 0;
      }

      .relevant-filter-checkbox label {
        font-size: 12px;
      }

      .relevant-filter-checkbox input[type="checkbox"] {
        width: 14px;
        height: 14px;
      }

      .date-section {
        padding: 16px;
      }

      .articles-by-date {
        grid-template-columns: 1fr;
      }

      .article-card {
        padding: 16px;
      }

      .article-card-title {
        font-size: 16px;
      }

      .article-detail-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }

      .article-header-actions {
        width: 100%;
        flex-direction: column;
        gap: 8px;
      }

      .article-header-actions button,
      .article-header-actions a {
        width: 100%;
        text-align: center;
      }

      .btn-back-to-list {
        min-height: 44px;
      }

      .btn-translate {
        min-height: 44px;
        width: 100%;
      }

      .article-detail-title {
        font-size: 22px;
      }

      .article-detail-meta {
        flex-direction: column;
        gap: 8px;
      }

      .article-detail-text {
        font-size: 15px;
      }

      /* Topics tabs */
      .topics-tabs-header {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .topic-tab {
        padding: 10px 14px;
        font-size: 13px;
        min-height: 44px;
      }

      /* Features page */
      .features-tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .features-tab {
        padding: 12px 16px;
        font-size: 13px;
        min-height: 44px;
        white-space: nowrap;
      }

      .features-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .feature-card {
        padding: 20px;
      }

      /* Guide */
      .guide-step,
      .guide-feature,
      .guide-tip,
      .guide-faq {
        padding: 16px;
      }

      /* Changelog */
      .changelog-header {
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
      }

      /* Logout button */
      .logout-btn {
        min-height: 44px;
      }
    }
  </style>
  <!-- KaTeX Êï∞Â≠¶ÂÖ¨ÂºèÊ∏≤ÊüìÂ∫ì -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Ê±âÂ†°ËèúÂçïÊåâÈíÆÔºàÁßªÂä®Á´ØÔºâ -->
  <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleSidebar()">‚ò∞</button>
  <!-- ‰æßËæπÊ†èÈÅÆÁΩ©Â±ÇÔºàÁßªÂä®Á´ØÔºâ -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
  <!-- Â∑¶‰æßËèúÂçï -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1>‰∏™‰∫∫‰ø°ÊÅØÊï¥ÁêÜ</h1>
      <div class="user-info" id="userInfo">Âä†ËΩΩ‰∏≠...</div>
    </div>
    <div class="sidebar-menu">
      <div class="menu-item active" onclick="switchPage('subscriptions', event)">
        <span class="menu-item-icon">üìã</span>
        <span class="menu-item-text">ËÆ¢ÈòÖÁÆ°ÁêÜ</span>
      </div>
      <div class="menu-item" onclick="switchPage('articles', event)">
        <span class="menu-item-icon">üì∞</span>
        <span class="menu-item-text">ÊñáÁ´†ÈòÖËØª</span>
      </div>
      <div class="menu-item" onclick="switchPage('guide', event)">
        <span class="menu-item-icon">üìñ</span>
        <span class="menu-item-text">Áî®Êà∑ÊåáÂçó</span>
      </div>
      <div class="menu-item" onclick="switchPage('features', event)">
        <span class="menu-item-icon">‚≠ê</span>
        <span class="menu-item-text">ÁâπÊÄß‰ªãÁªç</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="handleLogout()">ÈÄÄÂá∫ÁôªÂΩï</button>
    </div>
  </div>

  <!-- Êó•ÊúüËøáÊª§‰æßËæπÊ†èÔºà‰ªÖÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÊòæÁ§∫Ôºâ -->
  <div class="date-sidebar" id="dateSidebar" style="display: none;">
    <div class="date-sidebar-header">
      <h3>Êó•ÊúüÁ≠õÈÄâ</h3>
    </div>
    <div class="date-sidebar-list" id="dateSidebarList">
      <div class="date-sidebar-item active" data-date="all" onclick="filterByDate('all')">ÂÖ®ÈÉ®Êó•Êúü</div>
      <!-- Êó•ÊúüÂàóË°®Â∞ÜÂä®ÊÄÅÁîüÊàê -->
    </div>
  </div>

  <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
  <div class="main-content">
    <!-- ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ -->
    <div id="subscriptionsPage" class="content-page active">
      <div id="message" class="message"></div>

      <!-- ‰∏ªÈ¢òËØçËæìÂÖ•Âå∫Âüü -->
      <div class="section">
        <h3>Ê∑ªÂä†‰∏ªÈ¢òËØç</h3>
        <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
          ËæìÂÖ•ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®‰∏∫ÊÇ®Êé®Ëçê‰ºòË¥®ÁöÑ‰ø°ÊÅØÊ∫ê
        </p>
        <div class="topic-input-container">
          <input
            type="text"
            id="topicInput"
            class="topic-input"
            placeholder="‰æãÂ¶ÇÔºö‰∫∫Â∑•Êô∫ËÉΩ„ÄÅÊú∫Âô®Â≠¶‰π†„ÄÅÂå∫ÂùóÈìæ..."
            onkeypress="if(event.key==='Enter') addNewTopic()"
          >
          <button class="btn-primary" onclick="addNewTopic()" id="addTopicBtn">
            Ê∑ªÂä†‰∏ªÈ¢ò
          </button>
        </div>
      </div>

      <!-- ‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô® -->
      <div class="section" id="topicsTabsSection" style="display: none;">
        <div class="sub-topics-tabs-container">
          <div class="sub-topics-tabs-header" id="subTopicsTabsHeader">
            <!-- È°µÁ≠æÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
          </div>
          <div class="sub-topics-tabs-content" id="subTopicsTabsContent">
            <!-- È°µÁ≠æÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàêÔºåÊØè‰∏™È°µÁ≠æÂåÖÂê´Ôºö
              1. ËøõÂ∫¶ÊèêÁ§∫Âå∫Âüü
              2. Â∑≤ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂàóË°®
              3. Êé®Ëçê‰ø°ÊÅØÊ∫êÂàóË°®ÔºàÊØèÊ¨°10È°πÔºâ
              4. Âä†ËΩΩÊõ¥Â§öÊåâÈíÆ
            -->
          </div>
        </div>
      </div>

      <!-- Êó†‰∏ªÈ¢òÊó∂ÁöÑÊèêÁ§∫ -->
      <div class="section" id="noTopicsHint">
        <div class="empty-state">
          <div class="empty-icon">üìö</div>
          <h4>ËøòÊ≤°ÊúâÊ∑ªÂä†‰∏ªÈ¢ò</h4>
          <p>Âú®‰∏äÊñπËæìÂÖ•ÊÇ®ÊÑüÂÖ¥Ë∂£ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªüÂ∞Ü‰∏∫ÊÇ®Êé®ËçêÁõ∏ÂÖ≥ÁöÑ‰ºòË¥®‰ø°ÊÅØÊ∫ê</p>
        </div>
      </div>

      <!-- ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÁ§∫Âå∫ÂüüÔºàÂèØÊäòÂè†Ôºâ -->
      <div class="section curated-sources-section">
        <div class="curated-sources-header" onclick="toggleAllCuratedSources()">
          <span class="curated-sources-toggle" id="allCuratedSourcesToggle">‚ñ∂</span>
          <h3>ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê</h3>
          <span class="curated-sources-count" id="allCuratedSourcesCount"></span>
        </div>
        <div class="curated-sources-content" id="allCuratedSourcesContent" style="display: none;">
          <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâÂå∫Âüü -->
          <div class="curated-sources-filters">
            <input type="text" id="curatedSourcesSearch" class="curated-sources-search-input" placeholder="ÊêúÁ¥¢‰ø°ÊÅØÊ∫êÂêçÁß∞„ÄÅURLÊàñÊèèËø∞..." oninput="filterAllCuratedSources()">
            <select id="curatedSourcesTypeFilter" onchange="filterAllCuratedSources()">
              <option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>
            </select>
            <select id="curatedSourcesCategoryFilter" onchange="filterAllCuratedSources()">
              <option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>
            </select>
            <select id="curatedSourcesRegionFilter" onchange="filterAllCuratedSources()">
              <option value="">ÂÖ®ÈÉ®Âú∞Âå∫</option>
              <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
              <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
            </select>
          </div>
          <div class="curated-sources-stats" id="allCuratedSourcesStats"></div>
          <!-- ‰ø°ÊÅØÊ∫êÂàóË°® -->
          <div class="curated-sources-table-wrapper">
            <table class="curated-sources-table">
              <thead>
                <tr>
                  <th>‰ø°ÊÅØÊ∫êÂêçÁß∞</th>
                  <th>Á±ªÂûã</th>
                  <th>ÂàÜÁ±ª</th>
                  <th>Âú∞Âå∫</th>
                  <th>ÊèèËø∞</th>
                </tr>
              </thead>
              <tbody id="allCuratedSourcesBody">
                <tr><td colspan="5" style="text-align: center; padding: 20px; color: #999;">ÁÇπÂáªÂ±ïÂºÄÊü•ÁúãÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ -->
    <div id="articlesPage" class="content-page">
      <!-- ‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô® -->
      <div class="topics-tabs-container" id="articlesTopicsTabsContainer" style="display: none;">
        <div class="topics-tabs-header" id="articlesTopicsTabsHeader">
          <!-- È°µÁ≠æÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="topics-tabs-content" id="articlesTopicsTabsContent">
          <!-- È°µÁ≠æÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>

      <!-- Êó†‰∏ªÈ¢òÊó∂ÁöÑÊèêÁ§∫ -->
      <div id="articlesNoTopicsHint" class="empty-state" style="display: none;">
        <p>ÊöÇÊó†‰∏ªÈ¢òÔºåËØ∑ÂÖàÂú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ê∑ªÂä†‰∏ªÈ¢òÂπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</p>
      </div>

      <!-- ÊñáÁ´†ËØ¶ÊÉÖËßÜÂõæ -->
      <div id="articleDetailView" class="article-detail-view" style="display: none;">
        <div class="article-detail-header">
          <button class="btn-back-to-list" onclick="backToList()">‚Üê ËøîÂõûÂàóË°®</button>
          <div class="article-header-actions">
            <button id="articleSummarizeBtn" class="btn-translate" onclick="generateSummary()" style="display: none;">ÁîüÊàêÊÄªÁªì</button>
            <button id="articleTranslateBtn" class="btn-translate" onclick="toggleTranslate()" style="display: none;">ÁøªËØë‰∏∫‰∏≠Êñá</button>
          </div>
        </div>
        <div class="article-detail-content">
          <h1 id="articleDetailTitle" class="article-detail-title">Âä†ËΩΩ‰∏≠...</h1>
          <div class="article-detail-meta">
            <span id="articleDetailSource"></span>
            <span id="articleDetailDate"></span>
          </div>
          <div id="articleDetailImage" class="article-detail-image"></div>
          <div id="articleGeneratedSummary" class="article-generated-summary" style="display: none;">
            <h3>ÊñáÁ´†ÊÄªÁªì</h3>
            <div id="articleGeneratedSummaryContent"></div>
          </div>
          <div id="articleDetailSummary" class="article-detail-summary"></div>
          <div id="articleDetailContent" class="article-detail-text"></div>
          <a id="articleSourceLink" href="#" target="_blank" class="article-source-link" style="display: none;">Êü•ÁúãÂéüÊñáÈìæÊé•</a>
          <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button class="btn-back-to-list" onclick="backToList()">‚Üê ËøîÂõûÂàóË°®</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Áî®Êà∑ÊåáÂçóÈ°µÈù¢ -->
    <div id="guidePage" class="content-page">

      <!-- Âü∫Á°Ä‰ΩøÁî®ÊµÅÁ®ã -->
      <div class="section">
        <h3>üìö Âü∫Á°Ä‰ΩøÁî®ÊµÅÁ®ã</h3>
        <div class="guide-content">
          <div class="guide-step">
            <h4>1. Ê≥®ÂÜå/ÁôªÂΩï</h4>
            <p>È¶ñÊ¨°‰ΩøÁî®ÈúÄË¶ÅÊ≥®ÂÜåË¥¶Âè∑ÔºåËæìÂÖ•Áî®Êà∑Âêç„ÄÅÈÇÆÁÆ±ÂíåÂØÜÁ†ÅÂç≥ÂèØÂÆåÊàêÊ≥®ÂÜå„ÄÇÂ∑≤ÊúâË¥¶Âè∑ÁöÑÁî®Êà∑ÂèØ‰ª•Áõ¥Êé•ÁôªÂΩï„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>2. Ê∑ªÂä†‰∏ªÈ¢òÂÖ≥ÈîÆËØç</h4>
            <p>Âú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢ÔºåÁÇπÂáª"+"ÊåâÈíÆÊ∑ªÂä†ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºå‰æãÂ¶ÇÔºö‰∫∫Â∑•Êô∫ËÉΩ„ÄÅÊú∫Âô®Â≠¶‰π†„ÄÅÂå∫ÂùóÈìæÁ≠â„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>3. Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê</h4>
            <p>ËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂêéÔºåÁÇπÂáª"Ëé∑ÂèñÊé®Ëçê"ÊåâÈíÆÔºåÁ≥ªÁªü‰ºö‰ΩøÁî® AI ‰∏∫ÊÇ®Êé®Ëçê‰ºòË¥®ÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>4. ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</h4>
            <p>Âú®Êé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®‰∏≠ÔºåÈÄâÊã©ÊÇ®ÊÑüÂÖ¥Ë∂£ÁöÑ‰ø°ÊÅØÊ∫êÔºåÁÇπÂáª"ËÆ¢ÈòÖÈÄâ‰∏≠"ÊåâÈíÆÂÆåÊàêËÆ¢ÈòÖ„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>5. Êü•ÁúãÊî∂ÈõÜÁöÑÊñ∞Èóª</h4>
            <p>ËÆ¢ÈòÖÂêéÔºåÁ≥ªÁªü‰ºöÊØè 10 ÂàÜÈíüËá™Âä®Êî∂ÈõÜËøô‰∫õ‰ø°ÊÅØÊ∫êÁöÑÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇÊÇ®ÂèØ‰ª•Âú®"ÊñáÁ´†ÈòÖËØª"È°µÈù¢Êü•ÁúãÊî∂ÈõÜÂà∞ÁöÑÊñ∞Èóª„ÄÇ</p>
          </div>
        </div>
      </div>

      <!-- ËØ¶ÁªÜÂäüËÉΩ‰ªãÁªç -->
      <div class="section">
        <h3>üîß ËØ¶ÁªÜÂäüËÉΩ‰ªãÁªç</h3>
        <div class="guide-content">
          <div class="guide-feature">
            <h4>‰∏ªÈ¢òÁÆ°ÁêÜ</h4>
            <p>ÊÇ®ÂèØ‰ª•Ê∑ªÂä†Â§ö‰∏™‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªü‰ºö‰∏∫ÊØè‰∏™‰∏ªÈ¢òÊé®ËçêÁõ∏Â∫îÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇ‰∏ªÈ¢ò‰πãÈó¥Áõ∏‰∫íÁã¨Á´ãÔºåÊñπ‰æøÊÇ®ÁÆ°ÁêÜ‰∏çÂêåÈ¢ÜÂüüÁöÑÂÖ≥Ê≥®ÁÇπ„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>AI Êé®Ëçê‰ø°ÊÅØÊ∫ê</h4>
            <p>Á≥ªÁªü‰ΩøÁî® DeepSeek AI Ê†πÊçÆÊÇ®ËæìÂÖ•ÁöÑÂÖ≥ÈîÆËØçÔºåÊô∫ËÉΩÊé®ËçêÁõ∏ÂÖ≥ÁöÑÈ´òË¥®Èáè‰ø°ÊÅØÊ∫êÔºåÂåÖÊã¨ RSS Ê∫êÂíåÂçöÂÆ¢ÁΩëÁ´ô„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>ËÆ¢ÈòÖÁÆ°ÁêÜ</h4>
            <p>Âú®ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ÔºåÊÇ®ÂèØ‰ª•Êü•ÁúãÊâÄÊúâÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºåÂåÖÊã¨‰ø°ÊÅØÊ∫êÂêçÁß∞„ÄÅURL„ÄÅÁ±ªÂûãÂíåÂàÜÁ±ª„ÄÇÊÇ®ÂèØ‰ª•ÈöèÊó∂ÂèñÊ∂à‰∏çÈúÄË¶ÅÁöÑËÆ¢ÈòÖ„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>ÊñáÁ´†ÈòÖËØª</h4>
            <p>ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êåâ‰∏ªÈ¢òÂàÜÁªÑÂ±ïÁ§∫Êñ∞ÈóªÔºåÊîØÊåÅÊåâ‰ø°ÊÅØÊ∫êËøáÊª§„ÄÇÁÇπÂáªÊñáÁ´†ÂèØ‰ª•Êü•ÁúãËØ¶ÊÉÖÔºåÊîØÊåÅÁîüÊàêÊëòË¶ÅÂíåÁøªËØëÂäüËÉΩ„ÄÇ</p>
          </div>
        </div>
      </div>

      <!-- ‰ΩøÁî®ÊäÄÂ∑ßÂíåÊúÄ‰Ω≥ÂÆûË∑µ -->
      <div class="section">
        <h3>üí° ‰ΩøÁî®ÊäÄÂ∑ßÂíåÊúÄ‰Ω≥ÂÆûË∑µ</h3>
        <div class="guide-content">
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÈÄâÊã©ÊúâÊïàÁöÑÂÖ≥ÈîÆËØç</h4>
            <ul>
              <li>‰ΩøÁî®ÂÖ∑‰ΩìÁöÑÂÖ≥ÈîÆËØçÔºåÈÅøÂÖçËøá‰∫éÂÆΩÊ≥õÁöÑËØçÊ±á</li>
              <li>ÂèØ‰ª•Â∞ùËØï‰ΩøÁî®Ëã±ÊñáÂÖ≥ÈîÆËØçÔºåÂèØËÉΩËé∑ÂæóÊõ¥Â§ö‰ºòË¥®‰ø°ÊÅØÊ∫ê</li>
              <li>ÁªìÂêàÂ§ö‰∏™Áõ∏ÂÖ≥ÂÖ≥ÈîÆËØçÔºåËé∑ÂæóÊõ¥ÂÖ®Èù¢ÁöÑÊé®Ëçê</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÁÆ°ÁêÜÂ§ö‰∏™‰∏ªÈ¢ò</h4>
            <ul>
              <li>‰∏∫‰∏çÂêåÈ¢ÜÂüüÂàõÂª∫‰∏çÂêåÁöÑ‰∏ªÈ¢òÔºå‰æø‰∫éÂàÜÁ±ªÁÆ°ÁêÜ</li>
              <li>ÂÆöÊúüÊ£ÄÊü•ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºåÂèñÊ∂à‰∏çÂÜçÈúÄË¶ÅÁöÑËÆ¢ÈòÖ</li>
              <li>Âú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ôºå‰ΩøÁî®‰∏ªÈ¢òÈ°µÁ≠æÂø´ÈÄüÂàáÊç¢‰∏çÂêå‰∏ªÈ¢òÁöÑÂÜÖÂÆπ</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰Ωï‰ºòÂåñËÆ¢ÈòÖÂàóË°®</h4>
            <ul>
              <li>‰ºòÂÖàËÆ¢ÈòÖÊõ¥Êñ∞È¢ëÁéáÈ´ò„ÄÅÂÜÖÂÆπË¥®ÈáèÂ•ΩÁöÑ‰ø°ÊÅØÊ∫ê</li>
              <li>ÈÅøÂÖçËÆ¢ÈòÖËøáÂ§öÁõ∏‰ººÁöÑ‰ø°ÊÅØÊ∫êÔºåÂáèÂ∞ëÈáçÂ§çÂÜÖÂÆπ</li>
              <li>ÂÆöÊúüÊ£ÄÊü•ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÊòØÂê¶‰ªçÁÑ∂Ê¥ªË∑É</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÈ´òÊïàÈòÖËØªÊñ∞Èóª</h4>
            <ul>
              <li>‰ΩøÁî®‰ø°ÊÅØÊ∫êËøáÊª§ÂäüËÉΩÔºå‰∏ìÊ≥®‰∫éÁâπÂÆöÊù•Ê∫êÁöÑÂÜÖÂÆπ</li>
              <li>Âà©Áî®ÊñáÁ´†ÊëòË¶ÅÂäüËÉΩÔºåÂø´ÈÄü‰∫ÜËß£ÊñáÁ´†Ë¶ÅÁÇπ</li>
              <li>‰ΩøÁî®ÁøªËØëÂäüËÉΩÈòÖËØªËã±ÊñáÂÜÖÂÆπ</li>
              <li>Âú®ÊñáÁ´†ËØ¶ÊÉÖÈ°µÊü•ÁúãÂéüÊñáÈìæÊé•ÔºåËé∑ÂèñÂÆåÊï¥‰ø°ÊÅØ</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î -->
      <div class="section">
        <h3>‚ùì Â∏∏ËßÅÈóÆÈ¢òËß£Á≠îÔºàFAQÔºâ</h3>
        <div class="guide-content">
          <div class="guide-faq">
            <h4>Â¶Ç‰ΩïÂºÄÂßã‰ΩøÁî®Ôºü</h4>
            <p>È¶ñÂÖàÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Âè∑ÔºåÁÑ∂ÂêéÂú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ê∑ªÂä†ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåËé∑ÂèñÊé®ËçêÂπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºåÁ≥ªÁªüÂ∞±‰ºöËá™Âä®‰∏∫ÊÇ®Êî∂ÈõÜÁõ∏ÂÖ≥Êñ∞Èóª„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>‰∏∫‰ªÄ‰πàÊ≤°ÊúâÊé®ËçêÂà∞‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÂèØËÉΩÁöÑÂéüÂõ†ÂåÖÊã¨ÔºöÂÖ≥ÈîÆËØçËøá‰∫éÂÆΩÊ≥õÊàñÁâπÊÆä„ÄÅAI Êé®ËçêÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®„ÄÇÂª∫ËÆÆÂ∞ùËØï‰ΩøÁî®Êõ¥ÂÖ∑‰ΩìÁöÑÂÖ≥ÈîÆËØçÔºåÊàñÁ®çÂêéÈáçËØï„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>Êñ∞ÈóªÂ§ö‰πÖÊõ¥Êñ∞‰∏ÄÊ¨°Ôºü</h4>
            <p>Á≥ªÁªüÊØè 10 ÂàÜÈíüËá™Âä®Êî∂ÈõÜ‰∏ÄÊ¨°ÊÇ®ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÁöÑÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇÊÇ®‰πüÂèØ‰ª•ÊâãÂä®Âà∑Êñ∞Êü•ÁúãÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>Â¶Ç‰ΩïÂèñÊ∂àËÆ¢ÈòÖÔºü</h4>
            <p>Âú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢ÔºåÊâæÂà∞Ë¶ÅÂèñÊ∂àÁöÑËÆ¢ÈòÖÔºåÁÇπÂáªÂà†Èô§ÊåâÈíÆÂç≥ÂèØ„ÄÇÂèñÊ∂àËÆ¢ÈòÖÂêéÔºåÁ≥ªÁªüÂ∞Ü‰∏çÂÜçÊî∂ÈõÜËØ•‰ø°ÊÅØÊ∫êÁöÑÂÜÖÂÆπ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>ÂèØ‰ª•ËÆ¢ÈòÖÂ§öÂ∞ë‰∏™‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÁõÆÂâçÊ≤°ÊúâÈôêÂà∂Ôºå‰ΩÜÂª∫ËÆÆ‰∏çË¶ÅËÆ¢ÈòÖËøáÂ§ö‰ø°ÊÅØÊ∫êÔºå‰ª•ÂÖçÂÜÖÂÆπËøáÂ§öÈöæ‰ª•ÁÆ°ÁêÜ„ÄÇÂª∫ËÆÆÊéßÂà∂Âú® 20-30 ‰∏™‰ª•ÂÜÖ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>ÊîØÊåÅÂì™‰∫õÁ±ªÂûãÁöÑ‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÁõÆÂâçÊîØÊåÅ RSS Ê∫êÂíåÂçöÂÆ¢ÁΩëÁ´ô„ÄÇÁ≥ªÁªü‰ºöËá™Âä®ËØÜÂà´‰ø°ÊÅØÊ∫êÁ±ªÂûãÂπ∂ÈááÁî®Áõ∏Â∫îÁöÑÊî∂ÈõÜÊñπÂºè„ÄÇ</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ÁâπÊÄß‰ªãÁªçÈ°µÈù¢ -->
    <div id="featuresPage" class="content-page">

        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">üîê</div>
            <h3 class="feature-title">Áî®Êà∑ËÆ§ËØÅÁ≥ªÁªü</h3>
            <p class="feature-description">ÂÆåÊï¥ÁöÑÁî®Êà∑Ê≥®ÂÜå„ÄÅÁôªÂΩïÂíåËÆ§ËØÅÁ≥ªÁªüÔºå‰ΩøÁî® JWT token ËøõË°åË∫´‰ªΩÈ™åËØÅÔºåÁ°Æ‰øùÁî®Êà∑Êï∞ÊçÆÂÆâÂÖ®„ÄÇ</p>
            <div class="feature-value">
              <div class="feature-value-label">üíé ÂØπÁî®Êà∑ÁöÑ‰ª∑ÂÄº</div>
              <div class="feature-value-text">‰øùÊä§‰∏™‰∫∫ÈöêÁßÅÔºåÊØè‰∏™Áî®Êà∑Âè™ËÉΩÁúãÂà∞Ëá™Â∑±ËÆ¢ÈòÖÁöÑÂÜÖÂÆπÔºåÊï∞ÊçÆÂÆâÂÖ®ÂèØÈù†„ÄÇ</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">ü§ñ</div>
            <h3 class="feature-title">AI Êô∫ËÉΩÊé®Ëçê‰ø°ÊÅØÊ∫ê</h3>
            <p class="feature-description">Âü∫‰∫é DeepSeek AI ÁöÑÊô∫ËÉΩÊé®ËçêÁ≥ªÁªüÔºåÊ†πÊçÆÁî®Êà∑ËæìÂÖ•ÁöÑÂÖ≥ÈîÆËØçËá™Âä®Êé®ËçêÈ´òË¥®ÈáèÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇ</p>
            <div class="feature-value">
              <div class="feature-value-label">üíé ÂØπÁî®Êà∑ÁöÑ‰ª∑ÂÄº</div>
              <div class="feature-value-text">Êó†ÈúÄÊâãÂä®ÊêúÁ¥¢ÔºåAI Ëá™Âä®‰∏∫ÊÇ®ÊâæÂà∞ÊúÄÁõ∏ÂÖ≥ÁöÑ‰ºòË¥®‰ø°ÊÅØÊ∫êÔºåËäÇÁúÅÂ§ßÈáèÊó∂Èó¥„ÄÇ</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üì∞</div>
            <h3 class="feature-title">‰∏™ÊÄßÂåñÊñ∞ÈóªÊî∂ÈõÜ</h3>
            <p class="feature-description">Á≥ªÁªüÊ†πÊçÆÊØè‰∏™Áî®Êà∑ÁöÑËÆ¢ÈòÖËá™Âä®Êî∂ÈõÜÊñ∞ÈóªÔºåÊØè 10 ÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ÔºåÁ°Æ‰øùÂÜÖÂÆπÂèäÊó∂ÊÄß„ÄÇ</p>
            <div class="feature-value">
              <div class="feature-value-label">üíé ÂØπÁî®Êà∑ÁöÑ‰ª∑ÂÄº</div>
              <div class="feature-value-text">Âè™ÁúãÂà∞ÊÇ®ÂÖ≥ÂøÉÁöÑÂÜÖÂÆπÔºå‰∏ç‰ºöË¢´Êó†ÂÖ≥‰ø°ÊÅØÂπ≤Êâ∞ÔºåÊèêÈ´òÈòÖËØªÊïàÁéá„ÄÇ</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üìã</div>
            <h3 class="feature-title">Â§öÊ∫êËÆ¢ÈòÖÁÆ°ÁêÜ</h3>
            <p class="feature-description">ÊîØÊåÅËÆ¢ÈòÖÂ§ö‰∏™‰ø°ÊÅØÊ∫êÔºåÊîØÊåÅ RSS ÂíåÂçöÂÆ¢‰∏§ÁßçÁ±ªÂûãÔºåÁªü‰∏ÄÁÆ°ÁêÜÊâÄÊúâËÆ¢ÈòÖ„ÄÇ</p>
            <div class="feature-value">
              <div class="feature-value-label">üíé ÂØπÁî®Êà∑ÁöÑ‰ª∑ÂÄº</div>
              <div class="feature-value-text">Âú®‰∏Ä‰∏™Âú∞ÊñπÁÆ°ÁêÜÊâÄÊúâ‰ø°ÊÅØÊ∫êÔºåÊó†ÈúÄËÆøÈóÆÂ§ö‰∏™ÁΩëÁ´ôÔºåÊñπ‰æøÂø´Êç∑„ÄÇ</div>
            </div>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üìñ</div>
            <h3 class="feature-title">ÊñáÁ´†ÈòÖËØª‰ΩìÈ™å</h3>
            <p class="feature-description">ÊîØÊåÅÊåâ‰∏ªÈ¢òÂíå‰ø°ÊÅØÊ∫êËøáÊª§ÔºåÊèê‰æõÊñáÁ´†ÊëòË¶ÅÁîüÊàêÂíåÁøªËØëÂäüËÉΩÔºå‰ºòÂåñÈòÖËØª‰ΩìÈ™å„ÄÇ</p>
            <div class="feature-value">
              <div class="feature-value-label">üíé ÂØπÁî®Êà∑ÁöÑ‰ª∑ÂÄº</div>
              <div class="feature-value-text">Âø´ÈÄüÂÆö‰ΩçÊÑüÂÖ¥Ë∂£ÁöÑÂÜÖÂÆπÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÈòÖËØªÔºåÊèêÂçáÈòÖËØªÊïàÁéá„ÄÇ</div>
            </div>
          </div>

      </div>
    </div>
  </div>

  <script>
    // ÁßªÂä®Á´Ø‰æßËæπÊ†èÂàáÊç¢
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
    }

    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
    }

    // API Âü∫Á°ÄÂú∞ÂùÄ
    // API Âü∫Á°ÄÂú∞ÂùÄÔºàÁªü‰∏ÄÈÉ®ÁΩ≤ÔºåÂâçÂêéÁ´ØÂêåÂüüÔºâ
    const API_BASE_URL = `${window.location.protocol}//${window.location.host}/api`;

    let authToken = localStorage.getItem('authToken');
    let currentUser = null;
    let recommendedSources = [];
    let userSubscriptions = []; // Áî®Êà∑Â∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®Ôºà‰ªÖÂêçÁß∞Ôºâ
    let userSubscriptionsMap = {}; // Áî®Êà∑Â∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÊò†Â∞Ñ {sourceName: {sourceName, sourceUrl}, ...}
    let savedProcessLogs = []; // ‰øùÂ≠òÁöÑÊé®ËçêËøáÁ®ãÊó•Âøó

    // ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Áõ∏ÂÖ≥ÂèòÈáè
    let allArticles = []; // Â≠òÂÇ®ÊâÄÊúâÊñáÁ´†Êï∞ÊçÆ
    let filteredArticles = []; // ÂΩìÂâçËøáÊª§ÂêéÁöÑÊñáÁ´†
    let currentSourceFilter = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    let savedScrollPosition = 0; // ‰øùÂ≠òÊªöÂä®‰ΩçÁΩÆ
    let currentTopicFilter = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢ò
    let userTopics = []; // Áî®Êà∑‰∏ªÈ¢òÂàóË°®
    let topicRecommendationHistory = {}; // ‰∏ªÈ¢òÊé®ËçêÂéÜÂè≤ {topic_keywords: {recommended_sources: [...]}}
    let showOnlyRelevantArticles = true; // ÊòØÂê¶Âè™ÊòæÁ§∫Áõ∏ÂÖ≥ÊñáÁ´†ÔºàÈªòËÆ§ÈÄâ‰∏≠Ôºâ

    // ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Áõ∏ÂÖ≥ÂèòÈáè
    let subCurrentTopicIndex = 0; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢Âºï
    let subTopicsData = {}; // ÊØè‰∏™‰∏ªÈ¢òÁöÑÊï∞ÊçÆ {topicKeywords: {subscriptions: [], recommendations: [], displayedCount: 0, allRecommendations: []}}
    let curatedSourcesCache = null; // ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÁºìÂ≠ò
    

    // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
    if (!authToken) {
      alert('ËØ∑ÂÖàÁôªÂΩï');
      window.location.href = '/login.html';
    }

    function getHeaders() {
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      };
    }

    // È™åËØÅÁî®Êà∑Âπ∂Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
    async function initUser() {
      try {
        const response = await fetch(`${API_BASE_URL}/auth/me`, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          currentUser = result.user;
          document.getElementById('userInfo').textContent = `Ê¨¢ËøéÔºå${currentUser.username}`;
        } else {
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('È™åËØÅÁî®Êà∑Â§±Ë¥•:', error);
        window.location.href = '/login.html';
      }
    }

    // ÂàáÊç¢È°µÈù¢
    function switchPage(page, event) {
      // ÁßªÂä®Á´ØÂàáÊç¢È°µÈù¢Êó∂ÂÖ≥Èó≠‰æßËæπÊ†è
      closeSidebar();

      // ‰øùÂ≠òÂΩìÂâçÈ°µÈù¢Âà∞ localStorage
      localStorage.setItem('dashboardCurrentPage', page);

      // Ê∑ªÂä†ÊµèËßàÂô®ÂéÜÂè≤ËÆ∞ÂΩïÔºåÊîØÊåÅËøîÂõûÈîÆÂØºËà™
      if (window.location.hash !== `#${page}`) {
        history.pushState({ page: page, view: 'list' }, '', `#${page}`);
      }

      // Êõ¥Êñ∞ËèúÂçïÁä∂ÊÄÅ
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      if (event && event.target) {
        event.target.closest('.menu-item').classList.add('active');
      } else {
        // Â¶ÇÊûúÊ≤°Êúâ eventÔºåÈÄöËøá page ÂèÇÊï∞ÊâæÂà∞ÂØπÂ∫îÁöÑËèúÂçïÈ°π
        const menuItems = document.querySelectorAll('.menu-item');
        const pageIndexMap = {
          'subscriptions': 0,
          'articles': 1,
          'guide': 2,
          'features': 3
        };
        menuItems.forEach((item, index) => {
          if (pageIndexMap[page] === index) {
            item.classList.add('active');
          }
        });
      }

      // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
      document.querySelectorAll('.content-page').forEach(p => {
        p.classList.remove('active');
      });
      const targetPage = document.getElementById(page + 'Page');
      if (!targetPage) {
        console.warn(`È°µÈù¢ ${page} ‰∏çÂ≠òÂú®ÔºåÂàáÊç¢Âà∞ÈªòËÆ§È°µÈù¢ subscriptions`);
        page = 'subscriptions';
      }
      document.getElementById(page + 'Page').classList.add('active');
      
      // ÊéßÂà∂Êó•Êúü‰æßËæπÊ†èÁöÑÊòæÁ§∫/ÈöêËóèÔºà‰ªÖÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÊòæÁ§∫Ôºâ
      if (page === 'articles') {
        showDateSidebar();
      } else {
        hideDateSidebar();
      }

      // Âä†ËΩΩÂØπÂ∫îÈ°µÈù¢Êï∞ÊçÆ
      if (page === 'subscriptions') {
        // ÂàáÊç¢Âà∞ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Êó∂ÔºåÊ∏ÖÈô§ÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅ
        localStorage.removeItem('dashboardViewingArticleId');
        loadTopics();
        loadRecommendationHistory(); // Âä†ËΩΩÊé®ËçêÂéÜÂè≤
      } else if (page === 'articles') {
        // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ËØ¶ÊÉÖÈ°µÈù¢ÔºåÂÖàËøîÂõûÂàóË°®È°µÈù¢
        const articleDetailView = document.getElementById('articleDetailView');
        if (articleDetailView && articleDetailView.style.display !== 'none') {
          // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
          const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
          
          // ÊòæÁ§∫ÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
          const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
          const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
          
          if (statsBar) statsBar.style.display = 'flex';
          if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
          
          // ÈöêËóèËØ¶ÊÉÖËßÜÂõæÔºåÊòæÁ§∫ÂàóË°®ËßÜÂõæ
          articleDetailView.style.display = 'none';
          const articlesListView = document.getElementById(`articlesListView-${currentTabIndex}`);
          if (articlesListView) articlesListView.style.display = 'block';
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
        } else {
          // ÊØèÊ¨°ËøõÂÖ•ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êó∂ÔºåÈÉΩÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊòæÁ§∫ÊâÄÊúâÊúÄÊñ∞‰∏ªÈ¢ò
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          console.log('üìö ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºöÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊòæÁ§∫ÊâÄÊúâ‰∏ªÈ¢ò...');
          loadArticlesTopicsTabs().then(() => {
            console.log('‚úÖ ‰∏ªÈ¢òÈ°µÁ≠æÂä†ËΩΩÂÆåÊàê');
            // Á°Æ‰øù‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÂèØËßÅ
            if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
          }).catch(err => {
            console.error('‚ùå Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•:', err);
          });
        }
      }
    }

    // ÈÄÄÂá∫ÁôªÂΩï
    function handleLogout() {
      if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userInfo');
        window.location.href = '/login.html';
      }
    }


    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }

    // Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®
    async function loadTopics() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const topicsListEl = document.getElementById('topicsList');
          if (result.data.length === 0) {
            topicsListEl.innerHTML = '<p style="color: #999;">ÊöÇÊó†‰∏ªÈ¢òÔºåËØ∑Ê∑ªÂä†Êñ∞‰∏ªÈ¢ò</p>';
          } else {
            topicsListEl.innerHTML = result.data.map(topic => `
              <div class="topic-tag">
                <span>${escapeHtml(topic.topic_keywords)}</span>
                <button class="remove-btn" onclick="removeTopic('${topic.topic_keywords}')" title="Âà†Èô§">√ó</button>
              </div>
            `).join('');
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂ§±Ë¥•:', error);
      }
    }

    // Ê∑ªÂä†‰∫§‰∫íËøáÁ®ãÊó•Âøó
    function addProcessLog(message, type = 'info', data = null) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl) return;
      
      const stepEl = document.createElement('div');
      stepEl.className = `process-step ${type}`;
      
      const time = new Date().toLocaleTimeString('zh-CN');
      let html = `<div class="process-message">${escapeHtml(message)}<span class="process-time">${time}</span></div>`;
      
      if (data) {
        html += `<div class="process-data">${escapeHtml(JSON.stringify(data, null, 2))}</div>`;
      }
      
      stepEl.innerHTML = html;
      processEl.appendChild(stepEl);
      processEl.scrollTop = processEl.scrollHeight;
    }

    // Ê∏≤Êüì‰øùÂ≠òÁöÑÊé®ËçêËøáÁ®ãÊó•Âøó
    function renderProcessLogs(logs) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl || !logs || logs.length === 0) return;
      
      processEl.innerHTML = '';
      logs.forEach(log => {
        const stepEl = document.createElement('div');
        stepEl.className = `process-step ${log.type || 'info'}`;
        
        const time = log.timestamp ? new Date(log.timestamp).toLocaleTimeString('zh-CN') : '';
        let html = `<div class="process-message">${escapeHtml(log.message)}<span class="process-time">${time}</span></div>`;
        
        if (log.data) {
          html += `<div class="process-data">${escapeHtml(JSON.stringify(log.data, null, 2))}</div>`;
        }
        
        stepEl.innerHTML = html;
        processEl.appendChild(stepEl);
      });
      processEl.scrollTop = processEl.scrollHeight;
    }

    // ÊòæÁ§∫Ê∑ªÂä†‰∏ªÈ¢òÂºπÁ™ó
    function showAddTopicModal() {
      const modal = document.getElementById('addTopicModal');
      if (modal) {
        modal.classList.add('show');
        // ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
        setTimeout(() => {
          const input = document.getElementById('topicInput');
          if (input) input.focus();
        }, 100);
      }
    }

    // ÂÖ≥Èó≠Ê∑ªÂä†‰∏ªÈ¢òÂºπÁ™ó
    function closeAddTopicModal(event) {
      // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂÖ≥Èó≠ÊåâÈíÆÊàñÈÅÆÁΩ©Â±ÇÔºåÂÖ≥Èó≠ÂºπÁ™ó
      if (!event || event.target.classList.contains('modal-overlay') || event.target.classList.contains('modal-close')) {
        const modal = document.getElementById('addTopicModal');
        if (modal) {
          modal.classList.remove('show');
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          const input = document.getElementById('topicInput');
          if (input) input.value = '';
        }
      }
    }

    // Êé®Ëçê‰ø°ÊÅØÊ∫ê
    async function recommendSources() {
      const topicInputEl = document.getElementById('topicInput');
      if (!topicInputEl) {
        console.error('[Êé®Ëçê] ÈîôËØØÔºöÊâæ‰∏çÂà∞ topicInput ÂÖÉÁ¥†');
        showMessage('Êó†Ê≥ïÊâæÂà∞ËæìÂÖ•Ê°ÜÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï', 'error');
        return;
      }
      
      const keywords = topicInputEl.value.trim();
      console.log('[Êé®Ëçê] Ëé∑ÂèñÂà∞ÁöÑÂÖ≥ÈîÆËØç:', keywords);
      
      if (!keywords) {
        console.warn('[Êé®Ëçê] ÂÖ≥ÈîÆËØç‰∏∫Á©∫ÔºåÂÅúÊ≠¢ÊâßË°å');
        showMessage('ËØ∑ËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
        return;
      }

      // ÂÖà‰øùÂ≠òÂÖ≥ÈîÆËØçÂà∞ÂèòÈáèÔºåÂÜçÂÖ≥Èó≠ÂºπÁ™óÔºàÈÅøÂÖçÂºπÁ™óÂÖ≥Èó≠ÂêéÊó†Ê≥ïËÆøÈóÆËæìÂÖ•Ê°ÜÔºâ
      const savedKeywords = keywords;
      
      // Á´ãÂç≥ÂÖ≥Èó≠ÂºπÁ™ó
      closeAddTopicModal();

      const recommendBtn = document.getElementById('recommendBtn');
      recommendBtn.disabled = true;
      recommendBtn.textContent = 'Ê≠£Âú®‰øùÂ≠ò‰∏ªÈ¢ò...';

      try {
        // ‰ΩøÁî®‰øùÂ≠òÁöÑÂÖ≥ÈîÆËØçÂèòÈáè
        console.log('[Êé®Ëçê] ‰ΩøÁî®‰øùÂ≠òÁöÑÂÖ≥ÈîÆËØç:', savedKeywords);
        
        // ÂÖà‰øùÂ≠ò‰∏ªÈ¢òÂà∞Êï∞ÊçÆÂ∫ìÔºåÁ°Æ‰øùÂ∑≤‰øùÂ≠òÊàêÂäü
        const saveResult = await saveTopic(savedKeywords);
        
        if (!saveResult || !saveResult.success) {
          throw new Error('‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
        
        console.log('‚úÖ ‰∏ªÈ¢òÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºåÁªßÁª≠Ëé∑ÂèñÊé®Ëçê...');
        
        // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨
        recommendBtn.textContent = 'Ê≠£Âú®Ëé∑ÂèñÊé®Ëçê...';
      } catch (saveError) {
        // ‰øùÂ≠òÂ§±Ë¥•ÔºåÊòæÁ§∫ÈîôËØØÂπ∂ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        console.error('[Êé®Ëçê] ‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•:', saveError);
        showMessage('‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•: ' + saveError.message, 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
        return; // ÂÅúÊ≠¢ÂêéÁª≠Êìç‰Ωú
      }

      // ÂàõÂª∫Êñ∞‰∏ªÈ¢òÁöÑÈ°µÁ≠æÂπ∂ÈÄâ‰∏≠ÔºàÂú® try ÂùóÂ§ñÔºåÁ°Æ‰øù newTabIndex Âú®ÂêéÁª≠‰ª£Á†Å‰∏≠ÂèØÁî®Ôºâ
      let newTabIndex = -1;
      try {
        newTabIndex = createNewTopicTab(savedKeywords);
        if (newTabIndex >= 0) {
          switchTopicTab(newTabIndex);
          // ÊòæÁ§∫È°µÁ≠æÂÆπÂô®
          document.getElementById('topicsTabsSection').style.display = 'block';
        }
      } catch (tabError) {
        console.error('[Êé®Ëçê] ÂàõÂª∫È°µÁ≠æÂ§±Ë¥•:', tabError);
      }

      if (newTabIndex < 0) {
        console.error('[Êé®Ëçê] ‚ùå ÂàõÂª∫‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•ÔºåÊó†Ê≥ïÁªßÁª≠Êé®Ëçê');
        showMessage('ÂàõÂª∫‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
        return;
      }

      // Âú®È°µÁ≠æ‰∏≠ÊòæÁ§∫Êé®ËçêËøáÁ®ãÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
      addProcessLogInTab(newTabIndex, `ÂºÄÂßã‰∏∫ÂÖ≥ÈîÆËØç "${savedKeywords}" Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê...`, 'loading');
 
      // ÂàùÂßãÂåñÊé®Ëçê‰ø°ÊÅØÊ∫êÂàóË°®ÔºàÁî®‰∫éÂÆûÊó∂Ê∑ªÂä†Ôºâ
      if (!window.recommendedSourcesByTab) {
        window.recommendedSourcesByTab = {};
      }
      window.recommendedSourcesByTab[newTabIndex] = [];

      try {
        console.log(`[Êé®Ëçê] ÂºÄÂßãË∞ÉÁî®Êé®ËçêÊé•Âè£ÔºåÂÖ≥ÈîÆËØç: "${savedKeywords}"`);
        console.log(`[Êé®Ëçê] APIÂú∞ÂùÄ: ${API_BASE_URL}/user/topics/recommend`);
        console.log(`[Êé®Ëçê] ËØ∑Ê±Ç‰Ωì:`, JSON.stringify({ keywords: savedKeywords }));
        
        // ‰ΩøÁî® fetch Ëé∑ÂèñÊµÅÂºèÂìçÂ∫îÔºåÂÆûÊó∂ÊòæÁ§∫ËøõÂ∫¶
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords: savedKeywords })
        });

        console.log(`[Êé®Ëçê] Êî∂Âà∞ÂìçÂ∫îÔºåÁä∂ÊÄÅÁ†Å: ${response.status}, Content-Type: ${response.headers.get('Content-Type')}`);

        if (!response.ok) {
          const errorText = await response.text();
          console.error(`[Êé®Ëçê] HTTPÈîôËØØ: ${response.status}`, errorText);
          throw new Error(`HTTP error! status: ${response.status}: ${errorText}`);
        }

        // Ê£ÄÊü•ÂìçÂ∫î‰ΩìÊòØÂê¶Â≠òÂú®
        if (!response.body) {
          console.error('[Êé®Ëçê] ÂìçÂ∫î‰Ωì‰∏∫Á©∫');
          throw new Error('ÂìçÂ∫î‰Ωì‰∏∫Á©∫ÔºåÊó†Ê≥ïËØªÂèñÊµÅÂºèÊï∞ÊçÆ');
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        let hasReceivedData = false;

        console.log('[Êé®Ëçê] ÂºÄÂßãËØªÂèñÊµÅÂºèÂìçÂ∫î...');

        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            console.log('[Êé®Ëçê] ÊµÅÂºèÂìçÂ∫îËØªÂèñÂÆåÊàê');
            break;
          }
          
          hasReceivedData = true;
          
          // Ëß£Á†ÅÊï∞ÊçÆÂπ∂Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
          buffer += decoder.decode(value, { stream: true });
          
          // ÊåâË°åÂàÜÂâ≤Âπ∂Â§ÑÁêÜÊØèË°å JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ‰øùÁïôÊúÄÂêé‰∏çÂÆåÊï¥ÁöÑË°å
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                console.log('[Êé®Ëçê] Êî∂Âà∞ËøõÂ∫¶Êï∞ÊçÆ:', progress.type, progress.message || '');
                
                // ÂÆûÊó∂Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
                if (progress.type === 'progress') {
                  addProcessLogInTab(newTabIndex, progress.message, progress.logType || 'info');
                } else if (progress.type === 'sourcesReceived') {
                  // DeepSeekËøîÂõûÁöÑÊâÄÊúâÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÁ´ãÂç≥ÊòæÁ§∫Ë°®Ê†º
                  if (progress.sources && progress.sources.length > 0) {
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    window.recommendedSourcesByTab[newTabIndex] = progress.sources;
                    // Á´ãÂç≥Ê∏≤ÊüìË°®Ê†ºÔºàÊâÄÊúâ‰ø°ÊÅØÊ∫êÊòæÁ§∫‰∏∫"È™åËØÅ‰∏≠..."Ôºâ
                    renderRecommendationsInTab(newTabIndex, progress.sources);
                  }
                } else if (progress.type === 'sourceValidated') {
                  // È™åËØÅÂÆåÊàêÁöÑ‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Ë°®Ê†º‰∏≠ÂØπÂ∫îË°åÁöÑÊúâÊïàÊÄßÁä∂ÊÄÅ
                  if (progress.source) {
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    if (!window.recommendedSourcesByTab[newTabIndex]) {
                      window.recommendedSourcesByTab[newTabIndex] = [];
                    }
                    
                    // Êü•ÊâæÂπ∂Êõ¥Êñ∞ÂØπÂ∫îÁöÑ‰ø°ÊÅØÊ∫ê
                    const sourceIndex = window.recommendedSourcesByTab[newTabIndex].findIndex(
                      s => (s.sourceUrl || s.url) === (progress.source.sourceUrl || progress.source.url)
                    );
                    
                    if (sourceIndex >= 0) {
                      // Êõ¥Êñ∞Áé∞Êúâ‰ø°ÊÅØÊ∫ê
                      window.recommendedSourcesByTab[newTabIndex][sourceIndex] = progress.source;
                    } else {
                      // Â¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÊ∑ªÂä†Êñ∞ÁöÑ
                      window.recommendedSourcesByTab[newTabIndex].push(progress.source);
                    }
                    
                    // ÂÆûÊó∂Êõ¥Êñ∞Ë°®Ê†º
                    renderRecommendationsInTab(newTabIndex, window.recommendedSourcesByTab[newTabIndex]);
                  }
                } else if (progress.type === 'final') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('Ëß£ÊûêËøõÂ∫¶Êï∞ÊçÆÂ§±Ë¥•:', e, line);
              }
            }
          }
        }

        // Â§ÑÁêÜÊúÄÁªàÁªìÊûú
        if (!hasReceivedData) {
          console.warn('[Êé®Ëçê] Ë≠¶ÂëäÔºöÊ≤°ÊúâÊî∂Âà∞‰ªª‰ΩïÊï∞ÊçÆ');
          addProcessLogInTab(newTabIndex, 'Êú™Êî∂Âà∞ÊúçÂä°Âô®ÂìçÂ∫îÊï∞ÊçÆÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï', 'error');
          showMessage('Êú™Êî∂Âà∞ÊúçÂä°Âô®ÂìçÂ∫îÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', 'error');
        } else if (finalResult) {
          console.log('[Êé®Ëçê] Êî∂Âà∞ÊúÄÁªàÁªìÊûú:', finalResult.success ? 'ÊàêÂäü' : 'Â§±Ë¥•');
          if (finalResult.success) {
            recommendedSources = finalResult.data || [];
            
            // ‰øùÂ≠òÊé®ËçêÂéÜÂè≤Âà∞Êï∞ÊçÆÂ∫ìÔºàÂêéÁ´ØÂ∑≤ÁªèÂú® recommend Êé•Âè£‰∏≠‰øùÂ≠ò‰∫ÜÔºâ
            // ÈáçÊñ∞Âä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤ÔºàÂåÖÊã¨Êñ∞Ê∑ªÂä†ÁöÑÔºâÔºåËøô‰ºöÊõ¥Êñ∞È°µÁ≠æÂÜÖÂÆπ
            await loadAllRecommendationHistory();
            
            // Á°Æ‰øùÈÄâ‰∏≠Êñ∞Ê∑ªÂä†ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÔºàÊ†πÊçÆ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÁ≤æÁ°ÆÊü•ÊâæÔºâ
            const tabsHeader = document.getElementById('topicsTabsHeader');
            const tabsContent = document.getElementById('topicsTabsContent');
            if (tabsHeader && tabsContent) {
              const tabs = Array.from(tabsHeader.children);
              const panels = Array.from(tabsContent.children);
              
              // Á≤æÁ°ÆÂåπÈÖç‰∏ªÈ¢òÂÖ≥ÈîÆËØç
              for (let i = 0; i < tabs.length; i++) {
                const panel = panels[i];
                if (panel && panel.dataset.history) {
                  try {
                    const history = JSON.parse(panel.dataset.history);
                    if (history.topic_keywords === savedKeywords.trim()) {
                      switchTopicTab(i);
                      // Á°Æ‰øùÈ°µÁ≠æÂÆπÂô®ÂèØËßÅ
                      document.getElementById('topicsTabsSection').style.display = 'block';
                      break;
                    }
                  } catch (e) {
                    console.error('Ëß£ÊûêÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', e);
                  }
                }
              }
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨‰ª•ÊòæÁ§∫Êñ∞Ê∑ªÂä†ÁöÑ‰∏ªÈ¢ò
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö Ëé∑ÂèñÊé®ËçêÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
            
            showMessage(finalResult.message || `Â∑≤ÊâæÂà∞ ${recommendedSources.length} ‰∏™Êé®Ëçê‰ø°ÊÅØÊ∫ê`, 'success');
          } else {
            console.error('[Êé®Ëçê] Êé®ËçêÂ§±Ë¥•:', finalResult.message);
            addProcessLogInTab(newTabIndex, finalResult.message || 'Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•', 'error');
            showMessage(finalResult.message || 'Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•', 'error');
          }
        } else {
          console.warn('[Êé®Ëçê] Ë≠¶ÂëäÔºöÊ≤°ÊúâÊî∂Âà∞ÊúÄÁªàÁªìÊûúÔºå‰ΩÜÂ∑≤Êî∂Âà∞ÈÉ®ÂàÜÊï∞ÊçÆ');
          addProcessLogInTab(newTabIndex, 'Êé®ËçêËøáÁ®ãÂèØËÉΩÊú™ÂÆåÊàêÔºåËØ∑Âà∑Êñ∞È°µÈù¢Êü•ÁúãÁªìÊûú', 'warning');
          showMessage('Êé®ËçêËøáÁ®ãÂèØËÉΩÊú™ÂÆåÊàêÔºåËØ∑Âà∑Êñ∞È°µÈù¢Êü•Áúã', 'warning');
        }
      } catch (error) {
        console.error('[Êé®Ëçê] ÊçïËé∑Âà∞ÈîôËØØ:', error);
        addProcessLogInTab(newTabIndex, 'API Ë∞ÉÁî®ÂºÇÂ∏∏: ' + error.message, 'error');
        showMessage('Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
      }
    }

    // ÂàõÂª∫Êñ∞‰∏ªÈ¢òÁöÑ‰∏¥Êó∂È°µÁ≠æÔºàÂú®Êé®ËçêÂºÄÂßãÊó∂Â∞±ÂàõÂª∫Ôºâ
    function createNewTopicTab(keywords) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return -1;
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ËØ•‰∏ªÈ¢òÁöÑÈ°µÁ≠æ
      const existingHistories = Array.from(tabsHeader.children).map((tab, idx) => {
        const panel = document.getElementById(`panel-${idx}`);
        if (panel && panel.dataset.history) {
          try {
            const history = JSON.parse(panel.dataset.history);
            return history.topic_keywords;
          } catch (e) {
            return null;
          }
        }
        return null;
      });
      
      const existingIndex = existingHistories.findIndex(k => k === keywords.trim());
      if (existingIndex >= 0) {
        return existingIndex;
      }
      
      // Ëé∑ÂèñÂΩìÂâçÈ°µÁ≠æÊï∞Èáè
      const currentTabCount = tabsHeader.children.length;
      const newTabIndex = currentTabCount;
      const tabId = `tab-${newTabIndex}`;
      const panelId = `panel-${newTabIndex}`;
      
      // ÂàõÂª∫È°µÁ≠æÊåâÈíÆ
      const tabBtn = document.createElement('button');
      tabBtn.className = `topic-tab active`;
      tabBtn.id = tabId;
      tabBtn.onclick = () => switchTopicTab(newTabIndex);
      tabBtn.innerHTML = `${escapeHtml(keywords)}<span class="tab-badge">Êé®Ëçê‰∏≠...</span>`;
      tabsHeader.appendChild(tabBtn);
      
      // ÂèñÊ∂àÂÖ∂‰ªñÈ°µÁ≠æÁöÑactiveÁä∂ÊÄÅ
      Array.from(tabsHeader.children).forEach((tab, idx) => {
        if (idx !== newTabIndex) {
          tab.classList.remove('active');
        }
      });
      
      // ÂàõÂª∫È°µÁ≠æÂÜÖÂÆπÈù¢Êùø
      const panel = document.createElement('div');
      panel.className = `topic-tab-panel active`;
      panel.id = panelId;
      
      // ÂàõÂª∫‰∏¥Êó∂ÂéÜÂè≤Êï∞ÊçÆÔºàËøòÊ≤°ÊúâÊé®ËçêÁªìÊûúÔºâ
      const tempHistory = {
        topic_keywords: keywords.trim(),
        process_logs: [],
        recommended_sources: []
      };
      panel.dataset.history = JSON.stringify(tempHistory);
      
      // Êé®ËçêËøáÁ®ãÊó•ÂøóÂå∫ÂüüÔºàÊîπ‰∏∫ÂçïË°åËøõÂ∫¶ÊòæÁ§∫Ôºâ
      const processLogsHtml = `
        <div style="font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;" id="processText-${newTabIndex}">
          ÂáÜÂ§áÂºÄÂßãÊé®Ëçê...
        </div>
      `;
      
      // Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†ºÁªìÊûÑÔºàÂàùÂßã‰∏∫Á©∫ÔºåÁ≠âÂæÖÊï∞ÊçÆÔºâ
      const recommendationsHtml = `
        <div class="recommendations-filters" id="filters-${newTabIndex}" style="display: none;">
          <div class="filter-group">
            <label>Âú∞Âå∫Ôºö</label>
            <select id="regionFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">ÂÖ®ÈÉ®</option>
              <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
              <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Á±ªÂûãÔºö</label>
            <select id="typeFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">ÂÖ®ÈÉ®</option>
            </select>
          </div>
          <div class="recommendations-stats" id="recommendationsStats-${newTabIndex}"></div>
        </div>
        <table class="recommendations-table" id="recommendationsTable-${newTabIndex}" style="display: none;">
          <thead>
            <tr>
              <th class="checkbox-cell"></th>
              <th>‰ø°ÊÅØÊ∫ê</th>
              <th>Á±ªÂûã</th>
              <th>Âú∞Âå∫</th>
              <th>ÊèèËø∞</th>
              <th>ÊúâÊïàÊÄß</th>
              <th>Áä∂ÊÄÅ</th>
            </tr>
          </thead>
          <tbody id="recommendationsBody-${newTabIndex}">
          </tbody>
        </table>
        <p id="recommendationsEmpty-${newTabIndex}" style="color: #999; padding: 20px; text-align: center;">Ê≠£Âú®Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåËØ∑Á®çÂÄô...</p>
      `;
      
      panel.innerHTML = processLogsHtml + recommendationsHtml;
      
      // ÂèñÊ∂àÂÖ∂‰ªñÈù¢ÊùøÁöÑactiveÁä∂ÊÄÅ
      Array.from(tabsContent.children).forEach((p, idx) => {
        if (idx !== newTabIndex) {
          p.classList.remove('active');
        }
      });
      
      tabsContent.appendChild(panel);
      
      return newTabIndex;
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∑ªÂä†Êé®ËçêËøáÁ®ãÊó•Âøó
    function addProcessLogInTab(tabIndex, message, type = 'info', data = null) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      
      // Êõ¥Êñ∞ËøõÂ∫¶ÊñáÊú¨ÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
      if (processTextEl) {
        processTextEl.textContent = message;
      } else {
        // Â¶ÇÊûúÊ≤°ÊúâÊñáÊú¨ÂÖÉÁ¥†ÔºåÂàõÂª∫Êñ∞ÁöÑÁªìÊûÑ
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (panel) {
          const processDiv = document.createElement('div');
          processDiv.id = `processText-${tabIndex}`;
          processDiv.style.cssText = 'font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;';
          processDiv.textContent = message;
          // ÊèíÂÖ•Âà∞Èù¢ÊùøÁöÑÊúÄÂâçÈù¢
          panel.insertBefore(processDiv, panel.firstChild);
        }
      }
    }

    // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®
    async function loadUserSubscriptions(topicKeywords = null) {
      try {
        let url = `${API_BASE_URL}/user/subscriptions`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          // ÊûÑÂª∫ËÆ¢ÈòÖÊò†Â∞ÑÔºàÂêåÊó∂Â≠òÂÇ®ÂêçÁß∞ÂíåURLÔºâ
          userSubscriptionsMap = {};
          result.data.forEach(sub => {
            const name = sub.source_name;
            userSubscriptionsMap[name] = {
              sourceName: name,
              sourceUrl: sub.source_url
            };
          });
          
          // Â¶ÇÊûúÊåáÂÆö‰∫Ü‰∏ªÈ¢òÔºåÂè™ËøîÂõûËØ•‰∏ªÈ¢òÁöÑËÆ¢ÈòÖÔºõÂê¶ÂàôËøîÂõûÊâÄÊúâËÆ¢ÈòÖ
          if (topicKeywords && topicKeywords.trim()) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          } else {
            // Â≠òÂÇ®ÊâÄÊúâËÆ¢ÈòÖÔºå‰ΩÜÊåâ‰∏ªÈ¢òÂàÜÁªÑ
            if (!window.allUserSubscriptions) {
              window.allUserSubscriptions = {};
            }
            result.data.forEach(sub => {
              const topic = sub.topic_keywords || '';
              if (!window.allUserSubscriptions[topic]) {
                window.allUserSubscriptions[topic] = [];
              }
              window.allUserSubscriptions[topic].push(sub.source_name);
            });
            // ‰∏∫‰∫ÜÂÖºÂÆπÊÄßÔºå‰ªçÁÑ∂ËÆæÁΩÆ userSubscriptions ‰∏∫ÊâÄÊúâËÆ¢ÈòÖÁöÑ source_name
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Â§±Ë¥•:', error);
        userSubscriptions = [];
      }
    }


    // ‰øùÂ≠ò‰∏ªÈ¢ò
    async function saveTopic(keywords) {
      try {
        console.log(`üíæ ÂºÄÂßã‰øùÂ≠ò‰∏ªÈ¢òÂà∞Êï∞ÊçÆÂ∫ì: "${keywords}"`);
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords }),
          cache: 'no-cache'
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.message || '‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•');
        }
        
        console.log(`‚úÖ ‰∏ªÈ¢òÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì: "${keywords}"`);
        
        // ÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®ÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆ
        await loadTopics();
        
        // Á´ãÂç≥Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊñ∞‰∏ªÈ¢òÁöÑÈ°µÁ≠æÊòæÁ§∫
        const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
        if (articlesTopicsTabsHeader) {
          console.log('üìö Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
          await loadArticlesTopicsTabs();
        }
        
        return { success: true, topic: result.topic };
      } catch (error) {
        console.error('‚ùå ‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•:', error);
        throw error; // ÊäõÂá∫ÈîôËØØÔºåËÆ©Ë∞ÉÁî®ËÄÖÁü•ÈÅì‰øùÂ≠òÂ§±Ë¥•
      }
    }

    // Ê∏≤ÊüìÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∏¶ËøáÊª§ÂäüËÉΩÔºâ
    function renderRecommendations() {
      const tbody = document.getElementById('recommendationsBody');
      if (!tbody) return;
      
      // Ëé∑ÂèñËøáÊª§Êù°‰ª∂
      const regionFilter = document.getElementById('regionFilter')?.value || 'all';
      const typeFilter = document.getElementById('typeFilter')?.value || 'all';
      
      // ËøáÊª§Êï∞ÊçÆ
      let filteredSources = recommendedSources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'ÂõΩÂ§ñ') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      tbody.innerHTML = filteredSources.map((source, index) => {
        // Ê£ÄÊü•ËÆ¢ÈòÖÁä∂ÊÄÅÔºöÂêåÊó∂ÊØîËæÉÂêçÁß∞ÂíåURLÔºåÁ°Æ‰øùÂåπÈÖçÂáÜÁ°Æ
        let isSubscribed = false;
        
        // ÊñπÊ≥ï1ÔºöÁ≤æÁ°ÆÂåπÈÖçÂêçÁß∞
        if (userSubscriptions.includes(source.sourceName)) {
          isSubscribed = true;
        } else {
          // ÊñπÊ≥ï2ÔºöÂ¶ÇÊûúÂêçÁß∞‰∏çÂåπÈÖçÔºåÂ∞ùËØïÈÄöËøáURLÂåπÈÖçÔºàÂ§ÑÁêÜÂêçÁß∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºâ
          const normalizeUrl = (url) => {
            if (!url) return '';
            // ÂéªÈô§ÂçèËÆÆ„ÄÅwww„ÄÅÂ∞æÈÉ®ÊñúÊù†ÔºåËΩ¨‰∏∫Â∞èÂÜô
            return url.replace(/^https?:\/\//, '')
                     .replace(/^www\./, '')
                     .replace(/\/$/, '')
                     .toLowerCase()
                     .trim();
          };
          
          const sourceUrlNormalized = normalizeUrl(source.sourceUrl);
          
          // ÈÅçÂéÜÊâÄÊúâËÆ¢ÈòÖÔºåÊØîËæÉURL
          for (const subName in userSubscriptionsMap) {
            const sub = userSubscriptionsMap[subName];
            const subUrlNormalized = normalizeUrl(sub.sourceUrl);
            
            // Â¶ÇÊûúURLÂåπÈÖçÔºåÂàôËÆ§‰∏∫Â∑≤ËÆ¢ÈòÖ
            if (subUrlNormalized && sourceUrlNormalized && subUrlNormalized === sourceUrlNormalized) {
              isSubscribed = true;
              break;
            }
          }
        }
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${recommendedSources.indexOf(source)}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChange(this)">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'Â∑≤ËÆ¢ÈòÖ' : 'Êú™ËÆ¢ÈòÖ'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
      updateRecommendationsStats(filteredSources.length, recommendedSources.length);
    }
    
    // Êõ¥Êñ∞Êé®ËçêÁªüËÆ°‰ø°ÊÅØ
    function updateRecommendationsStats(filtered, total) {
      const statsEl = document.getElementById('recommendationsStats');
      if (statsEl) {
        statsEl.textContent = `ÊòæÁ§∫ ${filtered} / ÂÖ± ${total} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
    }

    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.source-checkbox');
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
    }

    // Â§ÑÁêÜÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê
    async function handleManualAddSource(tabIndex) {
      const sourceNameInput = document.getElementById(`manualSourceName-${tabIndex}`);
      const sourceUrlInput = document.getElementById(`manualSourceUrl-${tabIndex}`);
      const addBtn = document.getElementById(`manualAddBtn-${tabIndex}`);
      
      if (!sourceNameInput || !sourceUrlInput) {
        showMessage('Êâæ‰∏çÂà∞ËæìÂÖ•Ê°ÜÂÖÉÁ¥†', 'error');
        return;
      }
      
      const sourceName = sourceNameInput.value.trim();
      const sourceUrl = sourceUrlInput.value.trim();
      
      // È™åËØÅËæìÂÖ•
      if (!sourceName) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êÂêçÁß∞', 'error');
        sourceNameInput.focus();
        return;
      }
      
      if (!sourceUrl) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êURL', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // È™åËØÅURLÊ†ºÂºè
      try {
        new URL(sourceUrl);
      } catch (e) {
        showMessage('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑURLÊ†ºÂºè', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÂÖ≥ÈîÆËØç
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) {
        showMessage('Êâæ‰∏çÂà∞‰∏ªÈ¢ò‰ø°ÊÅØ', 'error');
        return;
      }
      
      const history = JSON.parse(panel.dataset.history || '{}');
      const topicKeywords = history.topic_keywords || '';
      
      if (!topicKeywords || !topicKeywords.trim()) {
        showMessage('Êó†Ê≥ïÊ∑ªÂä†ÔºöÁº∫Â∞ë‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
        return;
      }
      
      // Á¶ÅÁî®ÊåâÈíÆ
      addBtn.disabled = true;
      addBtn.textContent = 'Ê∑ªÂä†‰∏≠...';
      
      try {
        // Âà§Êñ≠‰ø°ÊÅØÊ∫êÁ±ªÂûãÔºàÁÆÄÂçïÂà§Êñ≠ÔºöÂ¶ÇÊûúURLÂåÖÂê´rss/feed/xmlÁ≠âÔºåËÆ§‰∏∫ÊòØRSSÔºåÂê¶ÂàôÊòØblogÔºâ
        let sourceType = 'rss';
        const urlLower = sourceUrl.toLowerCase();
        if (!urlLower.includes('rss') && !urlLower.includes('feed') && !urlLower.includes('.xml') && !urlLower.includes('atom')) {
          sourceType = 'blog';
        }
        
        const subscriptionData = {
          sourceName: sourceName,
          sourceUrl: sourceUrl,
          sourceType: sourceType,
          topicKeywords: topicKeywords
        };
        
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: [subscriptionData] })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüÊ∑ªÂä†Âπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºö${sourceName}`, 'success');
          
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          sourceNameInput.value = '';
          sourceUrlInput.value = '';
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®
          await loadUserSubscriptions();
          
          // Â¶ÇÊûúËØ•È°µÁ≠æÊúâÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            await renderRecommendationsInTab(tabIndex, history.recommended_sources);
          }
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          showMessage(result.message || 'Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'Ê∑ªÂä†Âπ∂ËÆ¢ÈòÖ';
      }
    }

    // ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    async function subscribeSelected() {
      const checkboxes = document.querySelectorAll('.source-checkbox:checked');
      if (checkboxes.length === 0) {
        showMessage('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }

      const subscribeBtn = document.getElementById('subscribeBtn');
      subscribeBtn.disabled = true;
      subscribeBtn.textContent = 'ËÆ¢ÈòÖ‰∏≠...';

      const selectedSources = Array.from(checkboxes).map(cb => {
        const index = parseInt(cb.dataset.index);
        return recommendedSources[index];
      });

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: selectedSources })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${selectedSources.length} ‰∏™‰ø°ÊÅØÊ∫êÔºåÊ≠£Âú®Êî∂ÈõÜÊñáÁ´†...`, 'success');
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Âπ∂Êõ¥Êñ∞Ë°®Ê†ºÊòæÁ§∫
          await loadUserSubscriptions();
          renderRecommendations();
          // ‰∏çÊ∏ÖÁ©∫ËæìÂÖ•Ê°ÜÂíåÊé®ËçêÂàóË°®Ôºå‰øùÁïôË°®Ê†º‰æõÁî®Êà∑Êü•ÁúãÂíå‰øÆÊîπ
          // Ëá™Âä®Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜ
          triggerCollectAfterSubscribe();
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        subscribeBtn.disabled = false;
        subscribeBtn.textContent = 'ËÆ¢ÈòÖÈÄâ‰∏≠';
      }
    }

    // Âà†Èô§‰∏ªÈ¢ò
    async function removeTopic(keywords) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§‰∏ªÈ¢ò "${keywords}" ÂêóÔºü\n\nÂà†Èô§ÂêéÂ∞ÜÂêåÊó∂Âà†Èô§Ôºö\n- ËØ•‰∏ªÈ¢òÁöÑÊâÄÊúâ‰ø°ÊÅØÊ∫êËÆ¢ÈòÖ\n- Ëøô‰∫õ‰ø°ÊÅØÊ∫êÊî∂ÈõÜÁöÑÊâÄÊúâÊñáÁ´†\n- ËØ•‰∏ªÈ¢òÁöÑÊé®ËçêÂéÜÂè≤\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`)) {
        return;
      }

      try {
        const response = await fetch(
          `${API_BASE_URL}/user/topics/${encodeURIComponent(keywords)}`,
          {
            method: 'DELETE',
            headers: getHeaders()
          }
        );

        const result = await response.json();

        if (result.success) {
          let message = result.message || '‰∏ªÈ¢òÂà†Èô§ÊàêÂäü';
          if (result.deletedSubscriptionCount > 0 || result.deletedArticleCount > 0) {
            message += `ÔºàÂ∑≤Âà†Èô§ ${result.deletedSubscriptionCount || 0} ‰∏™ËÆ¢ÈòÖÔºå${result.deletedArticleCount || 0} ÁØáÊñáÁ´†Ôºâ`;
          }
          showMessage(message, 'success');
          
          console.log(`üóëÔ∏è  ‰∏ªÈ¢ò "${keywords}" Âà†Èô§ÊàêÂäüÔºåÂºÄÂßãÂà∑Êñ∞È°µÈù¢...`);
          
          // ÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®
          await loadTopics();
          
          // Âº∫Âà∂Âà∑Êñ∞Êé®ËçêÂéÜÂè≤ÔºàÁ°Æ‰øùÂà†Èô§ÁöÑÈ°µÁ≠æË¢´ÁßªÈô§Ôºâ
          console.log('üîÑ Âà∑Êñ∞Êé®ËçêÂéÜÂè≤È°µÁ≠æ...');
          await loadAllRecommendationHistory();
          
          // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºåÂà∑Êñ∞ÊñáÁ´†ÂàóË°®
          if (document.getElementById('articlesPage').classList.contains('active')) {
            console.log('üîÑ Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
          
          console.log('‚úÖ È°µÈù¢Âà∑Êñ∞ÂÆåÊàê');
        } else {
          showMessage(result.message || 'Âà†Èô§Â§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
      }
    }

    // Ê†ºÂºèÂåñÊó∂Èó¥Â∑Æ
    function formatTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const minutes = Math.floor(diff / 60000);
      
      if (minutes < 1) return 'ÂàöÂàö';
      if (minutes < 60) return `${minutes}ÂàÜÈíüÂâç`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}Â∞èÊó∂Ââç`;
      const days = Math.floor(hours / 24);
      return `${days}Â§©Ââç`;
    }

    // ËÆ°ÁÆóÂèëÂ∏ÉÊó∂Èó¥ËåÉÂõ¥
    function calculatePublishDateRange(articles) {
      if (!articles || articles.length === 0) {
        return '-';
      }
      
      const dates = articles.map(a => new Date(a.publish_date)).filter(d => !isNaN(d));
      if (dates.length === 0) return '-';
      
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      
      const formatDate = (d) => {
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}Âπ¥${month}Êúà${day}Êó•`;
      };
      
      if (minDate.toDateString() === maxDate.toDateString()) {
        return formatDate(minDate);
      } else {
        return `${formatDate(minDate)} - ${formatDate(maxDate)}`;
      }
    }

    // ËÆ°ÁÆóÊúÄËøëÂà∑Êñ∞ÁöÑÊñáÁ´†Êï∞ÔºàÊúÄËøë10ÂàÜÈíüÔºâ
    function calculateRecentArticlesCount(articles) {
      if (!articles || articles.length === 0) return 0;
      
      const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000);
      return articles.filter(a => {
        const created = new Date(a.created_at || a.publish_date);
        return created >= tenMinutesAgo;
      }).length;
    }

    // Âä†ËΩΩÂà∑Êñ∞Áä∂ÊÄÅÂíåÁªüËÆ°‰ø°ÊÅØ
    async function loadRefreshStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/news/update-info`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          const lastUpdateTime = data.lastUpdateTime ? new Date(data.lastUpdateTime) : null;
          
          const refreshEl = document.getElementById('lastRefreshTime');
          if (refreshEl) {
            refreshEl.textContent = lastUpdateTime ? formatTimeAgo(lastUpdateTime) : '-';
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂà∑Êñ∞Áä∂ÊÄÅÂ§±Ë¥•:', error);
      }
    }

    // ËÆ¢ÈòÖÂêéËá™Âä®Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜÔºàÂêéÂè∞ÊâßË°åÔºå‰∏çÈòªÂ°ûUIÔºâ
    function triggerCollectAfterSubscribe(topicKeywords) {
      const taskId = `auto-collect-${topicKeywords || 'all'}`;
      GlobalProgress.addTask(taskId, 'Êî∂ÈõÜÊñáÁ´†', topicKeywords || 'ÂÖ®ÈÉ®', 0, 'ËÆ¢ÈòÖÊàêÂäüÔºåÊ≠£Âú®Êî∂ÈõÜÊñáÁ´†...');

      const requestBody = {};
      if (topicKeywords) {
        requestBody.topicKeywords = topicKeywords;
      }

      fetch(`${API_BASE_URL}/collect`, {
        method: 'POST',
        headers: {
          ...getHeaders(),
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestBody)
      }).then(async response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split('\n');
          buffer = lines.pop();
          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const data = JSON.parse(line.slice(6));
                if (data.progress !== undefined) {
                  GlobalProgress.updateTask(taskId, data.progress, data.message || 'Êî∂ÈõÜ‰∏≠...');
                }
              } catch (e) {}
            }
          }
        }
        GlobalProgress.completeTask(taskId, 'ÊñáÁ´†Êî∂ÈõÜÂÆåÊàê');
        // Âà∑Êñ∞ÊñáÁ´†ÂàóË°®
        if (document.getElementById('articlesPage')?.classList.contains('active')) {
          await loadArticlesTopicsTabs();
        }
      }).catch(error => {
        console.error('Ëá™Âä®Êî∂ÈõÜÊñáÁ´†Â§±Ë¥•:', error);
        GlobalProgress.completeTask(taskId, 'Êî∂ÈõÜÂ§±Ë¥•: ' + error.message);
      });
    }

    // Á´ãÂç≥Âà∑Êñ∞Êñ∞Èóª
    async function refreshNewsNow(tabIndex = null) {
      // Â¶ÇÊûú‰º†ÂÖ•‰∫ÜtabIndexÔºå‰ΩøÁî®ÂØπÂ∫îÁöÑÊåâÈíÆÔºõÂê¶ÂàôÂ∞ùËØïÊü•ÊâæÈÄöÁî®ÊåâÈíÆ
      let btn;

      if (tabIndex !== null) {
        btn = document.getElementById(`refreshNowBtn-${tabIndex}`);
      } else {
        btn = document.getElementById('refreshNowBtn');
      }

      if (!btn) {
        console.error('Êâæ‰∏çÂà∞Âà∑Êñ∞ÊåâÈíÆ');
        return;
      }

      btn.disabled = true;
      btn.classList.add('refreshing');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>üîÑ</span> Âà∑Êñ∞‰∏≠...';

      const topicLabel = currentTopicFilter || 'ÂÖ®ÈÉ®';
      const taskId = `collect-${topicLabel}`;
      GlobalProgress.addTask(taskId, 'Êî∂ÈõÜÊñáÁ´†', topicLabel, 0, 'ÂáÜÂ§áÂºÄÂßãÊî∂ÈõÜ...');

      try {
        // ÊûÑÂª∫ËØ∑Ê±Ç‰ΩìÔºåÂ¶ÇÊûúÊòØÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠Ôºå‰º†ÈÄí‰∏ªÈ¢òÂÖ≥ÈîÆËØç
        const requestBody = {};
        if (tabIndex !== null && currentTopicFilter) {
          requestBody.topicKeywords = currentTopicFilter;
        }

        // Ë∞ÉÁî®ÂêéÁ´ØÊî∂ÈõÜÊé•Âè£ÔºàÊµÅÂºèÂìçÂ∫îÔºâ
        const response = await fetch(`${API_BASE_URL}/collect`, {
          method: 'POST',
          headers: {
            ...getHeaders(),
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;

        while (true) {
          const { done, value } = await reader.read();

          if (done) {
            break;
          }

          // Ëß£Á†ÅÊï∞ÊçÆÂπ∂Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
          buffer += decoder.decode(value, { stream: true });

          // ÊåâË°åÂàÜÂâ≤Âπ∂Â§ÑÁêÜÊØèË°å JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ‰øùÁïôÊúÄÂêé‰∏çÂÆåÊï¥ÁöÑË°å

          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);

                // Êõ¥Êñ∞ÂÖ®Â±ÄËøõÂ∫¶Êù°
                if (progress.type === 'start') {
                  GlobalProgress.updateTask(taskId, 5, progress.message || 'ÂºÄÂßãÊî∂ÈõÜ...');
                } else if (progress.type === 'progress') {
                  const pct = Math.round((progress.current / progress.total) * 100);
                  GlobalProgress.updateTask(taskId, pct, progress.message || `${progress.sourceName} (${progress.current}/${progress.total})`);
                } else if (progress.type === 'complete') {
                  GlobalProgress.completeTask(taskId, progress.message || 'Êî∂ÈõÜÂÆåÊàê');
                  finalResult = progress;
                } else if (progress.type === 'final') {
                  GlobalProgress.completeTask(taskId, progress.message || 'Êî∂ÈõÜÂÆåÊàê');
                  finalResult = progress;
                } else if (progress.type === 'error') {
                  GlobalProgress.completeTask(taskId, progress.message || 'Êî∂ÈõÜÂ§±Ë¥•', 3000);
                  finalResult = progress;
                }

                // ÂÆûÊó∂Ê∑ªÂä†Êî∂ÈõÜÂà∞ÁöÑÊñáÁ´†
                if (progress.type === 'articleCollected' && progress.article) {
                  // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºåÁ´ãÂç≥ÊòæÁ§∫Êñ∞ÊñáÁ´†
                  if (tabIndex !== null && currentTopicFilter) {
                    // Ê£ÄÊü•ÊñáÁ´†ÊòØÂê¶Â±û‰∫éÂΩìÂâç‰∏ªÈ¢ò
                    const recommendedSources = topicRecommendationHistory[currentTopicFilter]?.recommended_sources || [];
                    const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
                    if (sourceNames.length === 0 || sourceNames.includes(progress.article.source)) {
                      addArticleToTab(tabIndex, progress.article);
                    }
                  } else {
                    // ‰∏çÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠ÔºåÁõ¥Êé•Ê∑ªÂä†
                    addArticleToList(progress.article);
                  }
                } else if (progress.type === 'filterStats') {
                  // ÊòæÁ§∫ËøáÊª§ÁªüËÆ°‰ø°ÊÅØ
                  const statsMsg = `‚úì ÊâæÂà∞ ${progress.relevant} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†ÔºåÊ†áËÆ∞‰∫Ü ${progress.irrelevant} ÁØá‰∏çÁõ∏ÂÖ≥ÊñáÁ´†Ôºà‰∏ªÈ¢òÔºö${progress.topicKeywords}Ôºâ`;
                  GlobalProgress.updateTask(taskId, 95, statsMsg);
                  console.log(`[ËøáÊª§ÁªüËÆ°] ${statsMsg}`);
                  // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
                  showMessage(statsMsg, 'success');
                }

                // Â¶ÇÊûúÊòØÊúÄÁªàÁªìÊûúÔºå‰øùÂ≠ò
                if (progress.type === 'final' || progress.type === 'error') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('Ëß£ÊûêËøõÂ∫¶Êï∞ÊçÆÂ§±Ë¥•:', e, line);
              }
            }
          }
        }

        // Â§ÑÁêÜÊúÄÁªàÁªìÊûú
        if (finalResult) {
          if (finalResult.success !== false) {
            showMessage('Êñ∞ÈóªÊî∂ÈõÜÂÆåÊàê', 'success');

            // Á≠âÂæÖÂá†ÁßíÂêéÈáçÊñ∞Âä†ËΩΩÊñáÁ´†ÂàóË°®
            setTimeout(async () => {
              if (tabIndex !== null && currentTopicFilter) {
                // Â¶ÇÊûúÊòØÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠ÔºåÈáçÊñ∞Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†
                await loadArticlesForTopic(currentTopicFilter, tabIndex, true);
                // Êõ¥Êñ∞ËØ•È°µÁ≠æÁöÑÂà∑Êñ∞Êó∂Èó¥
                if (document.getElementById(`lastRefreshTime-${tabIndex}`)) {
                  document.getElementById(`lastRefreshTime-${tabIndex}`).textContent = 'ÂàöÂàö';
                }
              } else {
                // Âê¶Âàô‰ΩøÁî®ÂéüÊúâÁöÑÂä†ËΩΩÊñπÂºè
                await loadArticles(true);
                await loadRefreshStatus();
              }
            }, 1000);
          } else {
            showMessage('Âà∑Êñ∞Â§±Ë¥•: ' + (finalResult.message || 'Êú™Áü•ÈîôËØØ'), 'error');
          }
        }
      } catch (error) {
        console.error('Âà∑Êñ∞Êñ∞ÈóªÂ§±Ë¥•:', error);
        showMessage('Âà∑Êñ∞Â§±Ë¥•: ' + error.message, 'error');
        GlobalProgress.completeTask(taskId, 'Êî∂ÈõÜÂ§±Ë¥•: ' + error.message, 3000);
      } finally {
        btn.disabled = false;
        btn.classList.remove('refreshing');
        btn.innerHTML = originalText;
      }
    }

    // Âä†ËΩΩÊñáÁ´†ÂàóË°®
    async function loadArticles(forceRefresh = false) {
      const articlesListEl = document.getElementById('articlesList');
      
      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      articlesListEl.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏≠...</div>';

      try {
        const response = await fetch(`${API_BASE_URL}/news/list`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          
          // Â∞ÜÊâÄÊúâÊñáÁ´†Â±ïÂπ≥Âà∞‰∏Ä‰∏™Êï∞ÁªÑ‰∏≠
          allArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              allArticles.push({
                ...news,
                date: day.date
              });
            });
          });

          if (allArticles.length === 0) {
            articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†ÔºåËØ∑ÂÖàËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</p><p style="margin-top: 12px; font-size: 13px; color: #999;">Á≥ªÁªüÊØè10ÂàÜÈíüËá™Âä®Êî∂ÈõÜ‰∏ÄÊ¨°ÔºåËØ∑Á®çÂÄô</p></div>';
            updateStats([]);
            loadSourceCards([]);
          } else {
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            updateStats(allArticles);
            
            // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
            const sources = [...new Set(allArticles.map(a => a.source))];
            loadSourceCards(sources);
            
            // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
            applyFilters();
          }
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</p></div>';
      }
    }
    

    // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
    function updateStats(articles) {
      document.getElementById('totalArticles').textContent = articles.length;
      document.getElementById('publishDateRange').textContent = calculatePublishDateRange(articles);
      document.getElementById('recentArticlesCount').textContent = calculateRecentArticlesCount(articles);
    }

    // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
    function loadSourceCards(sources) {
      const container = document.getElementById('sourceFilterCards');
      
      // Ê∏ÖÁ©∫ÊâÄÊúâÂç°ÁâáÔºåÂåÖÊã¨"ÂÖ®ÈÉ®"
      container.innerHTML = '';
      
      // ÈáçÊñ∞ÂàõÂª∫"ÂÖ®ÈÉ®"Âç°Áâá
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>ÂÖ®ÈÉ®</span>';
      allCard.onclick = () => filterArticlesBySource(null);
      container.appendChild(allCard);
      
      // Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂç°Áâá
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySource(source);
        container.appendChild(card);
      });
      
      // Á°Æ‰øù"ÂÖ®ÈÉ®"Âç°ÁâáÊòØÊøÄÊ¥ªÁä∂ÊÄÅÔºàÂ¶ÇÊûúÂΩìÂâçÊ≤°ÊúâÈÄâÊã©ÁâπÂÆö‰ø°ÊÅØÊ∫êÔºâ
      if (currentSourceFilter === null) {
        allCard.classList.add('active');
      }
    }

    // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
    function filterArticlesBySource(source) {
      currentSourceFilter = source;
      
      // Êõ¥Êñ∞Âç°ÁâáÁä∂ÊÄÅ
      document.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      applyFilters();
    }

    // Â∫îÁî®ËøáÊª§
    function applyFilters() {
      let filtered = [...allArticles];
      
      // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
      if (currentSourceFilter) {
        filtered = filtered.filter(a => a.source === currentSourceFilter);
      }
      
      // ÊåâÁõ∏ÂÖ≥ÊÄßËøáÊª§ÔºàÂè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†Ôºâ
      if (showOnlyRelevantArticles) {
        filtered = filtered.filter(a => a.is_relevant_to_topic === true);
      }
      
      filteredArticles = filtered;
      renderArticles(filtered);
    }

    // Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
    function renderArticles(articles) {
      const articlesListEl = document.getElementById('articlesList');
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†</p></div>';
        return;
      }
      
      // ÊåâÊó•ÊúüÂàÜÁªÑ
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // Ê∏≤ÊüìËØ•Êó•Êúü‰∏ãÁöÑÊâÄÊúâÊñáÁ´†
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">‰∏çÁõ∏ÂÖ≥</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'Êú™Áü•')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // Êü•ÁúãÊñáÁ´†ËØ¶ÊÉÖ
    async function viewArticle(id) {
      // ‰øùÂ≠òÊªöÂä®‰ΩçÁΩÆ
      savedScrollPosition = window.pageYOffset || document.documentElement.scrollTop;

      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;

      // Ê∑ªÂä†ÊµèËßàÂô®ÂéÜÂè≤ËÆ∞ÂΩïÔºåÊîØÊåÅËøîÂõûÈîÆÂØºËà™
      history.pushState({
        page: 'articles',
        view: 'detail',
        articleId: id,
        topicIndex: currentTabIndex,
        scrollPosition: savedScrollPosition
      }, '', `#articles/article/${id}`);

      // ‰øùÂ≠òÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅÂà∞ localStorage
      localStorage.setItem('dashboardCurrentPage', 'articles');
      localStorage.setItem('dashboardViewingArticleId', id.toString());
      localStorage.setItem('dashboardCurrentTopicIndex', currentTabIndex.toString());
      
      // ÈöêËóèÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      const refreshBtn = document.getElementById(`refreshNowBtn-${currentTabIndex}`);

      if (statsBar) statsBar.style.display = 'none';
      if (sourceFilterCards) sourceFilterCards.style.display = 'none';
      if (refreshBtn) refreshBtn.style.display = 'none';
      
      // ÈöêËóèÊó•Êúü‰æßËæπÊ†è
      hideDateSidebar();
      
      // ÈöêËóèÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÂàóË°®ËßÜÂõæÔºåÈöêËóè‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÔºåÊòæÁ§∫ËØ¶ÊÉÖËßÜÂõæ
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'none';
      document.getElementById('articleDetailView').style.display = 'block';
      
      // ÊªöÂä®Âà∞È°∂ÈÉ®
      window.scrollTo(0, 0);
      
      // Âä†ËΩΩÊñáÁ´†ËØ¶ÊÉÖ
      try {
        const response = await fetch(`${API_BASE_URL}/news/${id}`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const article = result.data;
          
          document.getElementById('articleDetailTitle').textContent = article.title;
          document.getElementById('articleDetailSource').textContent = `Êù•Ê∫êÔºö${article.source || 'Êú™Áü•'}`;
          document.getElementById('articleDetailDate').textContent = `ÂèëÂ∏ÉÊó∂Èó¥Ôºö${formatDate(article.publish_date)}`;
          
          // Ê≠£ÊñáÂÜÖÂÆπ - ‰øùÁïôHTMLÊ†ºÂºèÔºàÂÖàÂ§ÑÁêÜÂÜÖÂÆπÔºåÊ£ÄÊü•ÊòØÂê¶ÂåÖÂê´ÂõæÁâáÔºâ
          const contentEl = document.getElementById('articleDetailContent');
          let originalContent = '';
          let contentHasImages = false;
          
          if (article.content) {
            originalContent = article.content;
            
            // Ê£ÄÊü•ÂÜÖÂÆπÊòØÂê¶ÂåÖÂê´HTMLÊ†áÁ≠æ
            const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
            
            // Ê£ÄÊü•ÂÜÖÂÆπ‰∏≠ÊòØÂê¶ÂåÖÂê´ÂõæÁâáÊ†áÁ≠æ
            contentHasImages = /<img[^>]*>/i.test(originalContent);
            
            if (hasHtml) {
              // ÂåÖÂê´HTMLÔºåËøõË°åÂÆâÂÖ®Ê∏ÖÁêÜÂêéÊòæÁ§∫
              // ÁßªÈô§Âç±Èô©Ê†áÁ≠æÂíåÂ±ûÊÄßÔºå‰ΩÜ‰øùÁïôÊ†ºÂºèÊ†áÁ≠æ
              let safeHtml = originalContent
                // ÁßªÈô§scriptÂíåstyleÊ†áÁ≠æÂèäÂÖ∂ÂÜÖÂÆπ
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                // ÁßªÈô§iframe
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                // ÁßªÈô§Âç±Èô©‰∫ã‰ª∂Â±ûÊÄß
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                // ÁßªÈô§javascript:ÈìæÊé•
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              
              // ‰ΩøÁî®DOMPurifyÊàñÁÆÄÂçïÁöÑÊ∏ÖÁêÜÂêéËÆæÁΩÆinnerHTML
              contentEl.innerHTML = safeHtml;
              // ÂØπHTMLÊ†ºÂºèÂÜÖÂÆπ‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤Êüì
              if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(contentEl, {
                  delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                  ],
                  throwOnError: false
                });
              }
            } else {
              // Á∫ØÊñáÊú¨ÂÜÖÂÆπÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
              const textContent = originalContent
                .replace(/&nbsp;/g, ' ')
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&quot;/g, '"')
                .trim();
              
              const paragraphs = textContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
            }
          } else {
            contentEl.textContent = 'ÊöÇÊó†ËØ¶ÁªÜÂÜÖÂÆπ';
          }
          
          // ÂõæÁâá - Â¶ÇÊûúÂÜÖÂÆπ‰∏≠Â∑≤ÁªèÂåÖÂê´ÂõæÁâáÔºåÂ∞±‰∏çÊòæÁ§∫ÂçïÁã¨ÁöÑimage_urlÂõæÁâá
          const imageEl = document.getElementById('articleDetailImage');
          if (article.image_url && !contentHasImages) {
            // Âè™ÊúâÂΩìÂÜÖÂÆπ‰∏≠Ê≤°ÊúâÂõæÁâáÊó∂ÔºåÊâçÊòæÁ§∫image_urlÁöÑÂõæÁâá
            imageEl.innerHTML = `<img src="${escapeHtml(article.image_url)}" alt="${escapeHtml(article.title)}" onerror="this.style.display='none'">`;
          } else {
            imageEl.innerHTML = '';
          }
          
          // ÊëòË¶Å
          const summaryEl = document.getElementById('articleDetailSummary');
          if (article.summary) {
            summaryEl.innerHTML = processMathFormulas(article.summary);
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          // ‰øùÂ≠òÊñáÁ´†IDÂíåÂéüÂßãÂÜÖÂÆπÁî®‰∫éÁøªËØëÂàáÊç¢
          window.currentArticleId = article.id;
          window.originalArticleData = {
            title: article.title,
            summary: article.summary || '',
            content: originalContent
          };
          window.isArticleTranslated = false; // ÈáçÁΩÆÁøªËØëÁä∂ÊÄÅ
          
          // ÂéüÊñáÈìæÊé•
          const sourceLink = document.getElementById('articleSourceLink');
          if (article.url) {
            sourceLink.href = article.url;
            sourceLink.style.display = 'inline-block';
          } else {
            sourceLink.style.display = 'none';
          }
          
          // ÁøªËØëÊåâÈíÆÔºàÂ¶ÇÊûúÊòØËã±ÊñáÔºâ
          const textToCheck = (article.title + ' ' + (article.summary || '') + ' ' + (article.content || '')).substring(0, 500);
          const translateBtn = document.getElementById('articleTranslateBtn');
          if (isEnglish(textToCheck)) {
            translateBtn.style.display = 'inline-block';
            translateBtn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
            translateBtn.setAttribute('data-translated', 'false');
            window.isArticleTranslated = false;
          } else {
            translateBtn.style.display = 'none';
          }
          
          // ÊÄªÁªìÊåâÈíÆÔºàÂ¶ÇÊûúÊñáÁ´†ËæÉÈïøÔºåË∂ÖËøá500Â≠óÔºâ
          const summarizeBtn = document.getElementById('articleSummarizeBtn');
          const contentLength = originalContent.length;
          if (contentLength > 500) {
            summarizeBtn.style.display = 'inline-block';
          } else {
            summarizeBtn.style.display = 'none';
          }
          
          // ÈöêËóèÁîüÊàêÁöÑÊÄªÁªìÂå∫ÂüüÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
          document.getElementById('articleGeneratedSummary').style.display = 'none';
        }
      } catch (error) {
        document.getElementById('articleDetailContent').textContent = 'Âä†ËΩΩÂ§±Ë¥•: ' + error.message;
      }
    }

    // ËøîÂõûÂàóË°®
    function backToList() {
      // Ê∏ÖÈô§ÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅ
      localStorage.removeItem('dashboardViewingArticleId');

      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;

      // Ê∑ªÂä†ÊµèËßàÂô®ÂéÜÂè≤ËÆ∞ÂΩï
      if (window.location.hash !== '#articles') {
        history.pushState({ page: 'articles', view: 'list', topicIndex: currentTabIndex }, '', '#articles');
      }

      // ÊòæÁ§∫ÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      const refreshBtn = document.getElementById(`refreshNowBtn-${currentTabIndex}`);

      if (statsBar) statsBar.style.display = 'flex';
      if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
      if (refreshBtn) refreshBtn.style.display = 'inline-flex';
      
      // ÊòæÁ§∫Êó•Êúü‰æßËæπÊ†è
      showDateSidebar();
      
      // ÈöêËóèËØ¶ÊÉÖËßÜÂõæÔºåÊòæÁ§∫‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÂíåÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÂàóË°®ËßÜÂõæ
      document.getElementById('articleDetailView').style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'block';
      
      // ÊÅ¢Â§çÊªöÂä®‰ΩçÁΩÆ
      window.scrollTo(0, savedScrollPosition);
    }

    // Ê£ÄÊµãÊòØÂê¶‰∏∫Ëã±Êñá
    function isEnglish(text) {
      const englishChars = (text.match(/[a-zA-Z]/g) || []).length;
      const totalChars = text.replace(/\s/g, '').length;
      return totalChars > 0 && englishChars / totalChars > 0.5;
    }

    // ÂàáÊç¢ÁøªËØë/ÂéüÊñá
    async function toggleTranslate() {
      const btn = document.getElementById('articleTranslateBtn');
      const titleEl = document.getElementById('articleDetailTitle');
      const summaryEl = document.getElementById('articleDetailSummary');
      const contentEl = document.getElementById('articleDetailContent');
      
      if (!window.originalArticleData || !window.currentArticleId) {
        return;
      }
      
      const isTranslated = window.isArticleTranslated || false;
      
      if (isTranslated) {
        // ÊòæÁ§∫ÂéüÊñá
        titleEl.textContent = window.originalArticleData.title;
        if (window.originalArticleData.summary) {
          summaryEl.innerHTML = processMathFormulas(window.originalArticleData.summary);
          summaryEl.style.display = 'block';
        } else {
          summaryEl.style.display = 'none';
        }
        
        // Ê£ÄÊü•ÂéüÊñáÊòØÂê¶ÂåÖÂê´HTML
        const originalContent = window.originalArticleData.content;
        const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
        
        if (hasHtml) {
          // ÂåÖÂê´HTMLÔºåËøõË°åÂÆâÂÖ®Ê∏ÖÁêÜÂêéÊòæÁ§∫
          let safeHtml = originalContent
            .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
            .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
            .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
            .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
            .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
            .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
          contentEl.innerHTML = safeHtml;
          // ÂØπÂéüÊñá‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤ÊüìÔºàÂ¶ÇÊûúÂéüÊñáÊòØHTMLÊ†ºÂºèÔºâ
          if (typeof renderMathInElement !== 'undefined') {
            renderMathInElement(contentEl, {
              delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '\\[', right: '\\]', display: true},
                {left: '\\(', right: '\\)', display: false}
              ],
              throwOnError: false
            });
          }
        } else {
          // Á∫ØÊñáÊú¨ÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
          const paragraphs = originalContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
          contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
        }
        
        btn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
        btn.setAttribute('data-translated', 'false');
        window.isArticleTranslated = false;
      } else {
        // ÁøªËØë‰∏∫‰∏≠ÊñáÔºà‰ΩøÁî® DeepSeek APIÔºåÂ∏¶ÁºìÂ≠òÔºâ
        btn.disabled = true;
        btn.textContent = 'ÁøªËØë‰∏≠...';
        
        try {
          // ÊèêÂèñÁ∫ØÊñáÊú¨Áî®‰∫éÁøªËØëÔºàÂ¶ÇÊûúÂåÖÂê´HTMLÔºåÊèêÂèñÊñáÊú¨ÂÜÖÂÆπÔºâ
          const originalContent = window.originalArticleData.content;
          const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
          
          let textForTranslation = '';
          if (hasHtml) {
            // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂DOMÂÖÉÁ¥†Êù•ÊèêÂèñÊñáÊú¨
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalContent;
            textForTranslation = (tempDiv.textContent || tempDiv.innerText || originalContent.replace(/<[^>]*>/g, '')).trim();
          } else {
            // Á∫ØÊñáÊú¨ÔºåÁõ¥Êé•‰ΩøÁî®
            textForTranslation = originalContent.replace(/<[^>]*>/g, '').trim();
          }
          
          // ‰ΩøÁî®Êñ∞ÁöÑÁøªËØëÊï¥ÁØáÊñáÁ´†APIÔºå‰º†ÈÄíÊñáÁ´†ID‰ª•ÊîØÊåÅÁºìÂ≠ò
          const response = await fetch(`${API_BASE_URL}/news/translate/article`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              ...getHeaders()
            },
            body: JSON.stringify({
              articleId: window.currentArticleId,
              title: window.originalArticleData.title,
              summary: window.originalArticleData.summary || '',
              content: textForTranslation.substring(0, 4000),
              source: 'en',
              target: 'zh'
            })
          });
          
          const result = await response.json();
          
          if (!result.success) {
            throw new Error(result.message || 'ÁøªËØëÂ§±Ë¥•');
          }
          
          // Êõ¥Êñ∞ÊòæÁ§∫
          titleEl.textContent = result.translatedTitle || window.originalArticleData.title;
          
          if (result.translatedSummary) {
            summaryEl.innerHTML = processMathFormulas(result.translatedSummary);
            summaryEl.style.display = 'block';
          } else if (window.originalArticleData.summary) {
            summaryEl.innerHTML = processMathFormulas(window.originalArticleData.summary);
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          if (result.translatedContent) {
            // ÁøªËØëÂêéÁöÑÂÜÖÂÆπÊòØÁ∫ØÊñáÊú¨ÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÊ†ºÂºèÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
            const paragraphs = result.translatedContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
            contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
          } else {
            // Â¶ÇÊûúÁøªËØëÂ§±Ë¥•ÔºåÊòæÁ§∫ÂéüÊñáÔºà‰øùÊåÅHTMLÊ†ºÂºèÔºâ
            if (hasHtml) {
              let safeHtml = originalContent
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              contentEl.innerHTML = safeHtml;
              // ÂØπÂéüÊñá‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤ÊüìÔºàÂ¶ÇÊûúÂéüÊñáÊòØHTMLÊ†ºÂºèÔºåÂèØËÉΩÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜÔºâ
              if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(contentEl, {
                  delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                  ],
                  throwOnError: false
                });
              }
            } else {
              const paragraphs = textForTranslation.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
            }
          }
          
          // ‰øùÂ≠òÁøªËØëÁªìÊûúÂà∞ window ÂØπË±°Ôºå‰ª•‰æøÂàáÊç¢Êó∂‰ΩøÁî®
          window.translatedArticleData = {
            title: result.translatedTitle,
            summary: result.translatedSummary,
            content: result.translatedContent
          };
          
          btn.textContent = 'Êü•ÁúãÂéüÊñá';
          btn.setAttribute('data-translated', 'true');
          window.isArticleTranslated = true;
          
          // Â¶ÇÊûúÊù•Ëá™ÁºìÂ≠òÔºåÊòæÁ§∫ÊèêÁ§∫
          if (result.fromCache) {
            console.log('ÁøªËØëÁªìÊûúÊù•Ëá™ÁºìÂ≠ò');
          }
        } catch (error) {
          alert('ÁøªËØëÂ§±Ë¥•: ' + error.message);
          btn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
        } finally {
          btn.disabled = false;
        }
      }
    }

    // ÁîüÊàêÊñáÁ´†ÊÄªÁªì
    async function generateSummary() {
      const btn = document.getElementById('articleSummarizeBtn');
      const summaryEl = document.getElementById('articleGeneratedSummary');
      const summaryContentEl = document.getElementById('articleGeneratedSummaryContent');
      
      if (!window.originalArticleData) {
        return;
      }
      
      btn.disabled = true;
      btn.textContent = 'ÁîüÊàê‰∏≠...';
      summaryEl.style.display = 'block';
      summaryContentEl.textContent = 'Ê≠£Âú®ÁîüÊàêÊÄªÁªìÔºåËØ∑Á®çÂÄô...';
      
      try {
        const content = window.originalArticleData.content.replace(/<[^>]*>/g, '').trim();
        const textToSummarize = (window.originalArticleData.title + '\n\n' + content).substring(0, 4000);
        
        const response = await fetch(`${API_BASE_URL}/news/summarize`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...getHeaders()
          },
          body: JSON.stringify({
            text: textToSummarize
          })
        });
        
        const result = await response.json();
        
        if (result.success && result.summary) {
          summaryContentEl.textContent = result.summary;
          btn.textContent = 'ÈáçÊñ∞ÁîüÊàê';
        } else {
          summaryContentEl.textContent = 'ÁîüÊàêÊÄªÁªìÂ§±Ë¥•: ' + (result.message || 'Êú™Áü•ÈîôËØØ');
          btn.textContent = 'ÁîüÊàêÊÄªÁªì';
        }
      } catch (error) {
        summaryContentEl.textContent = 'ÁîüÊàêÊÄªÁªìÂ§±Ë¥•: ' + error.message;
        btn.textContent = 'ÁîüÊàêÊÄªÁªì';
      } finally {
        btn.disabled = false;
      }
    }

    function formatDate(dateStr) {
      if (!dateStr) return '-';
      try {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}Âπ¥${month}Êúà${day}Êó•`;
      } catch (e) {
        return dateStr;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨ÂºèÔºåÂ∞Ü LaTeX ÂÖ¨ÂºèËΩ¨Êç¢‰∏∫ KaTeX ÂèØÊ∏≤ÊüìÁöÑÊ†ºÂºè
    function processMathFormulas(text) {
      if (!text || typeof text !== 'string') {
        return text;
      }

      // Áî®‰∫éÂ≠òÂÇ®ÂÖ¨ÂºèÁöÑÊï∞ÁªÑ
      const formulas = [];
      let formulaIndex = 0;
      
      // Âç†‰ΩçÁ¨¶Ê®°Êùø
      const placeholder = (index) => `__KATEX_FORMULA_${index}__`;

      // Â§ÑÁêÜÂùóÁ∫ßÂÖ¨Âºè \[...\] Êàñ $$...$$
      let processedText = text
        // Â§ÑÁêÜ \[...\] Ê†ºÂºè
        .replace(/\\\[([\s\S]*?)\\\]/g, (match, formula) => {
          formulas.push({ type: 'display', formula: formula.trim() });
          return placeholder(formulaIndex++);
        })
        // Â§ÑÁêÜ $$...$$ Ê†ºÂºèÔºàÈÅøÂÖç‰∏éÂ∑≤Â§ÑÁêÜÁöÑÂÜ≤Á™ÅÔºâ
        .replace(/\$\$([\s\S]*?)\$\$/g, (match, formula) => {
          // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊòØÂç†‰ΩçÁ¨¶
          if (match.includes('__KATEX_FORMULA_')) {
            return match;
          }
          formulas.push({ type: 'display', formula: formula.trim() });
          return placeholder(formulaIndex++);
        })
        // Â§ÑÁêÜË°åÂÜÖÂÖ¨Âºè \(...\)
        .replace(/\\\(([\s\S]*?)\\\)/g, (match, formula) => {
          formulas.push({ type: 'inline', formula: formula.trim() });
          return placeholder(formulaIndex++);
        });

      // ÂØπÈùûÂÖ¨ÂºèÈÉ®ÂàÜËøõË°å HTML ËΩ¨‰πâ
      let escapedText = escapeHtml(processedText);

      // Â∞ÜÂç†‰ΩçÁ¨¶ÊõøÊç¢‰∏∫ KaTeX Ê∏≤ÊüìÁöÑ HTML
      if (typeof katex === 'undefined') {
        // Â¶ÇÊûú KaTeX Êú™Âä†ËΩΩÔºåËøîÂõûËΩ¨‰πâÂêéÁöÑÊñáÊú¨ÔºàÂÖ¨ÂºèÈÉ®ÂàÜÊòæÁ§∫‰∏∫Âç†‰ΩçÁ¨¶Ôºâ
        console.warn('KaTeX Êú™Âä†ËΩΩÔºåÊó†Ê≥ïÊ∏≤ÊüìÊï∞Â≠¶ÂÖ¨Âºè');
        formulas.forEach((formulaData, index) => {
          const fallback = escapeHtml(`[ÂÖ¨Âºè: ${formulaData.formula}]`);
          escapedText = escapedText.replace(placeholder(index), fallback);
        });
      } else {
        formulas.forEach((formulaData, index) => {
          try {
            let renderedFormula;
            if (formulaData.type === 'display') {
              // ÂùóÁ∫ßÂÖ¨Âºè‰ΩøÁî® div ÂåÖË£Ö
              renderedFormula = katex.renderToString(formulaData.formula, {
                throwOnError: false,
                displayMode: true
              });
              renderedFormula = `<div class="katex-display" style="margin: 1em 0; overflow-x: auto; overflow-y: hidden;">${renderedFormula}</div>`;
            } else {
              // Ë°åÂÜÖÂÖ¨Âºè‰ΩøÁî® span ÂåÖË£Ö
              renderedFormula = katex.renderToString(formulaData.formula, {
                throwOnError: false,
                displayMode: false
              });
              renderedFormula = `<span class="katex-inline">${renderedFormula}</span>`;
            }
            escapedText = escapedText.replace(placeholder(index), renderedFormula);
          } catch (error) {
            console.error('KaTeX Ê∏≤ÊüìÈîôËØØ:', error, 'ÂÖ¨Âºè:', formulaData.formula);
            // Â¶ÇÊûúÊ∏≤ÊüìÂ§±Ë¥•ÔºåÊòæÁ§∫ÂéüÂßãÂÖ¨ÂºèÊñáÊú¨
            const fallback = escapeHtml(`[ÂÖ¨Âºè: ${formulaData.formula}]`);
            escapedText = escapedText.replace(placeholder(index), fallback);
          }
        });
      }

      return escapedText;
    }

    // Ëá™Âä®Âà∑Êñ∞ÊñáÁ´†ÂàóË°®ÔºàÊØè30ÁßíÔºâ
    let articlesRefreshInterval = null;

    function startArticlesAutoRefresh() {
      if (articlesRefreshInterval) {
        clearInterval(articlesRefreshInterval);
      }
      articlesRefreshInterval = setInterval(() => {
        const articlesPage = document.getElementById('articlesPage');
        if (articlesPage.classList.contains('active')) {
          // Ëá™Âä®Âà∑Êñ∞ÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆ
          loadArticles(true);
          loadRefreshStatus();
        }
      }, 30000); // 30ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
    }

    // Âä†ËΩΩÊâÄÊúâ‰∏ªÈ¢òÁöÑÊé®ËçêÂéÜÂè≤Âπ∂Ê∏≤ÊüìÈ°µÁ≠æ
    async function loadAllRecommendationHistory() {
      try {
        console.log('üìñ ÂºÄÂßãÂä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤...');
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        console.log('üìñ Êé®ËçêÂéÜÂè≤ÂìçÂ∫î:', result);

        if (result.success && result.data && result.data.length > 0) {
          const histories = result.data;
          console.log(`üìñ ÊâæÂà∞ ${histories.length} Êù°Êé®ËçêÂéÜÂè≤ÔºåÂºÄÂßãÊ∏≤ÊüìÈ°µÁ≠æ...`);
          console.log('üìñ Êé®ËçêÂéÜÂè≤‰∏ªÈ¢òÂàóË°®:', histories.map(h => h.topic_keywords));
          
          // Ê∏ÖÁ©∫Âπ∂ÈáçÊñ∞Ê∏≤ÊüìÈ°µÁ≠æ
          renderTopicsTabs(histories);
          document.getElementById('topicsTabsSection').style.display = 'block';
          console.log('‚úÖ Êé®ËçêÂéÜÂè≤È°µÁ≠æÊ∏≤ÊüìÂÆåÊàê');
        } else {
          console.log('üìñ Ê≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÈöêËóèÈ°µÁ≠æÂÆπÂô®');
          document.getElementById('topicsTabsSection').style.display = 'none';
        }
      } catch (error) {
        console.error('‚ùå Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', error);
        document.getElementById('topicsTabsSection').style.display = 'none';
      }
    }

    // Ê∏≤Êüì‰∏ªÈ¢òÈ°µÁ≠æ
    function renderTopicsTabs(histories) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) {
        console.warn('‚ö†Ô∏è  È°µÁ≠æÂÆπÂô®‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÊ∏≤Êüì');
        return;
      }
      
      console.log(`üé® ÂºÄÂßãÊ∏≤Êüì ${histories?.length || 0} ‰∏™‰∏ªÈ¢òÁöÑÈ°µÁ≠æ...`);

      // Ëé∑ÂèñÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºàÂú®Ê∏ÖÁ©∫‰πãÂâç‰øùÂ≠òÔºâ
      let activeTopicKeywords = null;
      const currentActiveTab = tabsHeader.querySelector('.topic-tab.active');
      if (currentActiveTab) {
        // ‰ªéÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÊñáÊú¨‰∏≠ÊèêÂèñ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºàÂéªÊéâÂæΩÁ´†Âíå"Êé®Ëçê‰∏≠..."Ôºâ
        const tabText = currentActiveTab.textContent.trim();
        activeTopicKeywords = tabText.replace(/\s*\(\d+\)\s*$/, '').replace(/\s*Êé®Ëçê‰∏≠\.\.\.\s*$/, '').trim();
        console.log(`üìå ÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢ò: "${activeTopicKeywords}"`);
      }

      // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';

      if (!histories || histories.length === 0) {
        console.log('‚ÑπÔ∏è  Ê≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊ∏ÖÁ©∫È°µÁ≠æÂπ∂ÈöêËóèÂÆπÂô®');
        // Â¶ÇÊûúÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÈöêËóèÈ°µÁ≠æÂÆπÂô®
        const topicsTabsSection = document.getElementById('topicsTabsSection');
        if (topicsTabsSection) {
          topicsTabsSection.style.display = 'none';
        }
        return;
      }
      
      // ÁîüÊàêÈ°µÁ≠æÂíåÂÜÖÂÆπ
      let hasActiveTab = false; // Ê†áËÆ∞ÊòØÂê¶ÊúâÈ°µÁ≠æË¢´ÊøÄÊ¥ª
      histories.forEach((history, index) => {
        const topicKeywords = history.topic_keywords;
        const tabId = `tab-${index}`;
        const panelId = `panel-${index}`;
        // Â¶ÇÊûúÂΩìÂâç‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂåπÈÖç‰πãÂâçÈÄâ‰∏≠ÁöÑÔºåÂàô‰øùÊåÅÈÄâ‰∏≠Áä∂ÊÄÅ
        let isActive = false;
        if (activeTopicKeywords && topicKeywords === activeTopicKeywords) {
          isActive = true;
          hasActiveTab = true;
        }

        // ÂàõÂª∫È°µÁ≠æÊåâÈíÆ
        const tabBtn = document.createElement('button');
        tabBtn.className = `topic-tab ${isActive ? 'active' : ''}`;
        tabBtn.id = tabId;
        tabBtn.onclick = () => switchTopicTab(index);
        const sourceCount = history.recommended_sources ? history.recommended_sources.length : 0;
        tabBtn.innerHTML = `${escapeHtml(topicKeywords)}${sourceCount > 0 ? `<span class="tab-badge">${sourceCount}</span>` : ''}`;
        tabsHeader.appendChild(tabBtn);

        // ÂàõÂª∫È°µÁ≠æÂÜÖÂÆπÈù¢Êùø
        const panel = document.createElement('div');
        panel.className = `topic-tab-panel ${isActive ? 'active' : ''}`;
        panel.id = panelId;
        panel.dataset.history = JSON.stringify(history);
        
        // Êé®ËçêËøáÁ®ãÊó•ÂøóÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
        let processLogsHtml = '';
        if (history.process_logs && history.process_logs.length > 0) {
          // Ëé∑ÂèñÊúÄÂêé‰∏ÄÊù°Êó•Âøó‰Ωú‰∏∫ÂΩìÂâçÁä∂ÊÄÅ
          const lastLog = history.process_logs[history.process_logs.length - 1];
          const lastMessage = lastLog.message || 'Êé®ËçêÂÆåÊàê';
          
          processLogsHtml = `
            <div style="font-size: 11px; color: #999; margin-bottom: 12px; padding: 4px 0;" id="processText-${index}">
              ${escapeHtml(lastMessage)}
            </div>
          `;
        }
        
        // Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†ºÔºàÂåÖÂê´ËøáÊª§Âô®ÂíåÂú∞Âå∫ÂàóÔºâ
        let recommendationsHtml = '';
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          // Ëé∑ÂèñÂîØ‰∏ÄÁöÑÁ±ªÂûãÂàóË°®
          const types = [...new Set(history.recommended_sources.map(s => s.sourceType || 'rss'))];
          
          recommendationsHtml = `
            <div class="recommendations-filters" id="filters-${index}">
              <div class="filter-group">
                <label>Âú∞Âå∫Ôºö</label>
                <select id="regionFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">ÂÖ®ÈÉ®</option>
                  <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
                  <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
                </select>
              </div>
              <div class="filter-group">
                <label>Á±ªÂûãÔºö</label>
                <select id="typeFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">ÂÖ®ÈÉ®</option>
                  ${types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('')}
                </select>
              </div>
              <div class="recommendations-stats" id="recommendationsStats-${index}"></div>
              <button class="invalid-sources-toggle" id="toggleInvalid-${index}" onclick="toggleInvalidSources(${index})" style="display: none;">
                <span id="toggleInvalidText-${index}">ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê</span>
                <span id="toggleInvalidCount-${index}"></span>
              </button>
            </div>
            <table class="recommendations-table" id="recommendationsTable-${index}">
              <thead>
                <tr>
                  <th class="checkbox-cell"></th>
                  <th>‰ø°ÊÅØÊ∫ê</th>
                  <th>Á±ªÂûã</th>
                  <th>Âú∞Âå∫</th>
                  <th>ÊèèËø∞</th>
                  <th>ÊúâÊïàÊÄß</th>
                  <th>Áä∂ÊÄÅ</th>
                </tr>
              </thead>
              <tbody id="recommendationsBody-${index}">
              </tbody>
            </table>
          `;
        } else {
          recommendationsHtml = '<p style="color: #999;">ÊöÇÊó†Êé®Ëçê‰ø°ÊÅØÊ∫ê</p>';
        }
        
        panel.innerHTML = processLogsHtml + recommendationsHtml;
        tabsContent.appendChild(panel);
        
        // Ê∏≤ÊüìËØ•‰∏ªÈ¢òÁöÑÊé®ËçêËøáÁ®ãÂíåÊé®Ëçê‰ø°ÊÅØÊ∫ê
        if (history.process_logs && history.process_logs.length > 0) {
          renderProcessLogsInTab(index, history.process_logs);
        }
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          renderRecommendationsInTab(index, history.recommended_sources);
        }
      });

      // Â¶ÇÊûúÊ≤°Êúâ‰ªª‰ΩïÈ°µÁ≠æË¢´ÊøÄÊ¥ªÔºà‰πãÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢òÂ∑≤Ë¢´Âà†Èô§ÔºâÔºåÊøÄÊ¥ªÁ¨¨‰∏Ä‰∏™È°µÁ≠æ
      if (!hasActiveTab && histories.length > 0) {
        console.log('‚ö†Ô∏è  ‰πãÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢òÂ∑≤Ë¢´Âà†Èô§ÔºåÊøÄÊ¥ªÁ¨¨‰∏Ä‰∏™È°µÁ≠æ');
        const firstTab = tabsHeader.querySelector('.topic-tab');
        const firstPanel = tabsContent.querySelector('.topic-tab-panel');
        if (firstTab) firstTab.classList.add('active');
        if (firstPanel) firstPanel.classList.add('active');
      }
    }

    // ÂàáÊç¢‰∏ªÈ¢òÈ°µÁ≠æ
    function switchTopicTab(index) {
      // Êõ¥Êñ∞È°µÁ≠æÊåâÈíÆÁä∂ÊÄÅ
      document.querySelectorAll('.topic-tab').forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÈù¢ÊùøÁä∂ÊÄÅ
      document.querySelectorAll('.topic-tab-panel').forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∏≤ÊüìÊé®ËçêËøáÁ®ãÊó•ÂøóÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
    function renderProcessLogsInTab(tabIndex, logs) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      if (!processTextEl) return;
      
      // Âè™ÊòæÁ§∫ÊúÄÂêé‰∏ÄÊù°Êó•ÂøóÔºàÊúÄÊñ∞ÁöÑËøõÂ∫¶Ôºâ
      if (logs && logs.length > 0) {
        const lastLog = logs[logs.length - 1];
        const message = lastLog.message || '';
        
        // Êõ¥Êñ∞ËøõÂ∫¶ÊñáÊú¨
        processTextEl.textContent = message;
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∏≤ÊüìÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∏¶ËøáÊª§ÂäüËÉΩÔºâ
    async function renderRecommendationsInTab(tabIndex, sources) {
      const tbody = document.getElementById(`recommendationsBody-${tabIndex}`);
      const table = document.getElementById(`recommendationsTable-${tabIndex}`);
      const filters = document.getElementById(`filters-${tabIndex}`);
      const emptyMsg = document.getElementById(`recommendationsEmpty-${tabIndex}`);
      
      if (!tbody) return;
      
      // Â¶ÇÊûúÊúâÊï∞ÊçÆÔºåÊòæÁ§∫Ë°®Ê†ºÂíåËøáÊª§Âô®ÔºåÈöêËóèÁ©∫Áä∂ÊÄÅÊèêÁ§∫
      if (sources && sources.length > 0) {
        if (table) table.style.display = 'table';
        if (filters) filters.style.display = 'flex';
        if (emptyMsg) emptyMsg.style.display = 'none';
      } else {
        if (table) table.style.display = 'none';
        if (filters) filters.style.display = 'none';
        if (emptyMsg) emptyMsg.style.display = 'block';
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÁöÑÂÖ≥ÈîÆËØç
      const panel = document.getElementById(`panel-${tabIndex}`);
      const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
      const topicKeywords = history.topic_keywords || null;
      
      // Êåâ‰∏ªÈ¢òÂä†ËΩΩËÆ¢ÈòÖÔºàÂ¶ÇÊûúÊúâ‰∏ªÈ¢òÔºâ
      if (topicKeywords) {
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          const result = await response.json();
          if (result.success) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        } catch (error) {
          console.error('Âä†ËΩΩ‰∏ªÈ¢òËÆ¢ÈòÖÂ§±Ë¥•:', error);
          await loadUserSubscriptions(); // ÈôçÁ∫ßÂà∞Âä†ËΩΩÊâÄÊúâËÆ¢ÈòÖ
        }
      } else {
        await loadUserSubscriptions();
      }
      
      // Êõ¥Êñ∞Á±ªÂûãËøáÊª§Âô®ÈÄâÈ°π
      const types = [...new Set(sources.map(s => s.sourceType || 'rss'))];
      const typeFilterEl = document.getElementById(`typeFilter-${tabIndex}`);
      if (typeFilterEl) {
        const currentValue = typeFilterEl.value;
        typeFilterEl.innerHTML = '<option value="all">ÂÖ®ÈÉ®</option>' + 
          types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');
        if (currentValue && types.includes(currentValue)) {
          typeFilterEl.value = currentValue;
        }
      }
      
      // Ëé∑ÂèñËøáÊª§Êù°‰ª∂
      const regionFilter = document.getElementById(`regionFilter-${tabIndex}`)?.value || 'all';
      const typeFilter = document.getElementById(`typeFilter-${tabIndex}`)?.value || 'all';
      
      // ËøáÊª§Êï∞ÊçÆ
      let filteredSources = sources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'ÂõΩÂ§ñ') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      // ÂàÜÁ¶ªÊúâÊïàÂíåÊó†ÊïàÁöÑ‰ø°ÊÅØÊ∫ê
      const validSources = filteredSources.filter(s => s.isValid !== false);
      const invalidSources = filteredSources.filter(s => s.isValid === false);
      
      // ÊéíÂ∫èÔºöÊúâÊïàÁöÑÊéíÂú®ÂâçÈù¢ÔºåÊó†ÊïàÁöÑÊéíÂú®ÂêéÈù¢ÔºåÊú™È™åËØÅÁöÑÊéíÂú®‰∏≠Èó¥
      validSources.sort((a, b) => {
        const aValid = a.isValid === true ? 0 : 1;
        const bValid = b.isValid === true ? 0 : 1;
        return aValid - bValid;
      });
      
      invalidSources.sort((a, b) => {
        const aName = (a.sourceName || '').toLowerCase();
        const bName = (b.sourceName || '').toLowerCase();
        return aName.localeCompare(bName);
      });
      
      // Êõ¥Êñ∞Êó†Êïà‰ø°ÊÅØÊ∫êÂàáÊç¢ÊåâÈíÆ
      const toggleBtn = document.getElementById(`toggleInvalid-${tabIndex}`);
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      const toggleCount = document.getElementById(`toggleInvalidCount-${tabIndex}`);
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      
      if (invalidSources.length > 0) {
        if (toggleBtn) toggleBtn.style.display = 'inline-block';
        if (toggleCount) toggleCount.textContent = ` (${invalidSources.length})`;
        
        // Ê£ÄÊü•ÂΩìÂâçÊòØÂê¶ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê
        const isShowingInvalid = window[`showInvalidSources_${tabIndex}`] || false;
        if (toggleText) {
          toggleText.textContent = isShowingInvalid ? 'ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê' : 'ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê';
        }
        if (recommendationsTable) {
          if (isShowingInvalid) {
            recommendationsTable.classList.add('show-invalid');
          } else {
            recommendationsTable.classList.remove('show-invalid');
          }
        }
      } else {
        if (toggleBtn) toggleBtn.style.display = 'none';
        if (recommendationsTable) recommendationsTable.classList.remove('show-invalid');
      }
      
      // Ê∏≤ÊüìÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫ê
      const validRows = validSources.map((source, idx) => {
        // Ê£ÄÊü•ËÆ¢ÈòÖÁä∂ÊÄÅÔºöÂêåÊó∂ÊØîËæÉÂêçÁß∞ÂíåURL
        let isSubscribed = false;
        
        // ÊñπÊ≥ï1ÔºöÁ≤æÁ°ÆÂåπÈÖçÂêçÁß∞
        if (userSubscriptions.includes(source.sourceName)) {
          isSubscribed = true;
        } else {
          // ÊñπÊ≥ï2ÔºöÂ¶ÇÊûúÂêçÁß∞‰∏çÂåπÈÖçÔºåÂ∞ùËØïÈÄöËøáURLÂåπÈÖç
          const normalizeUrl = (url) => {
            if (!url) return '';
            return url.replace(/^https?:\/\//, '')
                     .replace(/^www\./, '')
                     .replace(/\/$/, '')
                     .toLowerCase()
                     .trim();
          };
          
          const sourceUrlNormalized = normalizeUrl(source.sourceUrl);
          
          // ÈÅçÂéÜÊâÄÊúâËÆ¢ÈòÖÔºåÊØîËæÉURL
          for (const subName in userSubscriptionsMap) {
            const sub = userSubscriptionsMap[subName];
            const subUrlNormalized = normalizeUrl(sub.sourceUrl);
            
            if (subUrlNormalized && sourceUrlNormalized && subUrlNormalized === sourceUrlNormalized) {
              isSubscribed = true;
              break;
            }
          }
        }
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        // Ê£ÄÊü•ÊòØÂê¶È™åËØÅ‰∏çÈÄöËøá
        const isValid = source.isValid !== false; // Â¶ÇÊûú isValid ÊòØ falseÔºåÂàô‰∏∫Êó†Êïà
        const isInvalid = source.isValid === false;
        
        // Â§ÑÁêÜÈ™åËØÅÁªìÊûú
        let validityHtml = '';
        if (source.isValid === true) {
          validityHtml = '<span class="source-validity valid" title="Â∑≤È™åËØÅÊúâÊïà">‚úì ÊúâÊïà</span>';
        } else if (source.isValid === false) {
          const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
          validityHtml = `<span class="source-validity invalid"${errorMsg}>‚úó Êó†Êïà</span>`;
        } else {
          validityHtml = '<span class="source-validity validating">È™åËØÅ‰∏≠...</span>';
        }
        
        // Â¶ÇÊûúÈ™åËØÅ‰∏çÈÄöËøáÔºåÊ∑ªÂä† invalid-row Á±ªÂπ∂Á¶ÅÁî®Â§çÈÄâÊ°Ü
        const rowClass = isInvalid ? 'invalid-row' : '';
        const checkboxDisabled = isInvalid ? 'disabled' : '';
        const checkboxChecked = isInvalid ? '' : (isSubscribed ? 'checked' : '');
        
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${idx}" data-tab="${tabIndex}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChangeInTab(this, ${tabIndex})">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'Â∑≤ËÆ¢ÈòÖ' : 'Êú™ËÆ¢ÈòÖ'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      // Ê∏≤ÊüìÊó†ÊïàÁöÑ‰ø°ÊÅØÊ∫ê
      const invalidRows = invalidSources.map((source, idx) => {
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
        const validityHtml = `<span class="source-validity invalid"${errorMsg}>‚úó Êó†Êïà</span>`;
        
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr class="invalid-row">
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" disabled>
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status not-subscribed">Êú™ËÆ¢ÈòÖ</span>
            </td>
          </tr>
        `;
      }).join('');
      
      tbody.innerHTML = validRows + invalidRows;
      
      // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
      const statsEl = document.getElementById(`recommendationsStats-${tabIndex}`);
      if (statsEl) {
        const validCount = validSources.length;
        const invalidCount = invalidSources.length;
        const totalCount = sources.length;
        statsEl.textContent = `ÊòæÁ§∫ ${validCount} ‰∏™ÊúâÊïà‰ø°ÊÅØÊ∫ê${invalidCount > 0 ? `Ôºå${invalidCount} ‰∏™Êó†Êïà‰ø°ÊÅØÊ∫ê` : ''} / ÂÖ± ${totalCount} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
    }

    // ÂàáÊç¢ÊòæÁ§∫/ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê
    function toggleInvalidSources(tabIndex) {
      // ÂàáÊç¢Áä∂ÊÄÅ
      window[`showInvalidSources_${tabIndex}`] = !(window[`showInvalidSources_${tabIndex}`] || false);
      
      // Êõ¥Êñ∞Ë°®Ê†ºÁöÑshow-invalidÁ±ª
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      if (recommendationsTable) {
        if (window[`showInvalidSources_${tabIndex}`]) {
          recommendationsTable.classList.add('show-invalid');
        } else {
          recommendationsTable.classList.remove('show-invalid');
        }
      }
      
      // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      if (toggleText) {
        toggleText.textContent = window[`showInvalidSources_${tabIndex}`] ? 'ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê' : 'ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê';
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ËøáÊª§Êé®Ëçê‰ø°ÊÅØÊ∫ê
    function filterRecommendationsInTab(tabIndex) {
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) return;
      const history = JSON.parse(panel.dataset.history || '{}');
      if (history.recommended_sources) {
        renderRecommendationsInTab(tabIndex, history.recommended_sources);
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    async function toggleSelectAllInTab(tabIndex, checkbox) {
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:not(:disabled)`);
      const isChecked = checkbox.checked;
      
      // ÂÖàÊõ¥Êñ∞ÊâÄÊúâ checkbox ÁöÑÁä∂ÊÄÅ
      checkboxes.forEach(cb => {
        cb.checked = isChecked;
      });
      
      // Â¶ÇÊûúÂÖ®ÈÄâÔºåËá™Âä®ËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
      if (isChecked) {
        console.log(`üìã ÂÖ®ÈÄâÔºöÂºÄÂßãËÆ¢ÈòÖ ${checkboxes.length} ‰∏™‰ø°ÊÅØÊ∫ê...`);
        
        // Êî∂ÈõÜÊâÄÊúâË¶ÅËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê
        const sourcesToSubscribe = [];
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              sourcesToSubscribe.push(source);
            } catch (e) {
              console.error('Ëß£Êûê‰ø°ÊÅØÊ∫êÊï∞ÊçÆÂ§±Ë¥•:', e);
            }
          }
        }
        
        if (sourcesToSubscribe.length === 0) {
          console.warn('‚ö†Ô∏è  Ê≤°ÊúâÂèØËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê');
          return;
        }
        
        // ÊâπÈáèËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: sourcesToSubscribe })
          });
          
          const result = await response.json();
          
          if (result.success) {
            console.log(`‚úÖ ÊàêÂäüËÆ¢ÈòÖ ${sourcesToSubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`);
            showMessage(`Â∑≤ËÆ¢ÈòÖ ${sourcesToSubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`, 'success');
            
            // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Áä∂ÊÄÅ
            await loadUserSubscriptions();
            
            // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∑≤ËÆ¢ÈòÖÁöÑ‰ºöËá™Âä®ÈÄâ‰∏≠Ôºâ
            const panel = document.getElementById(`panel-${tabIndex}`);
            if (panel) {
              const history = JSON.parse(panel.dataset.history || '{}');
              if (history.recommended_sources) {
                await renderRecommendationsInTab(tabIndex, history.recommended_sources);
              }
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨‰ª•ÊòæÁ§∫Êñ∞ÂàõÂª∫ÁöÑ‰∏ªÈ¢ò
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö ÊâπÈáèËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
          } else {
            console.error('‚ùå ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•:', result.message);
            showMessage(result.message || 'ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•', 'error');
            // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
            checkboxes.forEach(cb => cb.checked = false);
            checkbox.checked = false;
          }
        } catch (error) {
          console.error('‚ùå ÊâπÈáèËÆ¢ÈòÖÂºÇÂ∏∏:', error);
          showMessage('ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
          // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
          checkboxes.forEach(cb => cb.checked = false);
          checkbox.checked = false;
        }
      } else {
        // Â¶ÇÊûúÂèñÊ∂àÂÖ®ÈÄâÔºåÂèñÊ∂àËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
        console.log(`üìã ÂèñÊ∂àÂÖ®ÈÄâÔºöÂºÄÂßãÂèñÊ∂àËÆ¢ÈòÖ ${checkboxes.length} ‰∏™‰ø°ÊÅØÊ∫ê...`);
        
        // Ëé∑Âèñ‰∏ªÈ¢òÂÖ≥ÈîÆËØç
        const panel = document.getElementById(`panel-${tabIndex}`);
        const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
        const topicKeywords = history.topic_keywords || '';
        
        // ÈÄê‰∏™ÂèñÊ∂àËÆ¢ÈòÖÔºàÂõ†‰∏∫ DELETE API ‰∏ÄÊ¨°Âè™ËÉΩÂà†Èô§‰∏Ä‰∏™Ôºâ
        let successCount = 0;
        let failCount = 0;
        let totalDeletedArticles = 0;
        
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              const sourceName = encodeURIComponent(source.sourceName);
              
              // ÊûÑÂª∫Âà†Èô§ URLÔºåÂåÖÂê´ topicKeywords
              let deleteUrl = `${API_BASE_URL}/user/subscriptions/${sourceName}`;
              if (topicKeywords && topicKeywords.trim()) {
                deleteUrl += `?topicKeywords=${encodeURIComponent(topicKeywords.trim())}`;
              }
              
              const response = await fetch(deleteUrl, {
                method: 'DELETE',
                headers: getHeaders()
              });
              
              const result = await response.json();
              
              if (result.success) {
                successCount++;
                totalDeletedArticles += (result.deletedArticleCount || 0);
              } else {
                failCount++;
              }
            } catch (e) {
              console.error('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•:', e);
              failCount++;
            }
          }
        }
        
        if (successCount > 0) {
          console.log(`‚úÖ ÊàêÂäüÂèñÊ∂àËÆ¢ÈòÖ ${successCount} ‰∏™‰ø°ÊÅØÊ∫ê`);
          let message = `Â∑≤ÂèñÊ∂àËÆ¢ÈòÖ ${successCount} ‰∏™‰ø°ÊÅØÊ∫ê`;
          if (totalDeletedArticles > 0) {
            message += `ÔºåÂ∑≤Âà†Èô§ ${totalDeletedArticles} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†`;
          }
          if (failCount > 0) {
            message += `Ôºå${failCount} ‰∏™Â§±Ë¥•`;
            showMessage(message, 'warning');
          } else {
            showMessage(message, 'success');
          }
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Áä∂ÊÄÅ
          await loadUserSubscriptions();
          
          // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
          const panel = document.getElementById(`panel-${tabIndex}`);
          if (panel) {
            const history = JSON.parse(panel.dataset.history || '{}');
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
          }
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâπÈáèÂèñÊ∂àËÆ¢ÈòÖÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          console.error('‚ùå ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•');
          showMessage('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
          checkboxes.forEach(cb => cb.checked = true);
          checkbox.checked = true;
        }
      }
    }

    // Â§ÑÁêÜÂçï‰∏™‰ø°ÊÅØÊ∫êÂ§çÈÄâÊ°ÜÂèòÂåñÔºàÊóßÁâàÊé®ËçêÊòæÁ§∫Ôºâ
    async function handleSourceCheckboxChange(checkbox) {
      if (checkbox.disabled) return;
      
      const sourceJson = checkbox.dataset.source;
      if (!sourceJson) return;
      
      const source = JSON.parse(sourceJson);
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true; // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
      
      try {
        if (isChecked) {
          // ËÆ¢ÈòÖ
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: [source] })
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadUserSubscriptions();
            renderRecommendations(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          } else {
            checkbox.checked = false; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        } else {
          // ÂèñÊ∂àËÆ¢ÈòÖÔºàÂêåÊó∂Âà†Èô§ËØ•‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Ôºâ
          // Ê≥®ÊÑèÔºöÊóßÁâàÊé®ËçêÊòæÁ§∫ÂèØËÉΩÊ≤°Êúâ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÊâÄ‰ª•‰∏ç‰º†ÈÄí topicKeywords
          const sourceName = encodeURIComponent(source.sourceName);
          const response = await fetch(`${API_BASE_URL}/user/subscriptions/${sourceName}`, {
            method: 'DELETE',
            headers: getHeaders()
          });
          
          const result = await response.json();
          
          if (result.success) {
            let message = result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÊàêÂäü';
            if (result.deletedArticleCount > 0) {
              message += `ÔºåÂ∑≤Âà†Èô§ ${result.deletedArticleCount} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†`;
            }
            showMessage(message, 'success');
            
            await loadUserSubscriptions();
            renderRecommendations(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          } else {
            checkbox.checked = true; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        }
      } catch (error) {
        // ÊÅ¢Â§çÁä∂ÊÄÅ
        checkbox.checked = !isChecked;
        showMessage('Êìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        checkbox.disabled = false;
      }
    }

    // Â§ÑÁêÜÂçï‰∏™‰ø°ÊÅØÊ∫êÂ§çÈÄâÊ°ÜÂèòÂåñÔºàÈ°µÁ≠æ‰∏≠Ôºâ
    async function handleSourceCheckboxChangeInTab(checkbox, tabIndex) {
      if (checkbox.disabled) return;
      
      const sourceJson = checkbox.dataset.source;
      if (!sourceJson) return;
      
      const source = JSON.parse(sourceJson);
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true; // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
      
      try {
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (!panel) return;
        
        const history = JSON.parse(panel.dataset.history || '{}');
        const topicKeywords = history.topic_keywords || '';
        
        if (isChecked) {
          // ËÆ¢ÈòÖÔºàÂøÖÈ°ªÂåÖÂê´‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºâ
          if (!topicKeywords || !topicKeywords.trim()) {
            checkbox.checked = false;
            showMessage('Êó†Ê≥ïËÆ¢ÈòÖÔºöÁº∫Â∞ë‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
            checkbox.disabled = false;
            return;
          }
          
          const subscriptionData = {
            ...source,
            topicKeywords: topicKeywords
          };
          
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: [subscriptionData] })
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadUserSubscriptions();
            // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨‰ª•ÊòæÁ§∫Êñ∞ÂàõÂª∫ÁöÑ‰∏ªÈ¢ò
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
          } else {
            checkbox.checked = false; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        } else {
          // ÂèñÊ∂àËÆ¢ÈòÖÔºàÂêåÊó∂Âà†Èô§ËØ•‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Ôºâ
          const sourceName = encodeURIComponent(source.sourceName);
          let deleteUrl = `${API_BASE_URL}/user/subscriptions/${sourceName}`;
          
          // Â¶ÇÊûúÊúâ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÊ∑ªÂä†Âà∞Êü•ËØ¢ÂèÇÊï∞
          if (topicKeywords && topicKeywords.trim()) {
            deleteUrl += `?topicKeywords=${encodeURIComponent(topicKeywords.trim())}`;
          }
          
          const response = await fetch(deleteUrl, {
            method: 'DELETE',
            headers: getHeaders()
          });
          
          const result = await response.json();
          
          if (result.success) {
            let message = result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÊàêÂäü';
            if (result.deletedArticleCount > 0) {
              message += `ÔºåÂ∑≤Âà†Èô§ ${result.deletedArticleCount} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†`;
            }
            showMessage(message, 'success');
            
            await loadUserSubscriptions();
            // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö ÂèñÊ∂àËÆ¢ÈòÖÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
          } else {
            checkbox.checked = true; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        }
      } catch (error) {
        // ÊÅ¢Â§çÁä∂ÊÄÅ
        checkbox.checked = !isChecked;
        showMessage('Êìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        checkbox.disabled = false;
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫êÔºà‰øùÁïôÁî®‰∫éÂÖºÂÆπÔºå‰ΩÜ‰∏çÂÜç‰ΩøÁî®Ôºâ
    async function subscribeSelectedInTab(tabIndex) {
      // Âè™ÈÄâÊã©Êú™Á¶ÅÁî®ÁöÑÂ§çÈÄâÊ°ÜÔºàÂç≥ÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫êÔºâ
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:checked:not(:disabled)`);
      if (checkboxes.length === 0) {
        showMessage('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }

      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) return;
      
      const history = JSON.parse(panel.dataset.history || '{}');
      if (!history.recommended_sources) return;
      
      // ËøáÊª§ÊéâÊó†ÊïàÁöÑ‰ø°ÊÅØÊ∫ê
      const sources = Array.from(checkboxes)
        .map(cb => {
          const idx = parseInt(cb.dataset.index);
          return history.recommended_sources[idx];
        })
        .filter(source => source.isValid !== false); // Âè™‰øùÁïôÊúâÊïàÁöÑÊàñÊú™È™åËØÅÁöÑ‰ø°ÊÅØÊ∫ê

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: sources })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${sources.length} ‰∏™‰ø°ÊÅØÊ∫ê`, 'success');
          await loadUserSubscriptions();
          // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∑≤ËÆ¢ÈòÖÁöÑ‰ºöËá™Âä®ÈÄâ‰∏≠ÔºåÂõ†‰∏∫renderRecommendationsInTab‰ºöÊ†πÊçÆisSubscribedËÆæÁΩÆcheckedÂ±ûÊÄßÔºâ
          if (history.recommended_sources) {
            await renderRecommendationsInTab(tabIndex, history.recommended_sources);
          }
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      }
    }


    // Âä†ËΩΩÊé®ËçêÂéÜÂè≤Ôºà‰øùÁïôÂêëÂêéÂÖºÂÆπÔºâ
    async function loadRecommendationHistory() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success && result.data) {
          const history = result.data;
          
          // ÊòæÁ§∫Êé®ËçêËøáÁ®ãÊó•Âøó
          if (history.process_logs && history.process_logs.length > 0) {
            savedProcessLogs = history.process_logs;
            document.getElementById('deepseekProcessSection').style.display = 'block';
            renderProcessLogs(history.process_logs);
          }
          
          // ÊòæÁ§∫Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†º
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            recommendedSources = history.recommended_sources;
            await loadUserSubscriptions();
            renderRecommendations();
            document.getElementById('recommendationsSection').style.display = 'block';
            
            // Â¶ÇÊûúÊúâ‰øùÂ≠òÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÊòæÁ§∫Âú®ËæìÂÖ•Ê°Ü‰∏≠
            if (history.topic_keywords) {
              document.getElementById('topicInput').value = history.topic_keywords;
            }
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', error);
      }
    }

    // Âä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
    async function loadArticlesTopicsTabs() {
      console.log('üìö ÂºÄÂßãÂä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
      
      try {
        // Âä†ËΩΩÁî®Êà∑‰∏ªÈ¢òÂàóË°®Ôºà‰∏ç‰ΩøÁî®ÁºìÂ≠òÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆÔºâ
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        
        if (!topicsResponse.ok) {
          throw new Error(`HTTP ${topicsResponse.status}: ${topicsResponse.statusText}`);
        }
        
        const topicsResult = await topicsResponse.json();
        console.log('üìã ‰∏ªÈ¢òÂàóË°®ÂìçÂ∫î:', topicsResult);
        
        if (!topicsResult.success || !topicsResult.data || topicsResult.data.length === 0) {
          console.log('‚ÑπÔ∏è  Áî®Êà∑Ê≤°Êúâ‰∏ªÈ¢òÔºåÊòæÁ§∫ÊèêÁ§∫');
          document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
          document.getElementById('articlesNoTopicsHint').style.display = 'block';
          return;
        }
        
        userTopics = topicsResult.data;
        console.log(`‚úÖ ÊâæÂà∞ ${userTopics.length} ‰∏™‰∏ªÈ¢ò`);
        
        document.getElementById('articlesTopicsTabsContainer').style.display = 'block';
        document.getElementById('articlesNoTopicsHint').style.display = 'none';
        
        // Âä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤Ôºà‰∏ç‰ΩøÁî®ÁºìÂ≠òÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆÔºâ
        try {
          const historyResponse = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          
          if (historyResponse.ok) {
            const historyResult = await historyResponse.json();
            
            if (historyResult.success && historyResult.data) {
              console.log(`üìñ Âä†ËΩΩ‰∫Ü ${historyResult.data.length} Êù°Êé®ËçêÂéÜÂè≤`);
              historyResult.data.forEach(history => {
                if (history.recommended_sources) {
                  topicRecommendationHistory[history.topic_keywords] = {
                    recommended_sources: Array.isArray(history.recommended_sources) 
                      ? history.recommended_sources 
                      : (typeof history.recommended_sources === 'string' 
                          ? JSON.parse(history.recommended_sources) 
                          : [])
                  };
                }
              });
            }
          } else {
            console.warn('‚ö†Ô∏è  Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', historyResponse.status);
          }
        } catch (historyError) {
          console.warn('‚ö†Ô∏è  Âä†ËΩΩÊé®ËçêÂéÜÂè≤Êó∂Âá∫Èîô:', historyError);
          // ÁªßÁª≠ÊâßË°åÔºå‰∏ç‰∏≠Êñ≠ÊµÅÁ®ã
        }
        
        // Ê∏≤Êüì‰∏ªÈ¢òÈ°µÁ≠æÔºà‰∏∫ÊâÄÊúâ‰∏ªÈ¢òÂàõÂª∫È°µÁ≠æÔºåÂç≥‰ΩøÊ≤°ÊúâÊé®ËçêÂéÜÂè≤Ôºâ
        renderArticlesTopicsTabs();
        
        // ÂàùÂßãÂåñÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
        if (userTopics.length > 0) {
          window.currentArticlesTopicIndex = 0;
          console.log(`‚úÖ ‰∏ªÈ¢òÈ°µÁ≠æÂä†ËΩΩÂÆåÊàêÔºåÂÖ± ${userTopics.length} ‰∏™‰∏ªÈ¢òÔºåÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò`);
          
          // ÊâìÂç∞ÊØè‰∏™‰∏ªÈ¢òÁöÑÈ°µÁ≠æÁä∂ÊÄÅ
          userTopics.forEach((topic, index) => {
            const hasHistory = topicRecommendationHistory[topic.topic_keywords]?.recommended_sources?.length > 0;
            console.log(`   - ‰∏ªÈ¢ò ${index + 1}: "${topic.topic_keywords}" ${hasHistory ? '(ÊúâÊé®ËçêÂéÜÂè≤)' : '(Êó†Êé®ËçêÂéÜÂè≤Ôºå‰ΩÜÈ°µÁ≠æÂ∑≤ÂàõÂª∫)'}`);
          });
        }
      } catch (error) {
        console.error('‚ùå Âä†ËΩΩÊñáÁ´†‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•:', error);
        console.error('   ÈîôËØØËØ¶ÊÉÖ:', error.message);
        console.error('   ÈîôËØØÂ†ÜÊ†à:', error.stack);
        document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
        document.getElementById('articlesNoTopicsHint').style.display = 'block';
      }
    }
    
    // Ê∏≤ÊüìÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
    function renderArticlesTopicsTabs() {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';
      
      // ‰∏∫ÊØè‰∏™‰∏ªÈ¢òÂàõÂª∫È°µÁ≠æÂíåÂÜÖÂÆπÈù¢Êùø
      userTopics.forEach((topic, index) => {
        const topicKeywords = topic.topic_keywords;
        
        // ÂàõÂª∫È°µÁ≠æ
        const tab = document.createElement('button');
        tab.className = 'topic-tab' + (index === 0 ? ' active' : '');
        tab.textContent = topicKeywords;
        tab.onclick = () => switchArticlesTopicTab(index);
        tabsHeader.appendChild(tab);
        
        // ÂàõÂª∫ÂÜÖÂÆπÈù¢Êùø
        const panel = document.createElement('div');
        panel.className = 'topic-tab-panel' + (index === 0 ? ' active' : '');
        panel.id = `articlesTopicPanel-${index}`;
        panel.innerHTML = `
          <!-- ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá -->
          <div class="source-filter-cards" id="sourceFilterCards-${index}">
            <div class="source-card active" data-source="all" onclick="filterArticlesBySourceInTab(${index}, null)">
              <span>ÂÖ®ÈÉ®</span>
            </div>
            <!-- Âä®ÊÄÅÂä†ËΩΩ‰ø°ÊÅØÊ∫ê -->
            <!-- Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†checkbox -->
            <div class="relevant-filter-checkbox">
              <input type="checkbox" id="relevantFilterCheckbox-${index}" ${showOnlyRelevantArticles ? 'checked' : ''} onchange="toggleRelevantFilter(${index})">
              <label for="relevantFilterCheckbox-${index}">Âè™ÁúãÁõ∏ÂÖ≥</label>
            </div>
          </div>

          <!-- Âà∑Êñ∞ÊåâÈíÆÔºàÁßªÂä®Á´Ø‰∏∫ÊµÆÂä®ÊåâÈíÆÔºâ -->
          <button class="btn-refresh-now" onclick="refreshNewsNow(${index})" id="refreshNowBtn-${index}">
            <span>üîÑ</span> Á´ãÂç≥Âà∑Êñ∞
          </button>

          <!-- ÊñáÁ´†ÂàóË°®ËßÜÂõæ -->
          <div id="articlesListView-${index}" class="articles-list-view">
            <div id="articlesList-${index}" class="articles-list">
              <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
          </div>
        `;
        tabsContent.appendChild(panel);
      });
      
      // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      if (userTopics.length > 0) {
        currentTopicFilter = userTopics[0].topic_keywords;
        switchArticlesTopicTab(0);
      }
    }
    
    // ÂàáÊç¢ÊñáÁ´†‰∏ªÈ¢òÈ°µÁ≠æ
    function switchArticlesTopicTab(index) {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // Êõ¥Êñ∞È°µÁ≠æÁä∂ÊÄÅ
      Array.from(tabsHeader.children).forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÈù¢ÊùøÁä∂ÊÄÅ
      Array.from(tabsContent.children).forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
      
      // ÈáçÁΩÆÊó•ÊúüËøáÊª§Âô®ÔºàÂàáÊç¢‰∏ªÈ¢òÊó∂ÈáçÁΩÆ‰∏∫"ÂÖ®ÈÉ®Êó•Êúü"Ôºâ
      currentDateFilter = 'all';
      
      // Êõ¥Êñ∞ÂΩìÂâç‰∏ªÈ¢òËøáÊª§ÂíåÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
      if (userTopics[index]) {
        currentTopicFilter = userTopics[index].topic_keywords;
        window.currentArticlesTopicIndex = index; // ‰øùÂ≠òÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
        // ÈáçÊñ∞Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†
        loadArticlesForTopic(currentTopicFilter, index);
      }
    }

    // ÂàáÊç¢"Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†"ËøáÊª§
    function toggleRelevantFilter(tabIndex) {
      // Êõ¥Êñ∞ÂÖ®Â±ÄÁä∂ÊÄÅ
      showOnlyRelevantArticles = document.getElementById(`relevantFilterCheckbox-${tabIndex}`).checked;
      
      // ÂêåÊ≠•ÊâÄÊúâÈ°µÁ≠æÁöÑcheckboxÁä∂ÊÄÅÔºàÂõ†‰∏∫ÊâÄÊúâÈ°µÁ≠æÂÖ±‰∫´Áä∂ÊÄÅÔºâ
      userTopics.forEach((topic, index) => {
        const checkbox = document.getElementById(`relevantFilterCheckbox-${index}`);
        if (checkbox) {
          checkbox.checked = showOnlyRelevantArticles;
        }
      });
      
      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : tabIndex;
      
      // ÈáçÊñ∞Â∫îÁî®ËøáÊª§Âπ∂Ê∏≤ÊüìÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÊñáÁ´†ÂàóË°®
      if (currentTopicFilter && userTopics[currentTabIndex]) {
        applyFiltersForTab(currentTopicFilter, currentTabIndex);
      } else {
        // Â¶ÇÊûúÊ≤°Êúâ‰∏ªÈ¢òËøáÊª§Ôºå‰ΩøÁî®applyFilters
        applyFilters();
      }
    }
    
    // ‰∏∫ÁâπÂÆö‰∏ªÈ¢òÂä†ËΩΩÊñáÁ´†
    async function loadArticlesForTopic(topicKeywords, tabIndex, forceRefresh = false) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // Ëé∑ÂèñËØ•‰∏ªÈ¢òÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
      const recommendedSources = topicRecommendationHistory[topicKeywords]?.recommended_sources || [];
      const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
      
      // Â¶ÇÊûúÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
      if (recommendedSources.length === 0) {
        console.log(`‚ÑπÔ∏è  ‰∏ªÈ¢ò "${topicKeywords}" ËøòÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ`);
        articlesListEl.innerHTML = `
          <div class="empty-state">
            <p>ËØ•‰∏ªÈ¢òËøòÊ≤°ÊúâËé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê</p>
            <p style="margin-top: 12px; font-size: 13px; color: #999;">
              ËØ∑ÂâçÂæÄ"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ôºå‰∏∫ËØ•‰∏ªÈ¢òËé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê
            </p>
          </div>
        `;
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStatsForTab([], tabIndex);
        // Ê∏ÖÁ©∫‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂè™‰øùÁïô"ÂÖ®ÈÉ®"Ôºâ
        loadSourceCardsForTab([], tabIndex);
        return;
      }
      
      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      articlesListEl.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏≠...</div>';
      
      try {
        // Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Ôºà‰º†ÈÄí topicKeywords ÂèÇÊï∞Ôºâ
        let url = `${API_BASE_URL}/news/list`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();
        
        if (result.success) {
          const data = result.data;
          
          // Â∞ÜÊâÄÊúâÊñáÁ´†Â±ïÂπ≥Âà∞‰∏Ä‰∏™Êï∞ÁªÑ‰∏≠
          let topicArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              const article = {
                ...news,
                date: day.date
              };
              
              // Âè™ÂåÖÂê´Â±û‰∫éËØ•‰∏ªÈ¢òÊé®Ëçê‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Ôºå‰∏î‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂåπÈÖç
              if ((sourceNames.length === 0 || sourceNames.includes(news.source)) &&
                  (!news.topic_keywords || news.topic_keywords === topicKeywords)) {
                topicArticles.push(article);
              }
            });
          });
          
          // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
          updateStatsForTab(topicArticles, tabIndex);
          
          // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂè™ÊòæÁ§∫ËØ•‰∏ªÈ¢òÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
          const sources = [...new Set(topicArticles.map(a => a.source))];
          loadSourceCardsForTab(sources, tabIndex);
          
          // Â≠òÂÇ®ËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Êï∞ÊçÆ
          if (!window.topicArticlesData) {
            window.topicArticlesData = {};
          }
          window.topicArticlesData[topicKeywords] = topicArticles;
          
          // Âä†ËΩΩÊó•Êúü‰æßËæπÊ†è
          loadDateSidebar(topicArticles);
          
          // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
          applyFiltersForTab(topicKeywords, tabIndex);
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</p></div>';
      }
    }
    
    // Êõ¥Êñ∞ÁâπÂÆöÈ°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØ
    function updateStatsForTab(articles, tabIndex) {
      const totalEl = document.getElementById(`totalArticles-${tabIndex}`);
      const dateEl = document.getElementById(`publishDateRange-${tabIndex}`);
      const recentEl = document.getElementById(`recentArticlesCount-${tabIndex}`);
      if (totalEl) totalEl.textContent = articles.length;
      if (dateEl) dateEl.textContent = calculatePublishDateRange(articles);
      if (recentEl) recentEl.textContent = calculateRecentArticlesCount(articles);
    }
    
    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÂä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
    function loadSourceCardsForTab(sources, tabIndex) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // ‰øùÂ≠òcheckboxÂÖÉÁ¥†ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
      const existingCheckbox = container.querySelector('.relevant-filter-checkbox');
      
      // Ê∏ÖÁ©∫ÊâÄÊúâÂç°ÁâáÔºåÂåÖÊã¨"ÂÖ®ÈÉ®"Ôºå‰ΩÜ‰øùÁïôcheckbox
      container.innerHTML = '';
      
      // ÈáçÊñ∞ÂàõÂª∫"ÂÖ®ÈÉ®"Âç°Áâá
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>ÂÖ®ÈÉ®</span>';
      allCard.onclick = () => filterArticlesBySourceInTab(tabIndex, null);
      container.appendChild(allCard);
      
      // Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂç°Áâá
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySourceInTab(tabIndex, source);
        container.appendChild(card);
      });
      
      // ÈáçÊñ∞Ê∑ªÂä†checkboxÔºàÂ¶ÇÊûú‰πãÂâçÂ≠òÂú®Ôºâ
      if (existingCheckbox) {
        const checkboxContainer = document.createElement('div');
        checkboxContainer.className = 'relevant-filter-checkbox';
        checkboxContainer.innerHTML = `
          <input type="checkbox" id="relevantFilterCheckbox-${tabIndex}" ${showOnlyRelevantArticles ? 'checked' : ''} onchange="toggleRelevantFilter(${tabIndex})">
          <label for="relevantFilterCheckbox-${tabIndex}">Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†</label>
        `;
        container.appendChild(checkboxContainer);
      }
    }
    
    // Âú®ÁâπÂÆöÈ°µÁ≠æ‰∏≠Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
    function filterArticlesBySourceInTab(tabIndex, source) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // Êõ¥Êñ∞Âç°ÁâáÁä∂ÊÄÅ
      container.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      // Â∫îÁî®ËøáÊª§
      if (currentTopicFilter) {
        applyFiltersForTab(currentTopicFilter, tabIndex, source);
      }
    }
    
    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÂ∫îÁî®ËøáÊª§ÂíåÊêúÁ¥¢
    function applyFiltersForTab(topicKeywords, tabIndex, sourceFilter = null) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // Ëé∑ÂèñËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Êï∞ÊçÆ
      const topicArticles = window.topicArticlesData?.[topicKeywords] || [];
      let filtered = [...topicArticles];
      
      // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
      const sourceInput = document.querySelector(`#sourceFilterCards-${tabIndex} .source-card.active`);
      const activeSource = sourceInput?.getAttribute('data-source');
      if (sourceFilter !== null) {
        // ‰ΩøÁî®‰º†ÂÖ•ÁöÑsourceFilter
        if (sourceFilter !== 'all') {
          filtered = filtered.filter(a => a.source === sourceFilter);
        }
      } else if (activeSource && activeSource !== 'all') {
        filtered = filtered.filter(a => a.source === activeSource);
      }
      
      // ÊåâÁõ∏ÂÖ≥ÊÄßËøáÊª§ÔºàÂè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†Ôºâ
      if (showOnlyRelevantArticles) {
        filtered = filtered.filter(a => a.is_relevant_to_topic === true);
      }
      
      // ÊåâÊó•ÊúüËøáÊª§
      if (currentDateFilter && currentDateFilter !== 'all') {
        filtered = filtered.filter(a => {
          const articleDate = new Date(a.publish_date).toDateString();
          return articleDate === currentDateFilter;
        });
      }
      
      // Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
      renderArticlesForTab(filtered, tabIndex);
    }
    
    // Ê†ºÂºèÂåñÊó•Êúü‰∏∫ÂÆåÊï¥Ê†ºÂºèÔºàÁî®‰∫éÊó•ÊúüÊ†áÈ¢òÔºâ
    function formatDateFull(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
      const weekday = weekdays[date.getDay()];
      
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (date.toDateString() === today.toDateString()) {
        return `‰ªäÂ§© (${year}Âπ¥${month}Êúà${day}Êó•)`;
      } else if (date.toDateString() === yesterday.toDateString()) {
        return `Êò®Â§© (${year}Âπ¥${month}Êúà${day}Êó•)`;
      } else {
        return `${year}Âπ¥${month}Êúà${day}Êó• ÊòüÊúü${weekday}`;
      }
    }

    // Ê†ºÂºèÂåñÊó•Êúü‰∏∫ÁÆÄÁü≠Ê†ºÂºèÔºàÁî®‰∫éÊñáÁ´†Âç°ÁâáÔºâ
    function formatDateShort(dateStr) {
      const date = new Date(dateStr);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      return `${month}Êúà${day}Êó•`;
    }

    // ÊåâÊó•ÊúüÂàÜÁªÑÊñáÁ´†
    function groupArticlesByDate(articles) {
      const groups = {};
      
      articles.forEach(article => {
        const date = new Date(article.publish_date);
        const dateKey = date.toDateString(); // ‰ΩøÁî®Êó•ÊúüÂ≠óÁ¨¶‰∏≤‰Ωú‰∏∫ÈîÆ
        
        if (!groups[dateKey]) {
          groups[dateKey] = {
            date: date,
            articles: []
          };
        }
        
        groups[dateKey].articles.push(article);
      });
      
      // ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂπ∂ÊåâÊó•ÊúüÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
      return Object.values(groups).sort((a, b) => b.date - a.date);
    }

    // ========== Êó•ÊúüËøáÊª§‰æßËæπÊ†èÂäüËÉΩ ==========
    let currentDateFilter = 'all'; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó•ÊúüËøáÊª§Âô®
    
    // Âä†ËΩΩÊó•Êúü‰æßËæπÊ†è
    function loadDateSidebar(articles) {
      const dateSidebarList = document.getElementById('dateSidebarList');
      if (!dateSidebarList) return;
      
      // ‰ªéÊñáÁ´†‰∏≠ÊèêÂèñÊâÄÊúâÂîØ‰∏ÄÊó•Êúü
      const dateGroups = groupArticlesByDate(articles);
      
      // ÁîüÊàêÊó•ÊúüÂàóË°®HTML
      let html = `<div class="date-sidebar-item all-dates ${currentDateFilter === 'all' ? 'active' : ''}" data-date="all" onclick="filterByDate('all')">ÂÖ®ÈÉ®Êó•Êúü</div>`;
      
      dateGroups.forEach(group => {
        const dateStr = group.date.toDateString();
        const year = group.date.getFullYear();
        const month = group.date.getMonth() + 1;
        const day = group.date.getDate();
        const displayDate = `${year}Âπ¥${month}Êúà${day}Êó•`;
        const isActive = currentDateFilter === dateStr ? 'active' : '';
        const articleCount = group.articles.length;
        
        html += `<div class="date-sidebar-item ${isActive}" data-date="${dateStr}" onclick="filterByDate('${dateStr}')" title="${articleCount}ÁØáÊñáÁ´†">${displayDate}</div>`;
      });
      
      dateSidebarList.innerHTML = html;
    }
    
    // ÊåâÊó•ÊúüËøáÊª§ÊñáÁ´†
    function filterByDate(dateStr) {
      currentDateFilter = dateStr;
      
      // Êõ¥Êñ∞Êó•Êúü‰æßËæπÊ†èÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
      const dateItems = document.querySelectorAll('.date-sidebar-item');
      dateItems.forEach(item => {
        if (item.getAttribute('data-date') === dateStr) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      
      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢Âºï
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
      
      // ÈáçÊñ∞Â∫îÁî®ËøáÊª§Âô®
      if (currentTopicFilter && userTopics && userTopics.length > 0) {
        applyFiltersForTab(currentTopicFilter, currentTabIndex);
      }
    }
    
    // ÊòæÁ§∫Êó•Êúü‰æßËæπÊ†è
    function showDateSidebar() {
      const dateSidebar = document.getElementById('dateSidebar');
      const mainContent = document.querySelector('.main-content');
      if (dateSidebar) {
        dateSidebar.style.display = 'block';
      }
      if (mainContent) {
        mainContent.classList.add('with-date-sidebar');
      }
    }
    
    // ÈöêËóèÊó•Êúü‰æßËæπÊ†è
    function hideDateSidebar() {
      const dateSidebar = document.getElementById('dateSidebar');
      const mainContent = document.querySelector('.main-content');
      if (dateSidebar) {
        dateSidebar.style.display = 'none';
      }
      if (mainContent) {
        mainContent.classList.remove('with-date-sidebar');
      }
    }
    // ========== Êó•ÊúüËøáÊª§‰æßËæπÊ†èÂäüËÉΩÁªìÊùü ==========

    // Ê∑ªÂä†ÊñáÁ´†Âà∞ÊåáÂÆöÈ°µÁ≠æ
    function addArticleToTab(tabIndex, article) {
      if (!window.topicArticlesData) {
        window.topicArticlesData = {};
      }
      if (!window.topicArticlesData[currentTopicFilter]) {
        window.topicArticlesData[currentTopicFilter] = [];
      }
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const exists = window.topicArticlesData[currentTopicFilter].some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        window.topicArticlesData[currentTopicFilter].push(article);
        
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStatsForTab(window.topicArticlesData[currentTopicFilter], tabIndex);
        
        // Êõ¥Êñ∞‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂÆûÊó∂Ê∑ªÂä†Êñ∞ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
        const currentSources = [...new Set(window.topicArticlesData[currentTopicFilter].map(a => a.source))];
        loadSourceCardsForTab(currentSources, tabIndex);
        
        // ÈáçÊñ∞Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
        applyFiltersForTab(currentTopicFilter, tabIndex);
      }
    }
    
    // Ê∑ªÂä†ÊñáÁ´†Âà∞ÂàóË°®ÔºàÈùû‰∏ªÈ¢òÈ°µÁ≠æÔºâ
    function addArticleToList(article) {
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const exists = allArticles.some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        allArticles.push(article);
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStats(allArticles);
        
        // Êõ¥Êñ∞‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂÆûÊó∂Ê∑ªÂä†Êñ∞ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
        const currentSources = [...new Set(allArticles.map(a => a.source))];
        loadSourceCards(currentSources);
        
        // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
        applyFilters();
      }
    }

    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÊ∏≤ÊüìÊñáÁ´†ÂàóË°®
    function renderArticlesForTab(articles, tabIndex) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†</p></div>';
        return;
      }
      
      // ÊåâÊó•ÊúüÂàÜÁªÑ
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // Ê∏≤ÊüìËØ•Êó•Êúü‰∏ãÁöÑÊâÄÊúâÊñáÁ´†
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">‰∏çÁõ∏ÂÖ≥</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'Êú™Áü•')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // Â§ÑÁêÜESCÈîÆÂÖ≥Èó≠ÂºπÁ™ó
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('addTopicModal');
        if (modal && modal.classList.contains('show')) {
          closeAddTopicModal();
        }
      }
    });

    // ÊòæÁ§∫Ê∂àÊÅØ
    function showMessage(text, type, containerId = 'message') {
      const messageEl = document.getElementById(containerId);
      if (!messageEl) return;
      
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }
    
    // ËΩ¨‰πâHTML
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÁõ∏ÂÖ≥ÂèòÈáè
    let curatedSources = [];
    let filteredCuratedSources = [];
    let userSubscriptionsForCurated = [];

    // ÂàáÊç¢ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÂºÄ/ÊäòÂè†
    function toggleCuratedSources() {
      const content = document.getElementById('curatedSourcesContent');
      const toggle = document.getElementById('curatedSourcesToggle');
      const isExpanded = content.style.display !== 'none';
      
      if (isExpanded) {
        content.style.display = 'none';
        toggle.textContent = '‚ñº';
      } else {
        content.style.display = 'block';
        toggle.textContent = '‚ñ≤';
        if (curatedSources.length === 0) {
          loadCuratedSources();
        }
      }
    }

    // Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    async function loadCuratedSources() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/curated-sources`, {
          headers: getHeaders()
        });
        const result = await response.json();
        
        if (result.success) {
          curatedSources = result.sources || [];
          filteredCuratedSources = [...curatedSources];
          
          // Êõ¥Êñ∞ËÆ°Êï∞
          document.getElementById('curatedSourcesCount').textContent = `(${curatedSources.length}‰∏™)`;
          
          // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
          renderCuratedSourcesStats(result.stats);
          
          // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
          renderCuratedSourcesFilters(result.stats);
          
          // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®ÔºàÁî®‰∫éÊ†áËÆ∞Â∑≤ËÆ¢ÈòÖÔºâ
          await loadUserSubscriptionsForCurated();
          
          // Ê∏≤ÊüìË°®Ê†º
          renderCuratedSourcesTable();
        } else {
          showMessage('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•: ' + (result.message || 'Êú™Áü•ÈîôËØØ'), 'error');
        }
      } catch (error) {
        showMessage('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•: ' + error.message, 'error');
        const tbody = document.getElementById('curatedSourcesTableBody');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Âä†ËΩΩÂ§±Ë¥•</td></tr>';
        }
      }
    }

    // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®ÔºàÁî®‰∫éÊ†áËÆ∞Â∑≤ËÆ¢ÈòÖÔºâ
    async function loadUserSubscriptionsForCurated() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          headers: getHeaders()
        });
        const result = await response.json();
        
        if (result.success) {
          userSubscriptionsForCurated = result.data || [];
        }
      } catch (error) {
        console.error('Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂ§±Ë¥•:', error);
      }
    }

    // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
    function renderCuratedSourcesStats(stats) {
      const statsEl = document.getElementById('curatedSourcesStats');
      if (!statsEl || !stats) return;
      
      statsEl.innerHTML = `
        <div class="stat-card">
          <h3>${curatedSources.length}</h3>
          <p>ÊÄª‰ø°ÊÅØÊ∫êÊï∞</p>
        </div>
        <div class="stat-card">
          <h3>${Object.keys(stats.byType || {}).length}</h3>
          <p>‰ø°ÊÅØÊ∫êÁ±ªÂûã</p>
        </div>
        <div class="stat-card">
          <h3>${stats.byRegion['ÂõΩÂÜÖ'] || 0}</h3>
          <p>ÂõΩÂÜÖ‰ø°ÊÅØÊ∫ê</p>
        </div>
        <div class="stat-card">
          <h3>${stats.byRegion['ÂõΩÂ§ñ'] || 0}</h3>
          <p>ÂõΩÂ§ñ‰ø°ÊÅØÊ∫ê</p>
              </div>
            `;
    }

    // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
    function renderCuratedSourcesFilters(stats) {
      // Á±ªÂûãÁ≠õÈÄâÂô®
      const typeSelect = document.getElementById('filterType');
      if (typeSelect) {
        const types = Object.keys(stats.byType || {}).sort();
        typeSelect.innerHTML = '<option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>' + 
          types.map(type => `<option value="${escapeHtml(type)}">${escapeHtml(type)} (${stats.byType[type]})</option>`).join('');
      }
      
      // ÂàÜÁ±ªÁ≠õÈÄâÂô®
      const categorySelect = document.getElementById('filterCategory');
      if (categorySelect) {
        const categories = Object.keys(stats.byCategory || {}).sort();
        categorySelect.innerHTML = '<option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>' + 
          categories.map(cat => `<option value="${escapeHtml(cat)}">${escapeHtml(cat)} (${stats.byCategory[cat]})</option>`).join('');
      }
    }

    // Á≠õÈÄâÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    function filterCuratedSources() {
      const typeFilter = document.getElementById('filterType')?.value || '';
      const categoryFilter = document.getElementById('filterCategory')?.value || '';
      const regionFilter = document.getElementById('filterRegion')?.value || '';
      const searchKeyword = (document.getElementById('searchCuratedSources')?.value || '').trim().toLowerCase();
      
      filteredCuratedSources = curatedSources.filter(source => {
        // Á±ªÂûãÁ≠õÈÄâ
        if (typeFilter && source.sourceType !== typeFilter) return false;
        // ÂàÜÁ±ªÁ≠õÈÄâ
        if (categoryFilter && source.category !== categoryFilter) return false;
        // Âú∞Âå∫Á≠õÈÄâ
        if (regionFilter && source.region !== regionFilter) return false;
        // ÂÖ≥ÈîÆËØçÊêúÁ¥¢ÔºàÂåπÈÖçÂêçÁß∞„ÄÅURL„ÄÅÊèèËø∞Ôºâ
        if (searchKeyword) {
          const nameMatch = (source.sourceName || '').toLowerCase().includes(searchKeyword);
          const urlMatch = (source.sourceUrl || '').toLowerCase().includes(searchKeyword);
          const descMatch = (source.description || '').toLowerCase().includes(searchKeyword);
          const categoryMatch = (source.category || '').toLowerCase().includes(searchKeyword);
          if (!nameMatch && !urlMatch && !descMatch && !categoryMatch) return false;
        }
        return true;
      });
      
      renderCuratedSourcesTable();
    }

    // Ê∏≤ÊüìÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êË°®Ê†º
    function renderCuratedSourcesTable() {
      const tbody = document.getElementById('curatedSourcesTableBody');
      const countEl = document.getElementById('curatedSourcesFilteredCount');
      
      if (!tbody) return;
      
      if (filteredCuratedSources.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Ê≤°ÊúâÂåπÈÖçÁöÑ‰ø°ÊÅØÊ∫ê</td></tr>';
        if (countEl) countEl.textContent = '';
        return;
      }
      
      if (countEl) {
        countEl.textContent = `ÊòæÁ§∫ ${filteredCuratedSources.length} / ÂÖ± ${curatedSources.length} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
      
      tbody.innerHTML = filteredCuratedSources.map((source, index) => {
        const isSubscribed = userSubscriptionsForCurated.some(sub => 
          sub.source_name === source.sourceName && sub.source_url === source.sourceUrl
        );
        
        const regionClass = source.region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        return `
          <tr>
            <td>
              <input type="checkbox" class="curated-source-checkbox" 
                     data-index="${index}" 
                     data-source='${escapeHtml(JSON.stringify(source))}'
                     ${isSubscribed ? 'checked disabled' : ''}>
            </td>
            <td>
              <div class="curated-source-name">${escapeHtml(source.sourceName)}</div>
              <div class="curated-source-url" title="${escapeHtml(source.sourceUrl)}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="curated-source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="curated-source-region ${regionClass}">${escapeHtml(source.region || 'Êú™Áü•')}</span>
            </td>
            <td>
              <span class="curated-source-category">${escapeHtml(source.category || 'Êú™ÂàÜÁ±ª')}</span>
            </td>
            <td class="curated-source-description" title="${escapeHtml(source.description || '')}">
              ${escapeHtml((source.description || '').substring(0, 50))}${(source.description || '').length > 50 ? '...' : ''}
            </td>
          </tr>
        `;
      }).join('');
    }

    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    function toggleSelectAllCurated() {
      const selectAll = document.getElementById('selectAllCurated');
      const selectAllHeader = document.getElementById('selectAllCuratedHeader');
      const checkboxes = document.querySelectorAll('.curated-source-checkbox:not(:disabled)');
      
      const isChecked = (selectAll && selectAll.checked) || (selectAllHeader && selectAllHeader.checked);
      checkboxes.forEach(cb => cb.checked = isChecked);
      
      // ÂêåÊ≠•‰∏§‰∏™ÂÖ®ÈÄâÊåâÈíÆ
      if (selectAll) selectAll.checked = isChecked;
      if (selectAllHeader) selectAllHeader.checked = isChecked;
    }

    // ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    async function subscribeSelectedCurated() {
      const checkboxes = document.querySelectorAll('.curated-source-checkbox:checked:not(:disabled)');
      
      if (checkboxes.length === 0) {
        showMessage('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }
      
      // Âä†ËΩΩÁî®Êà∑‰∏ªÈ¢òÂàóË°®
      let topics = [];
      try {
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const topicsResult = await topicsResponse.json();
        
        if (topicsResult.success && topicsResult.data && topicsResult.data.length > 0) {
          topics = topicsResult.data;
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®Â§±Ë¥•:', error);
      }
      
      // Â¶ÇÊûúÊ≤°Êúâ‰∏ªÈ¢òÔºåÊèêÁ§∫Áî®Êà∑ÂÖàÂàõÂª∫‰∏ªÈ¢ò
      if (topics.length === 0) {
        showMessage('ËØ∑ÂÖàÂàõÂª∫Ëá≥Â∞ë‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁÑ∂ÂêéÂÜçËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê', 'error');
        // ÂàáÊç¢Âà∞ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ÔºåËÆ©Áî®Êà∑ÂàõÂª∫‰∏ªÈ¢ò
        switchPage('subscriptions');
        return;
      }
      
      // Â¶ÇÊûúÂè™Êúâ‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁõ¥Êé•‰ΩøÁî®ËØ•‰∏ªÈ¢ò
      let selectedTopic = null;
      if (topics.length === 1) {
        selectedTopic = topics[0].topic_keywords;
      } else {
        // Â¶ÇÊûúÊúâÂ§ö‰∏™‰∏ªÈ¢òÔºåËÆ©Áî®Êà∑ÈÄâÊã©Ôºà‰ΩøÁî® Promise ÂåÖË£Ö promptÔºâ
        const topicList = topics.map((t, i) => `${i + 1}. ${t.topic_keywords}`).join('\n');
        const userInput = prompt(`ËØ∑ÈÄâÊã©Ë¶ÅÂÖ≥ËÅîÁöÑ‰∏ªÈ¢òÔºàËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºâÔºö\n\nÂèØÁî®‰∏ªÈ¢òÔºö\n${topicList}`);
        
        if (!userInput || !userInput.trim()) {
          showMessage('Â∑≤ÂèñÊ∂àËÆ¢ÈòÖ', 'info');
          return;
        }
        
        // È™åËØÅÁî®Êà∑ËæìÂÖ•ÁöÑ‰∏ªÈ¢òÊòØÂê¶Â≠òÂú®
        const matchedTopic = topics.find(t => t.topic_keywords === userInput.trim());
        if (!matchedTopic) {
          showMessage('Êó†ÊïàÁöÑ‰∏ªÈ¢òÔºåËØ∑ÈÄâÊã©ÂàóË°®‰∏≠ÁöÑ‰∏ªÈ¢ò', 'error');
          return;
        }
        
        selectedTopic = matchedTopic.topic_keywords;
      }
      
      // ÊûÑÂª∫ËÆ¢ÈòÖÊï∞ÊçÆÔºåÂåÖÂê´ topicKeywords
      const subscriptions = Array.from(checkboxes).map(cb => {
        const source = JSON.parse(cb.getAttribute('data-source'));
        return {
          sourceName: source.sourceName,
          sourceUrl: source.sourceUrl,
          sourceType: source.sourceType || 'rss',
          category: source.category || 'Êú™ÂàÜÁ±ª',
          description: source.description || '',
          region: source.region || 'ÂõΩÂ§ñ',
          topicKeywords: selectedTopic
        };
      });
      
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${subscriptions.length} ‰∏™‰ø°ÊÅØÊ∫êÂà∞‰∏ªÈ¢ò"${selectedTopic}"ÔºåÊ≠£Âú®Êî∂ÈõÜÊñáÁ´†...`, 'success');
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êË°®Ê†º
          await loadUserSubscriptions();
          await loadUserSubscriptionsForCurated();
          renderCuratedSourcesTable();
          // Ëá™Âä®Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜ
          triggerCollectAfterSubscribe(selectedTopic);
          // ÂèñÊ∂àÂÖ®ÈÄâ
          const selectAll = document.getElementById('selectAllCurated');
          const selectAllHeader = document.getElementById('selectAllCuratedHeader');
          if (selectAll) selectAll.checked = false;
          if (selectAllHeader) selectAllHeader.checked = false;
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      }
    }

    // Â§ÑÁêÜÈ°µÈù¢Â∫ïÈÉ®ÁöÑÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê
    async function handleManualAddSourceGlobal() {
      const sourceNameInput = document.getElementById('manualSourceNameGlobal');
      const sourceUrlInput = document.getElementById('manualSourceUrlGlobal');
      const addBtn = document.getElementById('manualAddBtnGlobal');
      
      if (!sourceNameInput || !sourceUrlInput || !addBtn) {
        showMessage('Êâæ‰∏çÂà∞ËæìÂÖ•Ê°Ü', 'error');
        return;
      }
      
      const sourceName = sourceNameInput.value.trim();
      const sourceUrl = sourceUrlInput.value.trim();
      
      if (!sourceName) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êÂêçÁß∞', 'error');
        sourceNameInput.focus();
        return;
      }
      
      if (!sourceUrl) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êURL', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // Ëé∑ÂèñÁî®Êà∑‰∏ªÈ¢òÂàóË°®ÔºåËá™Âä®‰ΩøÁî®Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      let topics = [];
      try {
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const topicsResult = await topicsResponse.json();
        
        if (topicsResult.success && topicsResult.data && topicsResult.data.length > 0) {
          topics = topicsResult.data;
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®Â§±Ë¥•:', error);
      }
      
      if (topics.length === 0) {
        showMessage('ËØ∑ÂÖàÂàõÂª∫Ëá≥Â∞ë‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁÑ∂ÂêéÂÜçÊ∑ªÂä†‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }
      
      // Ëá™Âä®‰ΩøÁî®Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      const topicKeywords = topics[0].topic_keywords;
      
      // Á¶ÅÁî®ÊåâÈíÆ
      addBtn.disabled = true;
      addBtn.textContent = 'Ê∑ªÂä†‰∏≠...';
      
      try {
        // Âà§Êñ≠‰ø°ÊÅØÊ∫êÁ±ªÂûã
        let sourceType = 'rss';
        const urlLower = sourceUrl.toLowerCase();
        if (!urlLower.includes('rss') && !urlLower.includes('feed') && !urlLower.includes('.xml') && !urlLower.includes('atom')) {
          sourceType = 'blog';
        }
        
        const subscriptionData = {
          sourceName: sourceName,
          sourceUrl: sourceUrl,
          sourceType: sourceType,
          topicKeywords: topicKeywords
        };
        
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: [subscriptionData] })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüÊ∑ªÂä†Âπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºö${sourceName}`, 'success');
          
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          sourceNameInput.value = '';
          sourceUrlInput.value = '';
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®
          await loadUserSubscriptions();
          
          // Âà∑Êñ∞Â∑≤Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
          await loadManualAddedSources();
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          showMessage(result.message || 'Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'Ê∑ªÂä†Âπ∂ËÆ¢ÈòÖ';
      }
    }

    // Âä†ËΩΩÂπ∂ÊòæÁ§∫ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
    async function loadManualAddedSources() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          headers: getHeaders()
        });
        const result = await response.json();

        const contentEl = document.getElementById('manualAddedSourcesContent');
        if (!contentEl) return;

        if (result.success && result.data && result.data.length > 0) {
          // ÊåâÂàõÂª∫Êó∂Èó¥ÂÄíÂ∫èÊéíÂàó
          const subscriptions = result.data.sort((a, b) => {
            const dateA = new Date(a.created_at || 0);
            const dateB = new Date(b.created_at || 0);
            return dateB - dateA;
          });

          contentEl.innerHTML = `
            <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
              <thead>
                <tr style="background-color: #f8f9fa; border-bottom: 2px solid #ddd;">
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">‰ø°ÊÅØÊ∫êÂêçÁß∞</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">URL</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">Á±ªÂûã</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">ÂÖ≥ËÅî‰∏ªÈ¢ò</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">Êìç‰Ωú</th>
                </tr>
              </thead>
              <tbody>
                ${subscriptions.map(sub => `
                  <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px; font-weight: 500; color: #333;">${escapeHtml(sub.source_name)}</td>
                    <td style="padding: 10px;">
                      <a href="${escapeHtml(sub.source_url)}" target="_blank" style="color: #8B5CF6; text-decoration: none; font-size: 12px; word-break: break-all;" title="${escapeHtml(sub.source_url)}">
                        ${escapeHtml(sub.source_url.length > 50 ? sub.source_url.substring(0, 50) + '...' : sub.source_url)}
                      </a>
                    </td>
                    <td style="padding: 10px;">
                      <span style="padding: 4px 8px; background-color: #e3f2fd; border-radius: 4px; font-size: 12px; color: #1976d2;">
                        ${escapeHtml(sub.source_type || 'rss')}
                      </span>
                    </td>
                    <td style="padding: 10px; font-size: 13px; color: #666;">${escapeHtml(sub.topic_keywords || 'Êú™Áü•')}</td>
                    <td style="padding: 10px;">
                      <button onclick="removeManualSource('${escapeHtml(sub.source_name)}', '${escapeHtml(sub.topic_keywords || '')}')" style="padding: 4px 12px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        Âà†Èô§
                      </button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        } else {
          contentEl.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ÊöÇÊó†ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê</p>';
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        const contentEl = document.getElementById('manualAddedSourcesContent');
        if (contentEl) {
          contentEl.innerHTML = '<p style="color: #f44336; text-align: center; padding: 20px;">Âä†ËΩΩÂ§±Ë¥•</p>';
        }
      }
    }

    // Âà†Èô§ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê
    async function removeManualSource(sourceName, topicKeywords) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§‰ø°ÊÅØÊ∫ê"${sourceName}"ÂêóÔºü`)) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions/${encodeURIComponent(sourceName)}?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        const result = await response.json();

        if (result.success) {
          showMessage('Âà†Èô§ÊàêÂäü', 'success');
          await loadManualAddedSources();
          await loadUserSubscriptions();
        } else {
          showMessage(result.message || 'Âà†Èô§Â§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('Âà†Èô§‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
      }
    }

    // ==================== ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Êñ∞ÂäüËÉΩ ====================

    // Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÔºàÂ∏¶ÁºìÂ≠òÔºâ
    async function loadCuratedSourcesForSub() {
      if (curatedSourcesCache) {
        return curatedSourcesCache;
      }
      try {
        const response = await fetch(`${API_BASE_URL}/user/curated-sources`, {
          headers: getHeaders()
        });
        const result = await response.json();
        if (result.success) {
          curatedSourcesCache = result.data || [];
          return curatedSourcesCache;
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
      }
      return [];
    }

    // ÂàùÂßãÂåñËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢
    async function initSubscriptionPage() {
      console.log('[ËÆ¢ÈòÖÁÆ°ÁêÜ] ÂàùÂßãÂåñÈ°µÈù¢...');
      try {
        // È¢ÑÂä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊï∞ÈáèÔºà‰∏çÈòªÂ°û‰∏ªÊµÅÁ®ãÔºâ
        preloadCuratedSourcesCount();

        // Âä†ËΩΩÁî®Êà∑‰∏ªÈ¢ò
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success && result.data && result.data.length > 0) {
          userTopics = result.data;
          document.getElementById('noTopicsHint').style.display = 'none';
          document.getElementById('topicsTabsSection').style.display = 'block';
          await renderSubTopicsTabs(userTopics);
        } else {
          userTopics = [];
          document.getElementById('noTopicsHint').style.display = 'block';
          document.getElementById('topicsTabsSection').style.display = 'none';
        }
      } catch (error) {
        console.error('[ËÆ¢ÈòÖÁÆ°ÁêÜ] ÂàùÂßãÂåñÂ§±Ë¥•:', error);
      }
    }

    // È¢ÑÂä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊï∞ÈáèÔºåÈ°µÈù¢ÂàùÂßãÂåñÊó∂Âç≥ÊòæÁ§∫‰∏™Êï∞
    async function preloadCuratedSourcesCount() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/curated-sources`, {
          headers: getHeaders()
        });
        const result = await response.json();
        if (result.success) {
          const sources = result.sources || result.data || [];
          const count = sources.length;
          document.getElementById('allCuratedSourcesCount').textContent = `(${count}‰∏™)`;
          // ÂêåÊó∂È¢ÑÂ°´ÂÖÖÁºìÂ≠òÔºåÈÅøÂÖçÂ±ïÂºÄÊó∂ÈáçÂ§çËØ∑Ê±Ç
          if (result.sources) {
            allCuratedSourcesData = sources;
          }
          if (!curatedSourcesCache && result.data) {
            curatedSourcesCache = result.data;
          }
        }
      } catch (error) {
        console.error('[ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê] È¢ÑÂä†ËΩΩÊï∞ÈáèÂ§±Ë¥•:', error);
        document.getElementById('allCuratedSourcesCount').textContent = '';
      }
    }

    // Ê∏≤ÊüìËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
    async function renderSubTopicsTabs(topics) {
      const tabsHeader = document.getElementById('subTopicsTabsHeader');
      const tabsContent = document.getElementById('subTopicsTabsContent');

      if (!tabsHeader || !tabsContent) return;

      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';

      for (let i = 0; i < topics.length; i++) {
        const topic = topics[i];
        const topicKeywords = topic.topic_keywords;

        // ÂàõÂª∫È°µÁ≠æÊåâÈíÆ
        const tabBtn = document.createElement('button');
        tabBtn.className = `sub-topic-tab ${i === 0 ? 'active' : ''}`;
        tabBtn.id = `sub-tab-${i}`;
        tabBtn.innerHTML = `
          <span>${escapeHtml(topicKeywords)}</span>
          <button class="delete-topic-btn" onclick="event.stopPropagation(); deleteSubTopic('${escapeHtml(topicKeywords)}')" title="Âà†Èô§‰∏ªÈ¢ò">√ó</button>
        `;
        tabBtn.onclick = (e) => {
          if (!e.target.classList.contains('delete-topic-btn')) {
            switchSubTopicTab(i);
          }
        };
        tabsHeader.appendChild(tabBtn);

        // ÂàõÂª∫È°µÁ≠æÂÜÖÂÆπÈù¢Êùø
        const panel = document.createElement('div');
        panel.className = `sub-topic-panel ${i === 0 ? 'active' : ''}`;
        panel.id = `sub-panel-${i}`;
        panel.dataset.topicKeywords = topicKeywords;
        panel.innerHTML = `
          <!-- Â∑≤ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂå∫Âüü -->
          <div class="subscribed-sources-section">
            <div class="subscribed-sources-header">
              <span class="subscribed-sources-title">Â∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê</span>
              <span class="subscribed-sources-count" id="sub-subscribed-count-${i}">0 ‰∏™</span>
            </div>
            <div class="subscribed-sources-list" id="sub-subscribed-list-${i}">
              <div class="no-subscriptions">Âä†ËΩΩ‰∏≠...</div>
            </div>
          </div>

          <!-- Êé®Ëçê‰ø°ÊÅØÊ∫êÂå∫Âüü -->
          <div class="recommended-sources-section">
            <div class="recommended-sources-header">
              <span class="recommended-sources-title">Êé®Ëçê‰ø°ÊÅØÊ∫ê</span>
            </div>
            <div id="sub-recommendations-container-${i}">
              <table class="sub-recommendations-table" id="sub-recommendations-table-${i}">
                <thead>
                  <tr>
                    <th></th>
                    <th>‰ø°ÊÅØÊ∫ê</th>
                    <th>Á±ªÂûã</th>
                    <th>ÊèèËø∞</th>
                  </tr>
                </thead>
                <tbody id="sub-recommendations-body-${i}">
                </tbody>
              </table>
            </div>
            <div class="actions-container" id="sub-actions-${i}">
              <button class="btn-primary" onclick="subscribeSelectedSub(${i})" id="sub-subscribe-btn-${i}" disabled>
                ËÆ¢ÈòÖÈÄâ‰∏≠ (<span id="sub-selected-count-${i}">0</span>)
              </button>
              <button class="btn-secondary" onclick="loadMoreRecommendationsSub(${i})" id="sub-load-more-btn-${i}" style="display: none;">
                Âä†ËΩΩÊõ¥Â§ö
              </button>
              <button class="btn-ai-recommend" onclick="loadMoreAIRecommendations(${i}, '${topicKeywords.replace(/'/g, "\\'")}')" id="ai-recommend-btn-${i}">
                ü§ñ ‰ΩøÁî®AIÊé®ËçêÊõ¥Â§ö
              </button>
            </div>
          </div>
        `;
        tabsContent.appendChild(panel);

        // ÂàùÂßãÂåñËØ•‰∏ªÈ¢òÁöÑÊï∞ÊçÆ
        if (!subTopicsData[topicKeywords]) {
          subTopicsData[topicKeywords] = {
            subscriptions: [],
            recommendations: [],
            allRecommendations: [],
            displayedCount: 0,
            isRecommending: false,
            hasLoadedAI: false
          };
        }
      }

      // Âä†ËΩΩÁ¨¨‰∏Ä‰∏™‰∏ªÈ¢òÁöÑÊï∞ÊçÆ
      if (topics.length > 0) {
        await loadSubTopicData(0);
      }
    }

    // ÂàáÊç¢ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÁ≠æ
    async function switchSubTopicTab(index) {
      const tabs = document.querySelectorAll('.sub-topic-tab');
      const panels = document.querySelectorAll('.sub-topic-panel');

      tabs.forEach((tab, i) => {
        tab.classList.toggle('active', i === index);
      });

      panels.forEach((panel, i) => {
        panel.classList.toggle('active', i === index);
      });

      subCurrentTopicIndex = index;
      await loadSubTopicData(index);
    }

    // Âä†ËΩΩÊåáÂÆö‰∏ªÈ¢òÁöÑÊï∞ÊçÆ
    async function loadSubTopicData(index) {
      const panel = document.getElementById(`sub-panel-${index}`);
      if (!panel) return;

      const topicKeywords = panel.dataset.topicKeywords;
      const data = subTopicsData[topicKeywords];

      // Âä†ËΩΩÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê
      await loadSubSubscriptions(index, topicKeywords);

      // Â¶ÇÊûúËøòÊ≤°ÊúâÊé®ËçêÊï∞ÊçÆÔºåÊ£ÄÊü•ÊòØÂê¶ÊúâÂéÜÂè≤Êé®Ëçê
      if (!data.allRecommendations || data.allRecommendations.length === 0) {
        await loadSubRecommendationHistory(index, topicKeywords);
      } else {
        // ÊòæÁ§∫Â∑≤ÊúâÁöÑÊé®Ëçê
        renderSubRecommendations(index);
      }
    }

    // Âä†ËΩΩÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê
    async function loadSubSubscriptions(index, topicKeywords) {
      const listEl = document.getElementById(`sub-subscribed-list-${index}`);
      const countEl = document.getElementById(`sub-subscribed-count-${index}`);

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const subscriptions = result.data || [];
          subTopicsData[topicKeywords].subscriptions = subscriptions;
          countEl.textContent = `${subscriptions.length} ‰∏™`;

          if (subscriptions.length === 0) {
            listEl.innerHTML = '<div class="no-subscriptions">ÊöÇÊó†ËÆ¢ÈòÖÔºåËØ∑‰ªé‰∏ãÊñπÊé®ËçêÂàóË°®‰∏≠ÈÄâÊã©‰ø°ÊÅØÊ∫ê</div>';
          } else {
            listEl.innerHTML = subscriptions.map(sub => `
              <div class="subscribed-source-tag">
                <span title="${escapeHtml(sub.source_url || '')}">${escapeHtml(sub.source_name)}</span>
                <button class="unsubscribe-btn" onclick="unsubscribeSub(${index}, '${escapeHtml(topicKeywords)}', '${escapeHtml(sub.source_name)}')" title="ÂèñÊ∂àËÆ¢ÈòÖ">√ó</button>
              </div>
            `).join('');
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩËÆ¢ÈòÖÂ§±Ë¥•:', error);
        listEl.innerHTML = '<div class="no-subscriptions">Âä†ËΩΩÂ§±Ë¥•</div>';
      }
    }

    // Âä†ËΩΩÊé®ËçêÂéÜÂè≤
    async function loadSubRecommendationHistory(index, topicKeywords) {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history/${encodeURIComponent(topicKeywords)}`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success && result.data && result.data.recommended_sources && result.data.recommended_sources.length > 0) {
          subTopicsData[topicKeywords].allRecommendations = result.data.recommended_sources;
          subTopicsData[topicKeywords].displayedCount = 0;
          renderSubRecommendations(index);
        } else {
          // Ê≤°ÊúâÂéÜÂè≤Êé®ËçêÔºåËá™Âä®ÂºÄÂßãÊé®Ëçê
          await startSubRecommendation(index, topicKeywords);
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', error);
        // Âá∫ÈîôÊó∂‰πüÂ∞ùËØïÂºÄÂßãÊé®Ëçê
        await startSubRecommendation(index, topicKeywords);
      }
    }

    // Ê∏≤ÊüìÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÊØèÊ¨°ÊòæÁ§∫10È°πÔºâ
    function renderSubRecommendations(index) {
      const panel = document.getElementById(`sub-panel-${index}`);
      if (!panel) return;

      const topicKeywords = panel.dataset.topicKeywords;
      const data = subTopicsData[topicKeywords];
      const tbody = document.getElementById(`sub-recommendations-body-${index}`);
      const loadMoreBtn = document.getElementById(`sub-load-more-btn-${index}`);

      if (!data.allRecommendations || data.allRecommendations.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #999; padding: 20px;">ÊöÇÊó†ÂåπÈÖçÁöÑÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÔºåËØ∑Â∞ùËØï‰ΩøÁî®AIÊé®Ëçê</td></tr>';
        loadMoreBtn.style.display = 'none';
        // ÊòæÁ§∫AIÊé®ËçêÊåâÈíÆ
        const aiBtn = document.getElementById(`ai-recommend-btn-${index}`);
        if (aiBtn && !data.hasLoadedAI) {
          aiBtn.style.display = 'inline-flex';
        }
        return;
      }

      // ËÆ°ÁÆóË¶ÅÊòæÁ§∫ÁöÑÊï∞Èáè
      const ITEMS_PER_PAGE = 10;
      const startIndex = data.displayedCount;
      const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, data.allRecommendations.length);
      const newItems = data.allRecommendations.slice(startIndex, endIndex);

      // Ëé∑ÂèñÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÂêçÁß∞ÂàóË°®
      const subscribedNames = data.subscriptions.map(s => s.source_name);

      // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°Âä†ËΩΩÔºåÊ∏ÖÁ©∫Ë°®Ê†º
      if (startIndex === 0) {
        tbody.innerHTML = '';
      }

      // Ê∑ªÂä†Êñ∞ÁöÑË°å
      newItems.forEach((source, i) => {
        const globalIndex = startIndex + i;
        const isSubscribed = subscribedNames.includes(source.sourceName);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <input type="checkbox" class="sub-source-checkbox" data-index="${globalIndex}"
              ${isSubscribed ? 'disabled checked' : ''}
              onchange="updateSubSelectedCount(${index})">
          </td>
          <td>
            <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
            <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl || '')}</div>
          </td>
          <td>
            <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
          </td>
          <td>${escapeHtml(source.description || '')}</td>
        `;
        if (isSubscribed) {
          row.style.opacity = '0.6';
          row.title = 'Â∑≤ËÆ¢ÈòÖ';
        }
        tbody.appendChild(row);
      });

      // Êõ¥Êñ∞ÊòæÁ§∫ËÆ°Êï∞
      data.displayedCount = endIndex;

      // ÊòæÁ§∫/ÈöêËóèÂä†ËΩΩÊõ¥Â§öÊåâÈíÆ
      if (endIndex < data.allRecommendations.length) {
        loadMoreBtn.style.display = 'inline-block';
        loadMoreBtn.textContent = `Âä†ËΩΩÊõ¥Â§ö (${data.allRecommendations.length - endIndex} ‰∏™)`;
      } else {
        loadMoreBtn.style.display = 'none';
      }

      // ÊòæÁ§∫/ÈöêËóèAIÊé®ËçêÊåâÈíÆÔºàÂ¶ÇÊûúÂ∑≤‰ΩøÁî®ËøáAIÊé®ËçêÂàôÈöêËóèÔºâ
      const aiBtn = document.getElementById(`ai-recommend-btn-${index}`);
      if (aiBtn) {
        if (data.hasLoadedAI) {
          aiBtn.style.display = 'none';
        } else {
          aiBtn.style.display = 'inline-flex';
          aiBtn.disabled = false;
          aiBtn.innerHTML = 'ü§ñ ‰ΩøÁî®AIÊé®ËçêÊõ¥Â§ö';
        }
      }

      updateSubSelectedCount(index);
    }

    // Âä†ËΩΩÊõ¥Â§öÊé®Ëçê
    async function loadMoreRecommendationsSub(index) {
      renderSubRecommendations(index);
    }

    // Êõ¥Êñ∞ÈÄâ‰∏≠Êï∞Èáè
    function updateSubSelectedCount(index) {
      const checkboxes = document.querySelectorAll(`#sub-recommendations-body-${index} .sub-source-checkbox:not(:disabled):checked`);
      const countEl = document.getElementById(`sub-selected-count-${index}`);
      const btn = document.getElementById(`sub-subscribe-btn-${index}`);

      if (countEl) {
        countEl.textContent = checkboxes.length;
      }
      if (btn) {
        btn.disabled = checkboxes.length === 0;
      }
    }

    // ÂºÄÂßãÊé®Ëçê‰ø°ÊÅØÊ∫êÔºà‰ªÖ‰ΩøÁî®ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÔºâ
    async function startSubRecommendation(index, topicKeywords) {
      const data = subTopicsData[topicKeywords];
      if (data.isRecommending) return;

      data.isRecommending = true;
      const taskId = `recommend-${topicKeywords}`;
      GlobalProgress.addTask(taskId, 'Êé®Ëçê‰ø°ÊÅØÊ∫ê', topicKeywords, 0, 'Ê≠£Âú®ÂàÜÊûê‰∏ªÈ¢òÂÖ≥ÈîÆËØç...');

      try {
        // Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
        GlobalProgress.updateTask(taskId, 30, 'Ê≠£Âú®Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê...');
        const curatedSources = await loadCuratedSourcesForSub();

        // ‰ªéÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê‰∏≠ÂåπÈÖç
        GlobalProgress.updateTask(taskId, 70, 'Ê≠£Âú®ÂåπÈÖçÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê...');
        const matchedCurated = matchCuratedSources(topicKeywords, curatedSources);
        console.log(`[Êé®Ëçê] ‰ªéÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂåπÈÖçÂà∞ ${matchedCurated.length} ‰∏™`);

        GlobalProgress.completeTask(taskId, `‰ªéÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂåπÈÖçÂà∞ ${matchedCurated.length} ‰∏™`);

        // ‰øùÂ≠òÊé®ËçêÁªìÊûú
        data.allRecommendations = [...matchedCurated];
        data.displayedCount = 0;
        data.hasLoadedAI = false; // Ê†áËÆ∞ÊòØÂê¶Â∑≤‰ΩøÁî®AIÊé®Ëçê

        // Ê∏≤ÊüìÊé®ËçêÁªìÊûú
        renderSubRecommendations(index);

      } catch (error) {
        console.error('Êé®ËçêÂ§±Ë¥•:', error);
        GlobalProgress.completeTask(taskId, 'Êé®ËçêÂ§±Ë¥•: ' + error.message, 3000);
      } finally {
        data.isRecommending = false;
      }
    }

    // ‰ΩøÁî® DeepSeek AI Ëé∑ÂèñÊõ¥Â§öÊé®Ëçê
    async function loadMoreAIRecommendations(index, topicKeywords) {
      const data = subTopicsData[topicKeywords];
      if (data.isRecommending) return;

      data.isRecommending = true;
      const taskId = `ai-recommend-${topicKeywords}`;
      GlobalProgress.addTask(taskId, 'AIÊé®Ëçê', topicKeywords, 0, 'Ê≠£Âú®Ë∞ÉÁî®AIÊé®ËçêÊõ¥Â§ö‰ø°ÊÅØÊ∫ê...');

      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      const btn = document.getElementById(`ai-recommend-btn-${index}`);
      if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> AIÊé®Ëçê‰∏≠...';
      }

      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords: topicKeywords })
        });

        if (response.ok) {
          // Â§ÑÁêÜÊµÅÂºèÂìçÂ∫î
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let aiRecommendations = [];

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';

            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const jsonData = JSON.parse(line.slice(6));
                  if (jsonData.type === 'progress') {
                    GlobalProgress.updateTask(taskId, jsonData.progress, jsonData.message);
                  } else if (jsonData.type === 'complete' && jsonData.data) {
                    aiRecommendations = jsonData.data;
                  }
                } catch (e) {
                  // ÂøΩÁï•Ëß£ÊûêÈîôËØØ
                }
              }
            }
          }

          // ÂêàÂπ∂AIÊé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÔºàÂéªÈáçÔºâ
          const existingUrls = new Set(data.allRecommendations.map(s => s.sourceUrl));
          const newSources = aiRecommendations.filter(s => !existingUrls.has(s.sourceUrl));
          
          if (newSources.length > 0) {
            data.allRecommendations = [...data.allRecommendations, ...newSources];
            GlobalProgress.completeTask(taskId, `AIÊé®Ëçê‰∫Ü ${newSources.length} ‰∏™Êñ∞‰ø°ÊÅØÊ∫ê`);
          } else {
            GlobalProgress.completeTask(taskId, 'AIÊ≤°ÊúâÊâæÂà∞Êõ¥Â§öÊñ∞‰ø°ÊÅØÊ∫ê');
          }

          data.hasLoadedAI = true;
          
          // ÈáçÊñ∞Ê∏≤ÊüìÊé®ËçêÁªìÊûú
          renderSubRecommendations(index);
        } else {
          throw new Error('AIÊé®ËçêËØ∑Ê±ÇÂ§±Ë¥•');
        }

      } catch (error) {
        console.error('AIÊé®ËçêÂ§±Ë¥•:', error);
        GlobalProgress.completeTask(taskId, 'AIÊé®ËçêÂ§±Ë¥•: ' + error.message, 3000);
        // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        if (btn) {
          btn.disabled = false;
          btn.innerHTML = 'ü§ñ ‰ΩøÁî®AIÊé®ËçêÊõ¥Â§ö';
        }
      } finally {
        data.isRecommending = false;
      }
    }

    // ÂåπÈÖçÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    function matchCuratedSources(keywords, curatedSources) {
      const keywordList = keywords.toLowerCase().split(/[,Ôºå\s]+/).filter(k => k.trim());
      const matched = [];

      for (const source of curatedSources) {
        const searchText = `${source.sourceName} ${source.description || ''} ${source.category || ''}`.toLowerCase();
        const isMatch = keywordList.some(keyword => searchText.includes(keyword));
        if (isMatch) {
          matched.push({
            sourceName: source.sourceName,
            sourceUrl: source.sourceUrl,
            sourceType: source.sourceType || 'rss',
            description: source.description || '',
            category: source.category || '',
            region: source.region || 'ÂõΩÂ§ñ',
            isCurated: true
          });
        }
      }

      return matched;
    }


    // Ê∑ªÂä†Êñ∞‰∏ªÈ¢ò
    async function addNewTopic() {
      const input = document.getElementById('topicInput');
      const keywords = input.value.trim();

      if (!keywords) {
        showMessage('ËØ∑ËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
        return;
      }

      const btn = document.getElementById('addTopicBtn');
      btn.disabled = true;
      btn.textContent = 'Ê∑ªÂä†‰∏≠...';

      try {
        // ‰øùÂ≠ò‰∏ªÈ¢òÂà∞Êï∞ÊçÆÂ∫ì
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords })
        });

        const result = await response.json();

        if (result.success) {
          showMessage('‰∏ªÈ¢òÊ∑ªÂä†ÊàêÂäü', 'success');
          input.value = '';

          // ÂàùÂßãÂåñËØ•‰∏ªÈ¢òÁöÑÊï∞ÊçÆ
          subTopicsData[keywords] = {
            subscriptions: [],
            recommendations: [],
            allRecommendations: [],
            displayedCount: 0,
            isRecommending: false,
            hasLoadedAI: false
          };

          // ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢
          await initSubscriptionPage();

          // ÂàáÊç¢Âà∞Êñ∞Ê∑ªÂä†ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
          const newIndex = userTopics.findIndex(t => t.topic_keywords === keywords);
          if (newIndex >= 0) {
            switchSubTopicTab(newIndex);
            // Ëá™Âä®ÂºÄÂßãÊé®Ëçê
            await startSubRecommendation(newIndex, keywords);
          }
        } else {
          showMessage(result.message || 'Ê∑ªÂä†Â§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('Ê∑ªÂä†‰∏ªÈ¢òÂ§±Ë¥•:', error);
        showMessage('Ê∑ªÂä†Â§±Ë¥•: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Ê∑ªÂä†‰∏ªÈ¢ò';
      }
    }

    // Âà†Èô§‰∏ªÈ¢ò
    async function deleteSubTopic(topicKeywords) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§‰∏ªÈ¢ò "${topicKeywords}" ÂêóÔºü\n\nÂà†Èô§ÂêéÂ∞ÜÂêåÊó∂Âà†Èô§Ôºö\n- ËØ•‰∏ªÈ¢òÁöÑÊâÄÊúâ‰ø°ÊÅØÊ∫êËÆ¢ÈòÖ\n- Ëøô‰∫õ‰ø°ÊÅØÊ∫êÊî∂ÈõÜÁöÑÊâÄÊúâÊñáÁ´†\n- ËØ•‰∏ªÈ¢òÁöÑÊé®ËçêÂéÜÂè≤\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`)) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/${encodeURIComponent(topicKeywords)}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        const result = await response.json();

        if (result.success) {
          showMessage(result.message || '‰∏ªÈ¢òÂà†Èô§ÊàêÂäü', 'success');
          delete subTopicsData[topicKeywords];
          await initSubscriptionPage();
        } else {
          showMessage(result.message || 'Âà†Èô§Â§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('Âà†Èô§‰∏ªÈ¢òÂ§±Ë¥•:', error);
        showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
      }
    }

    // ÂèñÊ∂àËÆ¢ÈòÖ
    async function unsubscribeSub(index, topicKeywords, sourceName) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂèñÊ∂àËÆ¢ÈòÖ "${sourceName}" ÂêóÔºü\n\nÂèñÊ∂àÂêéÂ∞ÜÂà†Èô§ËØ•‰ø°ÊÅØÊ∫êÊî∂ÈõÜÁöÑÊâÄÊúâÊñáÁ´†„ÄÇ`)) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions/${encodeURIComponent(sourceName)}?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        const result = await response.json();

        if (result.success) {
          showMessage(result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÊàêÂäü', 'success');
          await loadSubSubscriptions(index, topicKeywords);
          // ÈáçÊñ∞Ê∏≤ÊüìÊé®ËçêÂàóË°®‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          subTopicsData[topicKeywords].displayedCount = 0;
          renderSubRecommendations(index);
        } else {
          showMessage(result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•:', error);
        showMessage('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      }
    }

    // ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    async function subscribeSelectedSub(index) {
      const panel = document.getElementById(`sub-panel-${index}`);
      if (!panel) return;

      const topicKeywords = panel.dataset.topicKeywords;
      const data = subTopicsData[topicKeywords];
      const checkboxes = document.querySelectorAll(`#sub-recommendations-body-${index} .sub-source-checkbox:not(:disabled):checked`);

      if (checkboxes.length === 0) {
        showMessage('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }

      const selectedSources = [];
      checkboxes.forEach(cb => {
        const idx = parseInt(cb.dataset.index);
        const source = data.allRecommendations[idx];
        if (source) {
          selectedSources.push({
            sourceName: source.sourceName,
            sourceUrl: source.sourceUrl,
            sourceType: source.sourceType || 'rss',
            category: source.category || '',
            topicKeywords: topicKeywords
          });
        }
      });

      const btn = document.getElementById(`sub-subscribe-btn-${index}`);
      if (btn) {
        btn.disabled = true;
        btn.textContent = 'ËÆ¢ÈòÖ‰∏≠...';
      }

      const subTaskId = `subscribe-${topicKeywords}`;
      GlobalProgress.addTask(subTaskId, 'ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê', topicKeywords, 0, 'Ê≠£Âú®Ê∑ªÂä†ËÆ¢ÈòÖ...');

      try {
        // Ê∑ªÂä†ËÆ¢ÈòÖ
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: selectedSources })
        });

        const result = await response.json();

        if (result.success) {
          GlobalProgress.completeTask(subTaskId, `ÊàêÂäüËÆ¢ÈòÖ ${selectedSources.length} ‰∏™‰ø°ÊÅØÊ∫ê`);

          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${selectedSources.length} ‰∏™‰ø°ÊÅØÊ∫êÔºåÊ≠£Âú®Êî∂ÈõÜÊñáÁ´†...`, 'success');
          // Ëá™Âä®Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜ
          triggerCollectAfterSubscribe(topicKeywords);

          // Âà∑Êñ∞ËÆ¢ÈòÖÂàóË°®ÂíåÊé®ËçêÂàóË°®
          await loadSubSubscriptions(index, topicKeywords);
          data.displayedCount = 0;
          renderSubRecommendations(index);
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          GlobalProgress.removeTask(subTaskId);
        }
      } catch (error) {
        console.error('ËÆ¢ÈòÖÂ§±Ë¥•:', error);
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
        GlobalProgress.removeTask(subTaskId);
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.textContent = 'ËÆ¢ÈòÖÈÄâ‰∏≠ (0)';
        }
        updateSubSelectedCount(index);
      }
    }

    // ÊäìÂèñÊñáÁ´†
    async function fetchArticlesForSubscriptions(subTaskId, topicKeywords, sources) {
      const totalSources = sources.length;
      let completedSources = 0;

      for (const source of sources) {
        completedSources++;
        const percent = 30 + (completedSources / totalSources) * 60;
        GlobalProgress.updateTask(subTaskId, percent, `Ê≠£Âú®ÊäìÂèñ ${source.sourceName} (${completedSources}/${totalSources})...`);

        try {
          // Ë∞ÉÁî®ÊäìÂèñAPIÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâ
          // ËøôÈáåÁÆÄÂåñÂ§ÑÁêÜÔºåÂÆûÈôÖÊäìÂèñÁî±ÂêéÂè∞ÂÆöÊó∂‰ªªÂä°ÂÆåÊàê
          await new Promise(resolve => setTimeout(resolve, 500));
        } catch (error) {
          console.error(`ÊäìÂèñ ${source.sourceName} Â§±Ë¥•:`, error);
        }
      }

      GlobalProgress.completeTask(subTaskId, 'ÊñáÁ´†ÊäìÂèñÂÆåÊàê');
    }

    // ==================== ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÁ§∫ÂäüËÉΩ ====================
    let allCuratedSourcesData = []; // ÊâÄÊúâÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊï∞ÊçÆ
    let filteredCuratedSourcesData = []; // Á≠õÈÄâÂêéÁöÑÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊï∞ÊçÆ
    let allCuratedSourcesLoaded = false; // ÊòØÂê¶Â∑≤Âä†ËΩΩ

    // ÂàáÊç¢ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÂºÄ/ÊäòÂè†
    function toggleAllCuratedSources() {
      const content = document.getElementById('allCuratedSourcesContent');
      const toggle = document.getElementById('allCuratedSourcesToggle');
      const isExpanded = content.style.display !== 'none';
      
      if (isExpanded) {
        content.style.display = 'none';
        toggle.textContent = '‚ñ∂';
        toggle.classList.remove('expanded');
      } else {
        content.style.display = 'block';
        toggle.textContent = '‚ñ∂';
        toggle.classList.add('expanded');
        // È¶ñÊ¨°Â±ïÂºÄÊó∂Âä†ËΩΩÊï∞ÊçÆ
        if (!allCuratedSourcesLoaded) {
          loadAllCuratedSources();
        }
      }
    }

    // Âä†ËΩΩÊâÄÊúâÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    async function loadAllCuratedSources() {
      const tbody = document.getElementById('allCuratedSourcesBody');
      tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #999;">Âä†ËΩΩ‰∏≠...</td></tr>';
      
      try {
        const response = await fetch(`${API_BASE_URL}/user/curated-sources`, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          allCuratedSourcesData = result.sources || [];
          filteredCuratedSourcesData = [...allCuratedSourcesData];
          allCuratedSourcesLoaded = true;
          
          // Êõ¥Êñ∞ËÆ°Êï∞
          document.getElementById('allCuratedSourcesCount').textContent = `(${allCuratedSourcesData.length}‰∏™)`;
          
          // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
          renderCuratedSourcesFilterOptions(result.stats);
          
          // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
          renderCuratedSourcesStatsInfo(result.stats);
          
          // Ê∏≤ÊüìÂàóË°®
          renderAllCuratedSourcesList();
        } else {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #c33;">Âä†ËΩΩÂ§±Ë¥•</td></tr>';
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #c33;">Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</td></tr>';
      }
    }

    // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
    function renderCuratedSourcesFilterOptions(stats) {
      // Á±ªÂûãÁ≠õÈÄâÂô®
      const typeSelect = document.getElementById('curatedSourcesTypeFilter');
      const types = Object.keys(stats?.byType || {}).sort();
      typeSelect.innerHTML = '<option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>' + 
        types.map(type => `<option value="${escapeHtml(type)}">${escapeHtml(type)} (${stats.byType[type]})</option>`).join('');
      
      // ÂàÜÁ±ªÁ≠õÈÄâÂô®
      const categorySelect = document.getElementById('curatedSourcesCategoryFilter');
      const categories = Object.keys(stats?.byCategory || {}).sort();
      categorySelect.innerHTML = '<option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>' + 
        categories.map(cat => `<option value="${escapeHtml(cat)}">${escapeHtml(cat)} (${stats.byCategory[cat]})</option>`).join('');
    }

    // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
    function renderCuratedSourcesStatsInfo(stats) {
      const statsEl = document.getElementById('allCuratedSourcesStats');
      if (!statsEl || !stats) return;
      
      const domesticCount = stats.byRegion?.['ÂõΩÂÜÖ'] || 0;
      const foreignCount = stats.byRegion?.['ÂõΩÂ§ñ'] || 0;
      const typeCount = Object.keys(stats.byType || {}).length;
      const categoryCount = Object.keys(stats.byCategory || {}).length;
      
      statsEl.innerHTML = `
        <span>ÊÄªÊï∞: <span class="stat-value">${allCuratedSourcesData.length}</span></span>
        <span>ÂõΩÂÜÖ: <span class="stat-value">${domesticCount}</span></span>
        <span>ÂõΩÂ§ñ: <span class="stat-value">${foreignCount}</span></span>
        <span>Á±ªÂûã: <span class="stat-value">${typeCount}Áßç</span></span>
        <span>ÂàÜÁ±ª: <span class="stat-value">${categoryCount}‰∏™</span></span>
      `;
    }

    // Á≠õÈÄâÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    function filterAllCuratedSources() {
      const keyword = (document.getElementById('curatedSourcesSearch')?.value || '').trim().toLowerCase();
      const typeFilter = document.getElementById('curatedSourcesTypeFilter')?.value || '';
      const categoryFilter = document.getElementById('curatedSourcesCategoryFilter')?.value || '';
      const regionFilter = document.getElementById('curatedSourcesRegionFilter')?.value || '';
      
      filteredCuratedSourcesData = allCuratedSourcesData.filter(source => {
        // ÂÖ≥ÈîÆËØçÊêúÁ¥¢
        if (keyword) {
          const nameMatch = (source.sourceName || '').toLowerCase().includes(keyword);
          const urlMatch = (source.sourceUrl || '').toLowerCase().includes(keyword);
          const descMatch = (source.description || '').toLowerCase().includes(keyword);
          if (!nameMatch && !urlMatch && !descMatch) return false;
        }
        
        // Á±ªÂûãÁ≠õÈÄâ
        if (typeFilter && source.sourceType !== typeFilter) return false;
        
        // ÂàÜÁ±ªÁ≠õÈÄâ
        if (categoryFilter && source.category !== categoryFilter) return false;
        
        // Âú∞Âå∫Á≠õÈÄâ
        if (regionFilter && source.region !== regionFilter) return false;
        
        return true;
      });
      
      renderAllCuratedSourcesList();
    }

    // Ê∏≤ÊüìÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂàóË°®
    function renderAllCuratedSourcesList() {
      const tbody = document.getElementById('allCuratedSourcesBody');
      
      if (filteredCuratedSourcesData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #999;">Ê≤°ÊúâÂåπÈÖçÁöÑ‰ø°ÊÅØÊ∫ê</td></tr>';
        return;
      }
      
      tbody.innerHTML = filteredCuratedSourcesData.map(source => {
        const regionClass = source.region === 'ÂõΩÂÜÖ' ? 'domestic' : 'foreign';
        return `
          <tr>
            <td>
              <div class="source-name">${escapeHtml(source.sourceName || '')}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl || '')}</div>
            </td>
            <td><span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span></td>
            <td><span class="source-category">${escapeHtml(source.category || 'Êú™ÂàÜÁ±ª')}</span></td>
            <td><span class="source-region ${regionClass}">${escapeHtml(source.region || 'Êú™Áü•')}</span></td>
            <td><span class="source-description" title="${escapeHtml(source.description || '')}">${escapeHtml((source.description || '').substring(0, 50))}${(source.description || '').length > 50 ? '...' : ''}</span></td>
          </tr>
        `;
      }).join('');
    }
    // ==================== ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÁ§∫ÂäüËÉΩÁªìÊùü ====================

    // ==================== ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Êñ∞ÂäüËÉΩÁªìÊùü ====================

    // Â§ÑÁêÜÊµèËßàÂô®ËøîÂõû/ÂâçËøõÊåâÈíÆ
    window.addEventListener('popstate', function(event) {
      const state = event.state;

      if (!state) {
        // Â¶ÇÊûúÊ≤°ÊúâÁä∂ÊÄÅÔºåËøîÂõûÈªòËÆ§È°µÈù¢
        switchPage('subscriptions');
        return;
      }

      const page = state.page || 'subscriptions';

      // Â¶ÇÊûúÊòØÊñáÁ´†ËØ¶ÊÉÖÈ°µ
      if (page === 'articles' && state.view === 'detail' && state.articleId) {
        // ÊÅ¢Â§ç‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢Âºï
        if (state.topicIndex !== undefined) {
          window.currentArticlesTopicIndex = state.topicIndex;
        }
        // ÊòæÁ§∫ÊñáÁ´†ËØ¶ÊÉÖÔºà‰∏çËß¶ÂèëÊñ∞ÁöÑ pushStateÔºâ
        viewArticleWithoutHistory(state.articleId, state.scrollPosition);
      }
      // Â¶ÇÊûúÊòØÊñáÁ´†ÂàóË°®È°µ
      else if (page === 'articles' && state.view === 'list') {
        // Ê£ÄÊü•ÂΩìÂâçÊòØÂê¶Âú®ÊñáÁ´†ËØ¶ÊÉÖÈ°µ
        const articleDetailView = document.getElementById('articleDetailView');
        if (articleDetailView && articleDetailView.style.display !== 'none') {
          // ËøîÂõûÂàóË°®Ôºà‰∏çËß¶ÂèëÊñ∞ÁöÑ pushStateÔºâ
          backToListWithoutHistory();
        } else {
          // Á°Æ‰øùÂú®ÊñáÁ´†ÂàóË°®È°µ
          if (!document.getElementById('articlesPage').classList.contains('active')) {
            switchPageWithoutHistory(page);
          }
        }
      }
      // ÂÖ∂‰ªñÈ°µÈù¢
      else {
        switchPageWithoutHistory(page);
      }
    });

    // ‰∏çËß¶Âèë history.pushState ÁöÑÈ°µÈù¢ÂàáÊç¢
    function switchPageWithoutHistory(page) {
      const currentPage = document.querySelector('.content-page.active')?.id.replace('Page', '');
      if (currentPage === page) return;

      // ÂÖ≥Èó≠‰æßËæπÊ†è
      closeSidebar();

      // Êõ¥Êñ∞ËèúÂçïÁä∂ÊÄÅ
      document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
      const menuItems = document.querySelectorAll('.menu-item');
      const pageIndexMap = { 'subscriptions': 0, 'articles': 1, 'guide': 2, 'features': 3 };
      menuItems.forEach((item, index) => {
        if (pageIndexMap[page] === index) item.classList.add('active');
      });

      // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
      document.querySelectorAll('.content-page').forEach(p => p.classList.remove('active'));
      document.getElementById(page + 'Page').classList.add('active');

      // ÊéßÂà∂Êó•Êúü‰æßËæπÊ†è
      if (page === 'articles') {
        showDateSidebar();
      } else {
        hideDateSidebar();
      }

      // ‰øùÂ≠òÂà∞ localStorage
      localStorage.setItem('dashboardCurrentPage', page);
    }

    // ‰∏çËß¶Âèë history.pushState ÁöÑËøîÂõûÂàóË°®
    function backToListWithoutHistory() {
      localStorage.removeItem('dashboardViewingArticleId');
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;

      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      const refreshBtn = document.getElementById(`refreshNowBtn-${currentTabIndex}`);
      if (statsBar) statsBar.style.display = 'flex';
      if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
      if (refreshBtn) refreshBtn.style.display = 'inline-flex';

      showDateSidebar();

      document.getElementById('articleDetailView').style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'block';

      window.scrollTo(0, savedScrollPosition);
    }

    // ‰∏çËß¶Âèë history.pushState ÁöÑÊñáÁ´†ËØ¶ÊÉÖÊü•Áúã
    async function viewArticleWithoutHistory(id, scrollPos) {
      savedScrollPosition = scrollPos || 0;
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;

      localStorage.setItem('dashboardCurrentPage', 'articles');
      localStorage.setItem('dashboardViewingArticleId', id.toString());
      localStorage.setItem('dashboardCurrentTopicIndex', currentTabIndex.toString());

      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      const refreshBtn = document.getElementById(`refreshNowBtn-${currentTabIndex}`);
      if (statsBar) statsBar.style.display = 'none';
      if (sourceFilterCards) sourceFilterCards.style.display = 'none';
      if (refreshBtn) refreshBtn.style.display = 'none';

      hideDateSidebar();

      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'none';
      document.getElementById('articleDetailView').style.display = 'block';

      window.scrollTo(0, 0);

      // Âä†ËΩΩÊñáÁ´†ËØ¶ÊÉÖÔºàÂ§çÁî®Áé∞ÊúâÈÄªËæëÔºâ
      try {
        const response = await fetch(`${API_BASE_URL}/news/${id}`, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success && result.data) {
          const article = result.data;
          document.getElementById('articleDetailTitle').textContent = article.title;
          document.getElementById('articleDetailSource').textContent = `Êù•Ê∫êÔºö${article.source || 'Êú™Áü•'}`;
          document.getElementById('articleDetailCategory').textContent = `ÂàÜÁ±ªÔºö${article.category || 'Êú™ÂàÜÁ±ª'}`;
          document.getElementById('articleDetailDate').textContent = `ÂèëÂ∏ÉÊó∂Èó¥Ôºö${formatDate(article.publish_date)}`;
          if (article.summary) {
            document.getElementById('articleDetailSummary').textContent = article.summary;
            document.getElementById('articleDetailSummary').parentElement.style.display = 'block';
          } else {
            document.getElementById('articleDetailSummary').parentElement.style.display = 'none';
          }
          document.getElementById('articleDetailContent').innerHTML = article.content || '';
          document.getElementById('articleDetailLink').href = article.url || '#';
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•:', error);
      }
    }

    // È°µÈù¢Âä†ËΩΩÊó∂
    window.onload = async function() {
      // ËÆæÁΩÆÂàùÂßãÂéÜÂè≤Áä∂ÊÄÅÔºåÈÅøÂÖçÁ¨¨‰∏ÄÊ¨°ËøîÂõûÂ∞±ÈÄÄÂá∫ÁΩëÁ´ô
      if (!history.state) {
        history.replaceState({ page: 'subscriptions', view: 'list' }, '', '#subscriptions');
      }

      await initUser();
      await initSubscriptionPage(); // ÂàùÂßãÂåñËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢
      await loadUserSubscriptions(); // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®
      await loadArticlesTopicsTabs(); // Âä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
      await loadArticles(); // ‰øùÁïôÂéüÊúâÁöÑloadArticlesÁî®‰∫éÂÖºÂÆπ
      await loadRefreshStatus();
      startArticlesAutoRefresh();
      
      // Â§ÑÁêÜ URL hash ÂØºËà™
      const hash = window.location.hash.substring(1);
      if (hash === 'guide' || hash === 'features') {
        switchPage(hash);
      } else {
        // ÊÅ¢Â§çÈ°µÈù¢Áä∂ÊÄÅ
        const savedPage = localStorage.getItem('dashboardCurrentPage');
        const savedArticleId = localStorage.getItem('dashboardViewingArticleId');
        const savedTopicIndex = localStorage.getItem('dashboardCurrentTopicIndex');
        
        // ÊúâÊïàÁöÑÈ°µÈù¢ÂàóË°®
        const validPages = ['subscriptions', 'articles', 'guide', 'features'];
        
        if (savedPage && validPages.includes(savedPage)) {
        // ÂàáÊç¢Âà∞‰øùÂ≠òÁöÑÈ°µÈù¢
        switchPage(savedPage);
        
        // Â¶ÇÊûúÊòØÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ôºå‰∏î‰øùÂ≠ò‰∫ÜÊñáÁ´†IDÔºåÂàôÊÅ¢Â§çÊñáÁ´†ËØ¶ÊÉÖ
        if (savedPage === 'articles' && savedArticleId) {
          // ÊÅ¢Â§ç‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢Âºï
          if (savedTopicIndex) {
            const topicIndex = parseInt(savedTopicIndex, 10);
            window.currentArticlesTopicIndex = topicIndex;
            switchArticlesTopicTab(topicIndex);
          }
          
          // Á≠âÂæÖÊñáÁ´†ÂàóË°®Âä†ËΩΩÂÆåÊàêÂêéÂÜçÊòæÁ§∫ÊñáÁ´†ËØ¶ÊÉÖ
          setTimeout(async () => {
            try {
              await viewArticle(parseInt(savedArticleId, 10));
            } catch (error) {
              console.error('ÊÅ¢Â§çÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•:', error);
              // Â¶ÇÊûúÊñáÁ´†‰∏çÂ≠òÂú®ÊàñÂä†ËΩΩÂ§±Ë¥•ÔºåÊ∏ÖÈô§‰øùÂ≠òÁöÑÁä∂ÊÄÅ
              localStorage.removeItem('dashboardViewingArticleId');
            }
          }, 800);
        }
      }
      }
    };
  </script>
</body>
</html>
