<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‰∏™‰∫∫‰ø°ÊÅØÊï¥ÁêÜ - ‰ª™Ë°®Áõò</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%);
      color: #333;
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    /* Â∑¶‰æßËèúÂçï */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #ffffff 0%, #faf5ff 100%);
      box-shadow: 2px 0 12px rgba(139, 92, 246, 0.15);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid #eee;
    }

    .sidebar-header h1 {
      font-size: 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .user-info {
      font-size: 14px;
      color: #666;
    }

    .sidebar-menu {
      flex: 1;
      padding: 20px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.08) 0%, rgba(139, 92, 246, 0.03) 100%);
    }

    .menu-item.active {
      background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      border-left-color: #8B5CF6;
      color: #8B5CF6;
    }

    .menu-item-icon {
      width: 20px;
      margin-right: 12px;
      font-size: 18px;
    }

    .menu-item-text {
      font-size: 15px;
      font-weight: 500;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid #eee;
    }

    .logout-btn {
      width: 100%;
      padding: 10px;
      background-color: #f5f5f5;
      color: #666;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #e0e0e0;
    }

    /* ‰∏ªÂÜÖÂÆπÂå∫ */
    .main-content {
      flex: 1;
      margin-left: 240px;
      padding: 0;
      min-height: 100vh;
    }

    .content-page {
      display: none;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .content-page.active {
      display: block;
    }

    .page-header {
      margin-bottom: 24px;
    }

    .page-header h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }

    .page-header p {
      color: #666;
      font-size: 14px;
    }

    /* ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Ê†∑Âºè */
    .section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.1);
      margin-bottom: 20px;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }

    .section h3 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .add-topic-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .add-topic-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    /* ÂºπÁ™óÊ†∑Âºè */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f0f0f0;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: #e0e0e0;
      color: #333;
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .input-group input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
    }

    .input-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .btn-primary {
      padding: 12px 24px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .topics-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
    }

    .topic-tag {
      padding: 8px 16px;
      background-color: #f0f0f0;
      border-radius: 20px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .topic-tag .remove-btn {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topic-tag .remove-btn:hover {
      color: #c33;
    }

    .recommendations-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .recommendations-table th,
    .recommendations-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .recommendations-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
    }

    .recommendations-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .recommendations-table tr.invalid-row {
      background-color: #f5f5f5;
      opacity: 0.6;
      color: #999;
      display: none; /* ÈªòËÆ§ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê */
    }
    
    .recommendations-table.show-invalid tr.invalid-row {
      display: table-row; /* ÂΩìË°®Ê†ºÊúâshow-invalidÁ±ªÊó∂ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê */
    }
    
    .recommendations-table tr.invalid-row:hover {
      background-color: #f0f0f0;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox {
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .recommendations-table tr.invalid-row .source-checkbox:disabled {
      cursor: not-allowed;
    }

    .invalid-sources-toggle {
      margin-left: 16px;
      padding: 6px 12px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      color: #6c757d;
      transition: all 0.2s;
    }

    .invalid-sources-toggle:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .checkbox-cell {
      width: 50px;
      text-align: center;
    }

    /* ÈôêÂà∂‰ø°ÊÅØÊ∫êÂêçÁß∞ÂàóÁöÑÂÆΩÂ∫¶ */
    .recommendations-table th:nth-child(2),
    .recommendations-table td:nth-child(2) {
      width: 200px;
      max-width: 200px;
      min-width: 200px;
    }
    
    .recommendations-table td:nth-child(2) .source-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    
    .recommendations-table td:nth-child(2) .source-url {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    /* Âõ∫ÂÆöÂú∞Âå∫ÂàóÂÆΩÂ∫¶ÔºàÁ¨¨4ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4Ôºâ */
    .recommendations-table th:nth-child(4),
    .recommendations-table td:nth-child(4) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(4) .source-region {
      white-space: nowrap;
      display: inline-block;
    }

    /* Âõ∫ÂÆöÊúâÊïàÊÄßÂàóÂÆΩÂ∫¶ÔºàÁ¨¨6ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4, ÊèèËø∞=5, ÊúâÊïàÊÄß=6Ôºâ */
    .recommendations-table th:nth-child(6),
    .recommendations-table td:nth-child(6) {
      width: 100px;
      max-width: 100px;
      min-width: 100px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(6) .source-validity {
      white-space: nowrap;
      display: inline-block;
    }
    
    /* Âõ∫ÂÆöÁä∂ÊÄÅÂàóÂÆΩÂ∫¶ÔºàÁ¨¨7ÂàóÔºöcheckbox=1, ‰ø°ÊÅØÊ∫ê=2, Á±ªÂûã=3, Âú∞Âå∫=4, ÊèèËø∞=5, ÊúâÊïàÊÄß=6, Áä∂ÊÄÅ=7Ôºâ */
    .recommendations-table th:nth-child(7),
    .recommendations-table td:nth-child(7) {
      width: 80px;
      max-width: 80px;
      min-width: 80px;
      white-space: nowrap;
    }
    
    .recommendations-table td:nth-child(7) .source-status {
      white-space: nowrap;
      display: inline-block;
    }

    .source-name {
      font-weight: 500;
      color: #333;
      cursor: help;
    }

    .source-url {
      color: #8B5CF6;
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: help;
    }

    .source-type {
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .source-description {
      color: #666;
      font-size: 13px;
    }

    /* ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÊ†∑Âºè */
    .curated-sources-header {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      padding: 8px 0;
      transition: background-color 0.2s;
      border-radius: 8px;
      margin: -8px -8px 0 -8px;
      padding: 8px;
    }

    .curated-sources-header:hover {
      background-color: #f8f9fa;
    }

    .curated-sources-header h3 {
      margin: 0;
      flex: 1;
      margin-left: 8px;
    }

    .curated-sources-count {
      color: #8B5CF6;
      font-size: 14px;
      font-weight: normal;
      margin-left: 8px;
    }

    .curated-sources-toggle {
      font-size: 12px;
      color: #666;
      transition: transform 0.3s;
      margin-right: 4px;
    }

    .curated-sources-content {
      margin-top: 20px;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .curated-sources-stats {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      min-width: 150px;
      padding: 16px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 8px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 24px;
      margin: 0 0 4px 0;
      color: #333;
    }

    .stat-card p {
      margin: 0;
      font-size: 12px;
      color: #666;
    }

    .curated-sources-search {
      margin-bottom: 16px;
    }

    .curated-sources-search input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .curated-sources-search input:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .curated-sources-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .curated-sources-filters select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
    }

    .curated-sources-filters select:hover {
      border-color: #8B5CF6;
    }

    .curated-sources-actions {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      padding: 12px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .curated-sources-actions label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    .curated-sources-filtered-count {
      margin-left: auto;
      color: #666;
      font-size: 14px;
    }

    .curated-sources-table-container {
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }

    .curated-sources-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .curated-sources-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .curated-sources-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }

    .curated-sources-table tbody tr:hover {
      background-color: #f8f9fa;
    }

    .curated-source-checkbox {
      cursor: pointer;
    }

    .curated-source-name {
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
    }

    .curated-source-url {
      color: #8B5CF6;
      font-size: 12px;
      word-break: break-all;
    }

    .curated-source-type {
      padding: 4px 8px;
      background-color: #e3f2fd;
      border-radius: 4px;
      font-size: 12px;
      color: #1976d2;
    }

    .curated-source-region {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .curated-source-region.region-domestic {
      background-color: #fff3e0;
      color: #e65100;
    }

    .curated-source-region.region-foreign {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .curated-source-category {
      padding: 4px 8px;
      background-color: #f3e5f5;
      border-radius: 4px;
      font-size: 12px;
      color: #7b1fa2;
    }

    .curated-source-description {
      font-size: 13px;
      color: #666;
      max-width: 300px;
    }

    .source-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .source-status.subscribed {
      background-color: #d4edda;
      color: #155724;
    }

    .source-status.not-subscribed {
      background-color: #f8f9fa;
      color: #666;
    }
    
    .source-validity {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .source-validity.valid {
      background-color: #d4edda;
      color: #155724;
    }
    
    .source-validity.invalid {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .source-validity.validating {
      background-color: #fff3cd;
      color: #856404;
    }

    .source-region {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .source-region.region-domestic {
      background: linear-gradient(135deg, #E9D5FF 0%, #DDD6FE 100%);
      color: #6D28D9;
    }

    .source-region.region-foreign {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      color: #BE185D;
    }

    /* ËøáÊª§Êéß‰ª∂Ê†∑Âºè */
    .recommendations-filters {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 500;
      color: #333;
      white-space: nowrap;
    }

    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      min-width: 120px;
    }

    .filter-group select:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .recommendations-stats {
      font-size: 14px;
      color: #666;
      margin-left: auto;
    }

    /* ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂå∫ÂüüÊ†∑Âºè */
    .manual-add-source {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .manual-add-source h5 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .manual-add-source-form {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .section .manual-add-source-form {
      margin-top: 16px;
    }

    .section .manual-add-source-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .section .manual-add-source-form .form-group label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .section .manual-add-source-form .form-group input,
    .section .manual-add-source-form .form-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    .section .manual-add-source-form .form-group input:focus,
    .section .manual-add-source-form .form-group select:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    .manual-add-source-form .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 200px;
    }

    .manual-add-source-form .form-group label {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .manual-add-source-form .form-group input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      transition: border-color 0.3s;
    }

    .manual-add-source-form .form-group input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .manual-add-source-form .form-group input[type="url"] {
      flex: 2;
      min-width: 300px;
    }

    .manual-add-source-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .manual-add-source-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .manual-add-source-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      padding: 12px 24px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
      transform: translateY(-2px);
    }

    /* DeepSeek ‰∫§‰∫íËøáÁ®ãÊ†∑Âºè */
    .deepseek-process {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: rgba(139, 92, 246, 0.8);
      padding: 8px 12px;
      background: rgba(139, 92, 246, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(139, 92, 246, 0.1);
      min-height: 36px;
    }

    .deepseek-process-text {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .deepseek-process-dots {
      display: inline-block;
      width: 12px;
      text-align: left;
    }

    .deepseek-process-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    .deepseek-process.success {
      color: #28a745;
      background: rgba(40, 167, 69, 0.05);
      border-color: rgba(40, 167, 69, 0.1);
    }

    .deepseek-process.error {
      color: #dc3545;
      background: rgba(220, 53, 69, 0.05);
      border-color: rgba(220, 53, 69, 0.1);
    }

    .deepseek-process.loading {
      color: rgba(139, 92, 246, 0.8);
    }

    /* ‰øùÁïôÊóßÁöÑÊ†∑ÂºèÁî®‰∫éÂÖºÂÆπÔºàÂ¶ÇÊûúÂÖ∂‰ªñÂú∞ÊñπËøòÂú®‰ΩøÁî®Ôºâ */
    .process-step {
      margin-bottom: 6px;
      padding: 5px 8px;
      border-left: 3px solid #8B5CF6;
      background-color: white;
      border-radius: 4px;
    }

    .process-step.success {
      border-left-color: #28a745;
    }

    .process-step.error {
      border-left-color: #dc3545;
    }

    .process-step.loading {
      border-left-color: #ffc107;
    }

    .process-time {
      color: #999;
      font-size: 11px;
      margin-left: 8px;
    }

    .process-message {
      color: #333;
    }

    .process-data {
      margin-top: 4px;
      padding: 4px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 10px;
      color: #666;
      max-height: 80px;
    }

    /* Êé®ËçêËøõÂ∫¶Âä®ÁîªÊ†∑Âºè */
    .recommendation-progress {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .recommendation-progress.loading {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .progress-spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .recommendation-progress:not(.loading) .progress-spinner {
      display: none;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .progress-text {
      flex: 1;
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }

    .recommendation-progress.loading .progress-text {
      color: white;
    }

    .progress-dots {
      display: inline-block;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .progress-stage {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 4px;
    }

    .recommendation-progress:not(.loading) .progress-stage {
      display: none;
    }

    /* Á≠âÂæÖÁä∂ÊÄÅÂä®Áîª */
    .recommendations-empty {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }

    .recommendations-empty.loading {
      color: #8B5CF6;
    }

    .loading-message {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 500;
    }

    .loading-dots {
      display: inline-flex;
      gap: 4px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #8B5CF6;
      animation: bounce 1.4s ease-in-out infinite;
    }

    .loading-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .loading-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes bounce {
      0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ‰∏ªÈ¢òÈ°µÁ≠æÊ†∑Âºè */
    .topics-tabs-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .topics-tabs-header {
      display: flex;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid #dee2e6;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .topics-tabs-header::-webkit-scrollbar {
      height: 6px;
    }

    .topics-tabs-header::-webkit-scrollbar-thumb {
      background: #8B5CF6;
      border-radius: 3px;
    }

    .topic-tab {
      padding: 14px 24px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: #666;
      white-space: nowrap;
      transition: all 0.3s;
      position: relative;
    }

    .topic-tab:hover {
      background: rgba(139, 92, 246, 0.1);
      color: #8B5CF6;
    }

    .topic-tab.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: white;
    }

    .topic-tab .tab-badge {
      display: inline-block;
      margin-left: 8px;
      padding: 2px 8px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .topic-tab.active .tab-badge {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
    }

    .topics-tabs-content {
      padding: 24px;
    }

    .topic-tab-panel {
      display: none;
    }

    .topic-tab-panel.active {
      display: block;
    }

    .topic-tab-panel h4 {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    /* ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ê†∑Âºè */
    .refresh-status {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      color: #666;
      font-size: 14px;
    }

    .status-value {
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .status-value.success {
      color: #28a745;
    }

    .status-value.warning {
      color: #ffc107;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .news-item {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .news-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .news-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .news-item-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      flex: 1;
      margin-right: 16px;
    }

    .news-item-meta {
      display: flex;
      gap: 16px;
      font-size: 13px;
      color: #999;
      margin-bottom: 8px;
    }

    .news-item-summary {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 8px;
    }

    .news-item-source {
      display: inline-block;
      padding: 4px 8px;
      background-color: #f0f0f0;
      border-radius: 4px;
      font-size: 12px;
      color: #666;
    }

    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .message.show {
      display: block;
    }

    .message.error {
      background-color: #fee;
      color: #c33;
      border: 1px solid #fcc;
    }

    .message.success {
      background-color: #efe;
      color: #3c3;
      border: 1px solid #cfc;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    /* ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êñ∞Ê†∑Âºè */
    .articles-stats-bar {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      padding: 20px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
      margin-bottom: 24px;
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
    }
    
    .stats-items-container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      align-items: center;
      flex: 1;
      justify-content: flex-end;
    }
    
    .btn-refresh-now {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .btn-refresh-now:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .btn-refresh-now:active {
      transform: translateY(0);
    }
    
    .btn-refresh-now:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-refresh-now span {
      font-size: 16px;
      display: inline-block;
      animation: none;
    }
    
    .btn-refresh-now.refreshing span {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .refresh-progress {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      margin-left: 12px;
      display: none;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 400px;
    }

    .refresh-progress.show {
      display: flex;
    }

    .refresh-progress .progress-text {
      flex: 1;
      min-width: 0;
    }

    .refresh-progress .progress-dots {
      display: inline-block;
      width: 12px;
      text-align: left;
    }

    .refresh-progress .progress-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      color: #fff;
      font-weight: 700;
      font-size: 18px;
    }

    .source-filter-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      align-items: center;
      justify-content: space-between;
    }

    /* Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†checkboxÂÆπÂô® */
    .relevant-filter-checkbox {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      user-select: none;
      margin-left: auto;
    }

    .relevant-filter-checkbox:hover {
      border-color: #8B5CF6;
      background: #f3e8ff;
    }

    .relevant-filter-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #8B5CF6;
      margin: 0;
    }

    .relevant-filter-checkbox input[type="checkbox"]:checked {
      accent-color: #8B5CF6;
    }

    .relevant-filter-checkbox label {
      cursor: pointer;
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
    }

    .relevant-filter-checkbox:hover label {
      color: #8B5CF6;
    }

    .source-card {
      padding: 12px 24px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .source-card:hover {
      border-color: #8B5CF6;
      color: #8B5CF6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .source-card.active {
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      border-color: #8B5CF6;
      color: white;
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }


    /* ÊñáÁ´†ÊêúÁ¥¢Ê°ÜÊ†∑Âºè */
    .articles-search-container {
      margin: 16px 0;
    }

    .articles-search-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
      background: white;
    }

    .articles-search-input:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .articles-search-input::placeholder {
      color: #999;
    }

    .articles-list-view {
      display: block;
    }

    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .date-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0f0f0;
    }

    .date-header {
      padding-bottom: 16px;
      border-bottom: 2px solid #e8e8e8;
      margin-bottom: 20px;
    }

    .date-text {
      font-size: 20px;
      font-weight: 700;
      color: #8B5CF6;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-text::before {
      content: 'üìÖ';
      font-size: 18px;
    }

    .articles-by-date {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    @media (max-width: 1200px) {
      .articles-by-date {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .articles-by-date {
        grid-template-columns: 1fr;
      }
    }

    .article-card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid #f0f0f0;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* ‰∏çÁõ∏ÂÖ≥ÊñáÁ´†ÁöÑÊ†∑Âºè */
    .article-card.irrelevant {
      background: #fafafa;
      border-color: #e0e0e0;
      opacity: 0.85;
    }

    .article-card.irrelevant::before {
      background: linear-gradient(135deg, #9e9e9e 0%, #bdbdbd 100%);
    }

    .article-card.irrelevant:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(158, 158, 158, 0.15);
      border-color: #bdbdbd;
      opacity: 0.95;
    }

    .article-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      transform: scaleY(0);
      transition: transform 0.3s;
    }

    .article-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.2);
      border-color: #8B5CF6;
    }

    .article-card:hover::before {
      transform: scaleY(1);
    }

    /* ‰∏çÁõ∏ÂÖ≥Ê†áÁ≠æ */
    .article-irrelevant-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
      color: white;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .article-card.irrelevant .article-card-title {
      color: #666;
    }

    .article-card.irrelevant:hover .article-card-title {
      color: #757575;
    }

    .article-card-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
      line-height: 1.4;
      transition: color 0.3s;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-shrink: 0;
    }

    .article-card:hover .article-card-title {
      color: #8B5CF6;
    }

    .article-card-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 12px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .article-card-source {
      display: inline-block;
      padding: 6px 14px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #495057;
      border: 1px solid #dee2e6;
    }

    .article-card-summary {
      color: #495057;
      font-size: 14px;
      line-height: 1.6;
      margin-top: auto;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-grow: 1;
    }

    /* ÊñáÁ´†ËØ¶ÊÉÖËßÜÂõæ */
    .article-detail-view {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 24px;
      position: relative;
    }

    .article-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .btn-back-to-list {
      padding: 10px 20px;
      background-color: #f5f5f5;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .btn-back-to-list:hover {
      background-color: #e0e0e0;
    }

    /* Header Âè≥‰æßÁöÑÊìç‰ΩúÊåâÈíÆÂÆπÂô® */
    .article-header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .article-detail-content {
      max-width: 100%;
    }

    .article-detail-title {
      font-size: 32px;
      font-weight: bold;
      color: #1a1a1a;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .article-detail-meta {
      display: flex;
      gap: 20px;
      font-size: 14px;
      color: #666;
      margin-bottom: 24px;
    }

    .article-detail-image {
      margin-bottom: 24px;
    }

    .article-detail-image img {
      width: 100%;
      border-radius: 8px;
    }

    .article-detail-summary {
      background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
      padding: 16px;
      border-left: 4px solid #8B5CF6;
      border-radius: 4px;
      margin-bottom: 24px;
      font-size: 15px;
      line-height: 1.6;
      color: #333;
    }

    .article-generated-summary {
      background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
      padding: 20px;
      border-left: 4px solid #EC4899;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .article-generated-summary h3 {
      font-size: 18px;
      font-weight: 600;
      color: #BE185D;
      margin-bottom: 12px;
    }

    .article-generated-summary div {
      font-size: 15px;
      line-height: 1.7;
      color: #333;
    }

    .article-detail-text {
      font-size: 16px;
      line-height: 1.8;
      color: #333;
      max-width: 100%;
      word-wrap: break-word;
    }

    .article-detail-text p {
      margin-bottom: 16px;
    }
    
    /* HTMLÂÜÖÂÆπÊ†∑Âºè‰ºòÂåñ */
    .article-detail-text h1,
    .article-detail-text h2,
    .article-detail-text h3,
    .article-detail-text h4,
    .article-detail-text h5,
    .article-detail-text h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.4;
      color: #1a1a1a;
    }
    
    .article-detail-text h1 { font-size: 28px; }
    .article-detail-text h2 { font-size: 24px; }
    .article-detail-text h3 { font-size: 20px; }
    .article-detail-text h4 { font-size: 18px; }
    
    .article-detail-text ul,
    .article-detail-text ol {
      margin: 16px 0;
      padding-left: 32px;
    }
    
    .article-detail-text li {
      margin-bottom: 8px;
    }
    
    .article-detail-text code {
      background-color: #f4f4f4;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      color: #d63384;
    }
    
    .article-detail-text pre {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin: 16px 0;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .article-detail-text pre code {
      background-color: transparent;
      padding: 0;
      color: #333;
    }
    
    .article-detail-text blockquote {
      border-left: 4px solid #8B5CF6;
      padding-left: 16px;
      margin: 16px 0;
      color: #666;
      font-style: italic;
    }
    
    .article-detail-text img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 16px 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .article-detail-text a {
      color: #8B5CF6;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.3s;
    }
    
    .article-detail-text a:hover {
      border-bottom-color: #8B5CF6;
    }
    
    .article-detail-text table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    
    .article-detail-text table th,
    .article-detail-text table td {
      padding: 12px;
      border: 1px solid #e9ecef;
      text-align: left;
    }
    
    .article-detail-text table th {
      background-color: #f8f9fa;
      font-weight: 600;
    }
    
    .article-detail-text hr {
      border: none;
      border-top: 1px solid #e9ecef;
      margin: 24px 0;
    }
    
    .article-detail-text strong {
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .article-detail-text em {
      font-style: italic;
    }

    .btn-translate {
      padding: 10px 20px;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 12px rgba(139, 92, 246, 0.4);
      white-space: nowrap;
    }

    .btn-translate:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.5);
    }

    .btn-translate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .article-source-link {
      display: inline-block;
      margin-top: 24px;
      color: #8B5CF6;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }

    .article-source-link:hover {
      color: #7C3AED;
      text-decoration: underline;
    }

    /* Áî®Êà∑ÊåáÂçóÈ°µÈù¢Ê†∑Âºè */
    .guide-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .guide-step,
    .guide-feature,
    .guide-tip,
    .guide-faq {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .guide-step h4,
    .guide-feature h4,
    .guide-tip h4,
    .guide-faq h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
      font-weight: 600;
    }

    .guide-step p,
    .guide-feature p,
    .guide-faq p {
      margin: 0;
      color: #666;
      line-height: 1.6;
    }

    .guide-tip ul {
      margin: 12px 0 0 0;
      padding-left: 24px;
      color: #666;
    }

    .guide-tip li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    /* ÁâπÊÄß‰ªãÁªçÈ°µÈù¢Ê†∑Âºè - ÂÖ®Â±èÂ±ïÁ§∫ */
    #featuresPage {
      padding: 0;
      margin: 0;
      max-width: 100%;
      background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%);
    }

    #featuresPage .page-header {
      padding: 60px 40px 40px;
      text-align: center;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      color: white;
      margin: 0;
      border-radius: 0;
    }

    #featuresPage .page-header h2 {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 16px;
      color: white;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    #featuresPage .page-header p {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.9);
      margin: 0;
    }

    /* ÁâπÊÄßÂÖ®Â±èÂ±ïÁ§∫ÂÆπÂô® */
    .features-fullscreen {
      display: flex;
      flex-direction: column;
      min-height: calc(100vh - 200px);
    }

    /* ÁâπÊÄßÂç°Áâá - ÂÖ®Â±èÊ†∑Âºè */
    .feature-section {
      min-height: 100vh;
      display: flex;
      align-items: center;
      padding: 80px 40px;
      position: relative;
      overflow: hidden;
    }

    .feature-section:nth-child(even) {
      background: white;
    }

    .feature-section:nth-child(odd) {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.03) 0%, rgba(236, 72, 153, 0.03) 100%);
    }

    .feature-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      width: 100%;
    }

    .feature-container.reverse {
      direction: rtl;
    }

    .feature-container.reverse > * {
      direction: ltr;
    }

    .feature-visual {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 120px;
      opacity: 0.1;
      position: absolute;
      right: 5%;
      top: 50%;
      transform: translateY(-50%);
      z-index: 0;
    }

    .feature-section:nth-child(even) .feature-visual {
      left: 5%;
      right: auto;
    }

    .feature-content {
      position: relative;
      z-index: 1;
    }

    .feature-icon-large {
      font-size: 80px;
      margin-bottom: 24px;
      display: inline-block;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 4px 8px rgba(139, 92, 246, 0.2));
    }

    .feature-title-large {
      font-size: 42px;
      font-weight: 700;
      margin: 0 0 24px 0;
      color: #1a1a1a;
      line-height: 1.2;
      background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .feature-description-large {
      font-size: 18px;
      color: #555;
      line-height: 1.8;
      margin: 0 0 40px 0;
    }

    .feature-value-box {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
      border-left: 4px solid #8B5CF6;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.15);
    }

    .feature-value-label-large {
      font-size: 16px;
      font-weight: 700;
      color: #8B5CF6;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feature-value-label-large::before {
      content: '‚ú®';
      font-size: 20px;
    }

    .feature-value-text-large {
      font-size: 18px;
      color: #333;
      line-height: 1.8;
      font-weight: 500;
    }

    .feature-image {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .feature-image-placeholder {
      width: 100%;
      height: 400px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 120px;
      box-shadow: 0 20px 60px rgba(139, 92, 246, 0.2);
    }

    @media (max-width: 1024px) {
      .feature-container {
        grid-template-columns: 1fr;
        gap: 40px;
      }

      .feature-section {
        padding: 60px 30px;
        min-height: auto;
      }

      .feature-title-large {
        font-size: 32px;
      }

      .feature-description-large {
        font-size: 16px;
      }

      .feature-icon-large {
        font-size: 60px;
      }
    }

    @media (max-width: 768px) {
      #featuresPage .page-header {
        padding: 40px 20px 30px;
      }

      #featuresPage .page-header h2 {
        font-size: 32px;
      }

      #featuresPage .page-header p {
        font-size: 16px;
      }

      .feature-section {
        padding: 40px 20px;
      }

      .feature-title-large {
        font-size: 28px;
      }

      .feature-description-large {
        font-size: 15px;
      }

      .feature-value-box {
        padding: 24px;
      }

      .feature-card {
        padding: 24px;
      }
    }

    /* Êõ¥Êñ∞ÂéÜÂè≤Ê†∑Âºè */
    .changelog-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .changelog-item {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #8B5CF6;
    }

    .changelog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e9ecef;
    }

    .changelog-version {
      font-size: 18px;
      font-weight: 600;
      color: #8B5CF6;
    }

    .changelog-date {
      font-size: 14px;
      color: #999;
    }

    .changelog-section {
      margin-bottom: 12px;
    }

    .changelog-section:last-child {
      margin-bottom: 0;
    }

    .changelog-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .changelog-section ul {
      margin: 0;
      padding-left: 20px;
      color: #666;
    }

    .changelog-section li {
      margin-bottom: 6px;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 200px;
      }

      .main-content {
        margin-left: 200px;
      }
    }
  </style>
  <!-- KaTeX Êï∞Â≠¶ÂÖ¨ÂºèÊ∏≤ÊüìÂ∫ì -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Â∑¶‰æßËèúÂçï -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h1>‰∏™‰∫∫‰ø°ÊÅØÊï¥ÁêÜ</h1>
      <div class="user-info" id="userInfo">Âä†ËΩΩ‰∏≠...</div>
    </div>
    <div class="sidebar-menu">
      <div class="menu-item active" onclick="switchPage('subscriptions', event)">
        <span class="menu-item-icon">üìã</span>
        <span class="menu-item-text">ËÆ¢ÈòÖÁÆ°ÁêÜ</span>
      </div>
      <div class="menu-item" onclick="switchPage('articles', event)">
        <span class="menu-item-icon">üì∞</span>
        <span class="menu-item-text">ÊñáÁ´†ÈòÖËØª</span>
      </div>
      <div class="menu-item" onclick="switchPage('guide', event)">
        <span class="menu-item-icon">üìñ</span>
        <span class="menu-item-text">Áî®Êà∑ÊåáÂçó</span>
      </div>
      <div class="menu-item" onclick="switchPage('features', event)">
        <span class="menu-item-icon">‚≠ê</span>
        <span class="menu-item-text">ÁâπÊÄß‰ªãÁªç</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <button class="logout-btn" onclick="handleLogout()">ÈÄÄÂá∫ÁôªÂΩï</button>
    </div>
  </div>

  <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
  <div class="main-content">
    <!-- ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ -->
    <div id="subscriptionsPage" class="content-page active">
      <div class="page-header">
        <h2>ËÆ¢ÈòÖÁÆ°ÁêÜ</h2>
        <p>ÁÆ°ÁêÜÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂíå‰ø°ÊÅØÊ∫ê</p>
      </div>

      <div id="message" class="message"></div>

      <!-- ‰∏ªÈ¢òÁÆ°ÁêÜ -->
      <div class="section">
        <h3>
          ÊàëÁöÑ‰∏ªÈ¢ò
          <button class="add-topic-btn" onclick="showAddTopicModal()" title="Ê∑ªÂä†Êñ∞‰∏ªÈ¢ò">+</button>
        </h3>
        <div id="topicsList" class="topics-list">
          <div class="loading">Âä†ËΩΩ‰∏≠...</div>
        </div>
      </div>

      <!-- Ê∑ªÂä†Êñ∞‰∏ªÈ¢òÂºπÁ™ó -->
      <div class="modal-overlay" id="addTopicModal" onclick="closeAddTopicModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
          <div class="modal-header">
            <h3>Ê∑ªÂä†Êñ∞‰∏ªÈ¢ò</h3>
            <button class="modal-close" onclick="closeAddTopicModal()">√ó</button>
          </div>
          <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
            ËæìÂÖ•ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªüÂ∞Ü‰∏∫ÊÇ®Êé®Ëçê‰ºòË¥®ÁöÑ‰ø°ÊÅØÊ∫ê
          </p>
          <div class="input-group">
            <input 
              type="text" 
              id="topicInput" 
              placeholder="‰æãÂ¶ÇÔºö‰∫∫Â∑•Êô∫ËÉΩ„ÄÅÊú∫Âô®Â≠¶‰π†„ÄÅÂå∫ÂùóÈìæ..."
              onkeypress="if(event.key==='Enter') recommendSources()"
            >
            <button class="btn-primary" onclick="recommendSources()" id="recommendBtn">
              Ëé∑ÂèñÊé®Ëçê
            </button>
          </div>
        </div>
      </div>

      <!-- ‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô® -->
      <div class="section" id="topicsTabsSection" style="display: none;">
        <div class="topics-tabs-container">
          <div class="topics-tabs-header" id="topicsTabsHeader">
            <!-- È°µÁ≠æÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
          </div>
          <div class="topics-tabs-content" id="topicsTabsContent">
            <!-- È°µÁ≠æÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
          </div>
        </div>
      </div>

      <!-- ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÁ§∫Âå∫Âüü -->
      <div class="section">
        <div class="curated-sources-header" onclick="toggleCuratedSources()">
          <span class="curated-sources-toggle" id="curatedSourcesToggle">‚ñº</span>
          <h3>ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê</h3>
          <span class="curated-sources-count" id="curatedSourcesCount">(Âä†ËΩΩ‰∏≠...)</span>
        </div>
        <div class="curated-sources-content" id="curatedSourcesContent" style="display: none;">
          <!-- ÁªüËÆ°‰ø°ÊÅØÂç°Áâá -->
          <div class="curated-sources-stats" id="curatedSourcesStats"></div>
          
          <!-- ÊêúÁ¥¢Ê°Ü -->
          <div class="curated-sources-search">
            <input 
              type="text" 
              id="searchCuratedSources" 
              placeholder="ÊêúÁ¥¢‰ø°ÊÅØÊ∫êÔºàÂêçÁß∞„ÄÅURL„ÄÅÊèèËø∞Ôºâ..." 
              oninput="filterCuratedSources()"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
            >
          </div>
          
          <!-- Á≠õÈÄâÂô® -->
          <div class="curated-sources-filters">
            <select id="filterType" onchange="filterCuratedSources()">
              <option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>
            </select>
            <select id="filterCategory" onchange="filterCuratedSources()">
              <option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>
            </select>
            <select id="filterRegion" onchange="filterCuratedSources()">
              <option value="">ÂÖ®ÈÉ®Âú∞Âå∫</option>
              <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
              <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
            </select>
          </div>
          
          <!-- ÊâπÈáèÊìç‰Ωú -->
          <div class="curated-sources-actions">
            <label>
              <input type="checkbox" id="selectAllCurated" onchange="toggleSelectAllCurated()">
              ÂÖ®ÈÄâ
            </label>
            <button class="btn-primary" onclick="subscribeSelectedCurated()">ËÆ¢ÈòÖÈÄâ‰∏≠</button>
            <span class="curated-sources-filtered-count" id="curatedSourcesFilteredCount"></span>
          </div>
          
          <!-- ‰ø°ÊÅØÊ∫êË°®Ê†º -->
          <div class="curated-sources-table-container">
            <table class="curated-sources-table">
              <thead>
                <tr>
                  <th width="40">
                    <input type="checkbox" id="selectAllCuratedHeader" onchange="toggleSelectAllCurated()">
                  </th>
                  <th>‰ø°ÊÅØÊ∫êÂêçÁß∞</th>
                  <th width="100">Á±ªÂûã</th>
                  <th width="80">Âú∞Âå∫</th>
                  <th width="100">ÂàÜÁ±ª</th>
                  <th>ÊèèËø∞</th>
                </tr>
              </thead>
              <tbody id="curatedSourcesTableBody">
                <tr>
                  <td colspan="6" class="loading">Âä†ËΩΩ‰∏≠...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê -->
      <div class="section">
        <h3>üìù ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê</h3>
        <div class="manual-add-source-form">
          <div class="form-group">
            <label for="manualSourceNameGlobal">‰ø°ÊÅØÊ∫êÂêçÁß∞</label>
            <input type="text" id="manualSourceNameGlobal" placeholder="ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êÂêçÁß∞" onkeypress="if(event.key==='Enter') document.getElementById('manualSourceUrlGlobal').focus()" />
          </div>
          <div class="form-group" style="flex: 2; min-width: 300px;">
            <label for="manualSourceUrlGlobal">‰ø°ÊÅØÊ∫êURL</label>
            <input type="url" id="manualSourceUrlGlobal" placeholder="https://example.com/feed.xml" onkeypress="if(event.key==='Enter') handleManualAddSourceGlobal()" />
          </div>
          <button class="manual-add-source-btn" onclick="handleManualAddSourceGlobal()" id="manualAddBtnGlobal">
            Ê∑ªÂä†Âπ∂ËÆ¢ÈòÖ
          </button>
        </div>
        
        <!-- Â∑≤Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°® -->
        <div id="manualAddedSourcesList" style="margin-top: 24px;">
          <h4 style="font-size: 16px; margin-bottom: 12px; color: #333;">Â∑≤Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê</h4>
          <div id="manualAddedSourcesContent">
            <p style="color: #999; text-align: center; padding: 20px;">ÊöÇÊó†ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ -->
    <div id="articlesPage" class="content-page">
      <!-- ‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô® -->
      <div class="topics-tabs-container" id="articlesTopicsTabsContainer" style="display: none;">
        <div class="topics-tabs-header" id="articlesTopicsTabsHeader">
          <!-- È°µÁ≠æÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="topics-tabs-content" id="articlesTopicsTabsContent">
          <!-- È°µÁ≠æÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>

      <!-- Êó†‰∏ªÈ¢òÊó∂ÁöÑÊèêÁ§∫ -->
      <div id="articlesNoTopicsHint" class="empty-state" style="display: none;">
        <p>ÊöÇÊó†‰∏ªÈ¢òÔºåËØ∑ÂÖàÂú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ê∑ªÂä†‰∏ªÈ¢òÂπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</p>
      </div>

      <!-- ÊñáÁ´†ËØ¶ÊÉÖËßÜÂõæ -->
      <div id="articleDetailView" class="article-detail-view" style="display: none;">
        <div class="article-detail-header">
          <button class="btn-back-to-list" onclick="backToList()">‚Üê ËøîÂõûÂàóË°®</button>
          <div class="article-header-actions">
            <button id="articleSummarizeBtn" class="btn-translate" onclick="generateSummary()" style="display: none;">ÁîüÊàêÊÄªÁªì</button>
            <button id="articleTranslateBtn" class="btn-translate" onclick="toggleTranslate()" style="display: none;">ÁøªËØë‰∏∫‰∏≠Êñá</button>
          </div>
        </div>
        <div class="article-detail-content">
          <h1 id="articleDetailTitle" class="article-detail-title">Âä†ËΩΩ‰∏≠...</h1>
          <div class="article-detail-meta">
            <span id="articleDetailSource"></span>
            <span id="articleDetailDate"></span>
          </div>
          <div id="articleDetailImage" class="article-detail-image"></div>
          <div id="articleGeneratedSummary" class="article-generated-summary" style="display: none;">
            <h3>ÊñáÁ´†ÊÄªÁªì</h3>
            <div id="articleGeneratedSummaryContent"></div>
          </div>
          <div id="articleDetailSummary" class="article-detail-summary"></div>
          <div id="articleDetailContent" class="article-detail-text"></div>
          <a id="articleSourceLink" href="#" target="_blank" class="article-source-link" style="display: none;">Êü•ÁúãÂéüÊñáÈìæÊé•</a>
          <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button class="btn-back-to-list" onclick="backToList()">‚Üê ËøîÂõûÂàóË°®</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Áî®Êà∑ÊåáÂçóÈ°µÈù¢ -->
    <div id="guidePage" class="content-page">
      <div class="page-header">
        <h2>Áî®Êà∑ÊåáÂçó</h2>
        <p>‰∫ÜËß£Â¶Ç‰Ωï‰ΩøÁî®‰∏™‰∫∫‰ø°ÊÅØÊï¥ÁêÜÁ≥ªÁªü</p>
      </div>

      <!-- Âü∫Á°Ä‰ΩøÁî®ÊµÅÁ®ã -->
      <div class="section">
        <h3>üìö Âü∫Á°Ä‰ΩøÁî®ÊµÅÁ®ã</h3>
        <div class="guide-content">
          <div class="guide-step">
            <h4>1. Ê≥®ÂÜå/ÁôªÂΩï</h4>
            <p>È¶ñÊ¨°‰ΩøÁî®ÈúÄË¶ÅÊ≥®ÂÜåË¥¶Âè∑ÔºåËæìÂÖ•Áî®Êà∑Âêç„ÄÅÈÇÆÁÆ±ÂíåÂØÜÁ†ÅÂç≥ÂèØÂÆåÊàêÊ≥®ÂÜå„ÄÇÂ∑≤ÊúâË¥¶Âè∑ÁöÑÁî®Êà∑ÂèØ‰ª•Áõ¥Êé•ÁôªÂΩï„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>2. Ê∑ªÂä†‰∏ªÈ¢òÂÖ≥ÈîÆËØç</h4>
            <p>Âú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢ÔºåÁÇπÂáª"+"ÊåâÈíÆÊ∑ªÂä†ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºå‰æãÂ¶ÇÔºö‰∫∫Â∑•Êô∫ËÉΩ„ÄÅÊú∫Âô®Â≠¶‰π†„ÄÅÂå∫ÂùóÈìæÁ≠â„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>3. Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê</h4>
            <p>ËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂêéÔºåÁÇπÂáª"Ëé∑ÂèñÊé®Ëçê"ÊåâÈíÆÔºåÁ≥ªÁªü‰ºö‰ΩøÁî® AI ‰∏∫ÊÇ®Êé®Ëçê‰ºòË¥®ÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>4. ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</h4>
            <p>Âú®Êé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®‰∏≠ÔºåÈÄâÊã©ÊÇ®ÊÑüÂÖ¥Ë∂£ÁöÑ‰ø°ÊÅØÊ∫êÔºåÁÇπÂáª"ËÆ¢ÈòÖÈÄâ‰∏≠"ÊåâÈíÆÂÆåÊàêËÆ¢ÈòÖ„ÄÇ</p>
          </div>
          <div class="guide-step">
            <h4>5. Êü•ÁúãÊî∂ÈõÜÁöÑÊñ∞Èóª</h4>
            <p>ËÆ¢ÈòÖÂêéÔºåÁ≥ªÁªü‰ºöÊØè 10 ÂàÜÈíüËá™Âä®Êî∂ÈõÜËøô‰∫õ‰ø°ÊÅØÊ∫êÁöÑÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇÊÇ®ÂèØ‰ª•Âú®"ÊñáÁ´†ÈòÖËØª"È°µÈù¢Êü•ÁúãÊî∂ÈõÜÂà∞ÁöÑÊñ∞Èóª„ÄÇ</p>
          </div>
        </div>
      </div>

      <!-- ËØ¶ÁªÜÂäüËÉΩ‰ªãÁªç -->
      <div class="section">
        <h3>üîß ËØ¶ÁªÜÂäüËÉΩ‰ªãÁªç</h3>
        <div class="guide-content">
          <div class="guide-feature">
            <h4>‰∏ªÈ¢òÁÆ°ÁêÜ</h4>
            <p>ÊÇ®ÂèØ‰ª•Ê∑ªÂä†Â§ö‰∏™‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªü‰ºö‰∏∫ÊØè‰∏™‰∏ªÈ¢òÊé®ËçêÁõ∏Â∫îÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇ‰∏ªÈ¢ò‰πãÈó¥Áõ∏‰∫íÁã¨Á´ãÔºåÊñπ‰æøÊÇ®ÁÆ°ÁêÜ‰∏çÂêåÈ¢ÜÂüüÁöÑÂÖ≥Ê≥®ÁÇπ„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>AI Êé®Ëçê‰ø°ÊÅØÊ∫ê</h4>
            <p>Á≥ªÁªü‰ΩøÁî® DeepSeek AI Ê†πÊçÆÊÇ®ËæìÂÖ•ÁöÑÂÖ≥ÈîÆËØçÔºåÊô∫ËÉΩÊé®ËçêÁõ∏ÂÖ≥ÁöÑÈ´òË¥®Èáè‰ø°ÊÅØÊ∫êÔºåÂåÖÊã¨ RSS Ê∫êÂíåÂçöÂÆ¢ÁΩëÁ´ô„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>ËÆ¢ÈòÖÁÆ°ÁêÜ</h4>
            <p>Âú®ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ÔºåÊÇ®ÂèØ‰ª•Êü•ÁúãÊâÄÊúâÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºåÂåÖÊã¨‰ø°ÊÅØÊ∫êÂêçÁß∞„ÄÅURL„ÄÅÁ±ªÂûãÂíåÂàÜÁ±ª„ÄÇÊÇ®ÂèØ‰ª•ÈöèÊó∂ÂèñÊ∂à‰∏çÈúÄË¶ÅÁöÑËÆ¢ÈòÖ„ÄÇ</p>
          </div>
          <div class="guide-feature">
            <h4>ÊñáÁ´†ÈòÖËØª</h4>
            <p>ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êåâ‰∏ªÈ¢òÂàÜÁªÑÂ±ïÁ§∫Êñ∞ÈóªÔºåÊîØÊåÅÊåâ‰ø°ÊÅØÊ∫êËøáÊª§„ÄÇÁÇπÂáªÊñáÁ´†ÂèØ‰ª•Êü•ÁúãËØ¶ÊÉÖÔºåÊîØÊåÅÁîüÊàêÊëòË¶ÅÂíåÁøªËØëÂäüËÉΩ„ÄÇ</p>
          </div>
        </div>
      </div>

      <!-- ‰ΩøÁî®ÊäÄÂ∑ßÂíåÊúÄ‰Ω≥ÂÆûË∑µ -->
      <div class="section">
        <h3>üí° ‰ΩøÁî®ÊäÄÂ∑ßÂíåÊúÄ‰Ω≥ÂÆûË∑µ</h3>
        <div class="guide-content">
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÈÄâÊã©ÊúâÊïàÁöÑÂÖ≥ÈîÆËØç</h4>
            <ul>
              <li>‰ΩøÁî®ÂÖ∑‰ΩìÁöÑÂÖ≥ÈîÆËØçÔºåÈÅøÂÖçËøá‰∫éÂÆΩÊ≥õÁöÑËØçÊ±á</li>
              <li>ÂèØ‰ª•Â∞ùËØï‰ΩøÁî®Ëã±ÊñáÂÖ≥ÈîÆËØçÔºåÂèØËÉΩËé∑ÂæóÊõ¥Â§ö‰ºòË¥®‰ø°ÊÅØÊ∫ê</li>
              <li>ÁªìÂêàÂ§ö‰∏™Áõ∏ÂÖ≥ÂÖ≥ÈîÆËØçÔºåËé∑ÂæóÊõ¥ÂÖ®Èù¢ÁöÑÊé®Ëçê</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÁÆ°ÁêÜÂ§ö‰∏™‰∏ªÈ¢ò</h4>
            <ul>
              <li>‰∏∫‰∏çÂêåÈ¢ÜÂüüÂàõÂª∫‰∏çÂêåÁöÑ‰∏ªÈ¢òÔºå‰æø‰∫éÂàÜÁ±ªÁÆ°ÁêÜ</li>
              <li>ÂÆöÊúüÊ£ÄÊü•ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºåÂèñÊ∂à‰∏çÂÜçÈúÄË¶ÅÁöÑËÆ¢ÈòÖ</li>
              <li>Âú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ôºå‰ΩøÁî®‰∏ªÈ¢òÈ°µÁ≠æÂø´ÈÄüÂàáÊç¢‰∏çÂêå‰∏ªÈ¢òÁöÑÂÜÖÂÆπ</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰Ωï‰ºòÂåñËÆ¢ÈòÖÂàóË°®</h4>
            <ul>
              <li>‰ºòÂÖàËÆ¢ÈòÖÊõ¥Êñ∞È¢ëÁéáÈ´ò„ÄÅÂÜÖÂÆπË¥®ÈáèÂ•ΩÁöÑ‰ø°ÊÅØÊ∫ê</li>
              <li>ÈÅøÂÖçËÆ¢ÈòÖËøáÂ§öÁõ∏‰ººÁöÑ‰ø°ÊÅØÊ∫êÔºåÂáèÂ∞ëÈáçÂ§çÂÜÖÂÆπ</li>
              <li>ÂÆöÊúüÊ£ÄÊü•ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÊòØÂê¶‰ªçÁÑ∂Ê¥ªË∑É</li>
            </ul>
          </div>
          <div class="guide-tip">
            <h4>Â¶Ç‰ΩïÈ´òÊïàÈòÖËØªÊñ∞Èóª</h4>
            <ul>
              <li>‰ΩøÁî®‰ø°ÊÅØÊ∫êËøáÊª§ÂäüËÉΩÔºå‰∏ìÊ≥®‰∫éÁâπÂÆöÊù•Ê∫êÁöÑÂÜÖÂÆπ</li>
              <li>Âà©Áî®ÊñáÁ´†ÊëòË¶ÅÂäüËÉΩÔºåÂø´ÈÄü‰∫ÜËß£ÊñáÁ´†Ë¶ÅÁÇπ</li>
              <li>‰ΩøÁî®ÁøªËØëÂäüËÉΩÈòÖËØªËã±ÊñáÂÜÖÂÆπ</li>
              <li>Âú®ÊñáÁ´†ËØ¶ÊÉÖÈ°µÊü•ÁúãÂéüÊñáÈìæÊé•ÔºåËé∑ÂèñÂÆåÊï¥‰ø°ÊÅØ</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Â∏∏ËßÅÈóÆÈ¢òËß£Á≠î -->
      <div class="section">
        <h3>‚ùì Â∏∏ËßÅÈóÆÈ¢òËß£Á≠îÔºàFAQÔºâ</h3>
        <div class="guide-content">
          <div class="guide-faq">
            <h4>Â¶Ç‰ΩïÂºÄÂßã‰ΩøÁî®Ôºü</h4>
            <p>È¶ñÂÖàÊ≥®ÂÜå‰∏Ä‰∏™Ë¥¶Âè∑ÔºåÁÑ∂ÂêéÂú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ê∑ªÂä†ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåËé∑ÂèñÊé®ËçêÂπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºåÁ≥ªÁªüÂ∞±‰ºöËá™Âä®‰∏∫ÊÇ®Êî∂ÈõÜÁõ∏ÂÖ≥Êñ∞Èóª„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>‰∏∫‰ªÄ‰πàÊ≤°ÊúâÊé®ËçêÂà∞‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÂèØËÉΩÁöÑÂéüÂõ†ÂåÖÊã¨ÔºöÂÖ≥ÈîÆËØçËøá‰∫éÂÆΩÊ≥õÊàñÁâπÊÆä„ÄÅAI Êé®ËçêÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®„ÄÇÂª∫ËÆÆÂ∞ùËØï‰ΩøÁî®Êõ¥ÂÖ∑‰ΩìÁöÑÂÖ≥ÈîÆËØçÔºåÊàñÁ®çÂêéÈáçËØï„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>Êñ∞ÈóªÂ§ö‰πÖÊõ¥Êñ∞‰∏ÄÊ¨°Ôºü</h4>
            <p>Á≥ªÁªüÊØè 10 ÂàÜÈíüËá™Âä®Êî∂ÈõÜ‰∏ÄÊ¨°ÊÇ®ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÁöÑÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇÊÇ®‰πüÂèØ‰ª•ÊâãÂä®Âà∑Êñ∞Êü•ÁúãÊúÄÊñ∞ÂÜÖÂÆπ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>Â¶Ç‰ΩïÂèñÊ∂àËÆ¢ÈòÖÔºü</h4>
            <p>Âú®"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢ÔºåÊâæÂà∞Ë¶ÅÂèñÊ∂àÁöÑËÆ¢ÈòÖÔºåÁÇπÂáªÂà†Èô§ÊåâÈíÆÂç≥ÂèØ„ÄÇÂèñÊ∂àËÆ¢ÈòÖÂêéÔºåÁ≥ªÁªüÂ∞Ü‰∏çÂÜçÊî∂ÈõÜËØ•‰ø°ÊÅØÊ∫êÁöÑÂÜÖÂÆπ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>ÂèØ‰ª•ËÆ¢ÈòÖÂ§öÂ∞ë‰∏™‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÁõÆÂâçÊ≤°ÊúâÈôêÂà∂Ôºå‰ΩÜÂª∫ËÆÆ‰∏çË¶ÅËÆ¢ÈòÖËøáÂ§ö‰ø°ÊÅØÊ∫êÔºå‰ª•ÂÖçÂÜÖÂÆπËøáÂ§öÈöæ‰ª•ÁÆ°ÁêÜ„ÄÇÂª∫ËÆÆÊéßÂà∂Âú® 20-30 ‰∏™‰ª•ÂÜÖ„ÄÇ</p>
          </div>
          <div class="guide-faq">
            <h4>ÊîØÊåÅÂì™‰∫õÁ±ªÂûãÁöÑ‰ø°ÊÅØÊ∫êÔºü</h4>
            <p>ÁõÆÂâçÊîØÊåÅ RSS Ê∫êÂíåÂçöÂÆ¢ÁΩëÁ´ô„ÄÇÁ≥ªÁªü‰ºöËá™Âä®ËØÜÂà´‰ø°ÊÅØÊ∫êÁ±ªÂûãÂπ∂ÈááÁî®Áõ∏Â∫îÁöÑÊî∂ÈõÜÊñπÂºè„ÄÇ</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ÁâπÊÄß‰ªãÁªçÈ°µÈù¢ -->
    <div id="featuresPage" class="content-page">
      <div class="page-header">
        <h2>Ê†∏ÂøÉÁâπÊÄß</h2>
        <p>‰∏∫ÊÇ®ÊâìÈÄ†‰∏™ÊÄßÂåñÁöÑ‰ø°ÊÅØËé∑Âèñ‰ΩìÈ™å</p>
      </div>

      <div class="features-fullscreen">
        <!-- ÁâπÊÄß1: AIÊô∫ËÉΩÊé®Ëçê -->
        <div class="feature-section">
          <div class="feature-visual">ü§ñ</div>
          <div class="feature-container">
            <div class="feature-content">
              <div class="feature-icon-large">ü§ñ</div>
              <h2 class="feature-title-large">AI Êô∫ËÉΩÊé®Ëçê‰ø°ÊÅØÊ∫ê</h2>
              <p class="feature-description-large">
                Âü∫‰∫é DeepSeek AI ÁöÑÂº∫Â§ßËÉΩÂäõÔºåÂè™ÈúÄËæìÂÖ•ÊÇ®ÂÖ≥Ê≥®ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÁ≥ªÁªüÂ∞±ËÉΩÊô∫ËÉΩÂàÜÊûêÂπ∂‰∏∫ÊÇ®Êé®ËçêÂÖ®ÁêÉÊúÄ‰ºòË¥®„ÄÅÊúÄÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÊ∫ê„ÄÇÊó†ËÆ∫ÊòØ RSS ËÆ¢ÈòÖ„ÄÅÂçöÂÆ¢ÁΩëÁ´ôËøòÊòØÊñ∞ÈóªÊ∫êÔºåAI ÈÉΩËÉΩÁ≤æÂáÜÂåπÈÖçÊÇ®ÁöÑÈúÄÊ±Ç„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  ÂëäÂà´ÁπÅÁêêÁöÑÊâãÂä®ÊêúÁ¥¢ÔºÅAI Âú®Êï∞ÁßíÂÜÖ‰∏∫ÊÇ®ÊâæÂà∞ÊúÄÂåπÈÖçÁöÑ‰ºòË¥®‰ø°ÊÅØÊ∫êÔºåËäÇÁúÅÊÇ® 90% ÁöÑÊêúÁ¥¢Êó∂Èó¥„ÄÇÂÜÖÁΩÆ 968+ ‰∏™Â∑≤È™åËØÅÁöÑÈ´òË¥®Èáè‰ø°ÊÅØÊ∫êÔºåÁ°Æ‰øùÊé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÁúüÂÆûÂèØÁî®„ÄÇ
        </div>
      </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">ü§ñ</div>
          </div>
            </div>
          </div>

        <!-- ÁâπÊÄß2: ‰∏™ÊÄßÂåñÂÜÖÂÆπËÅöÂêà -->
        <div class="feature-section">
          <div class="feature-visual">üì∞</div>
          <div class="feature-container reverse">
            <div class="feature-content">
              <div class="feature-icon-large">üì∞</div>
              <h2 class="feature-title-large">‰∏™ÊÄßÂåñÂÜÖÂÆπËÅöÂêà</h2>
              <p class="feature-description-large">
                Á≥ªÁªüÊ†πÊçÆÊÇ®ÁöÑËÆ¢ÈòÖËá™Âä®Êî∂ÈõÜÂíåÊï¥ÁêÜÊñ∞ÈóªÂÜÖÂÆπÔºåÊØè 10 ÂàÜÈíüËá™Âä®Êõ¥Êñ∞‰∏ÄÊ¨°„ÄÇÊîØÊåÅÂ§ö‰∏ªÈ¢òÁÆ°ÁêÜÔºåÊØè‰∏™‰∏ªÈ¢òÁã¨Á´ãÊî∂ÈõÜÔºå‰∫í‰∏çÂπ≤Êâ∞„ÄÇÊô∫ËÉΩËøáÊª§‰∏çÁõ∏ÂÖ≥ÂÜÖÂÆπÔºåÁ°Æ‰øùÊÇ®ÁúãÂà∞ÁöÑÊØè‰∏ÄÊù°‰ø°ÊÅØÈÉΩÁ≤æÂáÜÂåπÈÖçÊÇ®ÁöÑÂÖ¥Ë∂£„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  ‰ø°ÊÅØËøáËΩΩÊó∂‰ª£ÁöÑÊïëÊòüÔºÅÂè™ÁúãÂà∞ÊÇ®ÁúüÊ≠£ÂÖ≥ÂøÉÁöÑÂÜÖÂÆπÔºåÂëäÂà´‰ø°ÊÅØÂô™Èü≥„ÄÇÂ§ö‰∏ªÈ¢òÂπ∂Ë°åÁÆ°ÁêÜÔºåÂ∑•‰Ωú„ÄÅÂ≠¶‰π†„ÄÅÂÖ¥Ë∂£‰∏ÄÁΩëÊâìÂ∞ΩÔºå‰∏Ä‰∏™Âπ≥Âè∞Êª°Ë∂≥ÊâÄÊúâ‰ø°ÊÅØÈúÄÊ±Ç„ÄÇ
                </div>
              </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">üì∞</div>
            </div>
            </div>
          </div>

        <!-- ÁâπÊÄß3: ÂÖ®Ê∫êËÆ¢ÈòÖÁÆ°ÁêÜ -->
        <div class="feature-section">
          <div class="feature-visual">üìã</div>
          <div class="feature-container">
            <div class="feature-content">
              <div class="feature-icon-large">üìã</div>
              <h2 class="feature-title-large">ÂÖ®Ê∫êËÆ¢ÈòÖÁÆ°ÁêÜ</h2>
              <p class="feature-description-large">
                Áªü‰∏ÄÁÆ°ÁêÜÊâÄÊúâ‰ø°ÊÅØÊ∫êÔºåÊîØÊåÅ RSS„ÄÅAtom„ÄÅÂçöÂÆ¢„ÄÅÊñ∞ÈóªÁΩëÁ´ôÁ≠âÂ§öÁßçÁ±ªÂûã„ÄÇÂÜÖÁΩÆ 968+ ‰∏™È´òË¥®Èáè‰ø°ÊÅØÊ∫êÂ∫ìÔºåÊîØÊåÅÊêúÁ¥¢ÂíåÁ≠õÈÄâ„ÄÇ‰∏ÄÈîÆÊâπÈáèËÆ¢ÈòÖÔºåËΩªÊùæÁÆ°ÁêÜÊï∞Áôæ‰∏™‰ø°ÊÅØÊ∫ê„ÄÇÊØè‰∏™Áî®Êà∑ÁöÑËÆ¢ÈòÖÂÆåÂÖ®Áã¨Á´ãÔºåÊï∞ÊçÆÂÆâÂÖ®ÂèØÈù†„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  ÂëäÂà´ÂàÜÊï£ÁÆ°ÁêÜÔºÅ‰∏Ä‰∏™Âπ≥Âè∞Áªü‰∏ÄÁÆ°ÁêÜÊâÄÊúâ‰ø°ÊÅØÊ∫êÔºåÊó†ÈúÄÂú®Â§ö‰∏™ÁΩëÁ´ôÈó¥ÂàáÊç¢„ÄÇÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ∫ìËÆ©ÊÇ®Âø´ÈÄüÂèëÁé∞‰ºòË¥®ÂÜÖÂÆπÔºåÊêúÁ¥¢Á≠õÈÄâÂäüËÉΩÂ∏ÆÊÇ®Á≤æÂáÜÂÆö‰ΩçÊâÄÈúÄ‰ø°ÊÅØÊ∫ê„ÄÇ
                </div>
              </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">üìã</div>
            </div>
            </div>
          </div>

        <!-- ÁâπÊÄß4: Êô∫ËÉΩÈòÖËØª‰ΩìÈ™å -->
        <div class="feature-section">
          <div class="feature-visual">üìñ</div>
          <div class="feature-container reverse">
            <div class="feature-content">
              <div class="feature-icon-large">üìñ</div>
              <h2 class="feature-title-large">Êô∫ËÉΩÈòÖËØª‰ΩìÈ™å</h2>
              <p class="feature-description-large">
                Êåâ‰∏ªÈ¢òÂíå‰ø°ÊÅØÊ∫êÊô∫ËÉΩËøáÊª§ÊñáÁ´†ÔºåÂø´ÈÄüÂÆö‰ΩçÊÑüÂÖ¥Ë∂£ÁöÑÂÜÖÂÆπ„ÄÇÊîØÊåÅÊñáÁ´†ÊëòË¶ÅÁîüÊàêÔºåÂø´ÈÄü‰∫ÜËß£Ê†∏ÂøÉË¶ÅÁÇπ„ÄÇÂÜÖÁΩÆÁøªËØëÂäüËÉΩÔºåËΩªÊùæÈòÖËØªÂ§öËØ≠Ë®ÄÂÜÖÂÆπ„ÄÇÊåâÊó•ÊúüÂàÜÁªÑÂ±ïÁ§∫ÔºåÊó∂Èó¥Á∫øÊ∏ÖÊô∞Êòé‰∫Ü„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  ÊèêÂçáÈòÖËØªÊïàÁéá 10 ÂÄçÔºÅÊô∫ËÉΩËøáÊª§Â∏ÆÊÇ®Âø´ÈÄüÊâæÂà∞ÂÖ≥ÈîÆ‰ø°ÊÅØÔºåÊëòË¶ÅÂäüËÉΩËÆ©ÊÇ® 30 Áßí‰∫ÜËß£ÊñáÁ´†Ë¶ÅÁÇπÔºåÁøªËØëÂäüËÉΩÊâìÁ†¥ËØ≠Ë®ÄÂ£ÅÂûíÔºåËÆ©ÂÖ®ÁêÉ‰ºòË¥®ÂÜÖÂÆπËß¶ÊâãÂèØÂèä„ÄÇ
                </div>
              </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">üìñ</div>
            </div>
            </div>
          </div>

        <!-- ÁâπÊÄß5: ÂÆâÂÖ®ÈöêÁßÅ‰øùÊä§ -->
        <div class="feature-section">
          <div class="feature-visual">üîê</div>
          <div class="feature-container">
            <div class="feature-content">
              <div class="feature-icon-large">üîê</div>
              <h2 class="feature-title-large">ÂÆâÂÖ®ÈöêÁßÅ‰øùÊä§</h2>
              <p class="feature-description-large">
                ÂÆåÊï¥ÁöÑÁî®Êà∑ËÆ§ËØÅÁ≥ªÁªüÔºå‰ΩøÁî® JWT token ËøõË°åÂÆâÂÖ®Ë∫´‰ªΩÈ™åËØÅ„ÄÇÊØè‰∏™Áî®Êà∑ÁöÑÊï∞ÊçÆÂÆåÂÖ®ÈöîÁ¶ªÔºåÊÇ®Âè™ËÉΩÁúãÂà∞Ëá™Â∑±ËÆ¢ÈòÖÁöÑÂÜÖÂÆπ„ÄÇÂØÜÁ†ÅÈááÁî® bcrypt Âä†ÂØÜÂ≠òÂÇ®ÔºåÁ°Æ‰øùË¥¶Êà∑ÂÆâÂÖ®„ÄÇÊîØÊåÅÂ§öËÆæÂ§áÁôªÂΩïÔºåÈöèÊó∂ÈöèÂú∞ËÆøÈóÆÊÇ®ÁöÑ‰∏™ÊÄßÂåñ‰ø°ÊÅØÊµÅ„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  ÊÇ®ÁöÑÊï∞ÊçÆÔºåÊÇ®ÂÅö‰∏ªÔºÅ‰∏•Ê†ºÁöÑÈöêÁßÅ‰øùÊä§Êú∫Âà∂Á°Æ‰øùÊÇ®ÁöÑËÆ¢ÈòÖÂíåÈòÖËØªËÆ∞ÂΩïÂÆåÂÖ®ÁßÅÂØÜ„ÄÇ‰ºÅ‰∏öÁ∫ßÂÆâÂÖ®Ê†áÂáÜÔºåËÆ©ÊÇ®ÂÆâÂøÉ‰ΩøÁî®Ôºå‰∏ìÊ≥®‰∫éÂÜÖÂÆπÊú¨Ë∫´„ÄÇ
            </div>
              </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">üîê</div>
          </div>
        </div>
      </div>

        <!-- ÁâπÊÄß6: ÁÅµÊ¥ªÊâ©Â±ïËÉΩÂäõ -->
        <div class="feature-section">
          <div class="feature-visual">‚ö°</div>
          <div class="feature-container reverse">
            <div class="feature-content">
              <div class="feature-icon-large">‚ö°</div>
              <h2 class="feature-title-large">ÁÅµÊ¥ªÊâ©Â±ïËÉΩÂäõ</h2>
              <p class="feature-description-large">
                ÊîØÊåÅÊâãÂä®Ê∑ªÂä†‰ªªÊÑè‰ø°ÊÅØÊ∫êÔºåÊó†ËÆ∫ÊòØ RSS„ÄÅÂçöÂÆ¢ËøòÊòØÊñ∞ÈóªÁΩëÁ´ôÔºåÂè™ÈúÄËæìÂÖ• URL Âç≥ÂèØËá™Âä®ËØÜÂà´Âπ∂ËÆ¢ÈòÖ„ÄÇÂº∫Â§ßÁöÑÁà¨Ëô´Á≥ªÁªüÊîØÊåÅÂ§öÁßçÂÜÖÂÆπÊ†ºÂºèÔºåÊô∫ËÉΩÊèêÂèñÊñáÁ´†ÂÜÖÂÆπ„ÄÇÊîØÊåÅ Twitter/X„ÄÅNitter Á≠âÂ§öÁßçÁ§æ‰∫§Â™í‰ΩìÊ∫êÔºåÂÖ®Èù¢Ë¶ÜÁõñ‰ø°ÊÅØËé∑ÂèñÊ∏†ÈÅì„ÄÇ
              </p>
              <div class="feature-value-box">
                <div class="feature-value-label-large">Ê†∏ÂøÉ‰ª∑ÂÄº</div>
                <div class="feature-value-text-large">
                  Êó†ÈôêÊâ©Â±ïÂèØËÉΩÔºÅ‰∏çÂèóÂπ≥Âè∞ÈôêÂà∂Ôºå‰ªª‰Ωï‰ø°ÊÅØÊ∫êÈÉΩËÉΩËΩªÊùæÊé•ÂÖ•„ÄÇÊô∫ËÉΩÂÜÖÂÆπÊèêÂèñÁ°Æ‰øùÈ´òË¥®ÈáèÈòÖËØª‰ΩìÈ™åÔºåËÆ©ÊÇ®ÁúüÊ≠£ÂÆûÁé∞"‰∏Ä‰∏™Âπ≥Âè∞ÔºåÊâÄÊúâ‰ø°ÊÅØ"ÁöÑÊÑøÊôØ„ÄÇ
                </div>
              </div>
            </div>
            <div class="feature-image">
              <div class="feature-image-placeholder">‚ö°</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API Âü∫Á°ÄÂú∞ÂùÄ
    const API_BASE_URL = (() => {
      // Êú¨Âú∞ÂºÄÂèëÔºö‰ΩøÁî®Êú¨Âú∞API
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        return `${window.location.protocol}//${window.location.host}/api`;
      }
      // Áîü‰∫ßÁéØÂ¢ÉÔºö‰ΩøÁî® Railway ÂêéÁ´ØÂú∞ÂùÄ
      return 'https://news-agent-production-c5db.up.railway.app/api';
    })();

    let authToken = localStorage.getItem('authToken');
    let currentUser = null;
    let recommendedSources = [];
    let userSubscriptions = []; // Áî®Êà∑Â∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®Ôºà‰ªÖÂêçÁß∞Ôºâ
    let userSubscriptionsMap = {}; // Áî®Êà∑Â∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÊò†Â∞Ñ {sourceName: {sourceName, sourceUrl}, ...}
    let savedProcessLogs = []; // ‰øùÂ≠òÁöÑÊé®ËçêËøáÁ®ãÊó•Âøó
    
    // ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Áõ∏ÂÖ≥ÂèòÈáè
    let allArticles = []; // Â≠òÂÇ®ÊâÄÊúâÊñáÁ´†Êï∞ÊçÆ
    let filteredArticles = []; // ÂΩìÂâçËøáÊª§ÂêéÁöÑÊñáÁ´†
    let currentSourceFilter = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    let savedScrollPosition = 0; // ‰øùÂ≠òÊªöÂä®‰ΩçÁΩÆ
    let currentTopicFilter = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢ò
    let userTopics = []; // Áî®Êà∑‰∏ªÈ¢òÂàóË°®
    let topicRecommendationHistory = {}; // ‰∏ªÈ¢òÊé®ËçêÂéÜÂè≤ {topic_keywords: {recommended_sources: [...]}}
    let showOnlyRelevantArticles = true; // ÊòØÂê¶Âè™ÊòæÁ§∫Áõ∏ÂÖ≥ÊñáÁ´†ÔºàÈªòËÆ§ÈÄâ‰∏≠Ôºâ
    

    // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
    if (!authToken) {
      alert('ËØ∑ÂÖàÁôªÂΩï');
      window.location.href = '/login.html';
    }

    function getHeaders() {
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      };
    }

    // È™åËØÅÁî®Êà∑Âπ∂Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
    async function initUser() {
      try {
        const response = await fetch(`${API_BASE_URL}/auth/me`, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          currentUser = result.user;
          document.getElementById('userInfo').textContent = `Ê¨¢ËøéÔºå${currentUser.username}`;
        } else {
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('È™åËØÅÁî®Êà∑Â§±Ë¥•:', error);
        window.location.href = '/login.html';
      }
    }

    // ÂàáÊç¢È°µÈù¢
    function switchPage(page, event) {
      // ‰øùÂ≠òÂΩìÂâçÈ°µÈù¢Âà∞ localStorage
      localStorage.setItem('dashboardCurrentPage', page);
      
      // Êõ¥Êñ∞ËèúÂçïÁä∂ÊÄÅ
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      if (event && event.target) {
        event.target.closest('.menu-item').classList.add('active');
      } else {
        // Â¶ÇÊûúÊ≤°Êúâ eventÔºåÈÄöËøá page ÂèÇÊï∞ÊâæÂà∞ÂØπÂ∫îÁöÑËèúÂçïÈ°π
        const menuItems = document.querySelectorAll('.menu-item');
        const pageIndexMap = {
          'subscriptions': 0,
          'articles': 1,
          'guide': 2,
          'features': 3
        };
        menuItems.forEach((item, index) => {
          if (pageIndexMap[page] === index) {
            item.classList.add('active');
          }
        });
      }

      // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
      document.querySelectorAll('.content-page').forEach(p => {
        p.classList.remove('active');
      });
      const targetPage = document.getElementById(page + 'Page');
      if (!targetPage) {
        console.warn(`È°µÈù¢ ${page} ‰∏çÂ≠òÂú®ÔºåÂàáÊç¢Âà∞ÈªòËÆ§È°µÈù¢ subscriptions`);
        page = 'subscriptions';
      }
      document.getElementById(page + 'Page').classList.add('active');

      // Âä†ËΩΩÂØπÂ∫îÈ°µÈù¢Êï∞ÊçÆ
      if (page === 'subscriptions') {
        // ÂàáÊç¢Âà∞ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢Êó∂ÔºåÊ∏ÖÈô§ÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅ
        localStorage.removeItem('dashboardViewingArticleId');
        loadTopics();
        loadRecommendationHistory(); // Âä†ËΩΩÊé®ËçêÂéÜÂè≤
      } else if (page === 'articles') {
        // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ËØ¶ÊÉÖÈ°µÈù¢ÔºåÂÖàËøîÂõûÂàóË°®È°µÈù¢
        const articleDetailView = document.getElementById('articleDetailView');
        if (articleDetailView && articleDetailView.style.display !== 'none') {
          // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
          const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
          
          // ÊòæÁ§∫ÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
          const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
          const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
          
          if (statsBar) statsBar.style.display = 'flex';
          if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
          
          // ÈöêËóèËØ¶ÊÉÖËßÜÂõæÔºåÊòæÁ§∫ÂàóË°®ËßÜÂõæ
          articleDetailView.style.display = 'none';
          const articlesListView = document.getElementById(`articlesListView-${currentTabIndex}`);
          if (articlesListView) articlesListView.style.display = 'block';
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
        } else {
          // ÊØèÊ¨°ËøõÂÖ•ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Êó∂ÔºåÈÉΩÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊòæÁ§∫ÊâÄÊúâÊúÄÊñ∞‰∏ªÈ¢ò
          const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
          console.log('üìö ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºöÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊòæÁ§∫ÊâÄÊúâ‰∏ªÈ¢ò...');
          loadArticlesTopicsTabs().then(() => {
            console.log('‚úÖ ‰∏ªÈ¢òÈ°µÁ≠æÂä†ËΩΩÂÆåÊàê');
            // Á°Æ‰øù‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÂèØËßÅ
            if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
          }).catch(err => {
            console.error('‚ùå Âä†ËΩΩ‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•:', err);
          });
        }
      }
    }

    // ÈÄÄÂá∫ÁôªÂΩï
    function handleLogout() {
      if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userInfo');
        window.location.href = '/login.html';
      }
    }


    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }

    // Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®
    async function loadTopics() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const topicsListEl = document.getElementById('topicsList');
          if (result.data.length === 0) {
            topicsListEl.innerHTML = '<p style="color: #999;">ÊöÇÊó†‰∏ªÈ¢òÔºåËØ∑Ê∑ªÂä†Êñ∞‰∏ªÈ¢ò</p>';
          } else {
            topicsListEl.innerHTML = result.data.map(topic => `
              <div class="topic-tag">
                <span>${escapeHtml(topic.topic_keywords)}</span>
                <button class="remove-btn" onclick="removeTopic('${topic.topic_keywords}')" title="Âà†Èô§">√ó</button>
              </div>
            `).join('');
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂ§±Ë¥•:', error);
      }
    }

    // Ê∑ªÂä†‰∫§‰∫íËøáÁ®ãÊó•Âøó
    function addProcessLog(message, type = 'info', data = null) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl) return;
      
      const stepEl = document.createElement('div');
      stepEl.className = `process-step ${type}`;
      
      const time = new Date().toLocaleTimeString('zh-CN');
      let html = `<div class="process-message">${escapeHtml(message)}<span class="process-time">${time}</span></div>`;
      
      if (data) {
        html += `<div class="process-data">${escapeHtml(JSON.stringify(data, null, 2))}</div>`;
      }
      
      stepEl.innerHTML = html;
      processEl.appendChild(stepEl);
      processEl.scrollTop = processEl.scrollHeight;
    }

    // Ê∏≤Êüì‰øùÂ≠òÁöÑÊé®ËçêËøáÁ®ãÊó•Âøó
    function renderProcessLogs(logs) {
      const processEl = document.getElementById('deepseekProcess');
      if (!processEl || !logs || logs.length === 0) return;
      
      processEl.innerHTML = '';
      logs.forEach(log => {
        const stepEl = document.createElement('div');
        stepEl.className = `process-step ${log.type || 'info'}`;
        
        const time = log.timestamp ? new Date(log.timestamp).toLocaleTimeString('zh-CN') : '';
        let html = `<div class="process-message">${escapeHtml(log.message)}<span class="process-time">${time}</span></div>`;
        
        if (log.data) {
          html += `<div class="process-data">${escapeHtml(JSON.stringify(log.data, null, 2))}</div>`;
        }
        
        stepEl.innerHTML = html;
        processEl.appendChild(stepEl);
      });
      processEl.scrollTop = processEl.scrollHeight;
    }

    // ÊòæÁ§∫Ê∑ªÂä†‰∏ªÈ¢òÂºπÁ™ó
    function showAddTopicModal() {
      const modal = document.getElementById('addTopicModal');
      if (modal) {
        modal.classList.add('show');
        // ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
        setTimeout(() => {
          const input = document.getElementById('topicInput');
          if (input) input.focus();
        }, 100);
      }
    }

    // ÂÖ≥Èó≠Ê∑ªÂä†‰∏ªÈ¢òÂºπÁ™ó
    function closeAddTopicModal(event) {
      // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂÖ≥Èó≠ÊåâÈíÆÊàñÈÅÆÁΩ©Â±ÇÔºåÂÖ≥Èó≠ÂºπÁ™ó
      if (!event || event.target.classList.contains('modal-overlay') || event.target.classList.contains('modal-close')) {
        const modal = document.getElementById('addTopicModal');
        if (modal) {
          modal.classList.remove('show');
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          const input = document.getElementById('topicInput');
          if (input) input.value = '';
        }
      }
    }

    // Êé®Ëçê‰ø°ÊÅØÊ∫ê
    async function recommendSources() {
      const topicInputEl = document.getElementById('topicInput');
      if (!topicInputEl) {
        console.error('[Êé®Ëçê] ÈîôËØØÔºöÊâæ‰∏çÂà∞ topicInput ÂÖÉÁ¥†');
        showMessage('Êó†Ê≥ïÊâæÂà∞ËæìÂÖ•Ê°ÜÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï', 'error');
        return;
      }
      
      const keywords = topicInputEl.value.trim();
      console.log('[Êé®Ëçê] Ëé∑ÂèñÂà∞ÁöÑÂÖ≥ÈîÆËØç:', keywords);
      
      if (!keywords) {
        console.warn('[Êé®Ëçê] ÂÖ≥ÈîÆËØç‰∏∫Á©∫ÔºåÂÅúÊ≠¢ÊâßË°å');
        showMessage('ËØ∑ËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
        return;
      }

      // ÂÖà‰øùÂ≠òÂÖ≥ÈîÆËØçÂà∞ÂèòÈáèÔºåÂÜçÂÖ≥Èó≠ÂºπÁ™óÔºàÈÅøÂÖçÂºπÁ™óÂÖ≥Èó≠ÂêéÊó†Ê≥ïËÆøÈóÆËæìÂÖ•Ê°ÜÔºâ
      const savedKeywords = keywords;
      
      // Á´ãÂç≥ÂÖ≥Èó≠ÂºπÁ™ó
      closeAddTopicModal();

      const recommendBtn = document.getElementById('recommendBtn');
      recommendBtn.disabled = true;
      recommendBtn.textContent = 'Ê≠£Âú®‰øùÂ≠ò‰∏ªÈ¢ò...';

      try {
        // ‰ΩøÁî®‰øùÂ≠òÁöÑÂÖ≥ÈîÆËØçÂèòÈáè
        console.log('[Êé®Ëçê] ‰ΩøÁî®‰øùÂ≠òÁöÑÂÖ≥ÈîÆËØç:', savedKeywords);
        
        // ÂÖà‰øùÂ≠ò‰∏ªÈ¢òÂà∞Êï∞ÊçÆÂ∫ìÔºåÁ°Æ‰øùÂ∑≤‰øùÂ≠òÊàêÂäü
        const saveResult = await saveTopic(savedKeywords);
        
        if (!saveResult || !saveResult.success) {
          throw new Error('‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
        
        console.log('‚úÖ ‰∏ªÈ¢òÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºåÁªßÁª≠Ëé∑ÂèñÊé®Ëçê...');
        
        // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨
        recommendBtn.textContent = 'Ê≠£Âú®Ëé∑ÂèñÊé®Ëçê...';
      } catch (saveError) {
        // ‰øùÂ≠òÂ§±Ë¥•ÔºåÊòæÁ§∫ÈîôËØØÂπ∂ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        console.error('[Êé®Ëçê] ‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•:', saveError);
        showMessage('‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•: ' + saveError.message, 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
        return; // ÂÅúÊ≠¢ÂêéÁª≠Êìç‰Ωú
      }

      // ÂàõÂª∫Êñ∞‰∏ªÈ¢òÁöÑÈ°µÁ≠æÂπ∂ÈÄâ‰∏≠ÔºàÂú® try ÂùóÂ§ñÔºåÁ°Æ‰øù newTabIndex Âú®ÂêéÁª≠‰ª£Á†Å‰∏≠ÂèØÁî®Ôºâ
      let newTabIndex = -1;
      try {
        newTabIndex = createNewTopicTab(savedKeywords);
        if (newTabIndex >= 0) {
          switchTopicTab(newTabIndex);
          // ÊòæÁ§∫È°µÁ≠æÂÆπÂô®
          document.getElementById('topicsTabsSection').style.display = 'block';
        }
      } catch (tabError) {
        console.error('[Êé®Ëçê] ÂàõÂª∫È°µÁ≠æÂ§±Ë¥•:', tabError);
      }

      if (newTabIndex < 0) {
        console.error('[Êé®Ëçê] ‚ùå ÂàõÂª∫‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•ÔºåÊó†Ê≥ïÁªßÁª≠Êé®Ëçê');
        showMessage('ÂàõÂª∫‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
        return;
      }

      // Âú®È°µÁ≠æ‰∏≠ÊòæÁ§∫Êé®ËçêËøáÁ®ãÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
      addProcessLogInTab(newTabIndex, `ÂºÄÂßã‰∏∫ÂÖ≥ÈîÆËØç "${savedKeywords}" Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê...`, 'loading');
 
      // ÂàùÂßãÂåñÊé®Ëçê‰ø°ÊÅØÊ∫êÂàóË°®ÔºàÁî®‰∫éÂÆûÊó∂Ê∑ªÂä†Ôºâ
      if (!window.recommendedSourcesByTab) {
        window.recommendedSourcesByTab = {};
      }
      window.recommendedSourcesByTab[newTabIndex] = [];

      try {
        console.log(`[Êé®Ëçê] ÂºÄÂßãË∞ÉÁî®Êé®ËçêÊé•Âè£ÔºåÂÖ≥ÈîÆËØç: "${savedKeywords}"`);
        console.log(`[Êé®Ëçê] APIÂú∞ÂùÄ: ${API_BASE_URL}/user/topics/recommend`);
        console.log(`[Êé®Ëçê] ËØ∑Ê±Ç‰Ωì:`, JSON.stringify({ keywords: savedKeywords }));
        
        // ‰ΩøÁî® fetch Ëé∑ÂèñÊµÅÂºèÂìçÂ∫îÔºåÂÆûÊó∂ÊòæÁ§∫ËøõÂ∫¶ÔºàÈôêÂà∂ÊØèÊ¨°10‰∏™Ôºâ
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ 
            keywords: savedKeywords,
            limit: 10,
            excludeSources: [] // È¶ñÊ¨°Êé®ËçêÔºåÊó†ÈúÄÊéíÈô§
          })
        });

        console.log(`[Êé®Ëçê] Êî∂Âà∞ÂìçÂ∫îÔºåÁä∂ÊÄÅÁ†Å: ${response.status}, Content-Type: ${response.headers.get('Content-Type')}`);

        if (!response.ok) {
          const errorText = await response.text();
          console.error(`[Êé®Ëçê] HTTPÈîôËØØ: ${response.status}`, errorText);
          throw new Error(`HTTP error! status: ${response.status}: ${errorText}`);
        }

        // Ê£ÄÊü•ÂìçÂ∫î‰ΩìÊòØÂê¶Â≠òÂú®
        if (!response.body) {
          console.error('[Êé®Ëçê] ÂìçÂ∫î‰Ωì‰∏∫Á©∫');
          throw new Error('ÂìçÂ∫î‰Ωì‰∏∫Á©∫ÔºåÊó†Ê≥ïËØªÂèñÊµÅÂºèÊï∞ÊçÆ');
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        let hasReceivedData = false;

        console.log('[Êé®Ëçê] ÂºÄÂßãËØªÂèñÊµÅÂºèÂìçÂ∫î...');

        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            console.log('[Êé®Ëçê] ÊµÅÂºèÂìçÂ∫îËØªÂèñÂÆåÊàê');
            break;
          }
          
          hasReceivedData = true;
          
          // Ëß£Á†ÅÊï∞ÊçÆÂπ∂Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
          buffer += decoder.decode(value, { stream: true });
          
          // ÊåâË°åÂàÜÂâ≤Âπ∂Â§ÑÁêÜÊØèË°å JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ‰øùÁïôÊúÄÂêé‰∏çÂÆåÊï¥ÁöÑË°å
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                console.log('[Êé®Ëçê] Êî∂Âà∞ËøõÂ∫¶Êï∞ÊçÆ:', progress.type, progress.message || '');
                
                // ÂÆûÊó∂Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
                if (progress.type === 'progress') {
                  // Ê†πÊçÆËøõÂ∫¶Ê∂àÊÅØÊ∑ªÂä†Âä®ÊÄÅÊñáÂ≠óÊèêÁ§∫
                  let dynamicMessage = progress.message;
                  if (progress.message && !progress.message.includes('...')) {
                    dynamicMessage = progress.message + '...';
                  }
                  addProcessLogInTab(newTabIndex, dynamicMessage, progress.logType || 'loading');
                } else if (progress.type === 'sourcesReceived') {
                  // DeepSeekËøîÂõûÁöÑÊâÄÊúâÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÁ´ãÂç≥ÊòæÁ§∫Ë°®Ê†º
                  if (progress.sources && progress.sources.length > 0) {
                    // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
                    addProcessLogInTab(newTabIndex, `Â∑≤Êî∂Âà∞ ${progress.sources.length} ‰∏™Êé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊ≠£Âú®È™åËØÅÊúâÊïàÊÄß...`, 'loading');
                    
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    // ‰∏∫È¶ñÊ¨°Êé®ËçêÊ∑ªÂä†ÊâπÊ¨°Âè∑1
                    const sourcesWithBatch = progress.sources.map(s => ({
                      ...s,
                      batchNumber: 1
                    }));
                    window.recommendedSourcesByTab[newTabIndex] = sourcesWithBatch;
                    // Á´ãÂç≥Ê∏≤ÊüìË°®Ê†ºÔºàÊâÄÊúâ‰ø°ÊÅØÊ∫êÊòæÁ§∫‰∏∫"È™åËØÅ‰∏≠..."Ôºâ
                    renderRecommendationsInTab(newTabIndex, sourcesWithBatch);
                  }
                } else if (progress.type === 'sourceValidated') {
                  // È™åËØÅÂÆåÊàêÁöÑ‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Ë°®Ê†º‰∏≠ÂØπÂ∫îË°åÁöÑÊúâÊïàÊÄßÁä∂ÊÄÅ
                  if (progress.source) {
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    if (!window.recommendedSourcesByTab[newTabIndex]) {
                      window.recommendedSourcesByTab[newTabIndex] = [];
                    }
                    
                    // Êü•ÊâæÂπ∂Êõ¥Êñ∞ÂØπÂ∫îÁöÑ‰ø°ÊÅØÊ∫ê
                    const sourceIndex = window.recommendedSourcesByTab[newTabIndex].findIndex(
                      s => (s.sourceUrl || s.url) === (progress.source.sourceUrl || progress.source.url)
                    );
                    
                    if (sourceIndex >= 0) {
                      // Êõ¥Êñ∞Áé∞Êúâ‰ø°ÊÅØÊ∫ê
                      window.recommendedSourcesByTab[newTabIndex][sourceIndex] = progress.source;
                    } else {
                      // Â¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÊ∑ªÂä†Êñ∞ÁöÑ
                      window.recommendedSourcesByTab[newTabIndex].push(progress.source);
                    }
                    
                    // ÂÆûÊó∂Êõ¥Êñ∞Ë°®Ê†º
                    renderRecommendationsInTab(newTabIndex, window.recommendedSourcesByTab[newTabIndex]);
                  }
                } else if (progress.type === 'final') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('Ëß£ÊûêËøõÂ∫¶Êï∞ÊçÆÂ§±Ë¥•:', e, line);
              }
            }
          }
        }

        // Â§ÑÁêÜÊúÄÁªàÁªìÊûú
        if (!hasReceivedData) {
          console.warn('[Êé®Ëçê] Ë≠¶ÂëäÔºöÊ≤°ÊúâÊî∂Âà∞‰ªª‰ΩïÊï∞ÊçÆ');
          addProcessLogInTab(newTabIndex, 'Êú™Êî∂Âà∞ÊúçÂä°Âô®ÂìçÂ∫îÊï∞ÊçÆÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï', 'error');
          showMessage('Êú™Êî∂Âà∞ÊúçÂä°Âô®ÂìçÂ∫îÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•', 'error');
        } else if (finalResult) {
          console.log('[Êé®Ëçê] Êî∂Âà∞ÊúÄÁªàÁªìÊûú:', finalResult.success ? 'ÊàêÂäü' : 'Â§±Ë¥•');
          if (finalResult.success) {
            recommendedSources = finalResult.data || [];
            
            // ‰øùÂ≠òÊé®ËçêÂéÜÂè≤Âà∞Êï∞ÊçÆÂ∫ìÔºàÂêéÁ´ØÂ∑≤ÁªèÂú® recommend Êé•Âè£‰∏≠‰øùÂ≠ò‰∫ÜÔºâ
            // ÈáçÊñ∞Âä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤ÔºàÂåÖÊã¨Êñ∞Ê∑ªÂä†ÁöÑÔºâÔºåËøô‰ºöÊõ¥Êñ∞È°µÁ≠æÂÜÖÂÆπ
            await loadAllRecommendationHistory();
            
            // Á°Æ‰øùÈÄâ‰∏≠Êñ∞Ê∑ªÂä†ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÔºàÊ†πÊçÆ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÁ≤æÁ°ÆÊü•ÊâæÔºâ
            const tabsHeader = document.getElementById('topicsTabsHeader');
            const tabsContent = document.getElementById('topicsTabsContent');
            if (tabsHeader && tabsContent) {
              const tabs = Array.from(tabsHeader.children);
              const panels = Array.from(tabsContent.children);
              
              // Á≤æÁ°ÆÂåπÈÖç‰∏ªÈ¢òÂÖ≥ÈîÆËØç
              for (let i = 0; i < tabs.length; i++) {
                const panel = panels[i];
                if (panel && panel.dataset.history) {
                  try {
                    const history = JSON.parse(panel.dataset.history);
                    if (history.topic_keywords === savedKeywords.trim()) {
                      switchTopicTab(i);
                      // Á°Æ‰øùÈ°µÁ≠æÂÆπÂô®ÂèØËßÅ
                      document.getElementById('topicsTabsSection').style.display = 'block';
                      break;
                    }
                  } catch (e) {
                    console.error('Ëß£ÊûêÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', e);
                  }
                }
              }
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨‰ª•ÊòæÁ§∫Êñ∞Ê∑ªÂä†ÁöÑ‰∏ªÈ¢ò
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö Ëé∑ÂèñÊé®ËçêÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
            
            showMessage(finalResult.message || `Â∑≤ÊâæÂà∞ ${recommendedSources.length} ‰∏™Êé®Ëçê‰ø°ÊÅØÊ∫ê`, 'success');
          } else {
            console.error('[Êé®Ëçê] Êé®ËçêÂ§±Ë¥•:', finalResult.message);
            addProcessLogInTab(newTabIndex, finalResult.message || 'Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•', 'error');
            showMessage(finalResult.message || 'Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•', 'error');
          }
        } else {
          console.warn('[Êé®Ëçê] Ë≠¶ÂëäÔºöÊ≤°ÊúâÊî∂Âà∞ÊúÄÁªàÁªìÊûúÔºå‰ΩÜÂ∑≤Êî∂Âà∞ÈÉ®ÂàÜÊï∞ÊçÆ');
          addProcessLogInTab(newTabIndex, 'Êé®ËçêËøáÁ®ãÂèØËÉΩÊú™ÂÆåÊàêÔºåËØ∑Âà∑Êñ∞È°µÈù¢Êü•ÁúãÁªìÊûú', 'warning');
          showMessage('Êé®ËçêËøáÁ®ãÂèØËÉΩÊú™ÂÆåÊàêÔºåËØ∑Âà∑Êñ∞È°µÈù¢Êü•Áúã', 'warning');
        }
      } catch (error) {
        console.error('[Êé®Ëçê] ÊçïËé∑Âà∞ÈîôËØØ:', error);
        addProcessLogInTab(newTabIndex, 'API Ë∞ÉÁî®ÂºÇÂ∏∏: ' + error.message, 'error');
        showMessage('Ëé∑ÂèñÊé®ËçêÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        recommendBtn.disabled = false;
        recommendBtn.textContent = 'Ëé∑ÂèñÊé®Ëçê';
      }
    }

    // ÂàõÂª∫Êñ∞‰∏ªÈ¢òÁöÑ‰∏¥Êó∂È°µÁ≠æÔºàÂú®Êé®ËçêÂºÄÂßãÊó∂Â∞±ÂàõÂª∫Ôºâ
    function createNewTopicTab(keywords) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return -1;
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ≠òÂú®ËØ•‰∏ªÈ¢òÁöÑÈ°µÁ≠æ
      const existingHistories = Array.from(tabsHeader.children).map((tab, idx) => {
        const panel = document.getElementById(`panel-${idx}`);
        if (panel && panel.dataset.history) {
          try {
            const history = JSON.parse(panel.dataset.history);
            return history.topic_keywords;
          } catch (e) {
            return null;
          }
        }
        return null;
      });
      
      const existingIndex = existingHistories.findIndex(k => k === keywords.trim());
      if (existingIndex >= 0) {
        return existingIndex;
      }
      
      // Ëé∑ÂèñÂΩìÂâçÈ°µÁ≠æÊï∞Èáè
      const currentTabCount = tabsHeader.children.length;
      const newTabIndex = currentTabCount;
      const tabId = `tab-${newTabIndex}`;
      const panelId = `panel-${newTabIndex}`;
      
      // ÂàõÂª∫È°µÁ≠æÊåâÈíÆ
      const tabBtn = document.createElement('button');
      tabBtn.className = `topic-tab active`;
      tabBtn.id = tabId;
      tabBtn.onclick = () => switchTopicTab(newTabIndex);
      tabBtn.innerHTML = `${escapeHtml(keywords)}<span class="tab-badge">Êé®Ëçê‰∏≠...</span>`;
      tabsHeader.appendChild(tabBtn);
      
      // ÂèñÊ∂àÂÖ∂‰ªñÈ°µÁ≠æÁöÑactiveÁä∂ÊÄÅ
      Array.from(tabsHeader.children).forEach((tab, idx) => {
        if (idx !== newTabIndex) {
          tab.classList.remove('active');
        }
      });
      
      // ÂàõÂª∫È°µÁ≠æÂÜÖÂÆπÈù¢Êùø
      const panel = document.createElement('div');
      panel.className = `topic-tab-panel active`;
      panel.id = panelId;
      
      // ÂàõÂª∫‰∏¥Êó∂ÂéÜÂè≤Êï∞ÊçÆÔºàËøòÊ≤°ÊúâÊé®ËçêÁªìÊûúÔºâ
      const tempHistory = {
        topic_keywords: keywords.trim(),
        process_logs: [],
        recommended_sources: []
      };
      panel.dataset.history = JSON.stringify(tempHistory);
      
      // Êé®ËçêËøáÁ®ãÊó•ÂøóÂå∫ÂüüÔºàÂ∏¶Âä®ÁîªÁöÑËøõÂ∫¶ÊòæÁ§∫Ôºâ
      const processLogsHtml = `
        <div class="recommendation-progress loading" id="processText-${newTabIndex}">
          <div class="progress-spinner"></div>
          <div style="flex: 1;">
            <div class="progress-text">Ê≠£Âú®ÂáÜÂ§áÊé®Ëçê‰ø°ÊÅØÊ∫ê<span class="progress-dots">...</span></div>
            <div class="progress-stage">ÂàùÂßãÂåñ‰∏≠</div>
            </div>
          </div>
        `;
      
      // Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†ºÁªìÊûÑÔºàÂàùÂßã‰∏∫Á©∫ÔºåÁ≠âÂæÖÊï∞ÊçÆÔºâ
      const recommendationsHtml = `
        <div class="recommendations-filters" id="filters-${newTabIndex}" style="display: none;">
          <div class="filter-group">
            <label>Âú∞Âå∫Ôºö</label>
            <select id="regionFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">ÂÖ®ÈÉ®</option>
              <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
              <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Á±ªÂûãÔºö</label>
            <select id="typeFilter-${newTabIndex}" onchange="filterRecommendationsInTab(${newTabIndex})">
              <option value="all">ÂÖ®ÈÉ®</option>
            </select>
          </div>
          <div class="recommendations-stats" id="recommendationsStats-${newTabIndex}"></div>
        </div>
        <div id="recommendationsContainer-${newTabIndex}" style="display: none;">
          <table class="recommendations-table" id="recommendationsTable-${newTabIndex}">
          <thead>
            <tr>
              <th class="checkbox-cell"></th>
              <th>‰ø°ÊÅØÊ∫ê</th>
              <th>Á±ªÂûã</th>
              <th>Âú∞Âå∫</th>
              <th>ÊèèËø∞</th>
              <th>ÊúâÊïàÊÄß</th>
              <th>Áä∂ÊÄÅ</th>
            </tr>
          </thead>
          <tbody id="recommendationsBody-${newTabIndex}">
          </tbody>
        </table>
        </div>
        <div style="text-align: center; margin: 20px 0; display: none;" id="recommendationsActions-${newTabIndex}">
          <button class="btn-primary" onclick="subscribeSelectedInTab(${newTabIndex})" id="subscribeSelectedBtn-${newTabIndex}" style="padding: 12px 24px; font-size: 15px; margin-right: 12px;">
            <span id="subscribeSelectedBtnText-${newTabIndex}">ËÆ¢ÈòÖÈÄâ‰∏≠</span>
            <span id="subscribeSelectedBtnLoading-${newTabIndex}" style="display: none; margin-left: 8px;">‚è≥</span>
          </button>
          <button class="btn-primary" onclick="loadMoreRecommendations(${newTabIndex})" id="loadMoreBtn-${newTabIndex}" style="padding: 12px 24px; font-size: 15px;">
            <span id="loadMoreBtnText-${newTabIndex}">ÂÜçÊ¨°Êé®Ëçê</span>
            <span id="loadMoreBtnLoading-${newTabIndex}" style="display: none; margin-left: 8px;">‚è≥</span>
          </button>
        </div>
        <div id="recommendationsEmpty-${newTabIndex}" class="recommendations-empty loading">
          <div class="loading-message">
            <span>Ê≠£Âú®Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê</span>
            <div class="loading-dots">
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
            </div>
          </div>
        </div>
      `;
      
      panel.innerHTML = processLogsHtml + recommendationsHtml;
      
      // ÂèñÊ∂àÂÖ∂‰ªñÈù¢ÊùøÁöÑactiveÁä∂ÊÄÅ
      Array.from(tabsContent.children).forEach((p, idx) => {
        if (idx !== newTabIndex) {
          p.classList.remove('active');
        }
      });
      
      tabsContent.appendChild(panel);
      
      return newTabIndex;
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∑ªÂä†Êé®ËçêËøáÁ®ãÊó•Âøó
    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∑ªÂä†Êé®ËçêËøáÁ®ãÊó•ÂøóÔºàÂ∏¶Âä®ÁîªÂíåÂä®ÊÄÅÊñáÂ≠óÔºâ
    function addProcessLogInTab(tabIndex, message, type = 'info', data = null) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      
      if (processTextEl) {
        const progressTextEl = processTextEl.querySelector('.progress-text');
        const progressStageEl = processTextEl.querySelector('.progress-stage');
        
        // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆ‰∏çÂêåÁöÑÊòæÁ§∫ÊïàÊûú
        if (type === 'loading' || type === 'info') {
          // ‰øùÊåÅÂä†ËΩΩÁä∂ÊÄÅ
          processTextEl.classList.add('loading');
          
          // Êõ¥Êñ∞‰∏ªÊñáÊú¨
          if (progressTextEl) {
            // ÁßªÈô§‰πãÂâçÁöÑdotsÔºåÊ∑ªÂä†Êñ∞ÁöÑ
            const textWithoutDots = message.replace(/\.{3,}$/, '');
            progressTextEl.innerHTML = textWithoutDots + '<span class="progress-dots">...</span>';
          }
          
          // Êõ¥Êñ∞Èò∂ÊÆµÊèêÁ§∫ÔºàÊ†πÊçÆÊ∂àÊÅØÂÜÖÂÆπÊòæÁ§∫‰∏çÂêåÁöÑÈò∂ÊÆµÔºâ
          if (progressStageEl) {
            let stageText = 'Â§ÑÁêÜ‰∏≠';
            if (message.includes('ÂàÜÊûê') || message.includes('ÂÖ≥ÈîÆËØç')) {
              stageText = 'Ê≠£Âú®ÂàÜÊûêÂÖ≥ÈîÆËØç';
            } else if (message.includes('Ë∞ÉÁî®') || message.includes('AI') || message.includes('DeepSeek')) {
              stageText = 'Ê≠£Âú®Ë∞ÉÁî®AIÊé®ËçêÂºïÊìé';
            } else if (message.includes('È™åËØÅ') || message.includes('Ê£ÄÊü•')) {
              stageText = 'Ê≠£Âú®È™åËØÅ‰ø°ÊÅØÊ∫êÊúâÊïàÊÄß';
            } else if (message.includes('Ëé∑Âèñ') || message.includes('Êé®Ëçê')) {
              stageText = 'Ê≠£Âú®Ëé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê';
            } else if (message.includes('ÂÆåÊàê') || message.includes('ÊàêÂäü')) {
              stageText = 'Â§ÑÁêÜÂÆåÊàê';
              processTextEl.classList.remove('loading');
            }
            progressStageEl.textContent = stageText;
          }
        } else if (type === 'success') {
          // ÊàêÂäüÁä∂ÊÄÅ
          processTextEl.classList.remove('loading');
          if (progressTextEl) {
            progressTextEl.innerHTML = message;
          }
          if (progressStageEl) {
            progressStageEl.textContent = 'Êé®ËçêÂÆåÊàê';
          }
        } else if (type === 'error') {
          // ÈîôËØØÁä∂ÊÄÅ
          processTextEl.classList.remove('loading');
          processTextEl.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
          if (progressTextEl) {
            progressTextEl.innerHTML = message;
          }
          if (progressStageEl) {
            progressStageEl.textContent = 'Âá∫Áé∞ÈîôËØØ';
          }
        }
      } else {
        // Â¶ÇÊûúÊ≤°ÊúâÊñáÊú¨ÂÖÉÁ¥†ÔºåÂàõÂª∫Êñ∞ÁöÑÁªìÊûÑ
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (panel) {
          const processDiv = document.createElement('div');
          processDiv.id = `processText-${tabIndex}`;
          processDiv.className = 'recommendation-progress loading';
          processDiv.innerHTML = `
            <div class="progress-spinner"></div>
            <div style="flex: 1;">
              <div class="progress-text">${message}<span class="progress-dots">...</span></div>
              <div class="progress-stage">Â§ÑÁêÜ‰∏≠</div>
            </div>
          `;
          // ÊèíÂÖ•Âà∞Èù¢ÊùøÁöÑÊúÄÂâçÈù¢
          panel.insertBefore(processDiv, panel.firstChild);
        }
      }
    }

    // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®
    async function loadUserSubscriptions(topicKeywords = null) {
      try {
        let url = `${API_BASE_URL}/user/subscriptions`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders()
        });
        const result = await response.json();

        if (result.success) {
          // ÊûÑÂª∫ËÆ¢ÈòÖÊò†Â∞ÑÔºàÂêåÊó∂Â≠òÂÇ®ÂêçÁß∞ÂíåURLÔºâ
          userSubscriptionsMap = {};
          result.data.forEach(sub => {
            const name = sub.source_name;
            userSubscriptionsMap[name] = {
              sourceName: name,
              sourceUrl: sub.source_url
            };
          });
          
          // Â¶ÇÊûúÊåáÂÆö‰∫Ü‰∏ªÈ¢òÔºåÂè™ËøîÂõûËØ•‰∏ªÈ¢òÁöÑËÆ¢ÈòÖÔºõÂê¶ÂàôËøîÂõûÊâÄÊúâËÆ¢ÈòÖ
          if (topicKeywords && topicKeywords.trim()) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          } else {
            // Â≠òÂÇ®ÊâÄÊúâËÆ¢ÈòÖÔºå‰ΩÜÊåâ‰∏ªÈ¢òÂàÜÁªÑ
            if (!window.allUserSubscriptions) {
              window.allUserSubscriptions = {};
            }
            result.data.forEach(sub => {
              const topic = sub.topic_keywords || '';
              if (!window.allUserSubscriptions[topic]) {
                window.allUserSubscriptions[topic] = [];
              }
              window.allUserSubscriptions[topic].push(sub.source_name);
            });
            // ‰∏∫‰∫ÜÂÖºÂÆπÊÄßÔºå‰ªçÁÑ∂ËÆæÁΩÆ userSubscriptions ‰∏∫ÊâÄÊúâËÆ¢ÈòÖÁöÑ source_name
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Â§±Ë¥•:', error);
        userSubscriptions = [];
      }
    }


    // ‰øùÂ≠ò‰∏ªÈ¢ò
    async function saveTopic(keywords) {
      try {
        console.log(`üíæ ÂºÄÂßã‰øùÂ≠ò‰∏ªÈ¢òÂà∞Êï∞ÊçÆÂ∫ì: "${keywords}"`);
        const response = await fetch(`${API_BASE_URL}/user/topics`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ keywords }),
          cache: 'no-cache'
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.message || '‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•');
        }
        
        console.log(`‚úÖ ‰∏ªÈ¢òÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ì: "${keywords}"`);
        
        // ÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®ÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆ
        await loadTopics();
        
        // Á´ãÂç≥Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÔºåÁ°Æ‰øùÊñ∞‰∏ªÈ¢òÁöÑÈ°µÁ≠æÊòæÁ§∫
        const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
        if (articlesTopicsTabsHeader) {
          console.log('üìö Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
          await loadArticlesTopicsTabs();
        }
        
        return { success: true, topic: result.topic };
      } catch (error) {
        console.error('‚ùå ‰øùÂ≠ò‰∏ªÈ¢òÂ§±Ë¥•:', error);
        throw error; // ÊäõÂá∫ÈîôËØØÔºåËÆ©Ë∞ÉÁî®ËÄÖÁü•ÈÅì‰øùÂ≠òÂ§±Ë¥•
      }
    }

    // Ê∏≤ÊüìÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∏¶ËøáÊª§ÂäüËÉΩÔºâ
    function renderRecommendations() {
      const tbody = document.getElementById('recommendationsBody');
      if (!tbody) return;
      
      // Ëé∑ÂèñËøáÊª§Êù°‰ª∂
      const regionFilter = document.getElementById('regionFilter')?.value || 'all';
      const typeFilter = document.getElementById('typeFilter')?.value || 'all';
      
      // ËøáÊª§Êï∞ÊçÆ
      let filteredSources = recommendedSources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'ÂõΩÂ§ñ') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      tbody.innerHTML = filteredSources.map((source, index) => {
        // Ê£ÄÊü•ËÆ¢ÈòÖÁä∂ÊÄÅÔºöÂêåÊó∂ÊØîËæÉÂêçÁß∞ÂíåURLÔºåÁ°Æ‰øùÂåπÈÖçÂáÜÁ°Æ
        let isSubscribed = false;
        
        // ÊñπÊ≥ï1ÔºöÁ≤æÁ°ÆÂåπÈÖçÂêçÁß∞
        if (userSubscriptions.includes(source.sourceName)) {
          isSubscribed = true;
        } else {
          // ÊñπÊ≥ï2ÔºöÂ¶ÇÊûúÂêçÁß∞‰∏çÂåπÈÖçÔºåÂ∞ùËØïÈÄöËøáURLÂåπÈÖçÔºàÂ§ÑÁêÜÂêçÁß∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºâ
          const normalizeUrl = (url) => {
            if (!url) return '';
            // ÂéªÈô§ÂçèËÆÆ„ÄÅwww„ÄÅÂ∞æÈÉ®ÊñúÊù†ÔºåËΩ¨‰∏∫Â∞èÂÜô
            return url.replace(/^https?:\/\//, '')
                     .replace(/^www\./, '')
                     .replace(/\/$/, '')
                     .toLowerCase()
                     .trim();
          };
          
          const sourceUrlNormalized = normalizeUrl(source.sourceUrl);
          
          // ÈÅçÂéÜÊâÄÊúâËÆ¢ÈòÖÔºåÊØîËæÉURL
          for (const subName in userSubscriptionsMap) {
            const sub = userSubscriptionsMap[subName];
            const subUrlNormalized = normalizeUrl(sub.sourceUrl);
            
            // Â¶ÇÊûúURLÂåπÈÖçÔºåÂàôËÆ§‰∏∫Â∑≤ËÆ¢ÈòÖ
            if (subUrlNormalized && sourceUrlNormalized && subUrlNormalized === sourceUrlNormalized) {
              isSubscribed = true;
              break;
            }
          }
        }
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${recommendedSources.indexOf(source)}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChange(this)">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'Â∑≤ËÆ¢ÈòÖ' : 'Êú™ËÆ¢ÈòÖ'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
      updateRecommendationsStats(filteredSources.length, recommendedSources.length);
    }
    
    // Êõ¥Êñ∞Êé®ËçêÁªüËÆ°‰ø°ÊÅØ
    function updateRecommendationsStats(filtered, total) {
      const statsEl = document.getElementById('recommendationsStats');
      if (statsEl) {
        statsEl.textContent = `ÊòæÁ§∫ ${filtered} / ÂÖ± ${total} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
    }

    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    function toggleSelectAll() {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.source-checkbox');
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
    }

    // Â§ÑÁêÜÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê
    async function handleManualAddSource(tabIndex) {
      const sourceNameInput = document.getElementById(`manualSourceName-${tabIndex}`);
      const sourceUrlInput = document.getElementById(`manualSourceUrl-${tabIndex}`);
      const addBtn = document.getElementById(`manualAddBtn-${tabIndex}`);
      
      if (!sourceNameInput || !sourceUrlInput) {
        showMessage('Êâæ‰∏çÂà∞ËæìÂÖ•Ê°ÜÂÖÉÁ¥†', 'error');
        return;
      }
      
      const sourceName = sourceNameInput.value.trim();
      const sourceUrl = sourceUrlInput.value.trim();
      
      // È™åËØÅËæìÂÖ•
      if (!sourceName) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êÂêçÁß∞', 'error');
        sourceNameInput.focus();
        return;
      }
      
      if (!sourceUrl) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êURL', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // È™åËØÅURLÊ†ºÂºè
      try {
        new URL(sourceUrl);
      } catch (e) {
        showMessage('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑURLÊ†ºÂºè', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÂÖ≥ÈîÆËØç
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) {
        showMessage('Êâæ‰∏çÂà∞‰∏ªÈ¢ò‰ø°ÊÅØ', 'error');
        return;
      }
      
      const history = JSON.parse(panel.dataset.history || '{}');
      const topicKeywords = history.topic_keywords || '';
      
      if (!topicKeywords || !topicKeywords.trim()) {
        showMessage('Êó†Ê≥ïÊ∑ªÂä†ÔºöÁº∫Â∞ë‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
        return;
      }
      
      // Á¶ÅÁî®ÊåâÈíÆ
      addBtn.disabled = true;
      addBtn.textContent = 'Ê∑ªÂä†‰∏≠...';
      
      try {
        // Âà§Êñ≠‰ø°ÊÅØÊ∫êÁ±ªÂûãÔºàÁÆÄÂçïÂà§Êñ≠ÔºöÂ¶ÇÊûúURLÂåÖÂê´rss/feed/xmlÁ≠âÔºåËÆ§‰∏∫ÊòØRSSÔºåÂê¶ÂàôÊòØblogÔºâ
        let sourceType = 'rss';
        const urlLower = sourceUrl.toLowerCase();
        if (!urlLower.includes('rss') && !urlLower.includes('feed') && !urlLower.includes('.xml') && !urlLower.includes('atom')) {
          sourceType = 'blog';
        }
        
        const subscriptionData = {
          sourceName: sourceName,
          sourceUrl: sourceUrl,
          sourceType: sourceType,
          topicKeywords: topicKeywords
        };
        
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: [subscriptionData] })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüÊ∑ªÂä†Âπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºö${sourceName}`, 'success');
          
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          sourceNameInput.value = '';
          sourceUrlInput.value = '';
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®
          await loadUserSubscriptions();
          
          // Â¶ÇÊûúËØ•È°µÁ≠æÊúâÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            await renderRecommendationsInTab(tabIndex, history.recommended_sources);
          }
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          showMessage(result.message || 'Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'Ê∑ªÂä†Âπ∂ËÆ¢ÈòÖ';
      }
    }

    // ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    async function subscribeSelected() {
      const checkboxes = document.querySelectorAll('.source-checkbox:checked');
      if (checkboxes.length === 0) {
        showMessage('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }

      const subscribeBtn = document.getElementById('subscribeBtn');
      subscribeBtn.disabled = true;
      subscribeBtn.textContent = 'ËÆ¢ÈòÖ‰∏≠...';

      const selectedSources = Array.from(checkboxes).map(cb => {
        const index = parseInt(cb.dataset.index);
        return recommendedSources[index];
      });

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: selectedSources })
        });

        const result = await response.json();

        if (result.success) {
          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${selectedSources.length} ‰∏™‰ø°ÊÅØÊ∫ê`, 'success');
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Âπ∂Êõ¥Êñ∞Ë°®Ê†ºÊòæÁ§∫
          await loadUserSubscriptions();
          renderRecommendations();
          // ‰∏çÊ∏ÖÁ©∫ËæìÂÖ•Ê°ÜÂíåÊé®ËçêÂàóË°®Ôºå‰øùÁïôË°®Ê†º‰æõÁî®Êà∑Êü•ÁúãÂíå‰øÆÊîπ
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        subscribeBtn.disabled = false;
        subscribeBtn.textContent = 'ËÆ¢ÈòÖÈÄâ‰∏≠';
      }
    }

    // Âà†Èô§‰∏ªÈ¢ò
    async function removeTopic(keywords) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§‰∏ªÈ¢ò "${keywords}" ÂêóÔºü\n\nÂà†Èô§ÂêéÂ∞ÜÂêåÊó∂Âà†Èô§Ôºö\n- ËØ•‰∏ªÈ¢òÁöÑÊâÄÊúâ‰ø°ÊÅØÊ∫êËÆ¢ÈòÖ\n- Ëøô‰∫õ‰ø°ÊÅØÊ∫êÊî∂ÈõÜÁöÑÊâÄÊúâÊñáÁ´†\n- ËØ•‰∏ªÈ¢òÁöÑÊé®ËçêÂéÜÂè≤\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ`)) {
        return;
      }

      try {
        const response = await fetch(
          `${API_BASE_URL}/user/topics/${encodeURIComponent(keywords)}`,
          {
            method: 'DELETE',
            headers: getHeaders()
          }
        );

        const result = await response.json();

        if (result.success) {
          let message = result.message || '‰∏ªÈ¢òÂà†Èô§ÊàêÂäü';
          if (result.deletedSubscriptionCount > 0 || result.deletedArticleCount > 0) {
            message += `ÔºàÂ∑≤Âà†Èô§ ${result.deletedSubscriptionCount || 0} ‰∏™ËÆ¢ÈòÖÔºå${result.deletedArticleCount || 0} ÁØáÊñáÁ´†Ôºâ`;
          }
          showMessage(message, 'success');
          
          console.log(`üóëÔ∏è  ‰∏ªÈ¢ò "${keywords}" Âà†Èô§ÊàêÂäüÔºåÂºÄÂßãÂà∑Êñ∞È°µÈù¢...`);
          
          // ÈáçÊñ∞Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®
          await loadTopics();
          
          // Âº∫Âà∂Âà∑Êñ∞Êé®ËçêÂéÜÂè≤ÔºàÁ°Æ‰øùÂà†Èô§ÁöÑÈ°µÁ≠æË¢´ÁßªÈô§Ôºâ
          console.log('üîÑ Âà∑Êñ∞Êé®ËçêÂéÜÂè≤È°µÁ≠æ...');
          await loadAllRecommendationHistory();
          
          // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºåÂà∑Êñ∞ÊñáÁ´†ÂàóË°®
          if (document.getElementById('articlesPage').classList.contains('active')) {
            console.log('üîÑ Âà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
          
          console.log('‚úÖ È°µÈù¢Âà∑Êñ∞ÂÆåÊàê');
        } else {
          showMessage(result.message || 'Âà†Èô§Â§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
      }
    }

    // Ê†ºÂºèÂåñÊó∂Èó¥Â∑Æ
    function formatTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const minutes = Math.floor(diff / 60000);
      
      if (minutes < 1) return 'ÂàöÂàö';
      if (minutes < 60) return `${minutes}ÂàÜÈíüÂâç`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}Â∞èÊó∂Ââç`;
      const days = Math.floor(hours / 24);
      return `${days}Â§©Ââç`;
    }

    // ËÆ°ÁÆóÂèëÂ∏ÉÊó∂Èó¥ËåÉÂõ¥
    function calculatePublishDateRange(articles) {
      if (!articles || articles.length === 0) {
        return '-';
      }
      
      const dates = articles.map(a => new Date(a.publish_date)).filter(d => !isNaN(d));
      if (dates.length === 0) return '-';
      
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      
      const formatDate = (d) => {
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}Âπ¥${month}Êúà${day}Êó•`;
      };
      
      if (minDate.toDateString() === maxDate.toDateString()) {
        return formatDate(minDate);
      } else {
        return `${formatDate(minDate)} - ${formatDate(maxDate)}`;
      }
    }

    // ËÆ°ÁÆóÊúÄËøëÂà∑Êñ∞ÁöÑÊñáÁ´†Êï∞ÔºàÊúÄËøë10ÂàÜÈíüÔºâ
    function calculateRecentArticlesCount(articles) {
      if (!articles || articles.length === 0) return 0;
      
      const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000);
      return articles.filter(a => {
        const created = new Date(a.created_at || a.publish_date);
        return created >= tenMinutesAgo;
      }).length;
    }

    // Âä†ËΩΩÂà∑Êñ∞Áä∂ÊÄÅÂíåÁªüËÆ°‰ø°ÊÅØ
    async function loadRefreshStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/news/update-info`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          const lastUpdateTime = data.lastUpdateTime ? new Date(data.lastUpdateTime) : null;
          
          if (lastUpdateTime) {
            document.getElementById('lastRefreshTime').textContent = formatTimeAgo(lastUpdateTime);
          } else {
            document.getElementById('lastRefreshTime').textContent = '-';
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩÂà∑Êñ∞Áä∂ÊÄÅÂ§±Ë¥•:', error);
      }
    }

    // Á´ãÂç≥Âà∑Êñ∞Êñ∞Èóª
    async function refreshNewsNow(tabIndex = null) {
      // Â¶ÇÊûú‰º†ÂÖ•‰∫ÜtabIndexÔºå‰ΩøÁî®ÂØπÂ∫îÁöÑÊåâÈíÆÔºõÂê¶ÂàôÂ∞ùËØïÊü•ÊâæÈÄöÁî®ÊåâÈíÆ
      let btn;
      let progressEl;
      let progressTextEl;
      
      if (tabIndex !== null) {
        btn = document.getElementById(`refreshNowBtn-${tabIndex}`);
        progressEl = document.getElementById(`refreshProgress-${tabIndex}`);
        progressTextEl = document.getElementById(`refreshProgressText-${tabIndex}`);
      } else {
        btn = document.getElementById('refreshNowBtn');
        progressEl = document.getElementById('refreshProgress');
        progressTextEl = document.getElementById('refreshProgressText');
      }
      
      if (!btn) {
        console.error('Êâæ‰∏çÂà∞Âà∑Êñ∞ÊåâÈíÆ');
        return;
      }
      
      btn.disabled = true;
      btn.classList.add('refreshing');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span>üîÑ</span> Âà∑Êñ∞‰∏≠...';
      
      // ÊòæÁ§∫ËøõÂ∫¶Âå∫Âüü
      if (progressEl) {
        progressEl.classList.add('show');
      }
      if (progressTextEl) {
        progressTextEl.textContent = 'ÂáÜÂ§áÂºÄÂßãÊî∂ÈõÜ...';
      }
      
      try {
        // ÊûÑÂª∫ËØ∑Ê±Ç‰ΩìÔºåÂ¶ÇÊûúÊòØÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠Ôºå‰º†ÈÄí‰∏ªÈ¢òÂÖ≥ÈîÆËØç
        const requestBody = {};
        if (tabIndex !== null && currentTopicFilter) {
          requestBody.topicKeywords = currentTopicFilter;
        }
        
        // Ë∞ÉÁî®ÂêéÁ´ØÊî∂ÈõÜÊé•Âè£ÔºàÊµÅÂºèÂìçÂ∫îÔºâ
        const response = await fetch(`${API_BASE_URL}/collect`, {
          method: 'POST',
          headers: {
            ...getHeaders(),
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        
        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            break;
          }
          
          // Ëß£Á†ÅÊï∞ÊçÆÂπ∂Ê∑ªÂä†Âà∞ÁºìÂÜ≤Âå∫
          buffer += decoder.decode(value, { stream: true });
          
          // ÊåâË°åÂàÜÂâ≤Âπ∂Â§ÑÁêÜÊØèË°å JSON
          const lines = buffer.split('\n');
          buffer = lines.pop() || ''; // ‰øùÁïôÊúÄÂêé‰∏çÂÆåÊï¥ÁöÑË°å
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                
                // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
                if (progressTextEl) {
                  if (progress.type === 'start') {
                    progressTextEl.textContent = progress.message || 'ÂºÄÂßãÊî∂ÈõÜ...';
                  } else if (progress.type === 'progress') {
                    const percentage = Math.round((progress.current / progress.total) * 100);
                    progressTextEl.textContent = progress.message || 
                      `${progress.sourceName} (${progress.current}/${progress.total}, ${percentage}%)`;
                  } else if (progress.type === 'complete') {
                    progressTextEl.textContent = progress.message || 'Êî∂ÈõÜÂÆåÊàê';
                  } else if (progress.type === 'final') {
                    progressTextEl.textContent = progress.message || 'ÂÆåÊàê';
                    finalResult = progress;
                  } else if (progress.type === 'error') {
                    progressTextEl.textContent = progress.message || 'Êî∂ÈõÜÂ§±Ë¥•';
                    finalResult = progress;
                  }
                }
                
                // ÂÆûÊó∂Ê∑ªÂä†Êî∂ÈõÜÂà∞ÁöÑÊñáÁ´†
                if (progress.type === 'articleCollected' && progress.article) {
                  // Â¶ÇÊûúÂΩìÂâçÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÔºåÁ´ãÂç≥ÊòæÁ§∫Êñ∞ÊñáÁ´†
                  if (tabIndex !== null && currentTopicFilter) {
                    // Ê£ÄÊü•ÊñáÁ´†ÊòØÂê¶Â±û‰∫éÂΩìÂâç‰∏ªÈ¢ò
                    const recommendedSources = topicRecommendationHistory[currentTopicFilter]?.recommended_sources || [];
                    const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
                    if (sourceNames.length === 0 || sourceNames.includes(progress.article.source)) {
                      addArticleToTab(tabIndex, progress.article);
                    }
                  } else {
                    // ‰∏çÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠ÔºåÁõ¥Êé•Ê∑ªÂä†
                    addArticleToList(progress.article);
                  }
                } else if (progress.type === 'filterStats') {
                  // ÊòæÁ§∫ËøáÊª§ÁªüËÆ°‰ø°ÊÅØ
                  const statsMsg = `‚úì ÊâæÂà∞ ${progress.relevant} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†ÔºåÊ†áËÆ∞‰∫Ü ${progress.irrelevant} ÁØá‰∏çÁõ∏ÂÖ≥ÊñáÁ´†Ôºà‰∏ªÈ¢òÔºö${progress.topicKeywords}Ôºâ`;
                  if (progressTextEl) {
                    progressTextEl.textContent = statsMsg;
                  }
                  console.log(`[ËøáÊª§ÁªüËÆ°] ${statsMsg}`);
                  // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
                  showMessage(statsMsg, 'success');
                }
                
                // Â¶ÇÊûúÊòØÊúÄÁªàÁªìÊûúÔºå‰øùÂ≠ò
                if (progress.type === 'final' || progress.type === 'error') {
                  finalResult = progress;
                }
              } catch (e) {
                console.error('Ëß£ÊûêËøõÂ∫¶Êï∞ÊçÆÂ§±Ë¥•:', e, line);
              }
            }
          }
        }
        
        // Â§ÑÁêÜÊúÄÁªàÁªìÊûú
        if (finalResult) {
          if (finalResult.success !== false) {
            showMessage('Êñ∞ÈóªÊî∂ÈõÜÂÆåÊàê', 'success');
            
            // Á≠âÂæÖÂá†ÁßíÂêéÈáçÊñ∞Âä†ËΩΩÊñáÁ´†ÂàóË°®
            setTimeout(async () => {
              if (tabIndex !== null && currentTopicFilter) {
                // Â¶ÇÊûúÊòØÂú®‰∏ªÈ¢òÈ°µÁ≠æ‰∏≠ÔºåÈáçÊñ∞Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†
                await loadArticlesForTopic(currentTopicFilter, tabIndex, true);
                // Êõ¥Êñ∞ËØ•È°µÁ≠æÁöÑÂà∑Êñ∞Êó∂Èó¥
                if (document.getElementById(`lastRefreshTime-${tabIndex}`)) {
                  document.getElementById(`lastRefreshTime-${tabIndex}`).textContent = 'ÂàöÂàö';
                }
              } else {
                // Âê¶Âàô‰ΩøÁî®ÂéüÊúâÁöÑÂä†ËΩΩÊñπÂºè
                await loadArticles(true);
                await loadRefreshStatus();
              }
            }, 1000);
          } else {
            showMessage('Âà∑Êñ∞Â§±Ë¥•: ' + (finalResult.message || 'Êú™Áü•ÈîôËØØ'), 'error');
          }
        }
      } catch (error) {
        console.error('Âà∑Êñ∞Êñ∞ÈóªÂ§±Ë¥•:', error);
        showMessage('Âà∑Êñ∞Â§±Ë¥•: ' + error.message, 'error');
        if (progressTextEl) {
          progressTextEl.textContent = 'Êî∂ÈõÜÂ§±Ë¥•: ' + error.message;
        }
      } finally {
        btn.disabled = false;
        btn.classList.remove('refreshing');
        btn.innerHTML = originalText;
        
        // Âª∂ËøüÈöêËóèËøõÂ∫¶Âå∫Âüü
        setTimeout(() => {
          if (progressEl) {
            progressEl.classList.remove('show');
          }
          if (progressTextEl) {
            progressTextEl.textContent = '';
          }
        }, 2000);
      }
    }

    // Âä†ËΩΩÊñáÁ´†ÂàóË°®
    async function loadArticles(forceRefresh = false) {
      const articlesListEl = document.getElementById('articlesList');
      
      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      articlesListEl.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏≠...</div>';

      try {
        const response = await fetch(`${API_BASE_URL}/news/list`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const data = result.data;
          
          // Â∞ÜÊâÄÊúâÊñáÁ´†Â±ïÂπ≥Âà∞‰∏Ä‰∏™Êï∞ÁªÑ‰∏≠
          allArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              allArticles.push({
                ...news,
                date: day.date
              });
            });
          });

          if (allArticles.length === 0) {
            articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†ÔºåËØ∑ÂÖàËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê</p><p style="margin-top: 12px; font-size: 13px; color: #999;">Á≥ªÁªüÊØè10ÂàÜÈíüËá™Âä®Êî∂ÈõÜ‰∏ÄÊ¨°ÔºåËØ∑Á®çÂÄô</p></div>';
            updateStats([]);
            loadSourceCards([]);
          } else {
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            updateStats(allArticles);
            
            // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
            const sources = [...new Set(allArticles.map(a => a.source))];
            loadSourceCards(sources);
            
            // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
            applyFilters();
          }
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</p></div>';
      }
    }
    

    // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
    function updateStats(articles) {
      document.getElementById('totalArticles').textContent = articles.length;
      document.getElementById('publishDateRange').textContent = calculatePublishDateRange(articles);
      document.getElementById('recentArticlesCount').textContent = calculateRecentArticlesCount(articles);
    }

    // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
    function loadSourceCards(sources) {
      const container = document.getElementById('sourceFilterCards');
      
      // Ê∏ÖÁ©∫ÊâÄÊúâÂç°ÁâáÔºåÂåÖÊã¨"ÂÖ®ÈÉ®"
      container.innerHTML = '';
      
      // ÈáçÊñ∞ÂàõÂª∫"ÂÖ®ÈÉ®"Âç°Áâá
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>ÂÖ®ÈÉ®</span>';
      allCard.onclick = () => filterArticlesBySource(null);
      container.appendChild(allCard);
      
      // Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂç°Áâá
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySource(source);
        container.appendChild(card);
      });
      
      // Á°Æ‰øù"ÂÖ®ÈÉ®"Âç°ÁâáÊòØÊøÄÊ¥ªÁä∂ÊÄÅÔºàÂ¶ÇÊûúÂΩìÂâçÊ≤°ÊúâÈÄâÊã©ÁâπÂÆö‰ø°ÊÅØÊ∫êÔºâ
      if (currentSourceFilter === null) {
        allCard.classList.add('active');
      }
    }

    // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
    function filterArticlesBySource(source) {
      currentSourceFilter = source;
      
      // Êõ¥Êñ∞Âç°ÁâáÁä∂ÊÄÅ
      document.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      applyFilters();
    }

    // Â∫îÁî®ËøáÊª§
    function applyFilters() {
      let filtered = [...allArticles];
      
      // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
      if (currentSourceFilter) {
        filtered = filtered.filter(a => a.source === currentSourceFilter);
      }
      
      // ÊåâÁõ∏ÂÖ≥ÊÄßËøáÊª§ÔºàÂè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†Ôºâ
      if (showOnlyRelevantArticles) {
        filtered = filtered.filter(a => a.is_relevant_to_topic === true);
      }
      
      filteredArticles = filtered;
      renderArticles(filtered);
    }

    // Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
    function renderArticles(articles) {
      const articlesListEl = document.getElementById('articlesList');
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†</p></div>';
        return;
      }
      
      // ÊåâÊó•ÊúüÂàÜÁªÑ
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // Ê∏≤ÊüìËØ•Êó•Êúü‰∏ãÁöÑÊâÄÊúâÊñáÁ´†
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">‰∏çÁõ∏ÂÖ≥</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'Êú™Áü•')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // Êü•ÁúãÊñáÁ´†ËØ¶ÊÉÖ
    async function viewArticle(id) {
      // ‰øùÂ≠òÊªöÂä®‰ΩçÁΩÆ
      savedScrollPosition = window.pageYOffset || document.documentElement.scrollTop;
      
      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
      
      // ‰øùÂ≠òÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅÂà∞ localStorage
      localStorage.setItem('dashboardCurrentPage', 'articles');
      localStorage.setItem('dashboardViewingArticleId', id.toString());
      localStorage.setItem('dashboardCurrentTopicIndex', currentTabIndex.toString());
      
      // ÈöêËóèÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      
      if (statsBar) statsBar.style.display = 'none';
      if (sourceFilterCards) sourceFilterCards.style.display = 'none';
      
      // ÈöêËóèÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÂàóË°®ËßÜÂõæÔºåÈöêËóè‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÔºåÊòæÁ§∫ËØ¶ÊÉÖËßÜÂõæ
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'none';
      document.getElementById('articleDetailView').style.display = 'block';
      
      // ÊªöÂä®Âà∞È°∂ÈÉ®
      window.scrollTo(0, 0);
      
      // Âä†ËΩΩÊñáÁ´†ËØ¶ÊÉÖ
      try {
        const response = await fetch(`${API_BASE_URL}/news/${id}`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success) {
          const article = result.data;
          
          document.getElementById('articleDetailTitle').textContent = article.title;
          document.getElementById('articleDetailSource').textContent = `Êù•Ê∫êÔºö${article.source || 'Êú™Áü•'}`;
          document.getElementById('articleDetailDate').textContent = `ÂèëÂ∏ÉÊó∂Èó¥Ôºö${formatDate(article.publish_date)}`;
          
          // Ê≠£ÊñáÂÜÖÂÆπ - ‰øùÁïôHTMLÊ†ºÂºèÔºàÂÖàÂ§ÑÁêÜÂÜÖÂÆπÔºåÊ£ÄÊü•ÊòØÂê¶ÂåÖÂê´ÂõæÁâáÔºâ
          const contentEl = document.getElementById('articleDetailContent');
          let originalContent = '';
          let contentHasImages = false;
          
          if (article.content) {
            originalContent = article.content;
            
            // Ê£ÄÊü•ÂÜÖÂÆπÊòØÂê¶ÂåÖÂê´HTMLÊ†áÁ≠æ
            const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
            
            // Ê£ÄÊü•ÂÜÖÂÆπ‰∏≠ÊòØÂê¶ÂåÖÂê´ÂõæÁâáÊ†áÁ≠æ
            contentHasImages = /<img[^>]*>/i.test(originalContent);
            
            if (hasHtml) {
              // ÂåÖÂê´HTMLÔºåËøõË°åÂÆâÂÖ®Ê∏ÖÁêÜÂêéÊòæÁ§∫
              // ÁßªÈô§Âç±Èô©Ê†áÁ≠æÂíåÂ±ûÊÄßÔºå‰ΩÜ‰øùÁïôÊ†ºÂºèÊ†áÁ≠æ
              let safeHtml = originalContent
                // ÁßªÈô§scriptÂíåstyleÊ†áÁ≠æÂèäÂÖ∂ÂÜÖÂÆπ
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                // ÁßªÈô§iframe
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                // ÁßªÈô§Âç±Èô©‰∫ã‰ª∂Â±ûÊÄß
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                // ÁßªÈô§javascript:ÈìæÊé•
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              
              // ‰ΩøÁî®DOMPurifyÊàñÁÆÄÂçïÁöÑÊ∏ÖÁêÜÂêéËÆæÁΩÆinnerHTML
              contentEl.innerHTML = safeHtml;
              // ÂØπHTMLÊ†ºÂºèÂÜÖÂÆπ‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤Êüì
              if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(contentEl, {
                  delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                  ],
                  throwOnError: false
                });
              }
            } else {
              // Á∫ØÊñáÊú¨ÂÜÖÂÆπÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
              const textContent = originalContent
                .replace(/&nbsp;/g, ' ')
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&quot;/g, '"')
                .trim();
              
              const paragraphs = textContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
            }
          } else {
            contentEl.textContent = 'ÊöÇÊó†ËØ¶ÁªÜÂÜÖÂÆπ';
          }
          
          // ÂõæÁâá - Â¶ÇÊûúÂÜÖÂÆπ‰∏≠Â∑≤ÁªèÂåÖÂê´ÂõæÁâáÔºåÂ∞±‰∏çÊòæÁ§∫ÂçïÁã¨ÁöÑimage_urlÂõæÁâá
          const imageEl = document.getElementById('articleDetailImage');
          if (article.image_url && !contentHasImages) {
            // Âè™ÊúâÂΩìÂÜÖÂÆπ‰∏≠Ê≤°ÊúâÂõæÁâáÊó∂ÔºåÊâçÊòæÁ§∫image_urlÁöÑÂõæÁâá
            imageEl.innerHTML = `<img src="${escapeHtml(article.image_url)}" alt="${escapeHtml(article.title)}" onerror="this.style.display='none'">`;
          } else {
            imageEl.innerHTML = '';
          }
          
          // ÊëòË¶Å
          const summaryEl = document.getElementById('articleDetailSummary');
          if (article.summary) {
            summaryEl.innerHTML = processMathFormulas(article.summary);
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          // ‰øùÂ≠òÊñáÁ´†IDÂíåÂéüÂßãÂÜÖÂÆπÁî®‰∫éÁøªËØëÂàáÊç¢
          window.currentArticleId = article.id;
          window.originalArticleData = {
            title: article.title,
            summary: article.summary || '',
            content: originalContent
          };
          window.isArticleTranslated = false; // ÈáçÁΩÆÁøªËØëÁä∂ÊÄÅ
          
          // ÂéüÊñáÈìæÊé•
          const sourceLink = document.getElementById('articleSourceLink');
          if (article.url) {
            sourceLink.href = article.url;
            sourceLink.style.display = 'inline-block';
          } else {
            sourceLink.style.display = 'none';
          }
          
          // ÁøªËØëÊåâÈíÆÔºàÂ¶ÇÊûúÊòØËã±ÊñáÔºâ
          const textToCheck = (article.title + ' ' + (article.summary || '') + ' ' + (article.content || '')).substring(0, 500);
          const translateBtn = document.getElementById('articleTranslateBtn');
          if (isEnglish(textToCheck)) {
            translateBtn.style.display = 'inline-block';
            translateBtn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
            translateBtn.setAttribute('data-translated', 'false');
            window.isArticleTranslated = false;
          } else {
            translateBtn.style.display = 'none';
          }
          
          // ÊÄªÁªìÊåâÈíÆÔºàÂ¶ÇÊûúÊñáÁ´†ËæÉÈïøÔºåË∂ÖËøá500Â≠óÔºâ
          const summarizeBtn = document.getElementById('articleSummarizeBtn');
          const contentLength = originalContent.length;
          if (contentLength > 500) {
            summarizeBtn.style.display = 'inline-block';
          } else {
            summarizeBtn.style.display = 'none';
          }
          
          // ÈöêËóèÁîüÊàêÁöÑÊÄªÁªìÂå∫ÂüüÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
          document.getElementById('articleGeneratedSummary').style.display = 'none';
        }
      } catch (error) {
        document.getElementById('articleDetailContent').textContent = 'Âä†ËΩΩÂ§±Ë¥•: ' + error.message;
      }
    }

    // ËøîÂõûÂàóË°®
    function backToList() {
      // Ê∏ÖÈô§ÊñáÁ´†ËØ¶ÊÉÖÁä∂ÊÄÅ
      localStorage.removeItem('dashboardViewingArticleId');
      
      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢ÂºïÔºàÂ¶ÇÊûúÊú™ËÆæÁΩÆÔºåÈªòËÆ§‰∏∫0Ôºâ
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : 0;
      
      // ÊòæÁ§∫ÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØÊ†è„ÄÅ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá
      const statsBar = document.getElementById(`articlesStatsBar-${currentTabIndex}`);
      const sourceFilterCards = document.getElementById(`sourceFilterCards-${currentTabIndex}`);
      
      if (statsBar) statsBar.style.display = 'flex';
      if (sourceFilterCards) sourceFilterCards.style.display = 'flex';
      
      // ÈöêËóèËØ¶ÊÉÖËßÜÂõæÔºåÊòæÁ§∫‰∏ªÈ¢òÈ°µÁ≠æÂÆπÂô®ÂíåÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÂàóË°®ËßÜÂõæ
      document.getElementById('articleDetailView').style.display = 'none';
      const topicsTabsContainer = document.getElementById('articlesTopicsTabsContainer');
      if (topicsTabsContainer) topicsTabsContainer.style.display = 'block';
      const currentListView = document.getElementById(`articlesListView-${currentTabIndex}`);
      if (currentListView) currentListView.style.display = 'block';
      
      // ÊÅ¢Â§çÊªöÂä®‰ΩçÁΩÆ
      window.scrollTo(0, savedScrollPosition);
    }

    // Ê£ÄÊµãÊòØÂê¶‰∏∫Ëã±Êñá
    function isEnglish(text) {
      const englishChars = (text.match(/[a-zA-Z]/g) || []).length;
      const totalChars = text.replace(/\s/g, '').length;
      return totalChars > 0 && englishChars / totalChars > 0.5;
    }

    // ÂàáÊç¢ÁøªËØë/ÂéüÊñá
    async function toggleTranslate() {
      const btn = document.getElementById('articleTranslateBtn');
      const titleEl = document.getElementById('articleDetailTitle');
      const summaryEl = document.getElementById('articleDetailSummary');
      const contentEl = document.getElementById('articleDetailContent');
      
      if (!window.originalArticleData || !window.currentArticleId) {
        return;
      }
      
      const isTranslated = window.isArticleTranslated || false;
      
      if (isTranslated) {
        // ÊòæÁ§∫ÂéüÊñá
        titleEl.textContent = window.originalArticleData.title;
        if (window.originalArticleData.summary) {
          summaryEl.innerHTML = processMathFormulas(window.originalArticleData.summary);
          summaryEl.style.display = 'block';
        } else {
          summaryEl.style.display = 'none';
        }
        
        // Ê£ÄÊü•ÂéüÊñáÊòØÂê¶ÂåÖÂê´HTML
        const originalContent = window.originalArticleData.content;
        const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
        
        if (hasHtml) {
          // ÂåÖÂê´HTMLÔºåËøõË°åÂÆâÂÖ®Ê∏ÖÁêÜÂêéÊòæÁ§∫
          let safeHtml = originalContent
            .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
            .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
            .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
            .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
            .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
            .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
          contentEl.innerHTML = safeHtml;
          // ÂØπÂéüÊñá‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤ÊüìÔºàÂ¶ÇÊûúÂéüÊñáÊòØHTMLÊ†ºÂºèÔºâ
          if (typeof renderMathInElement !== 'undefined') {
            renderMathInElement(contentEl, {
              delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '\\[', right: '\\]', display: true},
                {left: '\\(', right: '\\)', display: false}
              ],
              throwOnError: false
            });
          }
        } else {
          // Á∫ØÊñáÊú¨ÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
          const paragraphs = originalContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
          contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
        }
        
        btn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
        btn.setAttribute('data-translated', 'false');
        window.isArticleTranslated = false;
      } else {
        // ÁøªËØë‰∏∫‰∏≠ÊñáÔºà‰ΩøÁî® DeepSeek APIÔºåÂ∏¶ÁºìÂ≠òÔºâ
        btn.disabled = true;
        btn.textContent = 'ÁøªËØë‰∏≠...';
        
        try {
          // ÊèêÂèñÁ∫ØÊñáÊú¨Áî®‰∫éÁøªËØëÔºàÂ¶ÇÊûúÂåÖÂê´HTMLÔºåÊèêÂèñÊñáÊú¨ÂÜÖÂÆπÔºâ
          const originalContent = window.originalArticleData.content;
          const hasHtml = /<[a-z][\s\S]*>/i.test(originalContent);
          
          let textForTranslation = '';
          if (hasHtml) {
            // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂DOMÂÖÉÁ¥†Êù•ÊèêÂèñÊñáÊú¨
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalContent;
            textForTranslation = (tempDiv.textContent || tempDiv.innerText || originalContent.replace(/<[^>]*>/g, '')).trim();
          } else {
            // Á∫ØÊñáÊú¨ÔºåÁõ¥Êé•‰ΩøÁî®
            textForTranslation = originalContent.replace(/<[^>]*>/g, '').trim();
          }
          
          // ‰ΩøÁî®Êñ∞ÁöÑÁøªËØëÊï¥ÁØáÊñáÁ´†APIÔºå‰º†ÈÄíÊñáÁ´†ID‰ª•ÊîØÊåÅÁºìÂ≠ò
          const response = await fetch(`${API_BASE_URL}/news/translate/article`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              ...getHeaders()
            },
            body: JSON.stringify({
              articleId: window.currentArticleId,
              title: window.originalArticleData.title,
              summary: window.originalArticleData.summary || '',
              content: textForTranslation.substring(0, 4000),
              source: 'en',
              target: 'zh'
            })
          });
          
          const result = await response.json();
          
          if (!result.success) {
            throw new Error(result.message || 'ÁøªËØëÂ§±Ë¥•');
          }
          
          // Êõ¥Êñ∞ÊòæÁ§∫
          titleEl.textContent = result.translatedTitle || window.originalArticleData.title;
          
          if (result.translatedSummary) {
            summaryEl.innerHTML = processMathFormulas(result.translatedSummary);
            summaryEl.style.display = 'block';
          } else if (window.originalArticleData.summary) {
            summaryEl.innerHTML = processMathFormulas(window.originalArticleData.summary);
            summaryEl.style.display = 'block';
          } else {
            summaryEl.style.display = 'none';
          }
          
          if (result.translatedContent) {
            // ÁøªËØëÂêéÁöÑÂÜÖÂÆπÊòØÁ∫ØÊñáÊú¨ÔºåËΩ¨Êç¢‰∏∫ÊÆµËêΩÊ†ºÂºèÔºåÂπ∂Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨Âºè
            const paragraphs = result.translatedContent.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
            contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
          } else {
            // Â¶ÇÊûúÁøªËØëÂ§±Ë¥•ÔºåÊòæÁ§∫ÂéüÊñáÔºà‰øùÊåÅHTMLÊ†ºÂºèÔºâ
            if (hasHtml) {
              let safeHtml = originalContent
                .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                .replace(/<iframe[^>]*>[\s\S]*?<\/iframe>/gi, '')
                .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                .replace(/\s*on\w+\s*=\s*[^\s>]*/gi, '')
                .replace(/href\s*=\s*["']javascript:[^"']*["']/gi, 'href="#"');
              contentEl.innerHTML = safeHtml;
              // ÂØπÂéüÊñá‰∏≠ÁöÑÂÖ¨Âºè‰πüËøõË°åÊ∏≤ÊüìÔºàÂ¶ÇÊûúÂéüÊñáÊòØHTMLÊ†ºÂºèÔºåÂèØËÉΩÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜÔºâ
              if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(contentEl, {
                  delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '\\[', right: '\\]', display: true},
                    {left: '\\(', right: '\\)', display: false}
                  ],
                  throwOnError: false
                });
              }
            } else {
              const paragraphs = textForTranslation.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0);
              contentEl.innerHTML = paragraphs.map(p => `<p>${processMathFormulas(p)}</p>`).join('');
            }
          }
          
          // ‰øùÂ≠òÁøªËØëÁªìÊûúÂà∞ window ÂØπË±°Ôºå‰ª•‰æøÂàáÊç¢Êó∂‰ΩøÁî®
          window.translatedArticleData = {
            title: result.translatedTitle,
            summary: result.translatedSummary,
            content: result.translatedContent
          };
          
          btn.textContent = 'Êü•ÁúãÂéüÊñá';
          btn.setAttribute('data-translated', 'true');
          window.isArticleTranslated = true;
          
          // Â¶ÇÊûúÊù•Ëá™ÁºìÂ≠òÔºåÊòæÁ§∫ÊèêÁ§∫
          if (result.fromCache) {
            console.log('ÁøªËØëÁªìÊûúÊù•Ëá™ÁºìÂ≠ò');
          }
        } catch (error) {
          alert('ÁøªËØëÂ§±Ë¥•: ' + error.message);
          btn.textContent = 'ÁøªËØë‰∏∫‰∏≠Êñá';
        } finally {
          btn.disabled = false;
        }
      }
    }

    // ÁîüÊàêÊñáÁ´†ÊÄªÁªì
    async function generateSummary() {
      const btn = document.getElementById('articleSummarizeBtn');
      const summaryEl = document.getElementById('articleGeneratedSummary');
      const summaryContentEl = document.getElementById('articleGeneratedSummaryContent');
      
      if (!window.originalArticleData) {
        return;
      }
      
      btn.disabled = true;
      btn.textContent = 'ÁîüÊàê‰∏≠...';
      summaryEl.style.display = 'block';
      summaryContentEl.textContent = 'Ê≠£Âú®ÁîüÊàêÊÄªÁªìÔºåËØ∑Á®çÂÄô...';
      
      try {
        const content = window.originalArticleData.content.replace(/<[^>]*>/g, '').trim();
        const textToSummarize = (window.originalArticleData.title + '\n\n' + content).substring(0, 4000);
        
        const response = await fetch(`${API_BASE_URL}/news/summarize`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...getHeaders()
          },
          body: JSON.stringify({
            text: textToSummarize
          })
        });
        
        const result = await response.json();
        
        if (result.success && result.summary) {
          summaryContentEl.textContent = result.summary;
          btn.textContent = 'ÈáçÊñ∞ÁîüÊàê';
        } else {
          summaryContentEl.textContent = 'ÁîüÊàêÊÄªÁªìÂ§±Ë¥•: ' + (result.message || 'Êú™Áü•ÈîôËØØ');
          btn.textContent = 'ÁîüÊàêÊÄªÁªì';
        }
      } catch (error) {
        summaryContentEl.textContent = 'ÁîüÊàêÊÄªÁªìÂ§±Ë¥•: ' + error.message;
        btn.textContent = 'ÁîüÊàêÊÄªÁªì';
      } finally {
        btn.disabled = false;
      }
    }

    function formatDate(dateStr) {
      if (!dateStr) return '-';
      try {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}Âπ¥${month}Êúà${day}Êó•`;
      } catch (e) {
        return dateStr;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Â§ÑÁêÜÊï∞Â≠¶ÂÖ¨ÂºèÔºåÂ∞Ü LaTeX ÂÖ¨ÂºèËΩ¨Êç¢‰∏∫ KaTeX ÂèØÊ∏≤ÊüìÁöÑÊ†ºÂºè
    function processMathFormulas(text) {
      if (!text || typeof text !== 'string') {
        return text;
      }

      // Áî®‰∫éÂ≠òÂÇ®ÂÖ¨ÂºèÁöÑÊï∞ÁªÑ
      const formulas = [];
      let formulaIndex = 0;
      
      // Âç†‰ΩçÁ¨¶Ê®°Êùø
      const placeholder = (index) => `__KATEX_FORMULA_${index}__`;

      // Â§ÑÁêÜÂùóÁ∫ßÂÖ¨Âºè \[...\] Êàñ $$...$$
      let processedText = text
        // Â§ÑÁêÜ \[...\] Ê†ºÂºè
        .replace(/\\\[([\s\S]*?)\\\]/g, (match, formula) => {
          formulas.push({ type: 'display', formula: formula.trim() });
          return placeholder(formulaIndex++);
        })
        // Â§ÑÁêÜ $$...$$ Ê†ºÂºèÔºàÈÅøÂÖç‰∏éÂ∑≤Â§ÑÁêÜÁöÑÂÜ≤Á™ÅÔºâ
        .replace(/\$\$([\s\S]*?)\$\$/g, (match, formula) => {
          // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊòØÂç†‰ΩçÁ¨¶
          if (match.includes('__KATEX_FORMULA_')) {
            return match;
          }
          formulas.push({ type: 'display', formula: formula.trim() });
          return placeholder(formulaIndex++);
        })
        // Â§ÑÁêÜË°åÂÜÖÂÖ¨Âºè \(...\)
        .replace(/\\\(([\s\S]*?)\\\)/g, (match, formula) => {
          formulas.push({ type: 'inline', formula: formula.trim() });
          return placeholder(formulaIndex++);
        });

      // ÂØπÈùûÂÖ¨ÂºèÈÉ®ÂàÜËøõË°å HTML ËΩ¨‰πâ
      let escapedText = escapeHtml(processedText);

      // Â∞ÜÂç†‰ΩçÁ¨¶ÊõøÊç¢‰∏∫ KaTeX Ê∏≤ÊüìÁöÑ HTML
      if (typeof katex === 'undefined') {
        // Â¶ÇÊûú KaTeX Êú™Âä†ËΩΩÔºåËøîÂõûËΩ¨‰πâÂêéÁöÑÊñáÊú¨ÔºàÂÖ¨ÂºèÈÉ®ÂàÜÊòæÁ§∫‰∏∫Âç†‰ΩçÁ¨¶Ôºâ
        console.warn('KaTeX Êú™Âä†ËΩΩÔºåÊó†Ê≥ïÊ∏≤ÊüìÊï∞Â≠¶ÂÖ¨Âºè');
        formulas.forEach((formulaData, index) => {
          const fallback = escapeHtml(`[ÂÖ¨Âºè: ${formulaData.formula}]`);
          escapedText = escapedText.replace(placeholder(index), fallback);
        });
      } else {
        formulas.forEach((formulaData, index) => {
          try {
            let renderedFormula;
            if (formulaData.type === 'display') {
              // ÂùóÁ∫ßÂÖ¨Âºè‰ΩøÁî® div ÂåÖË£Ö
              renderedFormula = katex.renderToString(formulaData.formula, {
                throwOnError: false,
                displayMode: true
              });
              renderedFormula = `<div class="katex-display" style="margin: 1em 0; overflow-x: auto; overflow-y: hidden;">${renderedFormula}</div>`;
            } else {
              // Ë°åÂÜÖÂÖ¨Âºè‰ΩøÁî® span ÂåÖË£Ö
              renderedFormula = katex.renderToString(formulaData.formula, {
                throwOnError: false,
                displayMode: false
              });
              renderedFormula = `<span class="katex-inline">${renderedFormula}</span>`;
            }
            escapedText = escapedText.replace(placeholder(index), renderedFormula);
          } catch (error) {
            console.error('KaTeX Ê∏≤ÊüìÈîôËØØ:', error, 'ÂÖ¨Âºè:', formulaData.formula);
            // Â¶ÇÊûúÊ∏≤ÊüìÂ§±Ë¥•ÔºåÊòæÁ§∫ÂéüÂßãÂÖ¨ÂºèÊñáÊú¨
            const fallback = escapeHtml(`[ÂÖ¨Âºè: ${formulaData.formula}]`);
            escapedText = escapedText.replace(placeholder(index), fallback);
          }
        });
      }

      return escapedText;
    }

    // Ëá™Âä®Âà∑Êñ∞ÊñáÁ´†ÂàóË°®ÔºàÊØè30ÁßíÔºâ
    let articlesRefreshInterval = null;

    function startArticlesAutoRefresh() {
      if (articlesRefreshInterval) {
        clearInterval(articlesRefreshInterval);
      }
      articlesRefreshInterval = setInterval(() => {
        const articlesPage = document.getElementById('articlesPage');
        if (articlesPage.classList.contains('active')) {
          // Ëá™Âä®Âà∑Êñ∞ÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆ
          loadArticles(true);
          loadRefreshStatus();
        }
      }, 30000); // 30ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
    }

    // Âä†ËΩΩÊâÄÊúâ‰∏ªÈ¢òÁöÑÊé®ËçêÂéÜÂè≤Âπ∂Ê∏≤ÊüìÈ°µÁ≠æ
    async function loadAllRecommendationHistory() {
      try {
        console.log('üìñ ÂºÄÂßãÂä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤...');
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        console.log('üìñ Êé®ËçêÂéÜÂè≤ÂìçÂ∫î:', result);

        if (result.success && result.data && result.data.length > 0) {
          const histories = result.data;
          console.log(`üìñ ÊâæÂà∞ ${histories.length} Êù°Êé®ËçêÂéÜÂè≤ÔºåÂºÄÂßãÊ∏≤ÊüìÈ°µÁ≠æ...`);
          console.log('üìñ Êé®ËçêÂéÜÂè≤‰∏ªÈ¢òÂàóË°®:', histories.map(h => h.topic_keywords));
          
          // Ê£ÄÊü•ÊòØÂê¶ÊúâËøõË°å‰∏≠ÁöÑÊé®Ëçê
          const inProgressHistories = histories.filter(h => h.status === 'in_progress');
          if (inProgressHistories.length > 0) {
            console.log(`‚è≥ ÂèëÁé∞ ${inProgressHistories.length} ‰∏™ËøõË°å‰∏≠ÁöÑÊé®Ëçê:`, inProgressHistories.map(h => h.topic_keywords));
          }
          
          // Ê∏ÖÁ©∫Âπ∂ÈáçÊñ∞Ê∏≤ÊüìÈ°µÁ≠æ
          renderTopicsTabs(histories);
          document.getElementById('topicsTabsSection').style.display = 'block';
          console.log('‚úÖ Êé®ËçêÂéÜÂè≤È°µÁ≠æÊ∏≤ÊüìÂÆåÊàê');
        } else {
          console.log('üìñ Ê≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÈöêËóèÈ°µÁ≠æÂÆπÂô®');
          document.getElementById('topicsTabsSection').style.display = 'none';
        }
      } catch (error) {
        console.error('‚ùå Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', error);
        document.getElementById('topicsTabsSection').style.display = 'none';
      }
    }

    // Ê∏≤Êüì‰∏ªÈ¢òÈ°µÁ≠æ
    function renderTopicsTabs(histories) {
      const tabsHeader = document.getElementById('topicsTabsHeader');
      const tabsContent = document.getElementById('topicsTabsContent');
      
      if (!tabsHeader || !tabsContent) {
        console.warn('‚ö†Ô∏è  È°µÁ≠æÂÆπÂô®‰∏çÂ≠òÂú®ÔºåÊó†Ê≥ïÊ∏≤Êüì');
        return;
      }
      
      console.log(`üé® ÂºÄÂßãÊ∏≤Êüì ${histories?.length || 0} ‰∏™‰∏ªÈ¢òÁöÑÈ°µÁ≠æ...`);
      
      // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';
      
      if (!histories || histories.length === 0) {
        console.log('‚ÑπÔ∏è  Ê≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊ∏ÖÁ©∫È°µÁ≠æÂπ∂ÈöêËóèÂÆπÂô®');
        // Â¶ÇÊûúÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÈöêËóèÈ°µÁ≠æÂÆπÂô®
        const topicsTabsSection = document.getElementById('topicsTabsSection');
        if (topicsTabsSection) {
          topicsTabsSection.style.display = 'none';
        }
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâçÈÄâ‰∏≠ÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºàÂ¶ÇÊûúÊúâÔºâ
      let activeTopicKeywords = null;
      const currentActiveTab = tabsHeader.querySelector('.topic-tab.active');
      if (currentActiveTab) {
        // ‰ªéÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÊñáÊú¨‰∏≠ÊèêÂèñ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºàÂéªÊéâÂæΩÁ´†Âíå"Êé®Ëçê‰∏≠..."Ôºâ
        const tabText = currentActiveTab.textContent.trim();
        activeTopicKeywords = tabText.replace(/\s*\(\d+\)\s*$/, '').replace(/\s*Êé®Ëçê‰∏≠\.\.\.\s*$/, '').trim();
      }
      
      // ÁîüÊàêÈ°µÁ≠æÂíåÂÜÖÂÆπ
      histories.forEach((history, index) => {
        const topicKeywords = history.topic_keywords;
        const tabId = `tab-${index}`;
        const panelId = `panel-${index}`;
        // Â¶ÇÊûúÂΩìÂâç‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂåπÈÖç‰πãÂâçÈÄâ‰∏≠ÁöÑÔºåÂàô‰øùÊåÅÈÄâ‰∏≠Áä∂ÊÄÅ
        const isActive = activeTopicKeywords && topicKeywords === activeTopicKeywords 
          ? true 
          : (index === 0 && !activeTopicKeywords);
        
        // ÂàõÂª∫È°µÁ≠æÊåâÈíÆ
        const tabBtn = document.createElement('button');
        tabBtn.className = `topic-tab ${isActive ? 'active' : ''}`;
        tabBtn.id = tabId;
        tabBtn.onclick = () => switchTopicTab(index);
        const sourceCount = history.recommended_sources ? history.recommended_sources.length : 0;
        const recStatus = history.status || 'completed';
        const isInProgress = recStatus === 'in_progress';
        const statusBadge = isInProgress ? '<span class="tab-status-badge" style="color: #8B5CF6; font-size: 11px; margin-left: 4px;">Êé®Ëçê‰∏≠...</span>' : '';
        tabBtn.innerHTML = `${escapeHtml(topicKeywords)}${statusBadge}${sourceCount > 0 ? `<span class="tab-badge">${sourceCount}</span>` : ''}`;
        tabsHeader.appendChild(tabBtn);
        
        // ÂàõÂª∫È°µÁ≠æÂÜÖÂÆπÈù¢Êùø
        const panel = document.createElement('div');
        panel.className = `topic-tab-panel ${isActive ? 'active' : ''}`;
        panel.id = panelId;
        panel.dataset.history = JSON.stringify(history);
        
        // Êé®ËçêËøáÁ®ãÊó•ÂøóÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
        let processLogsHtml = '';
        
        if (history.process_logs && history.process_logs.length > 0) {
          // Ëé∑ÂèñÊúÄÂêé‰∏ÄÊù°Êó•Âøó‰Ωú‰∏∫ÂΩìÂâçÁä∂ÊÄÅ
          const lastLog = history.process_logs[history.process_logs.length - 1];
          const lastMessage = lastLog.message || (isInProgress ? 'Êé®ËçêËøõË°å‰∏≠...' : 'Êé®ËçêÂÆåÊàê');
          
          processLogsHtml = `
            <div style="font-size: 11px; color: ${isInProgress ? '#8B5CF6' : '#999'}; margin-bottom: 12px; padding: 4px 0;" id="processText-${index}">
              ${isInProgress ? '‚è≥ ' : ''}${escapeHtml(lastMessage)}
            </div>
          `;
        } else if (isInProgress) {
          processLogsHtml = `
            <div style="font-size: 11px; color: #8B5CF6; margin-bottom: 12px; padding: 4px 0;" id="processText-${index}">
              ‚è≥ Êé®ËçêËøõË°å‰∏≠ÔºåËØ∑Á®çÂÄô...
          </div>
        `;
        }
        
        // Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†ºÔºàÂåÖÂê´ËøáÊª§Âô®ÂíåÂú∞Âå∫ÂàóÔºâ
        let recommendationsHtml = '';
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          // Ëé∑ÂèñÂîØ‰∏ÄÁöÑÁ±ªÂûãÂàóË°®
          const types = [...new Set(history.recommended_sources.map(s => s.sourceType || 'rss'))];
          
          recommendationsHtml = `
            <div class="recommendations-filters" id="filters-${index}">
              <div class="filter-group">
                <label>Âú∞Âå∫Ôºö</label>
                <select id="regionFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">ÂÖ®ÈÉ®</option>
                  <option value="ÂõΩÂÜÖ">ÂõΩÂÜÖ</option>
                  <option value="ÂõΩÂ§ñ">ÂõΩÂ§ñ</option>
                </select>
              </div>
              <div class="filter-group">
                <label>Á±ªÂûãÔºö</label>
                <select id="typeFilter-${index}" onchange="filterRecommendationsInTab(${index})">
                  <option value="all">ÂÖ®ÈÉ®</option>
                  ${types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('')}
                </select>
              </div>
              <div class="recommendations-stats" id="recommendationsStats-${index}"></div>
              <button class="invalid-sources-toggle" id="toggleInvalid-${index}" onclick="toggleInvalidSources(${index})" style="display: none;">
                <span id="toggleInvalidText-${index}">ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê</span>
                <span id="toggleInvalidCount-${index}"></span>
              </button>
            </div>
            <div id="recommendationsContainer-${index}" style="display: none;">
            <table class="recommendations-table" id="recommendationsTable-${index}">
              <thead>
                <tr>
                  <th class="checkbox-cell"></th>
                  <th>‰ø°ÊÅØÊ∫ê</th>
                  <th>Á±ªÂûã</th>
                  <th>Âú∞Âå∫</th>
                  <th>ÊèèËø∞</th>
                  <th>ÊúâÊïàÊÄß</th>
                  <th>Áä∂ÊÄÅ</th>
                </tr>
              </thead>
              <tbody id="recommendationsBody-${index}">
              </tbody>
            </table>
            </div>
          `;
        } else {
          recommendationsHtml = '<p style="color: #999;">ÊöÇÊó†Êé®Ëçê‰ø°ÊÅØÊ∫ê</p>';
        }
        
        panel.innerHTML = processLogsHtml + recommendationsHtml;
        tabsContent.appendChild(panel);
        
        // Ê∏≤ÊüìËØ•‰∏ªÈ¢òÁöÑÊé®ËçêËøáÁ®ãÂíåÊé®Ëçê‰ø°ÊÅØÊ∫ê
        if (history.process_logs && history.process_logs.length > 0) {
          renderProcessLogsInTab(index, history.process_logs);
        }
        if (history.recommended_sources && history.recommended_sources.length > 0) {
          renderRecommendationsInTab(index, history.recommended_sources);
        }
      });
    }

    // Âä†ËΩΩÊõ¥Â§öÊé®Ëçê‰ø°ÊÅØÊ∫ê
    async function loadMoreRecommendations(tabIndex) {
      const loadMoreBtn = document.getElementById(`loadMoreBtn-${tabIndex}`);
      const loadMoreBtnText = document.getElementById(`loadMoreBtnText-${tabIndex}`);
      const loadMoreBtnLoading = document.getElementById(`loadMoreBtnLoading-${tabIndex}`);
      
      if (!loadMoreBtn) return;
      
      // Á¶ÅÁî®ÊåâÈíÆÂπ∂ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      loadMoreBtn.disabled = true;
      if (loadMoreBtnText) loadMoreBtnText.textContent = 'Ê≠£Âú®Ëé∑ÂèñÊõ¥Â§öÊé®Ëçê...';
      if (loadMoreBtnLoading) loadMoreBtnLoading.style.display = 'inline';
      
      try {
        // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÁöÑÂÖ≥ÈîÆËØç
        const panel = document.getElementById(`panel-${tabIndex}`);
        if (!panel) {
          throw new Error('Êâæ‰∏çÂà∞‰∏ªÈ¢òÈù¢Êùø');
        }
        
        const history = JSON.parse(panel.dataset.history || '{}');
        const topicKeywords = history.topic_keywords;
        
        if (!topicKeywords) {
          throw new Error('Êâæ‰∏çÂà∞‰∏ªÈ¢òÂÖ≥ÈîÆËØç');
        }
        
        // Ëé∑ÂèñÂ∑≤Êé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®ÔºàÁî®‰∫éÂéªÈáçÔºâ
        const currentSources = window.recommendedSourcesByTab?.[tabIndex] || [];
        const excludeSources = currentSources.map(s => ({
          sourceUrl: s.sourceUrl || s.url,
          sourceName: s.sourceName || s.name
        })).filter(s => s.sourceUrl || s.sourceName);
        
        console.log(`[Êõ¥Â§öÊé®Ëçê] ÂºÄÂßãËé∑ÂèñÊõ¥Â§öÊé®ËçêÔºåÊéíÈô§ ${excludeSources.length} ‰∏™Â∑≤Êé®Ëçê‰ø°ÊÅØÊ∫ê`);
        
        // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
        addProcessLogInTab(tabIndex, `Ê≠£Âú®Ëé∑ÂèñÊõ¥Â§öÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÊéíÈô§ ${excludeSources.length} ‰∏™Â∑≤Êé®ËçêÔºâ...`, 'loading');
        
        // Ë∞ÉÁî®Êé®ËçêÊé•Âè£
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({
            keywords: topicKeywords,
            limit: 10,
            excludeSources: excludeSources
          })
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP error! status: ${response.status}: ${errorText}`);
        }
        
        if (!response.body) {
          throw new Error('ÂìçÂ∫î‰Ωì‰∏∫Á©∫ÔºåÊó†Ê≥ïËØªÂèñÊµÅÂºèÊï∞ÊçÆ');
        }
        
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let finalResult = null;
        let newSources = [];
        
        while (true) {
          const { done, value } = await reader.read();
          
          if (done) {
            break;
          }
          
          buffer += decoder.decode(value, { stream: true });
          
          const lines = buffer.split('\n');
          buffer = lines.pop() || '';
          
          for (const line of lines) {
            if (line.trim()) {
              try {
                const progress = JSON.parse(line);
                
                if (progress.type === 'progress') {
                  addProcessLogInTab(tabIndex, progress.message, progress.logType || 'loading');
                } else if (progress.type === 'sourcesReceived') {
                  if (progress.sources && progress.sources.length > 0) {
                    newSources = progress.sources;
                    addProcessLogInTab(tabIndex, `Â∑≤Êî∂Âà∞ ${newSources.length} ‰∏™Êñ∞ÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊ≠£Âú®È™åËØÅÊúâÊïàÊÄß...`, 'loading');
                    
                    // ÂêàÂπ∂Âà∞Áé∞ÊúâÂàóË°®ÔºàÂéªÈáçÔºâ
                    if (!window.recommendedSourcesByTab) {
                      window.recommendedSourcesByTab = {};
                    }
                    if (!window.recommendedSourcesByTab[tabIndex]) {
                      window.recommendedSourcesByTab[tabIndex] = [];
                    }
                    
                    // ÂéªÈáçÔºöÂè™Ê∑ªÂä†‰∏çÂú®Áé∞ÊúâÂàóË°®‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
                    const existingUrls = new Set(window.recommendedSourcesByTab[tabIndex].map(s => (s.sourceUrl || s.url || '').toLowerCase().trim()));
                    const existingNames = new Set(window.recommendedSourcesByTab[tabIndex].map(s => (s.sourceName || s.name || '').toLowerCase().trim()));
                    
                    const uniqueNewSources = newSources.filter(s => {
                      const url = (s.sourceUrl || s.url || '').toLowerCase().trim();
                      const name = (s.sourceName || s.name || '').toLowerCase().trim();
                      return !existingUrls.has(url) && !existingNames.has(name);
                    });
                    
                    // ËÆ°ÁÆóÊñ∞ÁöÑÊâπÊ¨°Âè∑ÔºàÂΩìÂâçÊúÄÂ§ßÊâπÊ¨°Âè∑+1Ôºâ
                    const maxBatchNumber = window.recommendedSourcesByTab[tabIndex].reduce((max, s) => {
                      const batch = s.batchNumber || 1;
                      return Math.max(max, batch);
                    }, 0);
                    const newBatchNumber = maxBatchNumber + 1;
                    
                    // ‰∏∫Êñ∞Êé®ËçêÊ∑ªÂä†ÊâπÊ¨°Âè∑ÔºåÂπ∂Ê∑ªÂä†Âà∞ÂàóË°®ÊúÄÂâçÈù¢
                    const newSourcesWithBatch = uniqueNewSources.map(s => ({
                      ...s,
                      batchNumber: newBatchNumber
                    }));
                    window.recommendedSourcesByTab[tabIndex].unshift(...newSourcesWithBatch);
                    
                    // Êõ¥Êñ∞Ë°®Ê†ºÊòæÁ§∫
                    renderRecommendationsInTab(tabIndex, window.recommendedSourcesByTab[tabIndex]);
                  }
                } else if (progress.type === 'sourceValidated') {
                  // Êõ¥Êñ∞È™åËØÅÁä∂ÊÄÅ
                  if (progress.source && window.recommendedSourcesByTab?.[tabIndex]) {
                    const sourceIndex = window.recommendedSourcesByTab[tabIndex].findIndex(
                      s => (s.sourceUrl || s.url) === (progress.source.sourceUrl || progress.source.url)
                    );
                    if (sourceIndex >= 0) {
                      window.recommendedSourcesByTab[tabIndex][sourceIndex] = progress.source;
                      renderRecommendationsInTab(tabIndex, window.recommendedSourcesByTab[tabIndex]);
                    }
                  }
                } else if (progress.type === 'final') {
                  finalResult = progress;
                  if (finalResult.success) {
                    const totalCount = window.recommendedSourcesByTab?.[tabIndex]?.length || 0;
                    addProcessLogInTab(tabIndex, `Êõ¥Â§öÊé®ËçêÂÆåÊàêÔºÅÂΩìÂâçÂÖ±Êúâ ${totalCount} ‰∏™‰ø°ÊÅØÊ∫ê`, 'success');
                  }
                }
              } catch (e) {
                console.error('Ëß£ÊûêËøõÂ∫¶Êï∞ÊçÆÂ§±Ë¥•:', e, line);
              }
            }
          }
        }
        
        // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        if (loadMoreBtnText) loadMoreBtnText.textContent = 'Êõ¥Â§öÊé®Ëçê';
        if (loadMoreBtnLoading) loadMoreBtnLoading.style.display = 'none';
        loadMoreBtn.disabled = false;
        
      } catch (error) {
        console.error('[Êõ¥Â§öÊé®Ëçê] Ëé∑ÂèñÂ§±Ë¥•:', error);
        addProcessLogInTab(tabIndex, `Ëé∑ÂèñÊõ¥Â§öÊé®ËçêÂ§±Ë¥•: ${error.message}`, 'error');
        showMessage(`Ëé∑ÂèñÊõ¥Â§öÊé®ËçêÂ§±Ë¥•: ${error.message}`, 'error');
        
        // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        if (loadMoreBtnText) loadMoreBtnText.textContent = 'Êõ¥Â§öÊé®Ëçê';
        if (loadMoreBtnLoading) loadMoreBtnLoading.style.display = 'none';
        loadMoreBtn.disabled = false;
      }
    }

    // ÂàáÊç¢‰∏ªÈ¢òÈ°µÁ≠æ
    function switchTopicTab(index) {
      // Êõ¥Êñ∞È°µÁ≠æÊåâÈíÆÁä∂ÊÄÅ
      document.querySelectorAll('.topic-tab').forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÈù¢ÊùøÁä∂ÊÄÅ
      document.querySelectorAll('.topic-tab-panel').forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∏≤ÊüìÊé®ËçêËøáÁ®ãÊó•ÂøóÔºàÂ∞èÂ≠óÊòæÁ§∫Ôºâ
    function renderProcessLogsInTab(tabIndex, logs) {
      const processTextEl = document.getElementById(`processText-${tabIndex}`);
      if (!processTextEl) return;
      
      // Âè™ÊòæÁ§∫ÊúÄÂêé‰∏ÄÊù°Êó•ÂøóÔºàÊúÄÊñ∞ÁöÑËøõÂ∫¶Ôºâ
      if (logs && logs.length > 0) {
        const lastLog = logs[logs.length - 1];
        const message = lastLog.message || '';
        
        // Êõ¥Êñ∞ËøõÂ∫¶ÊñáÊú¨
        processTextEl.textContent = message;
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠Ê∏≤ÊüìÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∏¶ËøáÊª§ÂäüËÉΩÔºâ
    async function renderRecommendationsInTab(tabIndex, sources) {
      const tbody = document.getElementById(`recommendationsBody-${tabIndex}`);
      const table = document.getElementById(`recommendationsTable-${tabIndex}`);
      const filters = document.getElementById(`filters-${tabIndex}`);
      const emptyMsg = document.getElementById(`recommendationsEmpty-${tabIndex}`);
      
      if (!tbody) return;
      
      // Â¶ÇÊûúÊúâÊï∞ÊçÆÔºåÊòæÁ§∫Ë°®Ê†ºÂíåËøáÊª§Âô®ÔºåÈöêËóèÁ©∫Áä∂ÊÄÅÊèêÁ§∫
      if (sources && sources.length > 0) {
        if (table) table.style.display = 'table';
        if (filters) filters.style.display = 'flex';
        if (emptyMsg) emptyMsg.style.display = 'none';
        // ÊòæÁ§∫Êìç‰ΩúÊåâÈíÆ
        const actionsDiv = document.getElementById(`recommendationsActions-${tabIndex}`);
        if (actionsDiv) actionsDiv.style.display = 'block';
        // Êõ¥Êñ∞ËÆ¢ÈòÖÈÄâ‰∏≠ÊåâÈíÆÊñáÊú¨
        updateSubscribeButtonText(tabIndex);
      } else {
        if (table) table.style.display = 'none';
        if (filters) filters.style.display = 'none';
        if (emptyMsg) emptyMsg.style.display = 'block';
        // ÈöêËóè"Êõ¥Â§öÊé®Ëçê"ÊåâÈíÆ
        const loadMoreBtn = document.getElementById(`loadMoreRecommendations-${tabIndex}`);
        if (loadMoreBtn) loadMoreBtn.style.display = 'none';
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâç‰∏ªÈ¢òÁöÑÂÖ≥ÈîÆËØç
      const panel = document.getElementById(`panel-${tabIndex}`);
      const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
      const topicKeywords = history.topic_keywords || null;
      
      // Êåâ‰∏ªÈ¢òÂä†ËΩΩËÆ¢ÈòÖÔºàÂ¶ÇÊûúÊúâ‰∏ªÈ¢òÔºâ
      if (topicKeywords) {
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          const result = await response.json();
          if (result.success) {
            userSubscriptions = result.data.map(sub => sub.source_name);
          }
        } catch (error) {
          console.error('Âä†ËΩΩ‰∏ªÈ¢òËÆ¢ÈòÖÂ§±Ë¥•:', error);
          await loadUserSubscriptions(); // ÈôçÁ∫ßÂà∞Âä†ËΩΩÊâÄÊúâËÆ¢ÈòÖ
        }
      } else {
        await loadUserSubscriptions();
      }
      
      // Êõ¥Êñ∞Á±ªÂûãËøáÊª§Âô®ÈÄâÈ°π
      const types = [...new Set(sources.map(s => s.sourceType || 'rss'))];
      const typeFilterEl = document.getElementById(`typeFilter-${tabIndex}`);
      if (typeFilterEl) {
        const currentValue = typeFilterEl.value;
        typeFilterEl.innerHTML = '<option value="all">ÂÖ®ÈÉ®</option>' + 
          types.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');
        if (currentValue && types.includes(currentValue)) {
          typeFilterEl.value = currentValue;
        }
      }
      
      // Ëé∑ÂèñËøáÊª§Êù°‰ª∂
      const regionFilter = document.getElementById(`regionFilter-${tabIndex}`)?.value || 'all';
      const typeFilter = document.getElementById(`typeFilter-${tabIndex}`)?.value || 'all';
      
      // ËøáÊª§Êï∞ÊçÆ
      let filteredSources = sources;
      if (regionFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.region || 'ÂõΩÂ§ñ') === regionFilter);
      }
      if (typeFilter !== 'all') {
        filteredSources = filteredSources.filter(s => (s.sourceType || 'rss') === typeFilter);
      }
      
      // ÊåâÊâπÊ¨°ÂàÜÁªÑÔºàÊâπÊ¨°Âè∑Ë∂äÂ§ßÔºåË∂äÊñ∞Ôºâ
      const sourcesByBatch = {};
      filteredSources.forEach(source => {
        const batchNumber = source.batchNumber || 1;
        if (!sourcesByBatch[batchNumber]) {
          sourcesByBatch[batchNumber] = [];
        }
        sourcesByBatch[batchNumber].push(source);
      });
      
      // Ëé∑ÂèñÊâÄÊúâÊâπÊ¨°Âè∑ÔºåÊåâÈôçÂ∫èÊéíÂàóÔºàÊúÄÊñ∞ÊâπÊ¨°Âú®ÂâçÔºâ
      const batchNumbers = Object.keys(sourcesByBatch).map(Number).sort((a, b) => b - a);
      
      // ÂàÜÁ¶ªÊúâÊïàÂíåÊó†ÊïàÁöÑ‰ø°ÊÅØÊ∫êÔºàÊåâÊâπÊ¨°ÂàÜÁªÑÔºâ
      const validSourcesByBatch = {};
      const invalidSourcesByBatch = {};
      
      batchNumbers.forEach(batchNum => {
        const batchSources = sourcesByBatch[batchNum];
        validSourcesByBatch[batchNum] = batchSources.filter(s => s.isValid !== false);
        invalidSourcesByBatch[batchNum] = batchSources.filter(s => s.isValid === false);
        
        // ÊéíÂ∫èÔºöÊúâÊïàÁöÑÊéíÂú®ÂâçÈù¢ÔºåÊó†ÊïàÁöÑÊéíÂú®ÂêéÈù¢
        validSourcesByBatch[batchNum].sort((a, b) => {
        const aValid = a.isValid === true ? 0 : 1;
        const bValid = b.isValid === true ? 0 : 1;
        return aValid - bValid;
      });
      
        invalidSourcesByBatch[batchNum].sort((a, b) => {
        const aName = (a.sourceName || '').toLowerCase();
        const bName = (b.sourceName || '').toLowerCase();
        return aName.localeCompare(bName);
        });
      });
      
      // Â±ïÂπ≥‰∏∫Âçï‰∏™Êï∞ÁªÑÔºà‰øùÊåÅÊâπÊ¨°È°∫Â∫èÔºåÁî®‰∫éÂêéÁª≠Â§ÑÁêÜÔºâ
      const validSources = [];
      const invalidSources = [];
      
      batchNumbers.forEach(batchNum => {
        validSources.push(...validSourcesByBatch[batchNum]);
        invalidSources.push(...invalidSourcesByBatch[batchNum]);
      });
      
      // Êõ¥Êñ∞Êó†Êïà‰ø°ÊÅØÊ∫êÂàáÊç¢ÊåâÈíÆ
      const toggleBtn = document.getElementById(`toggleInvalid-${tabIndex}`);
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      const toggleCount = document.getElementById(`toggleInvalidCount-${tabIndex}`);
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      
      if (invalidSources.length > 0) {
        if (toggleBtn) toggleBtn.style.display = 'inline-block';
        if (toggleCount) toggleCount.textContent = ` (${invalidSources.length})`;
        
        // Ê£ÄÊü•ÂΩìÂâçÊòØÂê¶ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê
        const isShowingInvalid = window[`showInvalidSources_${tabIndex}`] || false;
        if (toggleText) {
          toggleText.textContent = isShowingInvalid ? 'ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê' : 'ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê';
        }
        if (recommendationsTable) {
          if (isShowingInvalid) {
            recommendationsTable.classList.add('show-invalid');
          } else {
            recommendationsTable.classList.remove('show-invalid');
          }
        }
      } else {
        if (toggleBtn) toggleBtn.style.display = 'none';
        if (recommendationsTable) recommendationsTable.classList.remove('show-invalid');
      }
      
      // Ê∏≤ÊüìÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫êÔºàÂ∏¶ÊâπÊ¨°Ê†áËØÜÔºâ
      let validRows = '';
      let currentBatch = null;
      
      validSources.forEach((source, idx) => {
        const batchNumber = source.batchNumber || 1;
        
        // Â¶ÇÊûúÊâπÊ¨°ÂèòÂåñÔºåÊèíÂÖ•ÊâπÊ¨°Ê†áËØÜË°å
        if (currentBatch !== batchNumber) {
          if (currentBatch !== null) {
            validRows += '</tbody></table></div>'; // ÂÖ≥Èó≠‰∏ä‰∏Ä‰∏™ÊâπÊ¨°
          }
          currentBatch = batchNumber;
          const batchLabel = batchNumbers.length > 1 ? `Á¨¨${batchNumber}ÊâπÊé®Ëçê` : 'Êé®Ëçê‰ø°ÊÅØÊ∫ê';
          validRows += `
            <div class="batch-section" style="margin-bottom: 20px;">
              <div class="batch-header" style="padding: 12px 16px; background: #f5f7fa; border-radius: 8px 8px 0 0; font-weight: 600; color: #333; border-bottom: 2px solid #8B5CF6;">
                ${escapeHtml(batchLabel)}
              </div>
              <table class="recommendations-table" style="margin: 0; border-radius: 0;">
                <thead>
                  <tr>
                    <th class="checkbox-cell"></th>
                    <th>‰ø°ÊÅØÊ∫ê</th>
                    <th>Á±ªÂûã</th>
                    <th>Âú∞Âå∫</th>
                    <th>ÊèèËø∞</th>
                    <th>ÊúâÊïàÊÄß</th>
                    <th>Áä∂ÊÄÅ</th>
                  </tr>
                </thead>
                <tbody>
          `;
        }
        // Ê£ÄÊü•ËÆ¢ÈòÖÁä∂ÊÄÅÔºöÂêåÊó∂ÊØîËæÉÂêçÁß∞ÂíåURL
        let isSubscribed = false;
        
        // ÊñπÊ≥ï1ÔºöÁ≤æÁ°ÆÂåπÈÖçÂêçÁß∞
        if (userSubscriptions.includes(source.sourceName)) {
          isSubscribed = true;
        } else {
          // ÊñπÊ≥ï2ÔºöÂ¶ÇÊûúÂêçÁß∞‰∏çÂåπÈÖçÔºåÂ∞ùËØïÈÄöËøáURLÂåπÈÖç
          const normalizeUrl = (url) => {
            if (!url) return '';
            return url.replace(/^https?:\/\//, '')
                     .replace(/^www\./, '')
                     .replace(/\/$/, '')
                     .toLowerCase()
                     .trim();
          };
          
          const sourceUrlNormalized = normalizeUrl(source.sourceUrl);
          
          // ÈÅçÂéÜÊâÄÊúâËÆ¢ÈòÖÔºåÊØîËæÉURL
          for (const subName in userSubscriptionsMap) {
            const sub = userSubscriptionsMap[subName];
            const subUrlNormalized = normalizeUrl(sub.sourceUrl);
            
            if (subUrlNormalized && sourceUrlNormalized && subUrlNormalized === sourceUrlNormalized) {
              isSubscribed = true;
              break;
            }
          }
        }
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        // Ê£ÄÊü•ÊòØÂê¶È™åËØÅ‰∏çÈÄöËøá
        const isValid = source.isValid !== false; // Â¶ÇÊûú isValid ÊòØ falseÔºåÂàô‰∏∫Êó†Êïà
        const isInvalid = source.isValid === false;
        
        // Â§ÑÁêÜÈ™åËØÅÁªìÊûú
        let validityHtml = '';
        if (source.isValid === true) {
          validityHtml = '<span class="source-validity valid" title="Â∑≤È™åËØÅÊúâÊïà">‚úì ÊúâÊïà</span>';
        } else if (source.isValid === false) {
          const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
          validityHtml = `<span class="source-validity invalid"${errorMsg}>‚úó Êó†Êïà</span>`;
        } else {
          validityHtml = '<span class="source-validity validating">È™åËØÅ‰∏≠...</span>';
        }
        
        // Â¶ÇÊûúÈ™åËØÅ‰∏çÈÄöËøáÔºåÊ∑ªÂä† invalid-row Á±ªÂπ∂Á¶ÅÁî®Â§çÈÄâÊ°Ü
        const rowClass = isInvalid ? 'invalid-row' : '';
        const checkboxDisabled = isInvalid ? 'disabled' : '';
        const checkboxChecked = isInvalid ? '' : (isSubscribed ? 'checked' : '');
        
        const sourceData = escapeHtml(JSON.stringify(source));
        validRows += `
          <tr>
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" data-index="${idx}" data-tab="${tabIndex}" data-source-name="${escapeHtml(source.sourceName)}" data-source='${sourceData}' ${isSubscribed ? 'checked' : ''} onchange="handleSourceCheckboxChangeInTab(this, ${tabIndex})">
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status ${isSubscribed ? 'subscribed' : 'not-subscribed'}">
                ${isSubscribed ? 'Â∑≤ËÆ¢ÈòÖ' : 'Êú™ËÆ¢ÈòÖ'}
              </span>
            </td>
          </tr>
        `;
      });
      
      // ÂÖ≥Èó≠ÊúÄÂêé‰∏Ä‰∏™ÊâπÊ¨°
      if (currentBatch !== null) {
        validRows += '</tbody></table></div>';
      }
      
      // Ê∏≤ÊüìÊó†ÊïàÁöÑ‰ø°ÊÅØÊ∫ê
      const invalidRows = invalidSources.map((source, idx) => {
        const region = source.region || 'ÂõΩÂ§ñ';
        const regionClass = region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        const errorMsg = source.validationError ? ` title="${escapeHtml(source.validationError)}"` : '';
        const validityHtml = `<span class="source-validity invalid"${errorMsg}>‚úó Êó†Êïà</span>`;
        
        const sourceData = escapeHtml(JSON.stringify(source));
        return `
          <tr class="invalid-row">
            <td class="checkbox-cell">
              <input type="checkbox" class="source-checkbox" disabled>
            </td>
            <td>
              <div class="source-name" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceName)}</div>
              <div class="source-url" title="${escapeHtml(source.sourceUrl || '')}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="source-region ${regionClass}">${escapeHtml(region)}</span>
            </td>
            <td class="source-description">${escapeHtml(source.description || '')}</td>
            <td>
              ${validityHtml}
            </td>
            <td>
              <span class="source-status not-subscribed">Êú™ËÆ¢ÈòÖ</span>
            </td>
          </tr>
        `;
      }).join('');
      
      // Â¶ÇÊûú‰ΩøÁî®ÊâπÊ¨°ÊòæÁ§∫ÔºåÈúÄË¶ÅÊõøÊç¢Êï¥‰∏™Ë°®Ê†ºÁªìÊûÑ
      if (batchNumbers.length > 1) {
        // ‰ΩøÁî®ÊâπÊ¨°ÊòæÁ§∫
        const table = document.getElementById(`recommendationsTable-${tabIndex}`);
        if (table && table.parentNode) {
          // ÂàõÂª∫Êñ∞ÁöÑÂÆπÂô®
          const container = document.createElement('div');
          container.id = `recommendationsContainer-${tabIndex}`;
          container.innerHTML = validRows;
          
          // Â¶ÇÊûúÊúâÊó†Êïà‰ø°ÊÅØÊ∫êÔºåÊ∑ªÂä†Âà∞ÊúÄÂêé
          if (invalidRows) {
            container.innerHTML += `
              <div class="batch-section" style="margin-top: 20px;">
                <div class="batch-header" style="padding: 12px 16px; background: #fff3cd; border-radius: 8px 8px 0 0; font-weight: 600; color: #856404; border-bottom: 2px solid #ffc107;">
                  Êó†Êïà‰ø°ÊÅØÊ∫ê
                </div>
                <table class="recommendations-table" style="margin: 0; border-radius: 0;">
                  <thead>
                    <tr>
                      <th class="checkbox-cell"></th>
                      <th>‰ø°ÊÅØÊ∫ê</th>
                      <th>Á±ªÂûã</th>
                      <th>Âú∞Âå∫</th>
                      <th>ÊèèËø∞</th>
                      <th>ÊúâÊïàÊÄß</th>
                      <th>Áä∂ÊÄÅ</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${invalidRows}
                  </tbody>
                </table>
              </div>
            `;
          }
          
          // ÊõøÊç¢Ë°®Ê†º
          table.parentNode.replaceChild(container, table);
        } else {
          // ÂõûÈÄÄÂà∞ÂéüÊù•ÁöÑÊñπÂºè
          tbody.innerHTML = validRows.replace(/<div[^>]*>/g, '').replace(/<\/div>/g, '').replace(/<table[^>]*>/g, '').replace(/<\/table>/g, '').replace(/<thead>[\s\S]*?<\/thead>/g, '') + invalidRows;
        }
      } else {
        // ÂçïÊâπÊ¨°Ôºå‰ΩøÁî®ÂéüÊù•ÁöÑË°®Ê†ºÁªìÊûÑ
        tbody.innerHTML = validRows.replace(/<div[^>]*>/g, '').replace(/<\/div>/g, '').replace(/<table[^>]*>/g, '').replace(/<\/table>/g, '').replace(/<thead>[\s\S]*?<\/thead>/g, '') + invalidRows;
      }
      
      // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
      const statsEl = document.getElementById(`recommendationsStats-${tabIndex}`);
      if (statsEl) {
        const validCount = validSources.length;
        const invalidCount = invalidSources.length;
        const totalCount = sources.length;
        statsEl.textContent = `ÊòæÁ§∫ ${validCount} ‰∏™ÊúâÊïà‰ø°ÊÅØÊ∫ê${invalidCount > 0 ? `Ôºå${invalidCount} ‰∏™Êó†Êïà‰ø°ÊÅØÊ∫ê` : ''} / ÂÖ± ${totalCount} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
    }

    // ÂàáÊç¢ÊòæÁ§∫/ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê
    function toggleInvalidSources(tabIndex) {
      // ÂàáÊç¢Áä∂ÊÄÅ
      window[`showInvalidSources_${tabIndex}`] = !(window[`showInvalidSources_${tabIndex}`] || false);
      
      // Êõ¥Êñ∞Ë°®Ê†ºÁöÑshow-invalidÁ±ª
      const recommendationsTable = document.getElementById(`recommendationsTable-${tabIndex}`);
      if (recommendationsTable) {
        if (window[`showInvalidSources_${tabIndex}`]) {
          recommendationsTable.classList.add('show-invalid');
        } else {
          recommendationsTable.classList.remove('show-invalid');
        }
      }
      
      // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨
      const toggleText = document.getElementById(`toggleInvalidText-${tabIndex}`);
      if (toggleText) {
        toggleText.textContent = window[`showInvalidSources_${tabIndex}`] ? 'ÈöêËóèÊó†Êïà‰ø°ÊÅØÊ∫ê' : 'ÊòæÁ§∫Êó†Êïà‰ø°ÊÅØÊ∫ê';
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ËøáÊª§Êé®Ëçê‰ø°ÊÅØÊ∫ê
    function filterRecommendationsInTab(tabIndex) {
      const panel = document.getElementById(`panel-${tabIndex}`);
      if (!panel) return;
      const history = JSON.parse(panel.dataset.history || '{}');
      if (history.recommended_sources) {
        renderRecommendationsInTab(tabIndex, history.recommended_sources);
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    async function toggleSelectAllInTab(tabIndex, checkbox) {
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:not(:disabled)`);
      const isChecked = checkbox.checked;
      
      // ÂÖàÊõ¥Êñ∞ÊâÄÊúâ checkbox ÁöÑÁä∂ÊÄÅ
      checkboxes.forEach(cb => {
        cb.checked = isChecked;
      });
      
      // Â¶ÇÊûúÂÖ®ÈÄâÔºåËá™Âä®ËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
      if (isChecked) {
        console.log(`üìã ÂÖ®ÈÄâÔºöÂºÄÂßãËÆ¢ÈòÖ ${checkboxes.length} ‰∏™‰ø°ÊÅØÊ∫ê...`);
        
        // Êî∂ÈõÜÊâÄÊúâË¶ÅËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê
        const sourcesToSubscribe = [];
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              sourcesToSubscribe.push(source);
            } catch (e) {
              console.error('Ëß£Êûê‰ø°ÊÅØÊ∫êÊï∞ÊçÆÂ§±Ë¥•:', e);
            }
          }
        }
        
        if (sourcesToSubscribe.length === 0) {
          console.warn('‚ö†Ô∏è  Ê≤°ÊúâÂèØËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê');
          return;
        }
        
        // ÊâπÈáèËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
        try {
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: sourcesToSubscribe })
          });
          
          const result = await response.json();
          
          if (result.success) {
            console.log(`‚úÖ ÊàêÂäüËÆ¢ÈòÖ ${sourcesToSubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`);
            showMessage(`Â∑≤ËÆ¢ÈòÖ ${sourcesToSubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`, 'success');
            
            // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Áä∂ÊÄÅ
            await loadUserSubscriptions();
            
            // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫êÔºàÂ∑≤ËÆ¢ÈòÖÁöÑ‰ºöËá™Âä®ÈÄâ‰∏≠Ôºâ
            const panel = document.getElementById(`panel-${tabIndex}`);
            if (panel) {
              const history = JSON.parse(panel.dataset.history || '{}');
              if (history.recommended_sources) {
                await renderRecommendationsInTab(tabIndex, history.recommended_sources);
              }
            }
            
            // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨‰ª•ÊòæÁ§∫Êñ∞ÂàõÂª∫ÁöÑ‰∏ªÈ¢ò
            const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
            if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
              console.log('üìö ÊâπÈáèËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
              await loadArticlesTopicsTabs();
            }
          } else {
            console.error('‚ùå ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•:', result.message);
            showMessage(result.message || 'ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•', 'error');
            // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
            checkboxes.forEach(cb => cb.checked = false);
            checkbox.checked = false;
          }
        } catch (error) {
          console.error('‚ùå ÊâπÈáèËÆ¢ÈòÖÂºÇÂ∏∏:', error);
          showMessage('ÊâπÈáèËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
          // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
          checkboxes.forEach(cb => cb.checked = false);
          checkbox.checked = false;
        }
      } else {
        // Â¶ÇÊûúÂèñÊ∂àÂÖ®ÈÄâÔºåÂèñÊ∂àËÆ¢ÈòÖÊâÄÊúâ‰ø°ÊÅØÊ∫ê
        console.log(`üìã ÂèñÊ∂àÂÖ®ÈÄâÔºöÂºÄÂßãÂèñÊ∂àËÆ¢ÈòÖ ${checkboxes.length} ‰∏™‰ø°ÊÅØÊ∫ê...`);
        
        // Ëé∑Âèñ‰∏ªÈ¢òÂÖ≥ÈîÆËØç
        const panel = document.getElementById(`panel-${tabIndex}`);
        const history = panel ? JSON.parse(panel.dataset.history || '{}') : {};
        const topicKeywords = history.topic_keywords || '';
        
        // ÈÄê‰∏™ÂèñÊ∂àËÆ¢ÈòÖÔºàÂõ†‰∏∫ DELETE API ‰∏ÄÊ¨°Âè™ËÉΩÂà†Èô§‰∏Ä‰∏™Ôºâ
        let successCount = 0;
        let failCount = 0;
        let totalDeletedArticles = 0;
        
        for (const cb of checkboxes) {
          const sourceJson = cb.dataset.source;
          if (sourceJson) {
            try {
              const source = JSON.parse(sourceJson);
              const sourceName = encodeURIComponent(source.sourceName);
              
              // ÊûÑÂª∫Âà†Èô§ URLÔºåÂåÖÂê´ topicKeywords
              let deleteUrl = `${API_BASE_URL}/user/subscriptions/${sourceName}`;
              if (topicKeywords && topicKeywords.trim()) {
                deleteUrl += `?topicKeywords=${encodeURIComponent(topicKeywords.trim())}`;
              }
              
              const response = await fetch(deleteUrl, {
                method: 'DELETE',
                headers: getHeaders()
              });
              
              const result = await response.json();
              
              if (result.success) {
                successCount++;
                totalDeletedArticles += (result.deletedArticleCount || 0);
              } else {
                failCount++;
              }
            } catch (e) {
              console.error('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•:', e);
              failCount++;
            }
          }
        }
        
        if (successCount > 0) {
          console.log(`‚úÖ ÊàêÂäüÂèñÊ∂àËÆ¢ÈòÖ ${successCount} ‰∏™‰ø°ÊÅØÊ∫ê`);
          let message = `Â∑≤ÂèñÊ∂àËÆ¢ÈòÖ ${successCount} ‰∏™‰ø°ÊÅØÊ∫ê`;
          if (totalDeletedArticles > 0) {
            message += `ÔºåÂ∑≤Âà†Èô§ ${totalDeletedArticles} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†`;
          }
          if (failCount > 0) {
            message += `Ôºå${failCount} ‰∏™Â§±Ë¥•`;
            showMessage(message, 'warning');
          } else {
            showMessage(message, 'success');
          }
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÊé®Ëçê‰ø°ÊÅØÊ∫êÔºåÊõ¥Êñ∞Áä∂ÊÄÅ
          await loadUserSubscriptions();
          
          // ÈáçÊñ∞Ê∏≤ÊüìËØ•È°µÁ≠æÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
          const panel = document.getElementById(`panel-${tabIndex}`);
          if (panel) {
            const history = JSON.parse(panel.dataset.history || '{}');
            if (history.recommended_sources) {
              await renderRecommendationsInTab(tabIndex, history.recommended_sources);
            }
          }
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâπÈáèÂèñÊ∂àËÆ¢ÈòÖÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          console.error('‚ùå ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•');
          showMessage('ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          // ÊÅ¢Â§ç checkbox Áä∂ÊÄÅ
          checkboxes.forEach(cb => cb.checked = true);
          checkbox.checked = true;
        }
      }
    }

    // Â§ÑÁêÜÂçï‰∏™‰ø°ÊÅØÊ∫êÂ§çÈÄâÊ°ÜÂèòÂåñÔºàÊóßÁâàÊé®ËçêÊòæÁ§∫Ôºâ
    async function handleSourceCheckboxChange(checkbox) {
      if (checkbox.disabled) return;
      
      const sourceJson = checkbox.dataset.source;
      if (!sourceJson) return;
      
      const source = JSON.parse(sourceJson);
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true; // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
      
      try {
        if (isChecked) {
          // ËÆ¢ÈòÖ
          const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions: [source] })
          });
          
          const result = await response.json();
          
          if (result.success) {
            await loadUserSubscriptions();
            renderRecommendations(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          } else {
            checkbox.checked = false; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        } else {
          // ÂèñÊ∂àËÆ¢ÈòÖÔºàÂêåÊó∂Âà†Èô§ËØ•‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Ôºâ
          // Ê≥®ÊÑèÔºöÊóßÁâàÊé®ËçêÊòæÁ§∫ÂèØËÉΩÊ≤°Êúâ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÊâÄ‰ª•‰∏ç‰º†ÈÄí topicKeywords
          const sourceName = encodeURIComponent(source.sourceName);
          const response = await fetch(`${API_BASE_URL}/user/subscriptions/${sourceName}`, {
            method: 'DELETE',
            headers: getHeaders()
          });
          
          const result = await response.json();
          
          if (result.success) {
            let message = result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÊàêÂäü';
            if (result.deletedArticleCount > 0) {
              message += `ÔºåÂ∑≤Âà†Èô§ ${result.deletedArticleCount} ÁØáÁõ∏ÂÖ≥ÊñáÁ´†`;
            }
            showMessage(message, 'success');
            
            await loadUserSubscriptions();
            renderRecommendations(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
          } else {
            checkbox.checked = true; // ÊÅ¢Â§çÁä∂ÊÄÅ
            showMessage(result.message || 'ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•', 'error');
          }
        }
      } catch (error) {
        // ÊÅ¢Â§çÁä∂ÊÄÅ
        checkbox.checked = !isChecked;
        showMessage('Êìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        checkbox.disabled = false;
      }
    }

    // Â§ÑÁêÜÂçï‰∏™‰ø°ÊÅØÊ∫êÂ§çÈÄâÊ°ÜÂèòÂåñÔºàÈ°µÁ≠æ‰∏≠Ôºâ
    // Â§ÑÁêÜÂ§çÈÄâÊ°ÜÂèòÂåñÔºàÂè™Êõ¥Êñ∞UIÔºå‰∏çÁ´ãÂç≥ËÆ¢ÈòÖÔºâ
    function handleSourceCheckboxChangeInTab(checkbox, tabIndex) {
      if (checkbox.disabled) return;
      
      // Âè™Êõ¥Êñ∞UIÁä∂ÊÄÅÔºå‰∏çË∞ÉÁî®API
      // ÂÆûÈôÖÁöÑËÆ¢ÈòÖ/ÂèñÊ∂àËÆ¢ÈòÖÊìç‰ΩúÁî±"ËÆ¢ÈòÖÈÄâ‰∏≠"ÊåâÈíÆÂ§ÑÁêÜ
      
      // Êõ¥Êñ∞ËÆ¢ÈòÖÈÄâ‰∏≠ÊåâÈíÆÁöÑÊñáÊú¨ÔºàÊòæÁ§∫ÈÄâ‰∏≠Êï∞ÈáèÔºâ
      updateSubscribeButtonText(tabIndex);
    }
    
    // Êõ¥Êñ∞ËÆ¢ÈòÖÈÄâ‰∏≠ÊåâÈíÆÁöÑÊñáÊú¨
    function updateSubscribeButtonText(tabIndex) {
      const subscribeBtn = document.getElementById(`subscribeSelectedBtn-${tabIndex}`);
      if (!subscribeBtn) return;
      
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:checked:not(:disabled)`);
      const count = checkboxes.length;
      
      const btnText = document.getElementById(`subscribeSelectedBtnText-${tabIndex}`);
      if (btnText) {
        if (count > 0) {
          btnText.textContent = `ËÆ¢ÈòÖÈÄâ‰∏≠ (${count}‰∏™)`;
          } else {
          btnText.textContent = 'ËÆ¢ÈòÖÈÄâ‰∏≠';
        }
      }
    }

    // Âú®ÊåáÂÆöÈ°µÁ≠æ‰∏≠ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑ‰ø°ÊÅØÊ∫ê
    async function subscribeSelectedInTab(tabIndex) {
      const subscribeBtn = document.getElementById(`subscribeSelectedBtn-${tabIndex}`);
      const subscribeBtnText = document.getElementById(`subscribeSelectedBtnText-${tabIndex}`);
      const subscribeBtnLoading = document.getElementById(`subscribeSelectedBtnLoading-${tabIndex}`);
      
      if (!subscribeBtn) return;
      
      // Ëé∑ÂèñÊâÄÊúâÂãæÈÄâÁöÑ‰ø°ÊÅØÊ∫êÔºàÂåÖÊã¨ÊúâÊïàÂíåÊó†ÊïàÁöÑÔºå‰ΩÜÂè™Â§ÑÁêÜÊúâÊïàÁöÑÔºâ
      const checkboxes = document.querySelectorAll(`#recommendationsBody-${tabIndex} .source-checkbox:checked:not(:disabled)`);
      if (checkboxes.length === 0) {
        showMessage('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }

        const panel = document.getElementById(`panel-${tabIndex}`);
        if (!panel) return;
        
        const history = JSON.parse(panel.dataset.history || '{}');
        const topicKeywords = history.topic_keywords || '';
        
          if (!topicKeywords || !topicKeywords.trim()) {
            showMessage('Êó†Ê≥ïËÆ¢ÈòÖÔºöÁº∫Â∞ë‰∏ªÈ¢òÂÖ≥ÈîÆËØç', 'error');
            return;
          }
          
      // Ëé∑ÂèñÊâÄÊúâÊé®ËçêÁöÑ‰ø°ÊÅØÊ∫êÔºà‰ªé window.recommendedSourcesByTab Êàñ historyÔºâ
      const allSources = window.recommendedSourcesByTab?.[tabIndex] || history.recommended_sources || [];
      
      // Ëé∑ÂèñÂãæÈÄâÁöÑ‰ø°ÊÅØÊ∫êÔºàÂè™‰øùÁïôÊúâÊïàÁöÑÔºâ
      const checkedSources = Array.from(checkboxes)
        .map(cb => {
          const sourceJson = cb.dataset.source;
          if (!sourceJson) return null;
          try {
            return JSON.parse(sourceJson);
          } catch (e) {
            return null;
          }
        })
        .filter(source => source && source.isValid !== false);
      
      if (checkedSources.length === 0) {
        showMessage('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÊúâÊïàÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }
      
      // Ëé∑ÂèñÂΩìÂâçÂ∑≤ËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
      let subscribedSources = [];
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
            headers: getHeaders(),
          cache: 'no-cache'
          });
          const result = await response.json();
        if (result.success && result.data) {
          subscribedSources = result.data.map(sub => sub.source_name);
        }
      } catch (error) {
        console.error('Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Â§±Ë¥•:', error);
        showMessage('Âä†ËΩΩËÆ¢ÈòÖÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
        return;
      }
      
      // ÂØπÊØîÂ∑ÆÂºÇ
      const checkedSourceNames = new Set(checkedSources.map(s => s.sourceName));
      const subscribedSourceNames = new Set(subscribedSources);
      
      const toSubscribe = checkedSources.filter(s => !subscribedSourceNames.has(s.sourceName));
      const toUnsubscribe = subscribedSources.filter(name => !checkedSourceNames.has(name));
      
      // Â¶ÇÊûúÊúâÂèñÊ∂àËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºåÊèêÁ§∫Áî®Êà∑Á°ÆËÆ§
      if (toUnsubscribe.length > 0) {
        const confirmMessage = `ÊÇ®Â∞ÜÂèñÊ∂àËÆ¢ÈòÖ ${toUnsubscribe.length} ‰∏™‰ø°ÊÅØÊ∫êÔºåËøô‰∫õ‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Â∞ÜË¢´Âà†Èô§„ÄÇ\n\nÂèñÊ∂àËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫êÔºö\n${toUnsubscribe.map(name => `- ${name}`).join('\n')}\n\nÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü`;
        if (!confirm(confirmMessage)) {
          return;
        }
      }
      
      // Á¶ÅÁî®ÊåâÈíÆÂπ∂ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      subscribeBtn.disabled = true;
      if (subscribeBtnText) subscribeBtnText.textContent = 'Â§ÑÁêÜ‰∏≠...';
      if (subscribeBtnLoading) subscribeBtnLoading.style.display = 'inline';
      
      try {
        // 1. ÊâπÈáèËÆ¢ÈòÖÊñ∞‰ø°ÊÅØÊ∫ê
        if (toSubscribe.length > 0) {
          const subscriptions = toSubscribe.map(source => ({
            ...source,
            topicKeywords: topicKeywords
          }));
          
          const subscribeResponse = await fetch(`${API_BASE_URL}/user/subscriptions`, {
            method: 'POST',
            headers: getHeaders(),
            body: JSON.stringify({ subscriptions })
          });
          
          const subscribeResult = await subscribeResponse.json();
          
          if (!subscribeResult.success) {
            throw new Error(subscribeResult.message || 'ËÆ¢ÈòÖÂ§±Ë¥•');
          }
        }
        
        // 2. ÊâπÈáèÂà†Èô§ÂèñÊ∂àËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê
        if (toUnsubscribe.length > 0) {
          for (const sourceName of toUnsubscribe) {
            const deleteUrl = `${API_BASE_URL}/user/subscriptions/${encodeURIComponent(sourceName)}?topicKeywords=${encodeURIComponent(topicKeywords)}`;
            const deleteResponse = await fetch(deleteUrl, {
              method: 'DELETE',
              headers: getHeaders()
            });
            
            const deleteResult = await deleteResponse.json();
            if (!deleteResult.success) {
              console.warn(`Âà†Èô§ËÆ¢ÈòÖÂ§±Ë¥•: ${sourceName}`, deleteResult.message);
            }
          }
        }
        
        // 3. Êõ¥Êñ∞ËÆ¢ÈòÖÂàóË°®
        await loadUserSubscriptions();
        
        // 4. Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜÔºàÂêéÂè∞ÂºÇÊ≠•Ôºå‰∏çÈòªÂ°ûÔºâ
        if (toSubscribe.length > 0) {
          // ÂºÇÊ≠•Ëß¶ÂèëÊî∂ÈõÜÔºå‰∏çÁ≠âÂæÖÁªìÊûú
          fetch(`${API_BASE_URL}/collect`, {
          method: 'POST',
          headers: getHeaders(),
            body: JSON.stringify({ topicKeywords })
          }).catch(err => {
            console.error('Ëß¶ÂèëÊñáÁ´†Êî∂ÈõÜÂ§±Ë¥•:', err);
          });
        }
        
        // 5. Êõ¥Êñ∞UIÁä∂ÊÄÅ
        const message = [];
        if (toSubscribe.length > 0) {
          message.push(`ÊàêÂäüËÆ¢ÈòÖ ${toSubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`);
        }
        if (toUnsubscribe.length > 0) {
          message.push(`ÂèñÊ∂àËÆ¢ÈòÖ ${toUnsubscribe.length} ‰∏™‰ø°ÊÅØÊ∫ê`);
        }
        if (message.length > 0) {
          showMessage(message.join('Ôºå'), 'success');
        } else {
          showMessage('ËÆ¢ÈòÖÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞', 'success');
        }
        
        // ÈáçÊñ∞Ê∏≤ÊüìË°®Ê†º‰ª•Êõ¥Êñ∞Áä∂ÊÄÅ
        if (allSources.length > 0) {
          await renderRecommendationsInTab(tabIndex, allSources);
        }
        
        // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
        const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
        if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
          await loadArticlesTopicsTabs();
        }
        
      } catch (error) {
        console.error('ËÆ¢ÈòÖÊìç‰ΩúÂ§±Ë¥•:', error);
        showMessage('ËÆ¢ÈòÖÊìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        subscribeBtn.disabled = false;
        if (subscribeBtnText) subscribeBtnText.textContent = 'ËÆ¢ÈòÖÈÄâ‰∏≠';
        if (subscribeBtnLoading) subscribeBtnLoading.style.display = 'none';
        updateSubscribeButtonText(tabIndex);
      }
    }


    // Âä†ËΩΩÊé®ËçêÂéÜÂè≤Ôºà‰øùÁïôÂêëÂêéÂÖºÂÆπÔºâ
    async function loadRecommendationHistory() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/topics/recommend/history`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();

        if (result.success && result.data) {
          const history = result.data;
          
          // ÊòæÁ§∫Êé®ËçêËøáÁ®ãÊó•Âøó
          if (history.process_logs && history.process_logs.length > 0) {
            savedProcessLogs = history.process_logs;
            document.getElementById('deepseekProcessSection').style.display = 'block';
            renderProcessLogs(history.process_logs);
          }
          
          // ÊòæÁ§∫Êé®Ëçê‰ø°ÊÅØÊ∫êË°®Ê†º
          if (history.recommended_sources && history.recommended_sources.length > 0) {
            recommendedSources = history.recommended_sources;
            await loadUserSubscriptions();
            renderRecommendations();
            document.getElementById('recommendationsSection').style.display = 'block';
            
            // Â¶ÇÊûúÊúâ‰øùÂ≠òÁöÑ‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºåÊòæÁ§∫Âú®ËæìÂÖ•Ê°Ü‰∏≠
            if (history.topic_keywords) {
              document.getElementById('topicInput').value = history.topic_keywords;
            }
          }
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', error);
      }
    }

    // Âä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
    async function loadArticlesTopicsTabs() {
      console.log('üìö ÂºÄÂßãÂä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
      
      try {
        // Âä†ËΩΩÁî®Êà∑‰∏ªÈ¢òÂàóË°®Ôºà‰∏ç‰ΩøÁî®ÁºìÂ≠òÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆÔºâ
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        
        if (!topicsResponse.ok) {
          throw new Error(`HTTP ${topicsResponse.status}: ${topicsResponse.statusText}`);
        }
        
        const topicsResult = await topicsResponse.json();
        console.log('üìã ‰∏ªÈ¢òÂàóË°®ÂìçÂ∫î:', topicsResult);
        
        if (!topicsResult.success || !topicsResult.data || topicsResult.data.length === 0) {
          console.log('‚ÑπÔ∏è  Áî®Êà∑Ê≤°Êúâ‰∏ªÈ¢òÔºåÊòæÁ§∫ÊèêÁ§∫');
          document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
          document.getElementById('articlesNoTopicsHint').style.display = 'block';
          return;
        }
        
        userTopics = topicsResult.data;
        console.log(`‚úÖ ÊâæÂà∞ ${userTopics.length} ‰∏™‰∏ªÈ¢ò`);
        
        document.getElementById('articlesTopicsTabsContainer').style.display = 'block';
        document.getElementById('articlesNoTopicsHint').style.display = 'none';
        
        // Âä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤Ôºà‰∏ç‰ΩøÁî®ÁºìÂ≠òÔºåÁ°Æ‰øùËé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆÔºâ
        try {
          const historyResponse = await fetch(`${API_BASE_URL}/user/topics/recommend/history/all`, {
            headers: getHeaders(),
            cache: 'no-cache'
          });
          
          if (historyResponse.ok) {
            const historyResult = await historyResponse.json();
            
            if (historyResult.success && historyResult.data) {
              console.log(`üìñ Âä†ËΩΩ‰∫Ü ${historyResult.data.length} Êù°Êé®ËçêÂéÜÂè≤`);
              historyResult.data.forEach(history => {
                if (history.recommended_sources) {
                  topicRecommendationHistory[history.topic_keywords] = {
                    recommended_sources: Array.isArray(history.recommended_sources) 
                      ? history.recommended_sources 
                      : (typeof history.recommended_sources === 'string' 
                          ? JSON.parse(history.recommended_sources) 
                          : [])
                  };
                }
              });
            }
          } else {
            console.warn('‚ö†Ô∏è  Âä†ËΩΩÊé®ËçêÂéÜÂè≤Â§±Ë¥•:', historyResponse.status);
          }
        } catch (historyError) {
          console.warn('‚ö†Ô∏è  Âä†ËΩΩÊé®ËçêÂéÜÂè≤Êó∂Âá∫Èîô:', historyError);
          // ÁªßÁª≠ÊâßË°åÔºå‰∏ç‰∏≠Êñ≠ÊµÅÁ®ã
        }
        
        // Ê∏≤Êüì‰∏ªÈ¢òÈ°µÁ≠æÔºà‰∏∫ÊâÄÊúâ‰∏ªÈ¢òÂàõÂª∫È°µÁ≠æÔºåÂç≥‰ΩøÊ≤°ÊúâÊé®ËçêÂéÜÂè≤Ôºâ
        renderArticlesTopicsTabs();
        
        // ÂàùÂßãÂåñÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
        if (userTopics.length > 0) {
          window.currentArticlesTopicIndex = 0;
          console.log(`‚úÖ ‰∏ªÈ¢òÈ°µÁ≠æÂä†ËΩΩÂÆåÊàêÔºåÂÖ± ${userTopics.length} ‰∏™‰∏ªÈ¢òÔºåÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò`);
          
          // ÊâìÂç∞ÊØè‰∏™‰∏ªÈ¢òÁöÑÈ°µÁ≠æÁä∂ÊÄÅ
          userTopics.forEach((topic, index) => {
            const hasHistory = topicRecommendationHistory[topic.topic_keywords]?.recommended_sources?.length > 0;
            console.log(`   - ‰∏ªÈ¢ò ${index + 1}: "${topic.topic_keywords}" ${hasHistory ? '(ÊúâÊé®ËçêÂéÜÂè≤)' : '(Êó†Êé®ËçêÂéÜÂè≤Ôºå‰ΩÜÈ°µÁ≠æÂ∑≤ÂàõÂª∫)'}`);
          });
        }
      } catch (error) {
        console.error('‚ùå Âä†ËΩΩÊñáÁ´†‰∏ªÈ¢òÈ°µÁ≠æÂ§±Ë¥•:', error);
        console.error('   ÈîôËØØËØ¶ÊÉÖ:', error.message);
        console.error('   ÈîôËØØÂ†ÜÊ†à:', error.stack);
        document.getElementById('articlesTopicsTabsContainer').style.display = 'none';
        document.getElementById('articlesNoTopicsHint').style.display = 'block';
      }
    }
    
    // Ê∏≤ÊüìÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
    function renderArticlesTopicsTabs() {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
      tabsHeader.innerHTML = '';
      tabsContent.innerHTML = '';
      
      // ‰∏∫ÊØè‰∏™‰∏ªÈ¢òÂàõÂª∫È°µÁ≠æÂíåÂÜÖÂÆπÈù¢Êùø
      userTopics.forEach((topic, index) => {
        const topicKeywords = topic.topic_keywords;
        
        // ÂàõÂª∫È°µÁ≠æ
        const tab = document.createElement('button');
        tab.className = 'topic-tab' + (index === 0 ? ' active' : '');
        tab.textContent = topicKeywords;
        tab.onclick = () => switchArticlesTopicTab(index);
        tabsHeader.appendChild(tab);
        
        // ÂàõÂª∫ÂÜÖÂÆπÈù¢Êùø
        const panel = document.createElement('div');
        panel.className = 'topic-tab-panel' + (index === 0 ? ' active' : '');
        panel.id = `articlesTopicPanel-${index}`;
        panel.innerHTML = `
          <!-- ÁªüËÆ°‰ø°ÊÅØÊ†è -->
          <div class="articles-stats-bar" id="articlesStatsBar-${index}">
            <div style="display: flex; align-items: center;">
              <button class="btn-refresh-now" onclick="refreshNewsNow(${index})" id="refreshNowBtn-${index}">
                <span>üîÑ</span> Á´ãÂç≥Âà∑Êñ∞
              </button>
              <div class="refresh-progress" id="refreshProgress-${index}">
                <span class="progress-text" id="refreshProgressText-${index}"></span>
                <span class="progress-dots"></span>
              </div>
            </div>
            <div class="stats-items-container">
              <div class="stat-item">
                <span class="stat-label">ÊúÄÂêéÂà∑Êñ∞</span>
                <span class="stat-value" id="lastRefreshTime-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ÂèëÂ∏ÉÊó∂Èó¥</span>
                <span class="stat-value" id="publishDateRange-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ÊúÄËøëÂà∑Êñ∞</span>
                <span class="stat-value" id="recentArticlesCount-${index}">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ÊñáÁ´†ÊÄªÊï∞</span>
                <span class="stat-value" id="totalArticles-${index}">-</span>
              </div>
            </div>
          </div>

          <!-- ‰ø°ÊÅØÊ∫êËøáÊª§Âç°Áâá -->
          <div class="source-filter-cards" id="sourceFilterCards-${index}">
            <div class="source-card active" data-source="all" onclick="filterArticlesBySourceInTab(${index}, null)">
              <span>ÂÖ®ÈÉ®</span>
            </div>
            <!-- Âä®ÊÄÅÂä†ËΩΩ‰ø°ÊÅØÊ∫ê -->
            <!-- Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†checkbox -->
            <div class="relevant-filter-checkbox">
              <input type="checkbox" id="relevantFilterCheckbox-${index}" ${showOnlyRelevantArticles ? 'checked' : ''} onchange="toggleRelevantFilter(${index})">
              <label for="relevantFilterCheckbox-${index}">Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†</label>
            </div>
          </div>

          <!-- ÊñáÁ´†ÊêúÁ¥¢Ê°Ü -->
          <div class="articles-search-container" style="margin: 16px 0;">
            <input 
              type="text" 
              id="articlesSearch-${index}" 
              class="articles-search-input"
              placeholder="ÊêúÁ¥¢ÊñáÁ´†ÔºàÊ†áÈ¢ò„ÄÅÊëòË¶Å„ÄÅÊù•Ê∫êÔºâ..." 
              oninput="searchArticlesInTab(${index})"
              style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;"
            >
          </div>

          <!-- ÊñáÁ´†ÂàóË°®ËßÜÂõæ -->
          <div id="articlesListView-${index}" class="articles-list-view">
            <div id="articlesList-${index}" class="articles-list">
              <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
          </div>
        `;
        tabsContent.appendChild(panel);
      });
      
      // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      if (userTopics.length > 0) {
        currentTopicFilter = userTopics[0].topic_keywords;
        switchArticlesTopicTab(0);
      }
    }
    
    // ÂàáÊç¢ÊñáÁ´†‰∏ªÈ¢òÈ°µÁ≠æ
    function switchArticlesTopicTab(index) {
      const tabsHeader = document.getElementById('articlesTopicsTabsHeader');
      const tabsContent = document.getElementById('articlesTopicsTabsContent');
      
      if (!tabsHeader || !tabsContent) return;
      
      // Êõ¥Êñ∞È°µÁ≠æÁä∂ÊÄÅ
      Array.from(tabsHeader.children).forEach((tab, i) => {
        if (i === index) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÈù¢ÊùøÁä∂ÊÄÅ
      Array.from(tabsContent.children).forEach((panel, i) => {
        if (i === index) {
          panel.classList.add('active');
        } else {
          panel.classList.remove('active');
        }
      });
      
      // Êõ¥Êñ∞ÂΩìÂâç‰∏ªÈ¢òËøáÊª§ÂíåÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
      if (userTopics[index]) {
        currentTopicFilter = userTopics[index].topic_keywords;
        window.currentArticlesTopicIndex = index; // ‰øùÂ≠òÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
        // ÈáçÊñ∞Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†
        loadArticlesForTopic(currentTopicFilter, index);
      }
    }

    // ÂàáÊç¢"Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†"ËøáÊª§
    function toggleRelevantFilter(tabIndex) {
      // Êõ¥Êñ∞ÂÖ®Â±ÄÁä∂ÊÄÅ
      showOnlyRelevantArticles = document.getElementById(`relevantFilterCheckbox-${tabIndex}`).checked;
      
      // ÂêåÊ≠•ÊâÄÊúâÈ°µÁ≠æÁöÑcheckboxÁä∂ÊÄÅÔºàÂõ†‰∏∫ÊâÄÊúâÈ°µÁ≠æÂÖ±‰∫´Áä∂ÊÄÅÔºâ
      userTopics.forEach((topic, index) => {
        const checkbox = document.getElementById(`relevantFilterCheckbox-${index}`);
        if (checkbox) {
          checkbox.checked = showOnlyRelevantArticles;
        }
      });
      
      // Ëé∑ÂèñÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁ¥¢Âºï
      const currentTabIndex = window.currentArticlesTopicIndex !== undefined ? window.currentArticlesTopicIndex : tabIndex;
      
      // ÈáçÊñ∞Â∫îÁî®ËøáÊª§Âπ∂Ê∏≤ÊüìÂΩìÂâçÊ¥ªÂä®È°µÁ≠æÁöÑÊñáÁ´†ÂàóË°®
      if (currentTopicFilter && userTopics[currentTabIndex]) {
        applyFiltersForTab(currentTopicFilter, currentTabIndex);
      } else {
        // Â¶ÇÊûúÊ≤°Êúâ‰∏ªÈ¢òËøáÊª§Ôºå‰ΩøÁî®applyFilters
        applyFilters();
      }
    }
    
    // ‰∏∫ÁâπÂÆö‰∏ªÈ¢òÂä†ËΩΩÊñáÁ´†
    async function loadArticlesForTopic(topicKeywords, tabIndex, forceRefresh = false) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // Ëé∑ÂèñËØ•‰∏ªÈ¢òÁöÑÊé®Ëçê‰ø°ÊÅØÊ∫ê
      const recommendedSources = topicRecommendationHistory[topicKeywords]?.recommended_sources || [];
      const sourceNames = recommendedSources.map(s => s.sourceName || s.name).filter(Boolean);
      
      // Â¶ÇÊûúÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
      if (recommendedSources.length === 0) {
        console.log(`‚ÑπÔ∏è  ‰∏ªÈ¢ò "${topicKeywords}" ËøòÊ≤°ÊúâÊé®ËçêÂéÜÂè≤ÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ`);
        articlesListEl.innerHTML = `
          <div class="empty-state">
            <p>ËØ•‰∏ªÈ¢òËøòÊ≤°ÊúâËé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê</p>
            <p style="margin-top: 12px; font-size: 13px; color: #999;">
              ËØ∑ÂâçÂæÄ"ËÆ¢ÈòÖÁÆ°ÁêÜ"È°µÈù¢Ôºå‰∏∫ËØ•‰∏ªÈ¢òËé∑ÂèñÊé®Ëçê‰ø°ÊÅØÊ∫ê
            </p>
          </div>
        `;
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStatsForTab([], tabIndex);
        // Ê∏ÖÁ©∫‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂè™‰øùÁïô"ÂÖ®ÈÉ®"Ôºâ
        loadSourceCardsForTab([], tabIndex);
        return;
      }
      
      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      articlesListEl.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏≠...</div>';
      
      try {
        // Âä†ËΩΩËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Ôºà‰º†ÈÄí topicKeywords ÂèÇÊï∞Ôºâ
        let url = `${API_BASE_URL}/news/list`;
        if (topicKeywords && topicKeywords.trim()) {
          url += `?topicKeywords=${encodeURIComponent(topicKeywords)}`;
        }
        
        const response = await fetch(url, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const result = await response.json();
        
        if (result.success) {
          const data = result.data;
          
          // Â∞ÜÊâÄÊúâÊñáÁ´†Â±ïÂπ≥Âà∞‰∏Ä‰∏™Êï∞ÁªÑ‰∏≠
          let topicArticles = [];
          data.forEach(day => {
            day.news.forEach(news => {
              const article = {
                ...news,
                date: day.date
              };
              
              // Âè™ÂåÖÂê´Â±û‰∫éËØ•‰∏ªÈ¢òÊé®Ëçê‰ø°ÊÅØÊ∫êÁöÑÊñáÁ´†Ôºå‰∏î‰∏ªÈ¢òÂÖ≥ÈîÆËØçÂåπÈÖç
              if ((sourceNames.length === 0 || sourceNames.includes(news.source)) &&
                  (!news.topic_keywords || news.topic_keywords === topicKeywords)) {
                topicArticles.push(article);
              }
            });
          });
          
          // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
          updateStatsForTab(topicArticles, tabIndex);
          
          // Âä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂè™ÊòæÁ§∫ËØ•‰∏ªÈ¢òÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
          const sources = [...new Set(topicArticles.map(a => a.source))];
          loadSourceCardsForTab(sources, tabIndex);
          
          // Â≠òÂÇ®ËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Êï∞ÊçÆ
          if (!window.topicArticlesData) {
            window.topicArticlesData = {};
          }
          window.topicArticlesData[topicKeywords] = topicArticles;
          
          // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
          applyFiltersForTab(topicKeywords, tabIndex);
        } else {
          articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
        }
      } catch (error) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•: ' + error.message + '</p></div>';
      }
    }
    
    // Êõ¥Êñ∞ÁâπÂÆöÈ°µÁ≠æÁöÑÁªüËÆ°‰ø°ÊÅØ
    function updateStatsForTab(articles, tabIndex) {
      document.getElementById(`totalArticles-${tabIndex}`).textContent = articles.length;
      document.getElementById(`publishDateRange-${tabIndex}`).textContent = calculatePublishDateRange(articles);
      document.getElementById(`recentArticlesCount-${tabIndex}`).textContent = calculateRecentArticlesCount(articles);
    }
    
    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÂä†ËΩΩ‰ø°ÊÅØÊ∫êÂç°Áâá
    function loadSourceCardsForTab(sources, tabIndex) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // ‰øùÂ≠òcheckboxÂÖÉÁ¥†ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
      const existingCheckbox = container.querySelector('.relevant-filter-checkbox');
      
      // Ê∏ÖÁ©∫ÊâÄÊúâÂç°ÁâáÔºåÂåÖÊã¨"ÂÖ®ÈÉ®"Ôºå‰ΩÜ‰øùÁïôcheckbox
      container.innerHTML = '';
      
      // ÈáçÊñ∞ÂàõÂª∫"ÂÖ®ÈÉ®"Âç°Áâá
      const allCard = document.createElement('div');
      allCard.className = 'source-card active';
      allCard.setAttribute('data-source', 'all');
      allCard.innerHTML = '<span>ÂÖ®ÈÉ®</span>';
      allCard.onclick = () => filterArticlesBySourceInTab(tabIndex, null);
      container.appendChild(allCard);
      
      // Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂç°Áâá
      sources.forEach(source => {
        const card = document.createElement('div');
        card.className = 'source-card';
        card.setAttribute('data-source', source);
        card.textContent = source;
        card.onclick = () => filterArticlesBySourceInTab(tabIndex, source);
        container.appendChild(card);
      });
      
      // ÈáçÊñ∞Ê∑ªÂä†checkboxÔºàÂ¶ÇÊûú‰πãÂâçÂ≠òÂú®Ôºâ
      if (existingCheckbox) {
        const checkboxContainer = document.createElement('div');
        checkboxContainer.className = 'relevant-filter-checkbox';
        checkboxContainer.innerHTML = `
          <input type="checkbox" id="relevantFilterCheckbox-${tabIndex}" ${showOnlyRelevantArticles ? 'checked' : ''} onchange="toggleRelevantFilter(${tabIndex})">
          <label for="relevantFilterCheckbox-${tabIndex}">Âè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†</label>
        `;
        container.appendChild(checkboxContainer);
      }
    }
    
    // Âú®ÁâπÂÆöÈ°µÁ≠æ‰∏≠Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
    function filterArticlesBySourceInTab(tabIndex, source) {
      const container = document.getElementById(`sourceFilterCards-${tabIndex}`);
      if (!container) return;
      
      // Êõ¥Êñ∞Âç°ÁâáÁä∂ÊÄÅ
      container.querySelectorAll('.source-card').forEach(card => {
        card.classList.remove('active');
        if ((source === null && card.getAttribute('data-source') === 'all') ||
            (source !== null && card.getAttribute('data-source') === source)) {
          card.classList.add('active');
        }
      });
      
      // Â∫îÁî®ËøáÊª§
      if (currentTopicFilter) {
        applyFiltersForTab(currentTopicFilter, tabIndex, source);
      }
    }
    
    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÂ∫îÁî®ËøáÊª§ÂíåÊêúÁ¥¢
    function applyFiltersForTab(topicKeywords, tabIndex, sourceFilter = null) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      // Ëé∑ÂèñËØ•‰∏ªÈ¢òÁöÑÊñáÁ´†Êï∞ÊçÆ
      const topicArticles = window.topicArticlesData?.[topicKeywords] || [];
      let filtered = [...topicArticles];
      
      // Êåâ‰ø°ÊÅØÊ∫êËøáÊª§
      const sourceInput = document.querySelector(`#sourceFilterCards-${tabIndex} .source-card.active`);
      const activeSource = sourceInput?.getAttribute('data-source');
      if (sourceFilter !== null) {
        // ‰ΩøÁî®‰º†ÂÖ•ÁöÑsourceFilter
        if (sourceFilter !== 'all') {
          filtered = filtered.filter(a => a.source === sourceFilter);
        }
      } else if (activeSource && activeSource !== 'all') {
        filtered = filtered.filter(a => a.source === activeSource);
      }
      
      // ÊåâÁõ∏ÂÖ≥ÊÄßËøáÊª§ÔºàÂè™ÁúãÁõ∏ÂÖ≥ÊñáÁ´†Ôºâ
      if (showOnlyRelevantArticles) {
        filtered = filtered.filter(a => a.is_relevant_to_topic === true);
      }
      
      // ÂÖ≥ÈîÆËØçÊêúÁ¥¢
      const searchInput = document.getElementById(`articlesSearch-${tabIndex}`);
      if (searchInput) {
        const searchKeyword = (searchInput.value || '').trim().toLowerCase();
        if (searchKeyword) {
          filtered = filtered.filter(article => {
            const titleMatch = (article.title || '').toLowerCase().includes(searchKeyword);
            const summaryMatch = (article.summary || '').toLowerCase().includes(searchKeyword);
            const sourceMatch = (article.source || '').toLowerCase().includes(searchKeyword);
            const contentMatch = (article.content || '').toLowerCase().includes(searchKeyword);
            return titleMatch || summaryMatch || sourceMatch || contentMatch;
          });
        }
      }
      
      // Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
      renderArticlesForTab(filtered, tabIndex);
    }

    // Âú®ÁâπÂÆöÈ°µÁ≠æ‰∏≠ÊêúÁ¥¢ÊñáÁ´†
    function searchArticlesInTab(tabIndex) {
      if (currentTopicFilter) {
        applyFiltersForTab(currentTopicFilter, tabIndex);
      }
    }
    
    // Ê†ºÂºèÂåñÊó•Êúü‰∏∫ÂÆåÊï¥Ê†ºÂºèÔºàÁî®‰∫éÊó•ÊúüÊ†áÈ¢òÔºâ
    function formatDateFull(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
      const weekday = weekdays[date.getDay()];
      
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (date.toDateString() === today.toDateString()) {
        return `‰ªäÂ§© (${year}Âπ¥${month}Êúà${day}Êó•)`;
      } else if (date.toDateString() === yesterday.toDateString()) {
        return `Êò®Â§© (${year}Âπ¥${month}Êúà${day}Êó•)`;
      } else {
        return `${year}Âπ¥${month}Êúà${day}Êó• ÊòüÊúü${weekday}`;
      }
    }

    // Ê†ºÂºèÂåñÊó•Êúü‰∏∫ÁÆÄÁü≠Ê†ºÂºèÔºàÁî®‰∫éÊñáÁ´†Âç°ÁâáÔºâ
    function formatDateShort(dateStr) {
      const date = new Date(dateStr);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      return `${month}Êúà${day}Êó•`;
    }

    // ÊåâÊó•ÊúüÂàÜÁªÑÊñáÁ´†
    function groupArticlesByDate(articles) {
      const groups = {};
      
      articles.forEach(article => {
        const date = new Date(article.publish_date);
        const dateKey = date.toDateString(); // ‰ΩøÁî®Êó•ÊúüÂ≠óÁ¨¶‰∏≤‰Ωú‰∏∫ÈîÆ
        
        if (!groups[dateKey]) {
          groups[dateKey] = {
            date: date,
            articles: []
          };
        }
        
        groups[dateKey].articles.push(article);
      });
      
      // ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂπ∂ÊåâÊó•ÊúüÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
      return Object.values(groups).sort((a, b) => b.date - a.date);
    }

    // Ê∑ªÂä†ÊñáÁ´†Âà∞ÊåáÂÆöÈ°µÁ≠æ
    function addArticleToTab(tabIndex, article) {
      if (!window.topicArticlesData) {
        window.topicArticlesData = {};
      }
      if (!window.topicArticlesData[currentTopicFilter]) {
        window.topicArticlesData[currentTopicFilter] = [];
      }
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const exists = window.topicArticlesData[currentTopicFilter].some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        window.topicArticlesData[currentTopicFilter].push(article);
        
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStatsForTab(window.topicArticlesData[currentTopicFilter], tabIndex);
        
        // Êõ¥Êñ∞‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂÆûÊó∂Ê∑ªÂä†Êñ∞ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
        const currentSources = [...new Set(window.topicArticlesData[currentTopicFilter].map(a => a.source))];
        loadSourceCardsForTab(currentSources, tabIndex);
        
        // ÈáçÊñ∞Ê∏≤ÊüìÊñáÁ´†ÂàóË°®
        applyFiltersForTab(currentTopicFilter, tabIndex);
      }
    }
    
    // Ê∑ªÂä†ÊñáÁ´†Âà∞ÂàóË°®ÔºàÈùû‰∏ªÈ¢òÈ°µÁ≠æÔºâ
    function addArticleToList(article) {
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const exists = allArticles.some(a => a.id === article.id || a.url === article.url);
      if (!exists) {
        allArticles.push(article);
        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        updateStats(allArticles);
        
        // Êõ¥Êñ∞‰ø°ÊÅØÊ∫êÂç°ÁâáÔºàÂÆûÊó∂Ê∑ªÂä†Êñ∞ÁöÑ‰ø°ÊÅØÊ∫êÔºâ
        const currentSources = [...new Set(allArticles.map(a => a.source))];
        loadSourceCards(currentSources);
        
        // Â∫îÁî®ÂΩìÂâçËøáÊª§ÂíåÊêúÁ¥¢
        applyFilters();
      }
    }

    // ‰∏∫ÁâπÂÆöÈ°µÁ≠æÊ∏≤ÊüìÊñáÁ´†ÂàóË°®
    function renderArticlesForTab(articles, tabIndex) {
      const articlesListEl = document.getElementById(`articlesList-${tabIndex}`);
      if (!articlesListEl) return;
      
      if (articles.length === 0) {
        articlesListEl.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÊñáÁ´†</p></div>';
        return;
      }
      
      // ÊåâÊó•ÊúüÂàÜÁªÑ
      const dateGroups = groupArticlesByDate(articles);
      
      let html = '';
      dateGroups.forEach(group => {
        html += `
          <div class="date-section">
            <div class="date-header">
              <div class="date-text">${formatDateFull(group.date)}</div>
            </div>
            <div class="articles-by-date">
        `;
        
        // Ê∏≤ÊüìËØ•Êó•Êúü‰∏ãÁöÑÊâÄÊúâÊñáÁ´†
        group.articles.forEach(article => {
          const isIrrelevant = article.is_relevant_to_topic === false;
          const cardClass = isIrrelevant ? 'article-card irrelevant' : 'article-card';
          const irrelevantBadge = isIrrelevant ? '<span class="article-irrelevant-badge">‰∏çÁõ∏ÂÖ≥</span>' : '';
          
          html += `
            <div class="${cardClass}" onclick="viewArticle(${article.id})">
              ${irrelevantBadge}
              <div class="article-card-title">${escapeHtml(article.title)}</div>
              <div class="article-card-meta">
                <span class="article-card-source">${escapeHtml(article.source || 'Êú™Áü•')}</span>
                <span>${formatDateShort(article.publish_date)}</span>
              </div>
              ${article.summary ? `<div class="article-card-summary">${escapeHtml(article.summary.substring(0, 150))}${article.summary.length > 150 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      articlesListEl.innerHTML = html;
    }

    // Â§ÑÁêÜESCÈîÆÂÖ≥Èó≠ÂºπÁ™ó
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('addTopicModal');
        if (modal && modal.classList.contains('show')) {
          closeAddTopicModal();
        }
      }
    });

    // ÊòæÁ§∫Ê∂àÊÅØ
    function showMessage(text, type, containerId = 'message') {
      const messageEl = document.getElementById(containerId);
      if (!messageEl) return;
      
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 5000);
    }
    
    // ËΩ¨‰πâHTML
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÁõ∏ÂÖ≥ÂèòÈáè
    let curatedSources = [];
    let filteredCuratedSources = [];
    let userSubscriptionsForCurated = [];

    // ÂàáÊç¢ÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ±ïÂºÄ/ÊäòÂè†
    function toggleCuratedSources() {
      const content = document.getElementById('curatedSourcesContent');
      const toggle = document.getElementById('curatedSourcesToggle');
      const isExpanded = content.style.display !== 'none';
      
      if (isExpanded) {
        content.style.display = 'none';
        toggle.textContent = '‚ñº';
      } else {
        content.style.display = 'block';
        toggle.textContent = '‚ñ≤';
        if (curatedSources.length === 0) {
          loadCuratedSources();
        }
      }
    }

    // Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    async function loadCuratedSources() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/curated-sources`, {
          headers: getHeaders()
        });
        const result = await response.json();
        
        if (result.success) {
          curatedSources = result.sources || [];
          filteredCuratedSources = [...curatedSources];
          
          // Êõ¥Êñ∞ËÆ°Êï∞
          document.getElementById('curatedSourcesCount').textContent = `(${curatedSources.length}‰∏™)`;
          
          // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
          renderCuratedSourcesStats(result.stats);
          
          // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
          renderCuratedSourcesFilters(result.stats);
          
          // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®ÔºàÁî®‰∫éÊ†áËÆ∞Â∑≤ËÆ¢ÈòÖÔºâ
          await loadUserSubscriptionsForCurated();
          
          // Ê∏≤ÊüìË°®Ê†º
          renderCuratedSourcesTable();
        } else {
          showMessage('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•: ' + (result.message || 'Êú™Áü•ÈîôËØØ'), 'error');
        }
      } catch (error) {
        showMessage('Âä†ËΩΩÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êÂ§±Ë¥•: ' + error.message, 'error');
        const tbody = document.getElementById('curatedSourcesTableBody');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Âä†ËΩΩÂ§±Ë¥•</td></tr>';
        }
      }
    }

    // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®ÔºàÁî®‰∫éÊ†áËÆ∞Â∑≤ËÆ¢ÈòÖÔºâ
    async function loadUserSubscriptionsForCurated() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          headers: getHeaders()
        });
        const result = await response.json();
        
        if (result.success) {
          userSubscriptionsForCurated = result.data || [];
        }
      } catch (error) {
        console.error('Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂ§±Ë¥•:', error);
      }
    }

    // Ê∏≤ÊüìÁªüËÆ°‰ø°ÊÅØ
    function renderCuratedSourcesStats(stats) {
      const statsEl = document.getElementById('curatedSourcesStats');
      if (!statsEl || !stats) return;
      
      statsEl.innerHTML = `
        <div class="stat-card">
          <h3>${curatedSources.length}</h3>
          <p>ÊÄª‰ø°ÊÅØÊ∫êÊï∞</p>
        </div>
        <div class="stat-card">
          <h3>${Object.keys(stats.byType || {}).length}</h3>
          <p>‰ø°ÊÅØÊ∫êÁ±ªÂûã</p>
        </div>
        <div class="stat-card">
          <h3>${stats.byRegion['ÂõΩÂÜÖ'] || 0}</h3>
          <p>ÂõΩÂÜÖ‰ø°ÊÅØÊ∫ê</p>
        </div>
        <div class="stat-card">
          <h3>${stats.byRegion['ÂõΩÂ§ñ'] || 0}</h3>
          <p>ÂõΩÂ§ñ‰ø°ÊÅØÊ∫ê</p>
              </div>
            `;
    }

    // Ê∏≤ÊüìÁ≠õÈÄâÂô®ÈÄâÈ°π
    function renderCuratedSourcesFilters(stats) {
      // Á±ªÂûãÁ≠õÈÄâÂô®
      const typeSelect = document.getElementById('filterType');
      if (typeSelect) {
        const types = Object.keys(stats.byType || {}).sort();
        typeSelect.innerHTML = '<option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>' + 
          types.map(type => `<option value="${escapeHtml(type)}">${escapeHtml(type)} (${stats.byType[type]})</option>`).join('');
      }
      
      // ÂàÜÁ±ªÁ≠õÈÄâÂô®
      const categorySelect = document.getElementById('filterCategory');
      if (categorySelect) {
        const categories = Object.keys(stats.byCategory || {}).sort();
        categorySelect.innerHTML = '<option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>' + 
          categories.map(cat => `<option value="${escapeHtml(cat)}">${escapeHtml(cat)} (${stats.byCategory[cat]})</option>`).join('');
      }
    }

    // Á≠õÈÄâÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    function filterCuratedSources() {
      const typeFilter = document.getElementById('filterType')?.value || '';
      const categoryFilter = document.getElementById('filterCategory')?.value || '';
      const regionFilter = document.getElementById('filterRegion')?.value || '';
      const searchKeyword = (document.getElementById('searchCuratedSources')?.value || '').trim().toLowerCase();
      
      filteredCuratedSources = curatedSources.filter(source => {
        // Á±ªÂûãÁ≠õÈÄâ
        if (typeFilter && source.sourceType !== typeFilter) return false;
        // ÂàÜÁ±ªÁ≠õÈÄâ
        if (categoryFilter && source.category !== categoryFilter) return false;
        // Âú∞Âå∫Á≠õÈÄâ
        if (regionFilter && source.region !== regionFilter) return false;
        // ÂÖ≥ÈîÆËØçÊêúÁ¥¢ÔºàÂåπÈÖçÂêçÁß∞„ÄÅURL„ÄÅÊèèËø∞Ôºâ
          if (searchKeyword) {
          const nameMatch = (source.sourceName || '').toLowerCase().includes(searchKeyword);
          const urlMatch = (source.sourceUrl || '').toLowerCase().includes(searchKeyword);
          const descMatch = (source.description || '').toLowerCase().includes(searchKeyword);
          const categoryMatch = (source.category || '').toLowerCase().includes(searchKeyword);
          if (!nameMatch && !urlMatch && !descMatch && !categoryMatch) return false;
        }
        return true;
      });
      
      renderCuratedSourcesTable();
    }

    // Ê∏≤ÊüìÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êË°®Ê†º
    function renderCuratedSourcesTable() {
      const tbody = document.getElementById('curatedSourcesTableBody');
      const countEl = document.getElementById('curatedSourcesFilteredCount');
      
      if (!tbody) return;
      
      if (filteredCuratedSources.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Ê≤°ÊúâÂåπÈÖçÁöÑ‰ø°ÊÅØÊ∫ê</td></tr>';
        if (countEl) countEl.textContent = '';
        return;
      }
      
      if (countEl) {
        countEl.textContent = `ÊòæÁ§∫ ${filteredCuratedSources.length} / ÂÖ± ${curatedSources.length} ‰∏™‰ø°ÊÅØÊ∫ê`;
      }
      
      tbody.innerHTML = filteredCuratedSources.map((source, index) => {
        const isSubscribed = userSubscriptionsForCurated.some(sub => 
          sub.source_name === source.sourceName && sub.source_url === source.sourceUrl
        );
        
        const regionClass = source.region === 'ÂõΩÂÜÖ' ? 'region-domestic' : 'region-foreign';
        
        return `
          <tr>
            <td>
              <input type="checkbox" class="curated-source-checkbox" 
                     data-index="${index}" 
                     data-source='${escapeHtml(JSON.stringify(source))}'
                     ${isSubscribed ? 'checked disabled' : ''}>
            </td>
            <td>
              <div class="curated-source-name">${escapeHtml(source.sourceName)}</div>
              <div class="curated-source-url" title="${escapeHtml(source.sourceUrl)}">${escapeHtml(source.sourceUrl)}</div>
            </td>
            <td>
              <span class="curated-source-type">${escapeHtml(source.sourceType || 'rss')}</span>
            </td>
            <td>
              <span class="curated-source-region ${regionClass}">${escapeHtml(source.region || 'Êú™Áü•')}</span>
            </td>
            <td>
              <span class="curated-source-category">${escapeHtml(source.category || 'Êú™ÂàÜÁ±ª')}</span>
            </td>
            <td class="curated-source-description" title="${escapeHtml(source.description || '')}">
              ${escapeHtml((source.description || '').substring(0, 50))}${(source.description || '').length > 50 ? '...' : ''}
            </td>
          </tr>
        `;
      }).join('');
    }

    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    function toggleSelectAllCurated() {
      const selectAll = document.getElementById('selectAllCurated');
      const selectAllHeader = document.getElementById('selectAllCuratedHeader');
      const checkboxes = document.querySelectorAll('.curated-source-checkbox:not(:disabled)');
      
      const isChecked = (selectAll && selectAll.checked) || (selectAllHeader && selectAllHeader.checked);
      checkboxes.forEach(cb => cb.checked = isChecked);
      
      // ÂêåÊ≠•‰∏§‰∏™ÂÖ®ÈÄâÊåâÈíÆ
      if (selectAll) selectAll.checked = isChecked;
      if (selectAllHeader) selectAllHeader.checked = isChecked;
    }

    // ËÆ¢ÈòÖÈÄâ‰∏≠ÁöÑÂÜÖÁΩÆ‰ø°ÊÅØÊ∫ê
    async function subscribeSelectedCurated() {
      const checkboxes = document.querySelectorAll('.curated-source-checkbox:checked:not(:disabled)');
      
      if (checkboxes.length === 0) {
        showMessage('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅËÆ¢ÈòÖÁöÑ‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }
      
      // Âä†ËΩΩÁî®Êà∑‰∏ªÈ¢òÂàóË°®
      let topics = [];
      try {
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const topicsResult = await topicsResponse.json();
        
        if (topicsResult.success && topicsResult.data && topicsResult.data.length > 0) {
          topics = topicsResult.data;
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®Â§±Ë¥•:', error);
      }
      
      // Â¶ÇÊûúÊ≤°Êúâ‰∏ªÈ¢òÔºåÊèêÁ§∫Áî®Êà∑ÂÖàÂàõÂª∫‰∏ªÈ¢ò
      if (topics.length === 0) {
        showMessage('ËØ∑ÂÖàÂàõÂª∫Ëá≥Â∞ë‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁÑ∂ÂêéÂÜçËÆ¢ÈòÖ‰ø°ÊÅØÊ∫ê', 'error');
        // ÂàáÊç¢Âà∞ËÆ¢ÈòÖÁÆ°ÁêÜÈ°µÈù¢ÔºåËÆ©Áî®Êà∑ÂàõÂª∫‰∏ªÈ¢ò
        switchPage('subscriptions');
        return;
      }
      
      // Â¶ÇÊûúÂè™Êúâ‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁõ¥Êé•‰ΩøÁî®ËØ•‰∏ªÈ¢ò
      let selectedTopic = null;
      if (topics.length === 1) {
        selectedTopic = topics[0].topic_keywords;
          } else {
        // Â¶ÇÊûúÊúâÂ§ö‰∏™‰∏ªÈ¢òÔºåËÆ©Áî®Êà∑ÈÄâÊã©Ôºà‰ΩøÁî® Promise ÂåÖË£Ö promptÔºâ
        const topicList = topics.map((t, i) => `${i + 1}. ${t.topic_keywords}`).join('\n');
        const userInput = prompt(`ËØ∑ÈÄâÊã©Ë¶ÅÂÖ≥ËÅîÁöÑ‰∏ªÈ¢òÔºàËæìÂÖ•‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºâÔºö\n\nÂèØÁî®‰∏ªÈ¢òÔºö\n${topicList}`);
        
        if (!userInput || !userInput.trim()) {
          showMessage('Â∑≤ÂèñÊ∂àËÆ¢ÈòÖ', 'info');
          return;
        }
        
        // È™åËØÅÁî®Êà∑ËæìÂÖ•ÁöÑ‰∏ªÈ¢òÊòØÂê¶Â≠òÂú®
        const matchedTopic = topics.find(t => t.topic_keywords === userInput.trim());
        if (!matchedTopic) {
          showMessage('Êó†ÊïàÁöÑ‰∏ªÈ¢òÔºåËØ∑ÈÄâÊã©ÂàóË°®‰∏≠ÁöÑ‰∏ªÈ¢ò', 'error');
          return;
        }
        
        selectedTopic = matchedTopic.topic_keywords;
      }
      
      // ÊûÑÂª∫ËÆ¢ÈòÖÊï∞ÊçÆÔºåÂåÖÂê´ topicKeywords
      const subscriptions = Array.from(checkboxes).map(cb => {
        const source = JSON.parse(cb.getAttribute('data-source'));
        return {
          sourceName: source.sourceName,
          sourceUrl: source.sourceUrl,
          sourceType: source.sourceType || 'rss',
          category: source.category || 'Êú™ÂàÜÁ±ª',
          description: source.description || '',
          region: source.region || 'ÂõΩÂ§ñ',
          topicKeywords: selectedTopic
        };
      });
      
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüËÆ¢ÈòÖ ${subscriptions.length} ‰∏™‰ø°ÊÅØÊ∫êÂà∞‰∏ªÈ¢ò"${selectedTopic}"`, 'success');
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®ÂíåÂÜÖÁΩÆ‰ø°ÊÅØÊ∫êË°®Ê†º
          await loadUserSubscriptions();
          await loadUserSubscriptionsForCurated();
          renderCuratedSourcesTable();
          // ÂèñÊ∂àÂÖ®ÈÄâ
          const selectAll = document.getElementById('selectAllCurated');
          const selectAllHeader = document.getElementById('selectAllCuratedHeader');
          if (selectAll) selectAll.checked = false;
          if (selectAllHeader) selectAllHeader.checked = false;
        } else {
          showMessage(result.message || 'ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        showMessage('ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      }
    }

    // Â§ÑÁêÜÈ°µÈù¢Â∫ïÈÉ®ÁöÑÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫ê
    async function handleManualAddSourceGlobal() {
      const sourceNameInput = document.getElementById('manualSourceNameGlobal');
      const sourceUrlInput = document.getElementById('manualSourceUrlGlobal');
      const addBtn = document.getElementById('manualAddBtnGlobal');
      
      if (!sourceNameInput || !sourceUrlInput || !addBtn) {
        showMessage('Êâæ‰∏çÂà∞ËæìÂÖ•Ê°Ü', 'error');
        return;
      }
      
      const sourceName = sourceNameInput.value.trim();
      const sourceUrl = sourceUrlInput.value.trim();
      
      if (!sourceName) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êÂêçÁß∞', 'error');
        sourceNameInput.focus();
        return;
      }
      
      if (!sourceUrl) {
        showMessage('ËØ∑ËæìÂÖ•‰ø°ÊÅØÊ∫êURL', 'error');
        sourceUrlInput.focus();
        return;
      }
      
      // Ëé∑ÂèñÁî®Êà∑‰∏ªÈ¢òÂàóË°®ÔºåËá™Âä®‰ΩøÁî®Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      let topics = [];
      try {
        const topicsResponse = await fetch(`${API_BASE_URL}/user/topics`, {
          headers: getHeaders(),
          cache: 'no-cache'
        });
        const topicsResult = await topicsResponse.json();
        
        if (topicsResult.success && topicsResult.data && topicsResult.data.length > 0) {
          topics = topicsResult.data;
        }
      } catch (error) {
        console.error('Âä†ËΩΩ‰∏ªÈ¢òÂàóË°®Â§±Ë¥•:', error);
      }
      
      if (topics.length === 0) {
        showMessage('ËØ∑ÂÖàÂàõÂª∫Ëá≥Â∞ë‰∏Ä‰∏™‰∏ªÈ¢òÔºåÁÑ∂ÂêéÂÜçÊ∑ªÂä†‰ø°ÊÅØÊ∫ê', 'error');
        return;
      }
      
      // Ëá™Âä®‰ΩøÁî®Á¨¨‰∏Ä‰∏™‰∏ªÈ¢ò
      const topicKeywords = topics[0].topic_keywords;
      
      // Á¶ÅÁî®ÊåâÈíÆ
      addBtn.disabled = true;
      addBtn.textContent = 'Ê∑ªÂä†‰∏≠...';
      
      try {
        // Âà§Êñ≠‰ø°ÊÅØÊ∫êÁ±ªÂûã
        let sourceType = 'rss';
        const urlLower = sourceUrl.toLowerCase();
        if (!urlLower.includes('rss') && !urlLower.includes('feed') && !urlLower.includes('.xml') && !urlLower.includes('atom')) {
          sourceType = 'blog';
        }
        
        const subscriptionData = {
          sourceName: sourceName,
          sourceUrl: sourceUrl,
          sourceType: sourceType,
          topicKeywords: topicKeywords
        };
        
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify({ subscriptions: [subscriptionData] })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage(`ÊàêÂäüÊ∑ªÂä†Âπ∂ËÆ¢ÈòÖ‰ø°ÊÅØÊ∫êÔºö${sourceName}`, 'success');
          
          // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
          sourceNameInput.value = '';
          sourceUrlInput.value = '';
          
          // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÈòÖÂàóË°®
          await loadUserSubscriptions();
          
          // Âà∑Êñ∞Â∑≤Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
          await loadManualAddedSources();
          
          // Â¶ÇÊûúÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æÂ∑≤Âä†ËΩΩÔºåÂà∑Êñ∞ÂÆÉ‰ª¨
          const articlesTopicsTabsHeader = document.getElementById('articlesTopicsTabsHeader');
          if (articlesTopicsTabsHeader && articlesTopicsTabsHeader.children.length > 0) {
            console.log('üìö ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂêéÔºåÂà∑Êñ∞ÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ...');
            await loadArticlesTopicsTabs();
          }
        } else {
          showMessage(result.message || 'Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('ÊâãÂä®Ê∑ªÂä†‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Ê∑ªÂä†ËÆ¢ÈòÖÂ§±Ë¥•: ' + error.message, 'error');
      } finally {
        addBtn.disabled = false;
        addBtn.textContent = 'Ê∑ªÂä†Âπ∂ËÆ¢ÈòÖ';
      }
    }

    // Âä†ËΩΩÂπ∂ÊòæÁ§∫ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
    async function loadManualAddedSources() {
      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions`, {
          headers: getHeaders()
        });
        const result = await response.json();

        const contentEl = document.getElementById('manualAddedSourcesContent');
        if (!contentEl) return;

        if (result.success && result.data && result.data.length > 0) {
          // ÊåâÂàõÂª∫Êó∂Èó¥ÂÄíÂ∫èÊéíÂàó
          const subscriptions = result.data.sort((a, b) => {
            const dateA = new Date(a.created_at || 0);
            const dateB = new Date(b.created_at || 0);
            return dateB - dateA;
          });

          contentEl.innerHTML = `
            <table style="width: 100%; border-collapse: collapse; margin-top: 12px;">
              <thead>
                <tr style="background-color: #f8f9fa; border-bottom: 2px solid #ddd;">
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">‰ø°ÊÅØÊ∫êÂêçÁß∞</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">URL</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">Á±ªÂûã</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">ÂÖ≥ËÅî‰∏ªÈ¢ò</th>
                  <th style="padding: 10px; text-align: left; font-size: 13px; color: #666;">Êìç‰Ωú</th>
                </tr>
              </thead>
              <tbody>
                ${subscriptions.map(sub => `
                  <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px; font-weight: 500; color: #333;">${escapeHtml(sub.source_name)}</td>
                    <td style="padding: 10px;">
                      <a href="${escapeHtml(sub.source_url)}" target="_blank" style="color: #8B5CF6; text-decoration: none; font-size: 12px; word-break: break-all;" title="${escapeHtml(sub.source_url)}">
                        ${escapeHtml(sub.source_url.length > 50 ? sub.source_url.substring(0, 50) + '...' : sub.source_url)}
                      </a>
                    </td>
                    <td style="padding: 10px;">
                      <span style="padding: 4px 8px; background-color: #e3f2fd; border-radius: 4px; font-size: 12px; color: #1976d2;">
                        ${escapeHtml(sub.source_type || 'rss')}
                      </span>
                    </td>
                    <td style="padding: 10px; font-size: 13px; color: #666;">${escapeHtml(sub.topic_keywords || 'Êú™Áü•')}</td>
                    <td style="padding: 10px;">
                      <button onclick="removeManualSource('${escapeHtml(sub.source_name)}', '${escapeHtml(sub.topic_keywords || '')}')" style="padding: 4px 12px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        Âà†Èô§
                      </button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
      } else {
          contentEl.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ÊöÇÊó†ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê</p>';
        }
      } catch (error) {
        console.error('Âä†ËΩΩÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        const contentEl = document.getElementById('manualAddedSourcesContent');
        if (contentEl) {
          contentEl.innerHTML = '<p style="color: #f44336; text-align: center; padding: 20px;">Âä†ËΩΩÂ§±Ë¥•</p>';
        }
      }
    }

    // Âà†Èô§ÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫ê
    async function removeManualSource(sourceName, topicKeywords) {
      if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§‰ø°ÊÅØÊ∫ê"${sourceName}"ÂêóÔºü`)) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/user/subscriptions/${encodeURIComponent(sourceName)}?topicKeywords=${encodeURIComponent(topicKeywords)}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        const result = await response.json();

        if (result.success) {
          showMessage('Âà†Èô§ÊàêÂäü', 'success');
          await loadManualAddedSources();
          await loadUserSubscriptions();
        } else {
          showMessage(result.message || 'Âà†Èô§Â§±Ë¥•', 'error');
        }
      } catch (error) {
        console.error('Âà†Èô§‰ø°ÊÅØÊ∫êÂ§±Ë¥•:', error);
        showMessage('Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
      }
    }

    // È°µÈù¢Âä†ËΩΩÊó∂
    window.onload = async function() {
      await initUser();
      await loadTopics();
      await loadUserSubscriptions(); // Âä†ËΩΩÁî®Êà∑ËÆ¢ÈòÖÂàóË°®
      await loadAllRecommendationHistory(); // Âä†ËΩΩÊâÄÊúâÊé®ËçêÂéÜÂè≤
      await loadArticlesTopicsTabs(); // Âä†ËΩΩÊñáÁ´†ÈòÖËØªÈ°µÈù¢ÁöÑ‰∏ªÈ¢òÈ°µÁ≠æ
      await loadArticles(); // ‰øùÁïôÂéüÊúâÁöÑloadArticlesÁî®‰∫éÂÖºÂÆπ
      await loadRefreshStatus();
      await loadManualAddedSources(); // Âä†ËΩΩÊâãÂä®Ê∑ªÂä†ÁöÑ‰ø°ÊÅØÊ∫êÂàóË°®
      startArticlesAutoRefresh();
      
      // Â§ÑÁêÜ URL hash ÂØºËà™
      const hash = window.location.hash.substring(1);
      if (hash === 'guide' || hash === 'features') {
        switchPage(hash);
      } else {
        // ÊÅ¢Â§çÈ°µÈù¢Áä∂ÊÄÅ
        const savedPage = localStorage.getItem('dashboardCurrentPage');
        const savedArticleId = localStorage.getItem('dashboardViewingArticleId');
        const savedTopicIndex = localStorage.getItem('dashboardCurrentTopicIndex');
        
        // ÊúâÊïàÁöÑÈ°µÈù¢ÂàóË°®
        const validPages = ['subscriptions', 'articles', 'guide', 'features'];
        
        if (savedPage && validPages.includes(savedPage)) {
        // ÂàáÊç¢Âà∞‰øùÂ≠òÁöÑÈ°µÈù¢
        switchPage(savedPage);
        
        // Â¶ÇÊûúÊòØÂú®ÊñáÁ´†ÈòÖËØªÈ°µÈù¢Ôºå‰∏î‰øùÂ≠ò‰∫ÜÊñáÁ´†IDÔºåÂàôÊÅ¢Â§çÊñáÁ´†ËØ¶ÊÉÖ
        if (savedPage === 'articles' && savedArticleId) {
          // ÊÅ¢Â§ç‰∏ªÈ¢òÈ°µÁ≠æÁ¥¢Âºï
          if (savedTopicIndex) {
            const topicIndex = parseInt(savedTopicIndex, 10);
            window.currentArticlesTopicIndex = topicIndex;
            switchArticlesTopicTab(topicIndex);
          }
          
          // Á≠âÂæÖÊñáÁ´†ÂàóË°®Âä†ËΩΩÂÆåÊàêÂêéÂÜçÊòæÁ§∫ÊñáÁ´†ËØ¶ÊÉÖ
          setTimeout(async () => {
            try {
              await viewArticle(parseInt(savedArticleId, 10));
            } catch (error) {
              console.error('ÊÅ¢Â§çÊñáÁ´†ËØ¶ÊÉÖÂ§±Ë¥•:', error);
              // Â¶ÇÊûúÊñáÁ´†‰∏çÂ≠òÂú®ÊàñÂä†ËΩΩÂ§±Ë¥•ÔºåÊ∏ÖÈô§‰øùÂ≠òÁöÑÁä∂ÊÄÅ
              localStorage.removeItem('dashboardViewingArticleId');
            }
          }, 800);
        }
      }
      }
    };
  </script>
</body>
</html>
